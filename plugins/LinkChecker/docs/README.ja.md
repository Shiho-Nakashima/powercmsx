# LinkCheckerプラグイン

## 概要

ウェブサイトのリンク切れをチェックする機能を提供します。

- 指定した曜日・時刻の定期実行タスク時にリンクチェックしてメールで通知
- 任意のタイミングで管理画面からリンクチェックを実行

## 環境変数

- linkchecker\_parallel : 外部リンクチェックの並列処理数を指定します。初期値は15です。
- linkchecker\_retry\_outlink : 外部リンクのチェック時に HEADリクエストがエラーになった時に GETリクエストを送信して再チェックします。初期値は falseです。
- linkchecker\_open\_external : リンクチェックを別ウィンドウで開きます。初期値は trueです。
- linkchecker\_worker\_async : スケジュールタスクでのリンクチェックを worker\.php とは別プロセスで行います。初期値は trueです。
- linkchecker\_max\_exec\_time : 最大実行時間を秒で指定します。初期値は 36000\(10時間\)です。
- linkchecker\_print\_state : 進捗をリアルタイムに都度表示します。初期値は trueです。

## プラグイン設定

- すべてのスペースを対象に含める\(システムスコープのみ\) : システム・スペースを含みすべてのリンクチェックを行います。
- スコープの区切り文字 : すべてのスペースを対象に含める設定のある時、メール中でスコープの区切りに挿入する文字列を登録します。
- エラーのみを報告する : リンク切れしていないURLをレポートから除外し、エラーのみを報告します。
- タスクを実行する曜日 : リンクチェックしてメールで通知する曜日を指定します。
- 実行時刻 : 指定時刻を過ぎたタスクの実行時にリンクチェックを実行します。実行されるのは1日に1回のみです。
- メールのFrom : 省略時はシステムのメールアドレスが利用されます。
- メールのTo : 省略時はメールは送信されません。
- メールの件名 : テンプレートタグが利用可能です。
- メールの本文 : テンプレートタグが利用可能です。
- メールフッタ : メール本文に追加するテキスト。テンプレートタグが利用可能です。
- HTTP認証 : HTTP認証が有効な時、ユーザー名とパスワードを指定します。内部リンクのみで有効です\(※\)。
- Digest認証 : Basic認証ではなく Digest認証を利用する場合にチェックします。
- メンバー : Membersプラグインによる会員サイトのログイン Cookieを追加する時に指定します\(※\)。
- ダイナミック・パブリッシングのページを対象にする : 動的ページをビルドしてリンクチェックします。
- 外部リンクをチェックする : 外部リンクをチェック対象にします。処理に時間を要することがあります。

※ PowerCMS Xが管理する URLへのチェックについてはHTTP通信を行わずにローカルディスク上のファイルをチェックします。このため、内部リンクチェックには Basic認証やメンバーの指定は不要です。Basic認証とメンバーの Cookie はPowerCMS X 管理外のファイルへのリンクチェックの際に利用されます。

### メールのビルド時にセットされる変数

- app\_name : アプリ名・スペース名。
- broken\_links : リンク切れの数。
- total\_error : エラーのあったページ数。
- check\_pages : チェックしたページ数。
- results : 結果の配列。\_\_key\_\_ に URLと管理画面URL、\_\_value\_\_には、問題がない時「OK」、解析に失敗した時「ERROR」、リンク切れがあったときはURLの配列となります。

## 定期実行タスクでのリンクチェックの実行

以下の条件を満たす時、定期実行タスクでリンクチェックを行い、指定したメールアドレスにメールを送信します。

- スコープのプラグイン設定で、「メールのTo」「メールの件名」の指定のある時
- タスクを実行する曜日に該当する日、実行時刻を過ぎて定期実行タスクが実行された時、その日にチェックが行われていない時に1回のみ実行されます

## 管理画面からのリンクチェックの実行

- プラグインを有効化するとロールに「リンクチェック」権限が追加され、権限を有するユーザーはリンクチェックを実行できます。
- 「ツール」メニューから「リンクチェック」を実行します。
- 実行中のユーザーがオブジェクトに対する編集権限がない時、編集画面へのリンクは表示されません。
