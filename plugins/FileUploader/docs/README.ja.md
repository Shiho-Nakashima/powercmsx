# FileUploaderプラグイン

## 概要

ファイルアップロード機能を提供します。  
アセットや添付ファイル、バイナリカラムとは異なり、データベースのバイナリ型カラムにデータを格納しません。  
設定に依存せずに自由なパス名・ファイル名で最大 2GBまでの大きなファイルをアップロードできます。

## 設定

プラグインを有効化し、スキーマ管理の画面からモデル「upload\_file」を選択してアップグレードします。
このプラグインの利用にあたっての特別な設定は必要ありませんが、大きなサイズのファイルをアップロードするためには、以下の PHP コア設定ディレクティブを大きくする必要があります。

- [upload\_max\_filesize](https://www.php.net/manual/ini.core.php#ini.upload-max-filesize)
  - アップロードで想定されるファイルサイズよりも大きくする必要があります。
- [post\_max\_size](https://www.php.net/manual/ini.core.php#ini.post-max-size)
  - upload\_max\_filesize よりも大きくする必要があります。
- [memory\_limit](https://www.php.net/manual/ini.core.php#ini.memory-limit)
  - post\_max\_size よりも大きくする必要があります。

## 環境変数

- fileuploader\_backup : support ディレクトリ配下にアップロードしたファイルのバックアップを保存します。初期値は `false` です。
- fileuploader\_upload\_size\_limit : アップロードを許可するファイルの容量をバイト数で指定します。初期値は 2 GiB の `2147483648` です。
- fileuploader\_list\_video\_thumb": VideoCaptionsプラグインで動画のサムネイルを作成する設定の時、trueとすることで一覧画面に動画のサムネイルを表示します。初期値は falseです。

## 利用方法

このプラグインにより、各スコープで歯車アイコンのメニューに項目「ファイル」が追加されます。
このメニュー項目「ファイル」から、ファイルを一覧したり、新しいファイルをアップロードしたりすることが可能です。
新しいファイルをアップロードするときは、最初に [ファイル] 欄でローカルからファイルを選択すると、ラベルなどほかの項目が選択したファイルから自動的に入力されます。

### テンプレート・タグ

一般的なモデルのブロックループタグ、ファンクションタグが利用できます。  
このプラグインではバイナリ型のカラムにデータを格納しませんが、ファイルが画像の時、assetthumbnailurlタグに name=file_path を指定してサムネイル画像を出力することができます。

例 : `<mt:assetthumbnailurl name="file_path" height="250" square="1"/>`

## 制限事項

- データベースのバックアップとは別にアップロードされた実ファイルのバックアップが必要となります。データベースからファイルを復元することはできません。
- データのエクスポート&インポートではファイルをアップロードできません。
- システムやスペースの「サイトURL」「サイト・パス」を変更してもURLやパスは変更されず、ファイルは移動されません。
- ファイル名に拡張子が無いファイルをアップロードすることはできません。
- MIMEタイプはアップロード時のファイル拡張子によって決められ、実際とは異なることがあります。
- MIMEタイプを後から変更することはできません。
