# DynamicCachingプラグイン

## 概要

動的コンテンツをキャッシュします。

### 環境変数と初期値

        "dynamiccaching_extensions": ["html", "json"],
        "dynamiccaching_request_methods": ["GET"],
        "dynamiccaching_exclude_logged_in": ["member"],
        "dynamiccaching_cache_with_query": false

- dynamiccaching\_extensions : 対象とする拡張子を配列で指定します。
- dynamiccaching\_request\_methods : 対象とする REQUEST\_METHOD を配列で指定します。
- dynamiccaching\_exclude\_logged\_in : 指定したモデルでログイン済みの時、処理を対象外とします。
- dynamiccaching\_cache\_with\_query : trueを指定するとクエリ付きリクエストをキャッシュします。

### キャッシュが作成される時・利用される時

- 環境変数で指定した条件に拡張子と REQUEST\_METHOD がマッチする時で、指定したモデルでログインしていない時にダイナミック指定のページを閲覧した時
- 上記の条件にマッチして、且つ、リクエストされたURLに「QUERY\_STRING」が指定されていないか、「dynamiccaching\_cache\_with\_query」指定のある時

これらの条件を満たす時、キャッシュが利用され、キャッシュがなければ保存します。

### キャッシュが破棄されるタイミング

- プラグイン「CacheManager」で「アプリケーション・キャッシュ」がリセットされた時
- そのページのオブジェクトが更新された時
- そのページに対して再構築トリガーによる再構築が呼ばれた時 \(※\)

※ このプラグインを有効化すると、URLマップの編集画面で「ファイル出力」が「ダイナミック」の時も再構築トリガーの設定が表示されます。  
※ 「コンテナ」の指定およびプラグイン「RebuildRelations」によるトリガーは有効に作用しません。

#### 設定の例

- ファイル出力が「ダイナミック」のトップページなどの場合、オブジェクトの更新でキャッシュを破棄したいモデルをすべて再構築トリガーに指定してください。
- カテゴリーアーカイブや日付アーカイブで、コンテナが「記事」、ファイル出力が「ダイナミック」の URLマップの場合、再構築トリガーに「記事」を指定します。
- 記事アーカイブ、ファイル出力が「ダイナミック」の URLマップの場合、1つの記事の更新ですべての記事アーカイブのキャッシュをクリアする必要がある時を除き、再構築トリガーに「記事」を指定する必要はありません\(そのページの記事が更新された時にその記事アーカイブのキャッシュが破棄されるため\)。