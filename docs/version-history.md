## 2025\-01\-30

ver.3\.63 / version 2\.763

- \[セキュリティ・アップデート\] Website・Mediaテーマ使用時のコメント投稿時のクロスサイト・スクリプティング、HTMLタグインジェクションの脆弱性を修正しました。
- \[セキュリティ・アップデート\] 管理画面のクロスサイト・スクリプティング、HTMLタグインジェクションの脆弱性を修正しました。
- \[セキュリティ・アップデート\] オープンリダイレクトに関する脆弱性を修正しました。
- \[セキュリティ・アップデート\] アップロードした画像のフォーマットが拡張子と異なる時にエラーとなる様にしました。
- 再構築トリガーやコンテナの関連ページの再構築について、他のプロセスが処理開始以降に当該ページの再構築を行なっていた時は処理をスキップするようにしました。
- RESTfulAPI の「get」「list」「search」メソッドでバイナリカラムを SELECT文から除外するようにしました。
- Prototypeクラスにメソッド「chunk\_upload」を追加して「include/edit/chunk\_upload\.tmpl」を追加しました。
- エラーによってスクリプトが終了した時にエラーログを記録するようにしました。
- プラグイン「HTTPAuth」のプラグイン設定画面に「ドキュメントルートの設定をリセットする」ボタンを追加しました。
- プラグイン「HTMLImporter」からのインポート時、リレーション型のカラムに対応しました。
- DomDocumentを拡張した「lib/Prototype/class\.PTDomDocument\.php」を追加しました。guerySelectorメソッドなどを利用可能になります。
- テンプレート・タグを含まないビューと URLマップのコンパイルチェックを省略するようにしました。
- プラグイン「SearchEstraier」に環境変数「searchestraier\_consider\_headings\(見出しを重みづけに利用する\)」を追加しました。
- プラグイン「SearchEstraier」に環境変数「searchestraier\_use\_weight\(重み付けを有効化\)」「searchestraier\_doc\_weight\(拡張子ごとの重みをJSONで指定\)」「searchestraier\_model\_weight\(モデルごとの重みをJSONで指定\)」を追加しました。
- プラグイン「SimplifiedJapanese」に環境変数「simplifiedjapanese\_reflects\_dates」を追加しました。「ついたち」「ふつか」「とおか」のような日付の読みをふりがなに反映させます。初期値は「true」です。
- プラグイン「SimplifiedJapanese」で 1から12の数字\+月のふりがなを「がつ」にするようにしました。
- プラグイン「SimplifiedJapanese」にRESTfulAPIエンドポイント「get\_furigana\_mapping」を追加しました。テキストとふりがな付きテキストのマッピングを JSON形式で動的に生成して返します。
- 条件タグ「if」「unless」にタグ属性「or」を追加しました。「|」で区切った文字列または配列を指定、いずれかに合致するときにブロックを出力します。
- 環境変数「duplicate\_a\_date」を追加しました。オブジェクトの複製時に「公開日」の値を引き継いで複製します。初期値は trueです。モデルごとに設定するには「duplicate\_a\_entry\_date」のようにモデル名を含んで指定します。false指定の時「公開終了日を指定」「公開終了日」の設定がリセットされます。
- プラグイン「HTMLImporter」でのインポート時、同一URLを上書きする際に、リビジョンを上書きしないようにしました。
- プラグイン「HTMLImporter」の「前処理\(削除\)」「前処理\(置換\)」に単純文字列を指定できるようにしました。
- プラグイン「HTMLImporter」で「htmlimporter\_show\_import\_from」指定のあるとき、ZIPファイルからインポートしたときはインポート後の編集画面に URLを表示しないようにしました。
- オブジェクトのステータス変更後の再構築時に URLオブジェクトをリアルタイムに更新するようにしました。
- 「lib/Html2Text」「lib/CssXPath」を追加しました。
- PTRecommendAPIクラスでコマンド実行時に自分自身を除外するようにして読み込む関連記事を 1件少なくしました。
- スケジュールタスクのログを記録する時、1分以上時間のかかっている処理のログの経過時間を時分秒形式で記録するようにしました。
- 環境変数「optimize\_data\_free」を追加しました。初期値は「5000000」です。MySQLの「data\_free」が指定の値を超えているテーブルに対して、夜間に実行されるスケジュールタスクで「OPTIMIZE TABLE」を実行します。値に「\-1」を指定すると、常にスキップされます。
- 環境変数「optimize\_table\_cnt」を追加しました。初期値は「3」です。実行されるスケジュールタスクで「OPTIMIZE TABLE」を実行する最大テーブル数を指定します。
- プラグイン「NuHtmlChecker」で「script」「style」の「type」属性に関するエラーを無視するようにしました。
- プラグイン「Text2OgImage」で「padding\-top」「padding\-bottom」「ふりがな色」を指定できるようにしました。また、文字数からテキストのサイズを調整する機能を追加しました。
- やさしい日本語エディタにボタン「pt\-ogimage」を追加できるようにしました。選択文字列をプラグイン「Text2OgImage」を利用して画像化します。
- 環境変数「fmgr\_delayed」を廃止しました。
- 「tools/exportCSV\.php」を追加しました。「\-\-file\(拡張子は\.zip\)」「\-\-model」を引数に指定してオブジェクトのエクスポートデータを作成します。
- 「tools/importFromCSV\.php」でCSV/ZIP以外のファイルを指定したときのエラーメッセージにファイル名を追加するようにしました。
- 「cache\_driver」が「Memcached」または「Redis」の時プラグイン「CacheManager」のキャッシュ管理画面で「キャッシュ内のすべてのアイテムを無効にする」を選択可能にしました。
- プラグイン「BannedWords」の設定に「エディタでの修正対象を選択可能にする」を追加しました。チェックボックスでダイアログ内の修正適用箇所を選択して適用できるようになります。
- プラグイン「BannedWords」で「文末以外の副詞を削除する」が効かないケースを修正しました。
- プラグイン「BannedWords」で「文末以外の副詞を削除する」時、直後が「、」の時に直前の単語が重複するケースを修正しました。
- プラグイン「BannedWords」で「時刻を午前午後\+12時間表記に統一する」指定のある時12時台の時刻が適切な表記にならないケースを修正し「午前」を追加するようにしました。
- プラグイン「BannedWords」で同じ文字を含む修正候補が複数ある時、一部の文字が修正されないケースを修正しました。
- プラグイン「BannedWords」で全角数字「０」の修正を取りこぼすケースを修正しました。
- Website・Mediaテーマに同梱されているビュー「\(Furigana\) CSS」を修正しました。ふりがな機能を使用した際に Edge、Chrome でふりがなが親文字と近すぎる問題を修正しました。
- 設問に「集計する」がチェックされているものを含むコンタクトの一覧画面からアクション「CSVエクスポート」「集計する」がエラーになる問題を修正しました。
- Mediaテーマに同梱されているビュー「(Media) Stylesheet」を修正しました。出力ページでふりがなを付けた際にボタンの文字が隠れる場合があるのを修正しました。
- モデルのオプション「ディレクトリ・パス」指定のある時、パスの編集表示指定のある時パス・ベースネーム欄にパス欄を重複表示しないようにしました。また、パス・ベースネーム欄の input要素に placeholderと aria\-labelを追加しました。
- 特定の画像をアップロードした時にサムネイルが正常に生成されないケースを修正しました。
- ステータスカラムのあるモデルについて、削除権限のないユーザーが編集画面をひらいた時に「削除」ボタンが表示される問題を修正しました。
- 環境変数「rebuild\_async」指定時にプロパティ「request\_id」が引き継がれてずプロセス数上限を超えても待機しない問題を修正しました。
- 代替テンプレート「edit\_モデル名」「list\_モデル名」「hierarchy\_モデル名」が使われている時、template\_source / template\_outputコールバックが呼ばれないケースを修正しました。
- プラグイン「PasswordExpired」が有効で、パスワードの有効期限が切れているとき、ログインしているユーザー以外のユーザーの編集画面に警告が出ないようにしました。
- プラグイン「SearchEstraier」のプラグイン設定「タイトルの重み」が正しい「重み」でインデックスに反映されていなかった件を修正しました。
- プラグイン「ComponentBlocks」に同梱のVue\.jsをver\.3\.5\.3に更新しました。
- システム/スペース設定で「リンクURL」に「サイトURL」が含まれているとき、一覧画面の「ビュー」リンクが無効な URL になる問題を修正しました。
- 係り受け解析器「cabocha」を利用しているときにプラグイン「BannedWords」の文末の「ましょう」が意図しない変換結果になるケースを修正しました。
- プラグイン「BannedWords」の漢字レベルの表示ボタンで「固有名詞を含めて評価するにはCtrl\(Command\)キーを押下しながらボタンをクリックしてください。」が正常に動作しない問題を守成しました。
- プラグイン「Keywords」「SimplifiedJapanese」で環境変数に指定のある mecabの辞書を利用していなかった問題を修正しました。
- プラグイン「SingleSignOn」でSAMLドキュメントの署名がない場合に PHP Fatal error となる問題を修正しました。
- プラグイン「VideoCaptions」で管理者以外のユーザーがキャプションのタブ区切りテキストサンプルをダウンロードできない問題を修正しました。
- プラグイン「VideoCaptions」でファイルの編集画面のカードのフォントが適用されないケースを修正し、文字サイズや行送りなどを調整しました。
- プラグイン「Watermark」で透かしの合成時に「conversion from float XX\.XXX to int loses precision」エラーが出る問題を修正しました。
- プラグイン「Watermark」で拡張子が大文字の画像に透かしを合成できない問題を修正しました。
- プラグイン「Theme\_GitHub」を利用してリポジトリ連係機能を利用しているとき、テーマ管理画面で一部のテーマが表示されないケースを修正しました。
- プラグイン「AWS\_CloudFront」で環境変数「aws\_cloudfront\_maxpurge\_per\_once」によってリクエストのパスが「/\*」に纏められたとき、「AWS CloudFront キャッシュの無効化リクエスト送信中にエラーが発生しました\(Your request contains one or more invalid invalidation paths.\)。」エラーがとなり処理が失敗する問題を修正しました。
- プラグイン「AWS\_CloudFront」で環境変数「aws\_cloudfront\_ts\_job」が false のときにもジョブが作成される問題を修正しました。
- 検索機能でリレーションカラムに対して「\_filter\_and\_or\_\[カラム名\]」パラメータを利用できるようになりました。環境変数「filter\_relation\_cols\_and\_or\_compat」を true とすると従前の振る舞いと同等となります。初期値は false です。
- 環境変数「admin\_filter\_relation\_cols\_and\_or」を追加しました。「AND」または「OR」を設定可能で、管理画面での検索でリレーションカラムに対して複数フィルタを設定した際に OR 検索か AND 検索かを指定出来ます。
- 環境変数「cache\_driver」が「Redis」「Memcached」の時ポート番号を省略した時に「Notice: Undefined offset」エラーが出るケースを修正しました。
- 環境変数「cache\_driver」が「Redis」の時、TLS接続をサポートしました。環境変数「memcached\_servers」に「tls://」から始まるアドレスを指定してください。
- PTUtil::sec2hmsで「Implicit conversion from float\-string "\(string\)" to int loses precision」エラーが出るケースを修正しました。
- プラグイン「ImageInfo」でAdobe CMapファイルの読み込みに失敗しPDFのテキスト抽出が上手くいかないケースを修正しました。
- プラグイン「ImageInfo」で PDF\.jsによって抽出したテキストの null文字や不要な改行を取り除くようにしました。
- プラグイン「SearchEstraier」でインデックスのコピーに成功したのちにバックアップへのリネームを行うようにしました。
- プラグイン「SearchEstraier」でインデックスのコピーに失敗した時にエラーログが記録されないケースを修正しました。
- テーマの適用時に「Passing null to parameter \#1 \($haystack\) of type string is deprecated」エラーが出るケースを修正しました。
- 画像やファイルフィールドを必須にした時に必須チェックが効かないケースを修正しました。
- プラグイン「PluginStarter」が提供するプラグインひな形編集画面で追加済のコールバック選択セレクトボックスに「post\_save\_clone」「post\_save\_revision」が含まれない問題を修正しました。
- 「plugins/SearchEstraier/tools/syncCasket\.php」でコピー元のインデックスがない時処理を打ち切ってエラーを記録するようにしました。
- 環境変数「searchestraier\_idx\_backup」指定のある時、syncCasket実行時にコピー元インデックスが存在しなかった時バックアップからコピーを作成するようにしました。
- 「cache\_driver」が「Redis」で環境変数「query\_cache」が trueの時、削除した対象のキャッシュがヒットしてしまう問題を修正しました。
- プラグイン「DocumentSearch」で PDF ファイルを検索対象としているとき、環境変数「documentsearch\_pdf\_filter」が「PHP」の場合にドキュメント冒頭がインデックスに含まれないケースを修正しました。
- JSONに変換できない特定の文字列を含む選択テキストがある時、一部のエディタのボタンなどが正常に動作しないケースを修正しました。
- 条件タグ「ifembedaudio」が利用できない問題を修正しました。
- プラグイン「ImageWebP」のモディファイア「convert2webp」を画像以外の URLに適用した時「1」が出力される問題を修正しました。
- Prototypeクラスの「get\_children」が孫以下の階層のオブジェクトを返せない問題を修正しました。
- 「mt:objecttoresource」「mt:objecttojson」タグを利用したときに「Cannot modify header information」エラーがログに残る問題を修正しました。
- ふりがな機能でふりがな適用時にJavaScriptエラーが発生する場合があった問題を修正しました。
- モデル「設問」のオブジェクトで「値」を指定した場合にフォーム確認画面（エラー画面）で選択項目が選択されない問題を修正しました。
- モデル「設問」のオブジェクトで「オプション」もしくは「値」に引用符が含まれる場合にフォーム確認画面（エラー画面）で選択項目が選択されない問題を修正しました。
- 環境変数「machinetranslator\_bracket\_individual」の初期値がセットされていなかった問題を修正しました。
- 全般設定とモデル「user」「member」の保存時に「language」に不正な値を保存できないようにしました。
- プラグイン「MachineTranslator」ドキュメントの環境変数のスペルミス「machinetranslator\_cacheing」を「machinetranslator\_caching」に修正しました。
- プラグイン「HTMLImporter」で ZIPファイルからインポートしたときにオブジェクトとアセットの関連付けが正しく紐づかないケースを修正しました。
- 「ユーザーをアサイン」「ステータス対応」「有効期限対応」のモデルに「workspace\_id」カラムがないとき、管理者ではないユーザーが一覧画面を表示したときに PDOExceptionエラーがログに残る問題を修正しました。
- プラグイン「SearchEstraier」の「mt:estraiersearch」タグで複数フレーズを検索するとき、環境変数「searchestraier\_force\_mecab」が TRUE だと期待した結果にならない問題を修正しました。
- PTUtil::sec2hmsで「Implicit conversion from float "\(float\)" to int loses precision」エラーが出るケースを修正しました。
- プラグイン「ComponentBlocks」で入力フィールドが単一チェックボックスになる時、初期値が反映されない問題を修正しました。(ただしVue.jsの仕様上、単一チェックボックスの保存値は真偽値になります。)
- フォームの一部エラーメッセージが翻訳されない問題を修正しました。
- オブジェクト編集画面でエラーになると「階層」表示カラムのプライマリ設定が引き継がれない問題を修正しました。
- オブジェクト編集画面でエラーになると「ドロップダウン」表示のリレーション型カラムの値が引き継がれない問題を修正しました。
- 「rebuildFiles\.php」で urlmapping\_ids指定の時条件によって意図したファイルが出力されないケースを修正しました。
- 「rebuildFiles\.php」で URLマップが「手動」になっている URLが出力されないケースを修正しました。
- プラグイン設定画面のダイアログで「リセット」ボタンをクリックした時の確認メッセージの翻訳が漏れているのを修正しました。
- プラグイン「Keywords」が有効な時プラグイン「SearchEstraier」のインデックスに不要なキーワードが含まれてしまうケースを修正しました。
- 環境変数「leave_revisions」指定のある時、オブジェクト削除時にアーカイブが削除されないケースを修正しました。
- オブジェクトのインポート後、テーマの適用後カラム「status」のないオブジェクトが再構築されない問題を修正しました。
- 環境変数「export\_int2label」が true の時、数値だけの値を ID として扱ってしまう問題を修正しました。
- 環境変数「worker\_debug」指定のある時、タスクの実行時間が正確に計算されないケースを修正しました。
- 削除フラグの付いている URLをダイナミック・パブリッシングで表示させようとした時に空白のページが返るケースを修正しました。
- 「translate」モディファイアを指定している時フレーズに「%」を含む時にエラーになる事象を修正しました。
- 環境変数「documentsearch\_textfile\_enable」を追加しました。TRUE を指定するとプラグイン「DocumentSearch」が拡張子「\.txt」を検索対象に選択できます。テキストファイルの文字コードは「UTF-8」もしくは「Shift_JIS」のみをサポートします。

## 2024\-08\-22

ver.3\.621 / version 2\.7621

- PHP8\.0\.0未満のバージョンで 500エラーになるケースを修正しました。

## 2024\-08\-06

ver.3\.62 / version 2\.762

- \[セキュリティ・アップデート\] HOSTヘッダー・インジェクション対策として環境変数「verify\_host」指定のある時\(初期値 true\)初期化時 HOSTヘッダをチェックするようにしました。
- \[セキュリティ・アップデート\] 環境変数「allowed\_domains」(許可するホスト名の配列)を追加しました。ここに指定のあるホスト及びシステムとスペースのサイトURL、リンクURLをホワイトリストとしてチェックします。
- 環境変数「cookie\_samesite」を追加しました。クッキーの「samesite」属性を指定します。初期値は「Strict」です。この環境変数は PHP7\.3以降でのみ有効です。
- プラグイン「TinyMCE」でエディタひな形に「カスタムボタン」を登録できるようになりました。
- 環境変数「unchange\_disp\_upgrade」指定のない時、スキーマアップグレードでカラムのオプションの更新を反映されるようにしました。
- ブロックタグ「mt:grouploop」が「limit」「offset」属性をサポートしました。
- 一覧画面からオブジェクトの表示順を変更した時にログを残すようにしました。
- プラグイン「TinyMCE」のプラグイン設定のツールバーから「insert styleselect」を削除しました。
- RESTfulAPI の「update」メソッドで一部のカラムのみを指定してオブジェクトを更新できるようになりました。
- RESTfulAPI の「insert」メソッドでカラムのデフォルト値がセットされない問題を修正しました。
- 環境変数「path\_upperlower」を「true」で設定している環境で保存済みアセットの拡張子の大文字小文字を変更できないケースを修正しました。
- プラグイン「SearchEstraier」の「plugins/SearchEstraier/tools/syncCasket\.php」の重複起動を防止するようにしました。「searchestraier\_work\_dir」に指定したディレクトリに pidファイルを生成します。
- 管理画面のヘッダに値を挿入するための変数「add\_header\_system」「add\_header\_workspace」を追加しました。
- プラグイン「TinyMCE」のプラグイン設定から「CDNを利用」を削除しました。
- カラムの文字数制限のある時管理画面からのオブジェクト保存時に改行が 2文字としてカウントされる問題を修正しました。
- プラグイン「Members」の「plugins/Members/app/pt-view-members.php」\(ログインメンバーのみにファイルを見せたいときにリライト先に指定するプログラムのサンプル\)をHTTP Rangeリクエスト\(HTTP 範囲リクエスト\)に対応させました。会員サイト内の動画・音声メディアを途中から再生することが可能になります。
- バイナリカラムが複数あるモデルを CSV エクスポートしたとき、バイナリカラムのラベル\(代替テキスト\)が全て同一になってしまう問題を修正しました。
- スペース管理者権限があるユーザーがスペース配下のオブジェクトを編集できない問題を修正しました。
- モデルの保存時に「version\_compare\(\): Passing null to parameter \#1 \($version1\) of type string is deprecated」エラーが出る問題を修正しました。
- インデックスの洗い替え中に「plugins/SearchEstraier/tools/syncCasket\.php」を実行した時に pidファイルが残る問題を修正しました。
- 環境変数「canonicalurl\_compat」が false のとき、ファンクションタグ「mt:canonicalurl」「mt:canonicallink」の「with\_index」属性が機能しない問題を修正しました。
- 環境変数「canonicalurl\_compat」が false のとき、日付ベースアーカイブでファンクションタグ「mt:canonicalurl」「mt:canonicallink」が現在のページの URL を出力しない問題を修正しました。
- ファンクションタグ「mt:canonicalurl」「mt:canonicallink」がパーマリンクを返すとき、コンテキストに影響を受ける問題を修正しました。
- プラグイン「BannedWords」で 半角カナ→全角カナ変換の際、半角カナの濁点が変換対象にならない問題を修正しました。
- グループのオブジェクトに対する削除権限がある時、オブジェクトの編集画面に「削除」ボタンが表示されない問題を修正しました。
- 環境変数「no\_encode\_filename」が falseの時、マルチバイトファイル名の画像が「convert2webp」モディファイアで変換されない問題を修正しました。
- task\_idsを指定して「maintenance\_time」内の処理が実行された時に sessinが保存されて以降の処理がスキップされる問題を修正しました。
- プラグイン「AppProperties」のブラックリストに「cookie\_domain」を追加しました。
- プラグインの「locale」の「ja\.csv」の文字コードを「UTF8」に、改行コードを「LF」に統一しました。
- 複数のリレーション型のカラムのあるモデルを保存した時、意図しないアーカイブが出力されるケースを修正しました。
- プラグイン「HTML\_CodeSniffer」の検証結果に表示される翻訳を修正しました。
- db\-config\.phpが存在し、config\.jsonが存在しない場合にpt\-check\.phpがエラーになる問題を修正しました。
- ファイル名に空白等が含まれる時、プラグイン「AWS\_CloudFront」でキャッシュ無効化リクエスト時に「Your request contains one or more invalid invalidation paths」が発生するのを回避するようにしました。
- プラグイン「HTML\_CodeSniffer」の検証結果に表示される翻訳を修正しました。
- プラグイン「DocumentSearch」プラグインで「Undefined variable $message \(2\) occured」エラーが出るケースを修正しました。
- ブロックタグ「mt:objectloop」をリレーションカラムで絞り込むときも「array\_and\_or」属性に「OR」が指定できるようになりました。
- 条件分岐でURLマップフィールドが空になるURLマップにおいて、ファイルが削除された時にS3からファイルが削除されない問題を修正しました。
- 「worker\_db\_caching」が「false」の時、クラス「PADO」のloadメソッドでID指定で読み込んだオブジェクトをキャッシュしないようにしました。
- MTタグの含まれないビューからファイルをインクルードしている時にHTMLタグの開始文字と終了文字がダミー文字列に置換される問題を修正しました。
- プラグイン「ComponentBlocks」のマルチブロックにおける上下・削除処理、バリデーション処理を改善しました。
- プラグイン「ComponentBlocks」のマルチブロックで、入力したテキストがマウスで選択できない問題を修正しました。
- プラグイン「ComponentBlocks」で、画像を選択後に解除すると必須チェックを通過してしまう問題を修正しました。
- ユーザー設定で操作系ボタンを下部に固定した際にヘッダーのメニュープルダウンが背後に配置される問題を修正しました。

## 2024\-06\-19

ver.3\.61 / version 2\.761

- MySQL8\.0で「SELECT COUNT」文が遅くなるのを回避するため、全件数取得時に「DISTINCT」を指定することで一覧画面の表示速度を改善しました。
- PHP8\.3に対応しました。
- PHP8\.3環境でブロックタグ「mt:for」の属性「increment」「step」に「0」以下の数値が指定されたときエラーになる問題を修正しました。
- ブロックタグ「mt:for」の属性「increment」「step」に「0」以下の数値が指定されたとき、初期値の「1」として扱うようになりました。
- プラグイン「TableOfContents」を追加しました。コンテンツの見出し\(H2〜H6\)タグから目次を自動生成してページ内リンクを設定します。
- プラグイン「EditorDiff」を追加しました。リッチテキストエディタにボタン「差分を表示」を追加します。
- ダッシュボード「アクティビティ」に「エラーログ」を追加しました。
- スペースの編集画面の「名前」欄の下のパーマリンクを画像の URLから「サイトURL」に変更しました。
- 「mt:entriescount」などのカウント関連のタグが属性「unique」「exclude\_ids」に対応しました。
- 一覧画面のアクション「ファイル出力」「URLの再パブリッシュ」「AWS S3へのファイル同期」を「per\_rebuild」の件数ごとに分割処理するようにしました。
- 一覧画面のアクション「ファイル出力」実行後にログを残すようにしました。
- プラグイン「Members」でプロフィール編集、退会処理時にメンバーの更新日をアップデートするようにしました。
- プラグイン管理画面のテーブルのアクティブなプラグインのセルに罫線を追加し、ストライプ状背景を追加して見やすくしました。
- 「tools/encryptDBPassword\.php \-d」または「tools/encryptDBPassword\.php \-\-decrypt」で現在のパスワードを確認できるようになりました。
- PTRecommendAPIクラスの runメソッドの実行時に「pre\_recommend」「pre\_print\_recommend」コールバックを追加しました。
- 環境変数「searchestraier\_reccomend\_inc」を追加しました。レコメンドAPIの処理の開始時に指定のファイルを requireします。
- プラグイン「BannedWords」で文末を敬体に統一するとき、「〜する。」で終わる文章を「〜します。」に揃えるようにしました。
- プラグイン「BannedWords」で文末を敬体に統一するとき、形容詞の基本形に「〜です。」を追加するようにしました。
- プラグイン「BannedWords」の校正支援機能に「\-ty」の扱いを統一\(例「アクセシビリティ」「アクセシビリティー」の統一\)を追加しました。
- 環境変数「viewer\_size\_limit」を追加しました。動的生成でサイズを超えるファイルをメモリに読み込まずに逐次出力します。初期値は「50000000」です。
- プラグイン「AWS\_CloudFront」で無効化リクエストに失敗した時のログにパスとディストリビューションID、メソッド名を残すようにしました。
- PTUtil::get\_extension メソッドが環境変数「path\_upperlower」指定のある時拡張子を小文字に統一しないでそのままの値を返す様にしました。get\_extensionの第二引数に「true」を指定すると、環境変数の指定の有無にかかわらず小文字に統一します。
- 環境変数「path\_upperlower」指定のある時アセットの拡張子が大文字のまま登録できるようになりました。
- プラグイン「UploadUtilities」のアセットとのステータス同期でオブジェクトがリビジョンの時処理をスキップするようにしました。
- プラグイン「AppProperties」有効時「Undefined variable: mecab\_path」エラーがログに残る問題を修正しました。
- プラグイン「AppProperties」のブラックリストに「include\_realtime」を追加しました。
- ふりがな機能で title 要素にふりがなが適用されないように修正しました。
- ユーザーの言語が「英語」の時プラグインのフレーズの一部が日本語化される問題を修正しました。
- CSVエクスポートしたバイナリカラムのラベル\(代替テキスト\)に「,」が含まれる時、インポート時に値が途中で切れる問題を修正しました。
- PHP8\.1環境で「Implicit conversion from float 0\.1 to int loses precision」エラーがログに残る問題を修正しました。
- 一覧画面や公開側の検索画面で日付パラメタが不正な日付の時「Incorrect date value」エラーがログに残って検索に失敗する問題を修正しました。
- インポート&エクスポート機能でエクスポートした ZIPファイルの添付ファイルに CSVファイルが含まれるとき、ファイルのインポートに失敗する問題を修正しました。
- 「sitesync\_staging\_root\_path」「sitesync\_production\_root\_path」の設定の末尾に「/」が含まれるとき、パスがマッチしないケースを修正しました。
- プラグイン「SiteSync」で、重複URLがあって、削除済みのURLが残っているとき同期できない問題を修正しました。
- プラグイン「AWS\_CloudFront」で対応するジョブがない状態でキューが保存されるケースを修正しました。
- プラグイン「SearchEstraier」の翻訳フレーズの誤りを修正しました。
- プラグイン「SearchEstraier」のプラグイン設定「タイトルの重み」を「0\.0」以下に設定したとき、機能を無効化する様になりました。
- プラグイン「SearchEstraier」のプラグイン設定「タイトルの重み」を「1\.0」以上に設定したとき、「1\.0」を設定したものとして振舞う様になりました。
- プラグイン「BannedWords」の校正支援機能で、鉤括弧の中に固有名詞が含まれるときにダミー文字列が残るケースを修正しました。
- プラグイン「BannedWords」の校正支援機能の差分表示部分を太字で表示するようにしました。
- フレーズ「Could not generate Preview URL\.」が翻訳されない問題を修正しました。
- フォームオブジェクトの保存時に、正しいメールアドレスを設定しているにもかかわらず「正しいメールアドレスを入力してください」エラーになるケースを修正しました。
- 管理画面でプロフィールの編集画面をスマートフォンで表示した場合にクイック編集ボタンの表示が崩れる問題を修正しました。
- 条件タグ「mt:if」および「mt:unless」の「name」属性値に連想配列を「\.」を含む形式で指定したとき、値が空文字として評価される問題を修正しました。
- URLマップの中で「mt:breadcrumbs」ブロックタグを利用しているとき、無限ループになるケースを修正しました。
- テーマを適用したサイトでページ内アンカーをクリックした時、ヘッダに見出しが隠れる問題を修正しました。
- プラグイン「ComponentBlocks」のブロックでリレーションフィールドを作成した場合、該当フィールドのアイテム選択ダイアログ内で特定の操作を行うとアイテムが選択できなくなる問題を修正しました。
- 数値型のリレーションのコンテキストを対象オブジェクトと同じモデルのループの中でセットしているタグ内で、プレビュー中のオブジェクトのコンテキストが優先される問題を修正しました。
- プラグイン「ExternalPreview」のスペースのプラグイン設定「ベースURL」にシステムのサイトURLが表示される問題を修正しました。これは表示の問題で動作に変更はありません。
- フォームの設問タイプのドロップダウンで「隠し項目」が非表示になっていたのを修正しました。
- プラグイン「ExternalPreview」のシステムのプラグイン設定「ベースURL」にリンクURLを設定しているとき、外部プレビュー時にサイトURLへ遷移する問題を修正しました。
- プラグイン「DocumentSearch」を有効化しているとき、「Trying to access array offset on value of type null \(8\)」エラーが出る問題を修正しました。
- プラグイン「DocumentSearch」でファイルがインデックスに追加されない問題を修正しました。
- プラグイン「SimplifiedJapanese」が有効化されていない環境でWebsite・Mediaテーマを適用するとエラーが出る問題を修正しました。
- プラグイン「AxeRunner」でChrome for Linuxを利用できるようにしました。
- プラグイン「AxeRunner」で利用するNode.jsアプリのpackage-lock.jsonを更新しました。npm iを実行して依存モジュールを更新してください。
- 一覧画面の「アクション」で再構築を必要とする処理を行った時、件数が「per\_rebuild」より多いと処理が最後まで実行されず、システムのダッシュボードにリダイレクトされる問題を修正しました。
- アセット詳細画面の右カラム「利用状況」にアセットを利用しているオブジェクトが表示されないケースを修正しました。
- モディファイア「from\_json」に配列が渡された時に落ちるケースを修正しました。
- クラス PADOBaseModel の「get\_by\_key」メソッドが常に新規インスタンスを返すように変更しました。
- CSV インポート機能でページをインポートするとき、存在しないフォルダを紐づけていると、2階層目以降のフォルダが作成されない問題を修正しました。
- プラグイン「HTML\_CodeSniffer」で子要素に「aria\-label」属性指定のあるボタンでエラーになるケースを修正しました。
- プラグイン「SearchEstraier」で検索インデックスのコピー時にSimpleXMLElement::\_\_construct()のエラーが出る問題を修正しました。
- 「exif\_read\_data」関数で「File not supported」エラーが出るケースを修正しました。
- プラグイン「AWS\_S3」でバケットにあるファイルの削除が成功したにもかかわらずエラーとして記録され、キューで繰り返し削除を試みる問題を修正しました。
- 「Media」テーマでトップページのリンクでない画像部分でカーソルが「pointer」になる問題を修正しました。
- プラグインを初めて有効化する際に「version\_compare\(\): Passing null to parameter #2」エラーが出る問題を修正しました。
- 条件タグ「mt:ifformisopen」の判定を『フォームのステータスが終了以外で、コンタクト数の上限に達していない時』に内容を出力するように変更しました。これによりプラグイン「ExternalPreview」プラグイン「LivePreview」でステータスが公開ではないフォームの表示確認が行えるようになります。環境変数「ifformisopen\_compat」を true とすると従前の振る舞いと同等となります。
- 環境変数「ifformisopen\_compat」を追加しました。true を指定すると条件タグ「mt:ifformisopen」が『フォームのステータスが公開中で、コンタクト数の上限に達していない時』に内容を出力するようになります。
- プラグイン「MTMLReference」のタグ「ifformisopen」のドキュメントを更新しました。
- 環境変数「export\_int2label」指定のある時、CSVインポートで数値型のリレーションカラムの値が正しくセットされないケースを修正しました。
- 環境変数「export\_int2label」指定のある時、CSVインポートで数値型のリレーションカラムにリビジョンのデータがセットされるケースを修正しました。
- ページネーションなどのパラメタ付き URLの時に「mt:furiganajsonurl」の出力が意図通りにならないケースを修正しました。
- URL オブジェクトが所属するスペースとは異なるスペースがコンテキストにセットされて再構築されるケースを修正しました。
- プラグイン「Text2OgImage」の設定ダイアログ内で「text-align」の表示が設定した値にならない問題を修正しました。
- インストール時に作成される設問タイプ「添付ファイル」のテンプレートを、画面遷移時にファイル名を保持するように修正しました。
- プラグイン「ImageInfo」に同梱のpdf.jsの脆弱性に対する対応ため、v4.3.136に更新しました。.mjsファイルがMIMEタイプ「application/javascript」で配信されるようにサーバーの設定を行う必要があります。
- プラグイン「ComponentBlocks」でフィールドと繰り返しフィールドを併用した場合に、必須チェックが効かない問題を修正しました。
- 一部のプラグインを有効化した時に「version\_compare\(\): Passing null to parameter \#1 \($version1\) of type string is deprecated」エラーが出る問題を修正しました。
- RESTfulAPI のエンドポイント「insert」「update」にてオブジェクトを作成・更新するとき、アセットをリレーションしているカラムに対して ID による複数件の紐付けができない問題を修正しました。
- RESTfulAPI のエンドポイント「update」にてアセットを更新できない問題を修正しました。
- 環境変数「searchestraier\_auto\_keywords」に true を指定している時、プラグイン「DocumentSearch」により追加される検索インデックス（「SearchEstraier」プラグインのインデックス）のタイトルに「。」が付いてしまう問題を修正しました。
- プラグイン「PostOnTwitter」でポスト内のURLをリンクURLベースに変更できるようになりました。
- スケジュールタスク「scheduled\_replacement」によるリビジョン差し替えしたログの差分表記が「差し替え前のデータが[+]、差し替え後のデータが[-]」となる問題を修正しました。
- ワークフローで異なる権限グループのユーザーに承認依頼をした時、一覧へ遷移せずにダッシュボードへ遷移する問題を修正しました。
- モデル名\+dateタグに format 属性の指定があるとき、現在日時として扱われるケースを修正しました。
- プラグイン「BannedWords」の構成支援機能利用時に「Passing null to parameter \#1 \($string\) of type string is deprecated」エラーが出るケースを修正しました。
- AWSの EFSなど共有ディスクに「SearchEstraier」プラグインの検索インデックスを置いている時コピー時に検索インデックスが破損する問題を修正しました。
- 「searchestraier\_copy\_sleep」を追加しました。AWSの EFSなど共有ディスクに「SearchEstraier」プラグインの検索インデックスを置いている時インデックスのコピー後に一定時間待ってから処理を続行します。
- アセット詳細画面の右カラム「利用状況」に操作ユーザーが編集権限を持たないオブジェクトの編集画面へのリンクが表示される問題を修正しました。
- プラグイン「HTMLImporter」でのインポート時に「Attempt to read property "length" on bool」エラーが出るケースを修正しました。
- プラグイン「HTMLImporter」の「docs/README\.ja\.md」を削除してウェブサイトのドキュメントへのリンクを追加しました。
- バリデーション「カタカナ」で、文字「ヴ」がエラーにならない様に変更しました。
- 環境変数「validation\_katakana\_unicode」を追加しました。true を指定することで、カタカナのバリデーションルールがUnicode block のカタカナ ( 30A0 ~ 30FF ) に含まれる文字かをチェックするようになります。

## 2024\-03\-15

ver.3\.6 / version 2\.76

フィールド型「画像」「アセット」「ビデオ」から作成したフィールドに選択されているオブジェクトに権限がない時「＋」ボタンで新規オブジェクト作成保存時にモーダルが閉じない問題を修正しました。  
アップグレードで「フィールド型」は更新されますが、すでに生成済みのフィールドがある場合は修正を適用してください。対象のファイルは下記となります。

    tmpl/field/field_types/tmpl/asset_content.tmpl
    tmpl/field/field_types/tmpl/image_content.tmpl
    plugins/FileUploader/tmpl/fields/video_content.tmpl

- 環境変数「wait\_import」を追加しました。CSVインポート時に一定時間ごとにお POSTリクエストを送信して処理の終了を待ちます。
- 環境変数「exclude\_tasks」を追加しました。実行しないスケジュールタスクの IDを配列で指定します。
- 「PTViewer」クラスでlanguageをセットしてから初期化するようにしました。
- テーマにプラグイン「SimplifiedJapanese」で生成したふりがなを有効化するモジュールを追加しました。
- テーマの「\.htaccess」がサブディレクトリに設置されているとき、サブディレクトリへのリクエストでドキュメントルート直下の index\.html が表示されるケースを修正しました。
- VideoCaptionsプラグインに同梱しているVideo\.jsに PowerCMS Xオリジナルの外観を追加しました。
- フォーム投稿時、投稿完了画面のレスポンスヘッダに「Cache\-Control」「Pragma」を追加しました。
- オブジェクトの編集画面下部のボタンの余白を調整しました。
- リビジョンのワークフローで公開者がリビジョンをマスタに適用しようとした時に出る「通知メッセージが入力されていません」メッセージを 1回のみ表示されるようにしました。
- ワークフローの引き戻し実行時にログを保存するようにしました。
- フォームの確認画面でフォームのステータスとリクエストメソッドをチェックするようにしました。
- プラグイン「SearchEstraier」のプラグイン設定に「タイトルの重み」を追加しました。0\.0〜1\.0の範囲で指定し、数字が大きいほどタイトルに含まれるキーワードが優先されすりょうになります。
- プラグイン「SearchEstraier」の検索で環境変数「searchestraier\_force\_mecab」指定のある時、検索フレーズから自立語を抽出して ANDもしくは OR検索できるようになりました。
- プラグイン「SearchEstraier」の検索がフレーズ検索\("キーワードをダブルコーテーションで囲む"\)に対応しました。
- プラグイン「Members」の会員登録時のメールに含まれるユーザー名を表示名に変更しました。
- 管理画面及び会員サイトからのログアウト時に RESTfulAPIのユーザーのセッションも削除するようにしました。
- 環境変数「password\_1byte\_letternum」を追加しました。パスワードに英字と数字のみを利用可能にします。
- プラグイン「Members」の設定に「ログイン後の遷移先URL」指定のある時、ログイン後にログイン画面へ遷移しようとした時も「ログイン後の遷移先URL」に遷移するようにしました。
- プラグイン「Members」で確認画面を経由せずに会員登録できるようになりました。
- 「pt\-members\.php」の「unsubscribe」で \_type省略時に confirmとして処理を続行するようにしました。
- プラグイン「EmailMagazine」のプラグイン設定に「購読解除\(List\-Unsubscribe\)のURL」を追加しました。
- メールマガジンの新規作成画面でメールアドレス対象モデル選択のドロップダウンの初期値を「メルマガ購読者」となるようにしました。
- 環境変数「mail\_return\_path」に「true」を指定できるようになりました。メールの Fromアドレスと同じアドレスを「エンベロープFrom」にセットします。
- 一覧画面の画面オプションの表示数の最大値を「5000」にしました。
- プラグイン「Members」のプラグイン設定画面のレイアウトを調整しました。
- 環境変数「basename\_separator」を追加しました。ベースネームのスペースを置換する文字を指定します。初期値は「\_」です。
- Prototypeクラスの loginメソッドの第二引数に「true」を渡すことによって、リダイレクトせずにログイン処理のみを行えるようにしました。
- パスワード変更後にユーザーまたはメンバーを保存する直前に「recover\_password」コールバックを追加しました。
- 環境変数「strict\_offset」指定のある時、ソートキー配列の時も「id」を含まない時 limit指定のある時、ソートキーに「id」を追加するようにしました。
- ユーザーなどのパスワードハッシュ型カラムのあるオブジェクトを保存した時にログにハッシュ値が保存されないようにしました。
- ワークフローの作成・編集画面で「メールのFrom」が「個別に指定する」以外の時、メールアドレスのバリデーションを無効にするようにしました。
- 環境変数「tar\_path」の初期値を追加しました。
- Prototypeクラスにプロパティ「procs」配列を追加しました。proc\_openで開始したプロセスをインスタンスの終了時にまとめて終了します。
- 環境変数「show\_editor\_loader」を追加しました。リッチテキストロード時に進捗ローディングアニメーションを表示します。初期値は trueです。
- フォームのメール送信設定で「Return\-Path」を指定できるようにしました。
- 管理画面テンプレートのビルド時に変数「body\_class」をセットし、「\{\_type\}\-\{\_model\}」「mode\_\{\_\_mode\}」を追加するようにしました。
- プラグイン「QuickEdit」が「/」で終わる URLにも対応しました。
- 「pt\-members\.php」実行時に「pre\_run」フックをコールするようにしました。
- build\_pageに「ビュー」オブジェクトを指定した時にも「template\_source」「template\_output」コールバックを実行するようにしました。
- 真偽値型のカラムにバリデーション「必須」を追加しました。
- 設問タイプとフォームのバリデーションタイプに「パスワード」を追加しました。
- プラグイン「ExternalPreview」のクッキーの有効期限の初期値\(秒\)を「10」から「60」に変更しました。
- 「tools/backupSQL\.php」にmysqldumpに渡す引数\(値指定のないもの\)を指定できるようになりました。
- 環境変数「build\_dynamicmtml」を追加しました。DynamicMTMLを含む静的ファイル出力時にビルドを実行してコンパイルキャッシュを生成します。
- PTUtil::is\_binary\_fileを追加しました。ファイルがバイナリファイルかどうかを判別します。
- 「やさしい日本語エディタ」のエディタのスタイルを調整しました。
- プラグイン「HTML\_CodeSniffer」有効時、カラム「htmlcs\_a11ychecked」を作成することでチェック結果を保存できるようにしました。
- 情報分類の階層の保存、情報分類とタグの CSVからのインポート時に「正規化」カラムの値をセットするようにしました。
- 「tools/encryptDBPassword\.php」をデータベース接続なしで実行するようにしました。
- objectloopタグで「workspace\_id」カラムのあるオブジェクトを指定している時、重複クエリが発行されないようにしました。
- 記事・ページのタイトル・本文、フォームの名前と説明欄にヒントを指定した時表示されない問題を修正しました。
- 階層付きモデルでプライマリカラムをユニーク設定している時、オブジェクトの階層管理画面で重複を許容してしまう問題を修正しました。
- プラグイン「Members」のサインアップ後のテンプレートのフレーズを修正しました。
- オブジェクト作成・編集画面の表示オプションで非表示になっていたリッチテキストエディタを表示した時エディタの高さが十分に確保されない問題を修正しました。
- backupSQL\.phpで対象ファイルが存在する時上書き確認のプロンプトを出さずに実行できるようにしました。
- データベースが MariaDBの時、backupSQL\.phpで「/usr/bin/mysqldump: unknown variable 'set\-gtid\-purged=OFF'」エラーが出るケースを修正しました。
- ファンクションタグ「mt:membersappurl」が利用できなくなっていた問題を修正しました。
- スマートフォンなどの画面幅の狭い端末で管理画面を操作している時、リレーションのバッジのテキストがボタンと重なる問題を修正しました。
- orderカラムをユニーク指定した時、一覧画面で重複した表示順を指定しても保存ができてしまう問題を修正しました。
- 不正な「\_language」パラメタを無視するようにしました。
- モデルのオプション「リビジョン対応」を有効化した時に自動で作成されるカラム「rev\_changed」の一覧表示を「なし」から「テキスト」に変更しました。
- 不正なキャッシュパスへのアクセスを試みた時にエラーを返すようにしました。
- プラグイン「MTMLReference」のタグ「websitedescription」のドキュメントの誤りを修正しました。
- Windows環境で環境変数「プラグイン名\_mecab\_path」指定が有効にならない問題を修正しました。
- PHP拡張の「Exif」がインストールされていない時画像のアップロードができない問題を修正しました。
- プラグイン「UniqueURL」で重複チェックが機能しないケースを修正しました。
- ファンクションタグ「mt:canonicallink」「mt:canonicalurl」を呼び出した時「Undefined variable $obj \(2\) occured」エラーが出る問題を修正しました。
- プラグイン「Abs2Rel」が有効な時、ファンクションタグ「mt:canonicallink」の出力結果が相対パスに置換されてしまう問題を修正しました。
- プラグイン「SiteSync」で「sitesync\_workspaces\_in\_system」が有効時、システムの同期画面から同期ができない問題を修正しました。
- PHP8\.1以上で「PTUtil::sec\_to\_hms」で「Implicit conversion from float」エラーが出るケースを修正しました。
- Prototype クラスの「get\_related\_objs」の第3引数を指定したとき、数値タイプのカラムのデータを取得できない問題を修正しました。
- ブロックタグ「mt:breadcrumbs」に属性「relation\_name」を指定できるようになりました。container 属性に指定したモデルをリレーションしているカラム名を明示的に指定できます。
- プラグイン「MTMLReference」のタグリファレンスで、ブロックタグ「mt:breadcrumbs」に「relation\_name」属性の説明を追記しました。
- プラグイン「Members」の会員ログイン時の Cookieの有効期限と、RESTfulAPIのログインCookieの有効期限が合っていない問題を修正しました。
- 「Website」テーマ適用時にカテゴリアーカイブと年度別アーカイブのアーカイブ種別が空になる問題を修正しました。
- 「Website」テーマ適用時に年別リストがサイドバーに出ない問題を修正しました。
- 一部のプラグインの tmpl配下のテンプレートのタグのコンパイルエラーを修正しました。
- RESTfulAPIの「authentication」メソッドで「Undefined variable: app」エラーとなるケースを修正しました。
- 添付ファイルにCSVファイルを含むオブジェクトのインポートでエラーになるケースを修正しました。
- RESTfulAPIの「authentication」メソッドでシステム設定の「許可されたIPアドレスはロックしない」設定が機能するようになりました。
- プラグイン「Members」でユーザーを無効化した時にユーザーの有効化通知メールが送信されるケースを修正しました。
- プラグイン「SearchEstraier」でページの URLが変更された時に変更前のページが検索インデックスに残る問題を修正しました。
- スマートフォンなどの幅の狭い画面の時、一覧画面と作成・編集画面の「画面オプション」ボタンがヘッダーのバーと重なる問題を修正しました。
- プラグイン「ComponentBlocks」でマルチブロックにフィールドを追加した場合でもコンテナ配下のブロックのバリデーションが効くようにしました。
- 「PTPublisher」クラスの publishメソッドでテンプレート変数「application\_dir」「application\_path」をセットするようにしました。
- 「TinyMCE5」のアンカー挿入時のエラーメッセージを修正しました。
- スペースの WebサイトURLにディレクトリを含む時プラグイン「AWS\_S3」のアクション「AWS S3へのファイル同期」実行時に正しいパスに同期されない問題を修正しました。
- アセットのファイル選択後に表示される「ビュー」ボタンで選択したファイルの確認ができない問題を修正しました。
- プラグインエクスポート時に「Undefined variable $content」エラーが出るケースを修正しました。
- 「Mecab\Tagger」が有効な時、カスタム辞書が正しく利用されないケースを修正しました。
- プラグイン「SimplifiedJapanese」でユーザー辞書が正しく生成されないケースを修正しました。
- プラグイン「SiteSync」でステージングと本番を設定している時、公開同期処理で意図せず CMS環境のファイルが本番に反映されてしまう問題を修正しました。
- プラグイン「Mirroring」に設定するパスワードに特定の文字が含まれているとき、同期が行えない問題を修正しました。
- VideoCaptionsプラグインで動画を埋め込んだページにおいて、スマートフォンで動画を全画面表示をした際にキャプションの表示が大きすぎる問題を修正しました\(Video\.jsバージョン8\.xのみ\)。
- VideoCaptionsプラグインで動画を埋め込んだページにおいて、画面のリサイズを行うと字幕の選択肢に「unknown」と出るケースを修正しました。
- ワークフローの引き戻し実行時のメール本文のユーザー名にステータスがセットされる問題を修正しました。
- ワークフローメール通知設定がされていないときにも「引き戻し」のメールが送信されるケースを修正しました。
- 環境変数「multiplenotifications\_send\_bcc」を追加しました\(初期値 false\)。true を指定すると、プラグイン「MultipleNotifications」によるメール送信の To ではなく Bcc に宛先を追加します。メールの To にはシステムメールが設定されます。true の代わりにメールアドレスを設定すると To を明示的に設定できます。
- 環境変数「multiplenotifications\_send\_bcc\_logging」を追加しました\(初期値 false\)。true を指定すると、環境変数「multiplenotifications\_send\_bcc」が有効なとき送信内容 \(オプション含む\) をログに保存します。
- 「allow\_comment」カラムの初期値がオブジェクト作成画面に反映されない問題を修正しました。
- 「model」「object\_id」カラムのあるモデルの一覧画面で「PADOBaseModelException: unknown column 'primary' for model」がログに記録されるケースを修正しました。
- 権限を付与済みのモデルを削除した時、一覧・編集画面で「Undefined offset」警告がログに記録される問題を修正しました。
- アセット一覧画面でフィルタ「画像」を適用した時、一覧画面に「現在のフィルタ」表示が出ない問題を修正しました。
- フィールド型「画像」「アセット」「ビデオ」から作成したフィールドに選択されているオブジェクトに権限がない時「＋」ボタンで新規オブジェクト作成保存時にモーダルが閉じない問題を修正しました。
- 一覧画面で権限のないオブジェクトを一覧に表示している時「全n件を選択する」の件数が選択可能なオブジェクトの件数と一致しない問題を修正しました。

## 2023\-12\-22

ver.3\.542 / version 2\.7542

- プラグイン「BannedWords」の校正支援機能がプラグイン「ComponentBlocks」のフィールドに対応しました。
- プラグイン「BannedWords」の送り仮名辞書をアップデートしました。
- プラグイン「HTMLImporter」で ZIPファイルからインポートする時、HTMLより先にアセットをインポートされるようにしました。
- ブロックタグ「mt:taxonomyobjects」にオブジェクトのカラム値を指定できるようになりました。
- ファンクションタグ「mt:assetthumbnailurl」に属性「aspect」\(例: 16x9\)を指定できるようになりました。「fit」または「trim」とあわせて指定します。「fit」の時、余白ありトリミングなし、「trim」の時、余白なしトリミングありでアスペクト比を固定した画像を作成します。
- ファンクションタグ「mt:assetthumbnailurl」に属性「max」を指定できるようになりました。長辺のピクセルを指定してサムネイルを作成します。
- ファンクションタグ「mt:assetthumbnailurl」に属性「properties」を指定できるようになりました。画像のプロパティ\(配列\)を指定された変数名にセットします。
- 環境変数「simplifiedjapanese\_pdf\_header\_footer」を追加しました。header要素と footer要素を PDFのヘッダ、フッタにします。
- 環境変数「simplifiedjapanese\_pdf\_page\_number」を追加しました。PDFのフッタにページ番号を挿入します。
- 「記事」「ページ」モデルの「続き」欄のテキストエリアの高さの初期値を 3から 7に変更しました。
- 「app\_property」モデルにカラム「説明」を追加しました。
- 「app\_property」モデルにアクション「CSVエクスポート」を追加しました。
- プラグイン「Members」の設定に「ログイン後の遷移先URL」「パスワードリセット後の遷移先URL」を追加しました。
- スケジュールタスクの実行順で「時限公開・差し替え」処理の後ろに公開キューの処理を移動し、対象のオブジェクトをリルタイムに再構築するようにしました。
- プラグイン「ComponentBlocks」のアセット選択後のバッジがリンクURLに対応しました。
- ブロックタグ「mt:cacheblock」に属性「dynamic\_caching」を指定可能にしました。「cache\_ttl」を有効期限としてブロックを常にキャッシュします。
- ダッシュボードウィジェットの「アクティビティ」のグラフに利用される値をキャッシュするようにしました。環境変数「activity\_cache\_ttl」で有効期限秒を指定できます。省略時は 3600秒です。
- グローバルモディファイア「masking」を追加しました。パスワード文字列をマスキングします。
- ファンクションタグ「mt:memberssignuptoken」を追加しました。確認画面をスキップしてアクションを実行するための magic\_token を生成します。
- オブジェクトの作成・編集画面からステータス指定のあるオブジェクトを保存した時のログのメッセージにステータスを追記するようにしました。
- プラグイン「UploadUtilities」のアセットとのステータス同期でプラグイン「ComponentBlocks」で関連付けたアセットに対応しました。
- RESTfulAPIの「authentication」メソッドでログイン成功時セッションの「data」カラムにモデル名をセットするようにしました。
- 環境変数「api\_use\_cookie」指定のある時、会員サイトへのログインで RESTfulAPI用のクッキーとセッションを保存するようにしました。
- モデルのカラム詳細ダイアログで数値型・リレーションを選択した時「チェックボックス」を選択できないようにしました。
- プラグイン「ComponentBlocks」で関連付けを解除したリレーション型のアセットが保存後に再度関連づく問題を修正しました。
- 環境変数「api\_path\_from」が「REQUEST_URI」の時、RESTfulAPIのカスタムメソッドにパラメタ指定のある時、GETパラメタ指定できない問題を修正しました。
- 「記事」「ページ」「ウィジェット」「フォーム」などの編集画面でパーマリンク横の「クリップボードにコピー」ボタンが効かない問題を修正しました。
- プラグイン「ImageInfo」が有効な時「attach\_editor\_asset\_single」「editor\_paste\_relative」の指定が適用されない問題を修正しました。
- リッチテキストエディタで「toolbar\_mode: 'Sliding'」指定のある時、ヘッダのドロップダウンメニューがエディタの背面に隠れてしまう問題を修正しました。
- ログの詳細画面の「作成」「更新」欄のレイアウトが揃っていない点を修正しました。
- 開発者モードの時プラグイン「ImageWebP」のプラグイン設定保存後の画面に設定が引き継がれない問題を修正しました。
- プラグイン「UploadUtilities」でオブジェクトとアセットのステータスを同期する設定をしているとき、スケジュールタスクの実行での公開予約・リビジョン差し替え時にステータスが同期されない問題を修正しました。
- プラグイン「UploadUtilities」でオブジェクトとアセットのステータスを同期する設定をしているとき、数値型の単一リレーションで関連づいているアセットのステータスが同期しない問題を修正しました。
- 数値型の単一リレーションのバッジにパーマリンクのアイコンが表示されない問題を修正しました。
- プラグイン「LinkChecker」で%エンコードされた内部リンクがリンク切れと判別される問題を修正しました。
- プラグイン「HTMLImporter」で「tel:〜」リンクなどがパス変換されてインポートされる問題を修正しました。
- プラグイン「AWS\_CloudFront」で日本語を含むパスの URLのキャッシュ削除時にエラーになる問題を修正しました。
- URLオブジェクトが保存されていない時、プレビュー時の「mime\_type」が「text/plain」になる問題を修正しました。
- プラグイン「ComponentBlocks」で入力データに textarea要素がある場合にエディタの表示が壊れてしまう問題を修正しました。
- プラグイン「AWS\_S3」で例外発生時に落ちるケースを修正しました。
- プラグイン「AWS\_S3」のアクション「AWS S3へのファイル同期」実行時に同じログが複数記録される問題を修正しました。
- プラグイン「BannedWords」で「\(一部の\)副詞をひらがなに展開する」設定が有効な時「文末以外の副詞を削除する」設定があわせて効いてしまう問題を修正しました。
- プラグイン「ComponentBlocks」のコンポーネント名に「-（ハイフン）」などの記号があると保存時にエラーになる様に変更しました。
- モデルの編集画面でカラムの詳細を表示している時「参照」で同じモデルが選択できない問題を修正しました。
- 環境変数「field\_type\_asset」が設定されているとき、プラグイン「UploadUtilities」設定画面の「オブジェクトのステータスとアセットのステータスを同期」が表示されない問題を修正しました。
- 環境変数「asset\_overwrite」が true に設定されていても、プラグイン「UploadUtilities」の設定「同じパスのファイルの上書きを可能にする」が無効だとファイルの上書きができない問題を修正しました。
- 「PADO\_DB\_BLOB2FILE」指定のある時にモデルごとの blob型のカラムのキャッシュがヒットしていない問題を修正しました。
- 「操作系のボタンを下部に固定する」設定で階層の管理に大量のオブジェクトがある時、画面の読み込み前に「保存」ボタンをクリックするとオブジェクトが消える問題を修正しました。

## 2023\-12\-05

ver.3\.541 / version 2\.7541

- 環境変数「strict\_offset」を追加しました。ソートキーが「id」以外で limit指定のある時、第2ソートキーに「id」を追加します。初期値は「false」です。
- プラグイン「UploadUtilities」の設定に「オブジェクトの公開時はステータス同期を強制する」を追加しました。オブジェクトの公開時はアセットのステータスを公開、非公開時は関連オブジェクトのうち終了以外の最も値の大きなステータスにセットします。
- プラグイン「UploadUtilities」の設定に「公開されたアセットのステータスを変更しない」を追加しました。「オブジェクトの公開時はステータス同期を強制する」のチェックの有無に関わらず、一度公開したアセットのステータスを変更しません。
- プラグイン「AWS\_S3」のタスクによる同期時に「出力済み」URLオブジェクトのみを対象とするようにしました。
- 環境変数「attach\_editor\_asset\_single」を追加しました。単一選択型のアセットカラムを設定している時、エディタに貼り付けた最初のアセットを\(すでに選択がない時\)セットします。初期値は falseです。
- 複数のスコープに「優先」指定のある URLマップが存在するときに正しいパーマリンクを返すようにしました。
- 同一のベースネームで拡張子の異なるサムネイルを作成していた時、サムネイルの再生成時に異なる拡張子のサムネイルを削除するのではなく、新しいデータでサムネイルを作成し直すようにしました。
- ログの詳細画面に「更新日」\(処理の終了時刻\)を表示するようにしました。
- URLの一覧画面にアクション「URLの再パブリッシュ」を追加しました。
- プラグイン「AWS\_CloudFront」有効時に URLの一覧画面にアクション「AWS CloudFront キャッシュ無効化」を追加しました。
- 環境変数「aws\_s3\_skip\_rebuild\_phase」を追加しました。ポップアップからの再構築によって更新されたファイルの同期をスキップします。この設定は \-\-task\_idsに「aws\_s3\_synchronize\_s3」を指定して worker\.php を実行して同期することを想定しています。
- コマンドラインからの実行時、PADOの「debug=3」の時、デバッグ用のSQL文を HTMLエスケープしないで出力するようにしました。
- 環境変数「assets\_c」「assets\_c\_path」指定のある時一覧画面のサムネイルがキャッシュされて更新されない問題を修正しました。
- 環境変数「assets\_c」「assets\_c\_path」指定のある時に「同じパスのファイルを上書きする」指定で正方形の画像を上書きアップロードした時に一覧画面用のサムネイルが更新されないケースを修正しました。
- プラグイン「RebuildRelations」のプラグイン設定画面に削除済みのラベルの取得できないモデルのチェックボックスが表示される問題を修正しました。
- やさしい日本語エディタの要約ボタンのチェックが外せない問題を修正しました。
- ワークフローの編集画面で「メールのFrom」欄のラジオボタンの状態が維持されない問題を修正しました。
- スケジュールタスク実行時に「Undefined variable $dirname \(2\) occured」エラーが出るケースを修正しました。
- オブジェクトの保存時に値が nullのカラムがあった時「str_replace(): Passing null to parameter #3 ($subject) of type array|string is deprecated」エラーが出るケースを修正しました。
- PTUtil::sec\_to\_hmsに float型の値を渡した時「Implicit conversion from float」エラーが出るケースを修正しました。
- スケジュールタスク以外の Workerから $app\->publish をコールした時「Attempt to read property "update\_before" on null 」エラーが出るケースを修正しました。
- 管理画面フッタのバージョン番号が更新されない問題を修正しました。
- ブロックタグ「taxonomyobjects」条件タグ「iftaxonomyhaschild」でスコープのコンテキストが正しくセットされないケースを修正しました。
- ファンクションタグ「mt:estraierjson」に limit属性を指定している時、結果が 1件多く取得される問題を修正しました。
- 単一選択型のリレーションのバッジを選択解除したとき、ビューアイコンが残ったままになる問題を修正しました。
- 単一選択型のアセットカラムを設定している時、オブジェクトの保存時にバリデーションエラーになった時にビューアイコンが表示されない問題を修正しました。
- ワークフローで引き戻した時のメールの IDや URLなどの値が空になる問題を修正しました。
- プラグイン「RebuildRelations」のリレーション型カラムによるトリガーがスケジュールタスクによる予約関連の処理で実行されない問題を修正しました。
- プラグイン「ComponentBlocks」でコンポーネントブロックフィールドが表示できない問題を修正しました。

## 2023\-11\-28

ver.3\.54 / version 2\.754

ver.3\.532 / version 2\.7532を新規にインストールした方でモデルの一覧に「column」「meta」「option」「relation」「session」が存在している場合、データベースのバックアップをとっていただき、以下を一度実行してください。

    cd path/to/powercmsx; sudo -u apache php ./tools/restore3.53-2.753.php

- PADOクラスのテーブル操作・データ取得関連の SQL文のテーブル名を「\`\`」でエスケープするようにしました。
- ビューと URLマッピングのビルド時に変数「current\_container」をセットするようにしました。
- スケジュールタスク完了のログに所要時間を記録するようにしました。
- 「load」メソッドに数値指定をした時及び「get\_by\_key」メソッドに配列を指定した時、マッチするオブジェクトがなかった時も結果をキャッシュするようにしました。
- URLの一覧画面にアクション「再構築キューのキャンセル」を追加しました。
- フォームの「thanks\_template」「notyfy\_template」カラムを数値型リレーションに変更しました。
- プラグイン「AWS\_S3」で拡張子「ts」「m3u8」のファイルをファイル名を保ってエクスポートできるようにしました。
- PTFileMgrの「rename」メソッドで cross\-device linkに対するリネームを一時ファイルにコピーしてから行うようにしました。
- プラグイン「TaxonomyUtils」を追加しました。情報分類モデルの機能を拡張します。
- プラグイン「AWS\_S3」有効時に URLの一覧画面にアクション「AWS S3へのファイル同期」を追加しました。
- 環境変数「max\_status\_for\_revision」を追加しました。一覧・編集画面でリビジョンをの作成ボタンを表示するオブジェクトのステータスの最大値を指定します。初期値は「4」です。
- 環境変数「editor\_paste\_relative」を追加しました。trueを指定すると画像やファイルをエディタから挿入するときにルート相対パスでペーストされます。
- 環境変数「api\_path\_from」を追加しました。初期値は「REDIRECT\_URL」です。うまくパスを取得できない場合、代わりに「REQUEST\_URI」を指定してください。
- 環境変数「searchestraier\_use\_tmp」を追加しました。インデックスの最適化とキーワード抽出をワークディレクトリで実行します。
- 環境変数「searchestraier\_use\_reccomend」「searchestraier\_idx\_optimize」を追加しました。キーワード抽出・インデックスの最適化を実行するかを指定できます。初期値は trueです。
- 環境変数「searchestraier\_attr\_index\_path」を追加し、指定のある時「mt:estraiersearch」「mt:estraierjson」タグに「index」属性を指定できるようにしました。
- 環境変数「searchestraier\_idx\_backup」を追加しました。インデックスの洗い替え後にバックアップを作成します。
- 環境変数「searchestraier\_idx\_backup」指定のある時、検索実行時にインデックスがエラーになった時にバックアップを使って検索を継続するようにしました。
- 環境変数「get\_image\_src\_func」を追加しました。サムネイル作成時に拡張子からではなくデータを解析して適切な関数を利用します。負荷は少し増えますが、フォーマットが拡張子と異なる時にエラーにならなくなります。
- 環境変数「fileuploader\_max\_chunk\_size」を追加しました。プラグイン「FileUploader」のチャンクアップロードでファイルを分割するサイズ単位を指定します。初期値は「1048576\(1MB\)」です。
- worker\.phpに引数「\-\-publish\_queue\_order」を指定できるようにしました。ソート順\(キーは「filemtime」\)を指定でします。初期値は「descend」です。
- worker\.phpに引数「\-\-ignore\_pid」を指定できるようにしました。pidファイルを生成せず、重複実行を考慮せずにタスクを実行します。
- プラグイン「SearchEstraier」「DocumentSearch」のインデックス洗い替え処理を「work\_dir」のテンポラリディレクトリ内で実行するようにしました。
- 「plugins/SearchEstraier/tools/syncCasket\.php」を追加しました。引数「\-\-from」「\-\-to」を指定してインデックスをコピー\(検証\)します。
- ポップアップからの再構築で待機状態になった URLオブジェクトの再構築実行時に「mode」に「rebuild\_phase」をセットするようにしました。
- 「tools/replaceURL\.php」を追加しました。URLを変更して URLオブジェクトとファイルオブジェクトの URLを更新します。
- モデル毎に並列再構築を指定できるようになりました。例えば記事の場合、環境変数「entries\_rebuild\_async」を true「entries\_async\_max\_proc」に数値を指定します。
- オブジェクトの編集画面で、作成者・更新者名が長いとき、ダイアログの時に名前と日付が被ってしまわないようにしました。
- 環境変数「video\_captions\_thumbnail\_queue」を追加しました。動画のサムネイルをテンプレート・タグから出力する時、サムネイルをキュー経由で生成します。初期値は falseです。
- デバッグモードの時、ミリ秒を超えた SQLのクエリの実行時間\(秒\)を表示するようにしました。
- プラグイン「SimplifiedJapanese」にテキストノードのテキストとふりがな付きテキストのマッピングを JSON形式のファイルに出力する機能を追加しました。
- プラグイン「DisplayOptions」の設定に一覧画面の「ソート順のカスタマイズを許可」設定を追加しました。
- アセットの画像を差し替えて保存したときにサムネイルを再構築なしで作成し直すようにしました。
- 環境変数「save\_queue\_realtime」を追加しました。ファイル出力を「キュー」に設定しているモデルを保存した時、そのオブジェクトに対するアーカイブのみリアルタイムに再構築します。
- リビジョンのマスタが存在しない時マスタの編集リンクを出さないようにしました。
- 「mail\_transfer」が「debug」の時、headers、optionsなど詳細をログに保存するようにしました。
- 環境変数「export\_int2label」の設定のある時、数値型の単一リレーションで関連づいているアセットをエクスポート・インポートができるようになりました。
- 環境変数「prioritize\_relation」を追加しました。数値型の単一リレーションとリレーション型のカラムの両方がある時、関連オブジェクトのソート順を優先して SELECTします。
- 環境変数「workflow\_bidirectional」を追加しました。ワークフローの設定が並列の時、同じ権限レベルのユーザーを「差し戻し」「承認待ち」の両方の選択肢に含めます。
- スキーマの CSVエクスポートデータに「ヒント」を追加しました。
- PTUtil::export\_dataの第3引数\(inline\)に trueを指定するとダウンロードではなくブラウザにインラインにデータを返すようにしました。
- フォーム投稿時、確認画面のレスポンスヘッダに「Cache\-Control」「Pragma」を追加しました。
- サムネイル生成時に「imagecopyresized」の代わりに「imagecopyresampled」を利用することで画質が向上しました。
- 関連オブジェクトを SELECTする時、ignore\_filterを指定した時、post\_load\_objectコールバックを呼ばないようにしました。
- URLマップのビルド時に変数「current\_archive\_model」「current\_object\_id」をセットするようにしました。
- 環境変数「aws\_s3\_worker\_only」を追加しました。task\_ids に「aws\_s3\_synchronize\_s3」を指定して worker\.php を実行した時のみ同期を実行します。
- プラグインの「tag\_reference\.json」に指定するフレーズの翻訳フレーズ指定がない時プラグイン「MTMLReference」の辞書を使うことができるようになりました。
- 「mt:relatedobjects」タグで、モデルに「name」「model」「from」「to」カラムが存在するとき結果が正しくならない問題を修正しました。
- URLオブジェクト\(urlinfoモデル\)にメソッド「object」を追加しました。
- プラグイン「LivePreview」のプロパティ「preview」「preview\_ts」を publicに変更しました。
- プラグイン「VideoCaptions」で生成されたチャプターファイルを管理画面から削除できるようにしました。
- スペースセレクタにスペースに設定されている色を適用できるようにしました。ユーザーごとに機能の有効無効を切り替えできます。
- ユーザーグループのバッジを「名前」から「表示名」に変更してワークフローの編集画面と表記を合わせました。
- モーダルダイアログの幅を少し広くしました。
- スケジュールタスクの「URLの再パブリッシュ」を夜間のみに実行するようにしました。
- 環境変数「searchestraier\_index\_lt」を追加しました。プラグイン「SearchEstraier」で解析するテキストのサイズ制限をキロバイト単位で指定します。デフォルトは 32768KB\(約32MB\)です。
- ダッシュボードのウィジェット「ワークフロー」で権限のないオブジェクトについては非表示になるようにしました。
- 環境変数「work\_dir」の設定がなく「temp\_dir」の設定がある時、「temp\_dir」にあわせるようにしました。
- 環境変数「leave\_revisions」指定のある時、オブジェクトの削除時にマスタをリビジョンに残すようにしました。
- PTUtil::mime\_typesに「text/vtt」「font/ttf」「font/otf」「font/woff」「font/woff2」を追加しました。
- ファイルの一覧画面の動画のサムネイルが表示されないケースを修正しました。
- プライマリカラムの指定のないモデルを保存したときに1つ目のテキスト型カラムをプライマリカラムにセットするようにしました。
- オブジェクトの複製時にプラグイン「BannedWords」でエラーが表示された時、複製がキャンセルされたことを示すアラートメッセージを表示させるようにしました。
- 新規インストール時に「column」「meta」「option」「relation」「session」が mt\_tableに生成されないようにしました。
- ワークフローの選択ユーザーを続けて変更した時、ステータスのドロップダウンが適切な値にならない問題を修正しました。
- ワークフローでユーザーを選択してステータスが変更された時、ステータスのドロップダウンに「readonly」属性を付けるようにしました。
- HTML検証の実行結果のデザインが崩れる問題を修正しました。
- 「mt:include」タグの「file」属性に指定したテンプレートがパスの指定によって特定できない問題を修正しました。
- 環境変数「paml\_version」の指定がない時「pt\-check\.php」が 500エラーになる問題を修正しました。
- プラグイン「AxeRunner」の「exclude\_urls」メソッドで「Undefined variable $exclude\_path」が出る問題を修正しました。
- 情報分類の選択ダイアログで、一覧表示の権限のないユーザーが検索できない問題を修正しました。
- 再生時間が指定時間未満の動画のサムネイルが自動生成されない問題を修正しました。
- プラグイン「PostOnTwitter」のメソッド名が「𝕏」文字になっている問題を修正しました。
- プラグイン「SearchEstraier」の検索インデックスの確認画面で、操作系のボタンを下固定している時、バーの下に余白が出る件を修正しました。
- プラグイン「SearchEstraier」で本文抽出条件に「CSSセレクタ」を指定しているとき、洗い替えの実行時に指定した抽出条件が効かない問題を修正しました。
- 環境変数「aws\_s3\_setting\_by\_scope」の設定のない時、プラグイン「AWS\_S3」のスペースの設定画面にリージョンの入力欄を出ないようにしました。
- Prototypeクラスの publish\_objメソッドで「md5\(\): Passing null to parameter」エラーが出るケースを修正しました。
- 一覧画面からの CSVエクスポート時に「iconv stream filter」「strpos\(\): Passing null to parameter \#1」エラーが出るケースを修正しました。
- メンテナンスモードの時に cliから実行すると「Undefined variable $app」エラーが出る問題を修正しました。
- プラグイン「PluginStarter」で作成した条件タグで「Argument \#4 \($repeat\) cannot be passed by reference in」エラーが出る問題を修正しました。
- RESTfulAPIに配列で渡すべきデータを文字列で渡した時「foreach\(\) argument must be of type array|object, string given」エラーが出る問題を修正しました。
- TinyMCEのバージョンが「6」の時、リッチテキスト型のフィールドをドラッグして動かした時、リッチテキストが通常のテキストエリアになってしまうケースを修正しました。
- PowerCMSXディレクトリに Aliasを指定して環境変数「cfg\_admin\_url」を指定している時、テーマのアイコンが表示されない問題を修正しました。
- スケジュールタスクの「Workerによるアップグレード処理」が毎回実行される問題を修正しました。
- プラグイン「FileUploader」でファイルをアップロードした後に「ビュー」ボタンをクリックした時に「不正な要求です」エラーが出る問題を修正しました。
- プラグイン「AxeRunner」の検証結果が正しいスペースに保存されないケースを修正しました。
- CSVエクスポート時、モデル名にスペースを含む時、スペースを「\_」に変換したファイル名・フォルダ名でエクスポートするようにしました。
- RESTfulAPIにプラグインでモデル名と異なるカスタムメソッドを登録しても認識されない問題を修正しました。
- プラグイン「SimplifiedJapanese」でユーザー辞書が正しくコンパイルされない問題を修正しました。
- 1つのプラグインで複数の「api\_methods」が登録できない問題を修正しました。
- RESTfulAPIのカスタムエンドポイントが正しく認識されない問題を修正しました。
- 「\_filter\_and\_or」パラメタに「OR」を指定して一覧表示している時、リレーションカラムにマッチしなかった時、一部の条件にマッチしていても結果が 0件になる問題を修正しました。
- オブジェクトが存在するモデルの一覧画面にオブジェクトが表示されないケースを修正しました。
- URLマップのビルドでブロックタグを利用した時、コンテキストが意図せず変化する問題を修正しました。
- 環境変数「export\_int2label」指定のある時、CSVインポートで数値型のリレーションカラムの値が正しくセットされないケースを修正しました。
- 「mt:entries」などのオブジェクトをループするタグでリレーション先のモデルをカラムの「ラベル」指定しているとき、意図通り絞り込まれないケースを修正しました。
- 「mt\_column」テーブルのカラム「columnedit」にインデックスを追加しました。
- プラグイン「ComponentBlocks」のテンプレートでフレーズが使われていなかった「標準手プレート」「プレビュー」を翻訳フレーズ化しました。
- プラグイン「ComponentBlocks」が有効でモデル・カラム数の多い環境での編集画面のレスポンスを改善しました。
- ファンクションタグ「mt:videothumbnailurl」を呼び出した時「Only variables should be passed by reference」エラーが出る問題を修正しました。
- オリジナルと異なる拡張子を指定してサムネイルを指定した時に URLの「mime\_type」がオリジナルの値になるケースを修正しました。
- ユーザーのプロフィール設定を変更して保存した後に、保存前のユーザーの状態に戻るケースを修正しました。
- オブジェクトの作成・編集画面の表示が遅くなっていた件を改善しました。
- 「cache\_driver」が「File」以外の時「Undefined variable $data」エラーが出る問題を修正しました。
- アクション「ステータス変更」から「CSVエクスポート」に変更したときステータス選択が隠れない問題を修正しました。
- プラグイン「ComponentBlocks」のリッチテキストエディタで文字参照が Vue.jsによってデコードされる現象に対処しました。
- プラグイン「SplitPage」で分割したページが「AWS\_S3」プラグインの同期対象に含まれない問題を修正しました。この修正によりプラグイン「AWS\_S3」のフック「aws\_s3\_take\_down」プラグイン「AWS\_CloudFront」のフック「aws\_cloudfront\_take\_down」の Priorityが変更になっています。
- グローバルモディファイア「convert2webp」をWebP画像に適用すると画像が表示されなくなる問題を修正しました。
- 配列に対してグローバルモディファイア「escape」を適用した時に落ちる問題を修正しました。
- プラグイン「SearchEstraier」の検索キーワードにヌルバイト文字を含めた時にエラーになるケースを修正しました。
- ヌルバイト文字を含むメールを送信できずにエラーで落ちる問題を修正しました。
- ブロックタグ「mt:referencedobjects」に「include\_draft」モディファイアを指定しても公開されていない下書きなどのオブジェクトが含まれない問題を修正しました。
- 再構築キューの実行が意図せずスキップされるケースを修正しました。
- 非公開のオブジェクトの再構築キューが実行された時、URLオブジェクトの削除フラグを付与するようにしました。
- 透過PNG/透過WebP\(アルファチャネル情報を持つ\)画像のサムネイルを生成した時背景が黒くなる問題を修正しました。
- プラグイン「ImageInfo」で PDFの情報ダイアログを開いた時進捗インジケーターが消えないケースを修正しました。
- プラグイン「MachineTranslator」の日本語の難易度チェックダイアログのデザインが崩れる問題を修正しました。
- ファンクションタグ「mt:assetthumbnailurl」に属性「extension」を指定してサムネイルを作成した時、エラーが出てサムネイルが生成されないケースを修正しました。
- 「mt:includeblock」タグ内のテンプレート・タグが 2回ビルドされていた問題を修正しました。
- Webp形式のサムネイルを生成する時に、設定した画質の設定が適用されない問題を修正しました。
- プラグイン「URLRedirect」でタイプ「正規表現」コンディションにルート相対 URLを設定した時。意図通りにリダイレクトされない問題を修正しました。
- URLがディレクトリのパスになっている時 URLオブジェクトを生成しないようにしました。
- ファンクションタグ「mt:objectname」の wants属性に存在しないカラムを指定しているとき「unknown column 'status' for model 'モデル名'」エラーが出る問題を修正しました。
- プラグイン「DocumentSearch」で検索インデックスの更新をキューに入れたときにもインデックスの更新と最適化が実行される問題を修正しました。
- フォームの設問の設問タイプ、バリデーションタイプが「メールアドレス \(確認\)」の時「Reply\-To」が指定できない問題を修正しました。
- フォームの「管理者に通知メールを送る」の「ビュー」の「label」の for属性が正しく関連づいていなかった問題を修正しました。
- モデルの編集画面から JSON/CSVをエクスポートした時ファイルの先頭に「Warning:  Unknown: Input variables exceeded XXX\. To increase the limit change max\_input\_vars in php\.ini\. in 」のようなエラーメッセージが出力されるケースを修正しました。
- アセットのサムネイルを更新したときに URLオブジェクトの filemtimeカラムの値が更新されない問題を修正しました。
- プラグイン「LinkChecker」で「ダイナミック・パブリッシングのページを対象にする」設定が有効なとき、リンクチェック結果のテキストが表示されない問題を修正しました。

## 2023\-10\-14

ver.3\.532 / version 2\.7532

- グローバルモディファイア「escape」の引数に「backslash」を指定できるようになりました。
- グローバルモディファイア「pre\_quote」の引数を省略した時「/」として処理するようにしました。
- 複数の URLマップが指定されている時ファンクションタグ「mt:canonicalurl」「mt:canonicallink」がパーマリンクを返すようにしました。環境変数「canonicalurl\_compat」を trueとすると従前の振る舞いと同等となります。
- スペースに画像が登録されている時、画像の内容によってスペースの管理画面にアクセスできない問題を修正しました。
- objectloopタグで「Trying to access array offset on value of type null」エラーが出るケースを修正しました。
- 画像が登録されているウィジェットの編集画面を開いた時スペースのキャッシュが意図しないディレクトリに生成される問題を修正しました。
- プラグイン「PasswordExpired」で「Attempt to read property "id" on null」エラーが出る問題を修正しました。

## 2023\-10\-13

ver.3\.531 / version 2\.7531

- 新規インストール時に「mt\_table」レコードが重複する問題を修正しました。
- 新規インストール時にモデルの最大リビジョン数が設定されない問題を修正しました。
- プラグイン「SearchEstraier」で「Attempt to read property "object\_id" on null」が出るケースを修正しました。

## 2023\-10\-12

ver.3\.530 / version 2\.7530

- モデルのスキーマバージョンとモデルの設定画面のバージョン番号を同期するようにしました。
- プラグイン「TinyMCE」に「画像の位置とテキスト回り込み」ボタン\(pt\-float\-image\)を追加しました。
- メンテナンスモード機能を追加しました。管理画面操作や workerの実行を一時的にできなくします。
- 「PTMembers」クラスに「member」メソッドを追加しました。現在のメンバーを返します。
- プラグイン「DocumentSearch」にコールバック「get\_draft」を追加しました。
- プラグインで追加するシステムフィルタに「input」\(入力を受け付ける\)「hint」\(プロンプトのメッセージ\)「option」プロンプトの初期値を指定できるようになりました。
- CSVからインポートする際にパスワードハッシュ型のカラムに値のない時、上書きしないようにしました。
- 環境変数「componentblocks\_api\_decode」を追加しました。プラグイン「ComponentBlocks」の「コンポーネントブロック」カラムの値を RESTfulAPIで返却する時、JSONデコードした値をセットして返却します。
- 条件タグ「mt:if」の比較演算子に「vc」を追加しました。「version\_compare」関数でバージョン番号文字列を比較します。
- スキーマ、プラグインなどのバージョンの比較を数値比較ではなく「version\_compare」関数を用いて行うようにしました。
- PTUtil::hms\_to\_secを追加しました。「h:m:s」形式の時間を秒に変換します。
- 環境変数「video\_captions\_fill\_chapter」を追加しました。チャプターの終了時刻を次のチャプターの指定時刻の直前までに延長します。
- 環境変数「aws\_s3\_modified\_only」を追加しました。S3バケットへの同期時にバケットのオブジェクトを確認して更新されているもののみを同期します。
- タスク「aws\_s3\_synchronize\_s3」の実行時にパラメタ「\-\-modified\_only\(更新されているもののみ\)」「\-\-put\_only\(PUTのみ\)」「\-\-delete\_only\(DELETEのみ\)」を指定できるようにしました。
- タスク「aws\_s3\_synchronize\_s3」の実行時にパラメタ「\-\-update\_from」を指定できるようにしました。タイムスタンプまたは PHPの strtotime関数に渡せる文字列を指定できます\(例 : \-6 hour\)。
- グローバルモディファイア「encode\_url\_basename」「decode\_url\_basename」の属性値に「dirname」\(ディレクトリ名\)「all」\(すべてのパス\)を指定できるようになりました。
- RESTfulAPIでデータを保存する際のコールバックに「json」を渡すようにしました。
- RESTfulAPIの「insert」「update」時に「コンポーネントブロック」の値を配列で渡せるようにしました。
- テーマ「Media」にフレーズ「ニュース」を追加しました。
- urlinfoオブジェクトの論理削除時に現在時刻を filemtimeにセットするようにしました。
- 「tools/rebuildFiles\.php」に「\-\-logging\(実行時間をログに残す\)」「\-\-callbacks\(0またはfalse指定でpublish\_callbacksを無効化する\)」を追加しました。
- 「コンポーネントブロック」で labelが nullの時、オブジェクトのラベルがラジオボタンなどのラベルに表示される問題を修正しました。
- ブロックタグ「mt:localvars」を追加しました。変数をブロック内部に局所化します。
- 環境変数「rebuild\_time\_limit」を追加しました。ポップアップウィンドウでの再構築時に指定秒を超えた時、以降の再構築を次のリクエストに回します。「rebuild\_async」無効の時のみ作用します。初期値は「30」です。
- 一覧画面のアクションに「作成者の変更」を追加しました。
- 環境変数「build\_breadcrumbs\_url」を追加しました。アーカイブが存在しない時「categorypath」「folderpath」などのタグをビルドして URLを取得します。
- 日付ベースのアーカイブの再構築をバックグラウンドで実行するようにしました。
- システムのモデルに対してスペースに「URLマップ」を作成している時、プレビューボタンを表示するようにしました。
- ユーザーアーカイブを指定している時、ユーザーのプロフィール画面にパーマリンク欄が表示されるようにしました。
- RESTfulAPIで「confirm」メソッドを経ずに「submit」した時に添付ファイルが送信できない問題を修正しました。
- RESTfulAPIで「submit」メソッドを実行時に「Undefined variable $rel\_model」「Undefined variable $error\_msg」エラーが出る問題を修正しました。
- テーマ「Media」のトップページがライブプレビューに対応しました。
- モデル「upload\_file」のスキーマアップグレードが完了していない時プラグイン「VideoCaptions」を有効化できないようにしました。
- モデル「upload\_file」を更新した時に、作成日・作成者が更新される問題を修正しました。
- プラグイン「Theme\_GitHub」でGitHubからpullしたテーマを編集してpushすると、不正なアクセスですとエラーが表示される問題を修正しました。
- プラグイン「HTMLImporter」で前処理に指定のある時「Undefined array key 1」エラーが出るケースを修正しました。
- ライブプレビューの設定のある時、ファイルにアップロードした動画がプレビューできない問題を修正しました。
- プラグイン「AppProperties」で JSONのデコードに失敗した時のエラーが翻訳されない問題を修正しました。
- 環境変数「select\_preview\_urlmap」を指定していてもプレビューの選択肢が表示されない問題を修正しました。
- ビューに複数の URLマップを指定している時、「保存と再構築」でコンテキストが初期化されない問題を修正しました。
- PAMLのプロパティ「out」にビルド結果のキャッシュが残っている時、以降の別のビューのビルド時にキャッシュヒットしないと、その値が返ってしまうケースを修正しました。
- モデルを含むテーマの適用時に「PDOException: SQLSTATE: Base table or view already exists:」エラーが出るケースを修正しました。
- プラグイン「BannedWords」で校正支援実行時に「Extra content at the end of the document」エラーが出るケースを修正しました。
- 記事やページで本文欄を非表示にすると公開ページのURLやリンクボタンも一緒に非表示になる問題を修正しました。
- ビューの「ファイルへのリンク」を設定している時、ビューの保存時にテーマの「theme\.json」がアップデートされない問題を修正しました。
- 「保存して複製」を押して保存した時にバリデーションエラーになった時、次に保存した時に新しくオブジェクトが作成される問題を修正しました。
- プラグイン「SearchEstraier」で、更新がなかった時に検索インデックスのアップデートが実行されるケースを修正しました。
- プレビューやバックグラウンド再構築後に PHPプロセスが残る問題を修正しました。
- URLオブジェクトの md5値が更新されないケースを修正しました。
- 数値型の添付ファイルカラムの画像のサムネイルのサイズをアセットなどのバイナリカラムのサムネイルのサイズと統一しました。
- 添付ファイルカラムの拡張子を制限している時、拡張子チェックが作用しない問題を修正しました。
- ワークフローの設定が「直列」で「グループのメンバーのみを選択する」を選択している時、差し戻し・承認依頼のユーザーが選択できないケースを修正しました。
- テーマの適用時にビューの名前やベースネームなど JSONに指定した値に更新されない問題を修正しました。
- \_\_destructでトランザクションが有効な時、コミットするようにしました。
- ファンクションタグ「mt:getobjectname」に存在しないカラムを指定した時「PADOBaseModelException: unknown column 'status' for model 'モデル名'」エラーが出るケースを修正しました。
- プラグイン「Theme\_GitHub」で追加したユーザーモデルのカラムがキャッシュをクリアするまで認識されない問題を修正しました。
- ファンクションタグ「mt:customfieldvalues」の「index」モディファイアに0を指定しても意図したフィールドが取得できない問題を修正しました。
- 会員サイトの機能で「return\_to\_dashboard」が呼ばれた時管理画面 URLに遷移しないようにしました。
- 「パスワードハッシュ」型のカラムを「NOT NULL」指定している時、新規オブジェクトの作成時に値がなくてもエラーにならない問題を修正しました。
- プラグインで追加しているフィルタやアクションの「hint」が翻訳されない問題を修正しました。
- 数値型のカラムを新たに「NOT NULL」指定した時「Field '別の NOT NULLカラム' doesn't have a default value」エラーが出るケースを修正しました。
- 数値型の「添付ファイル」カラムを必須にした時、添付ファイルがなくてもエラーにならない問題を修正しました。
- 再構築トリガーの設定がスコープにない時、スケジュールタスクでの予約公開時にコンテナによって関連づけられているアーカイブが再構築されない問題を修正しました。
- プラグイン「UploadUtilities」の ZIPファイルの展開時に他のプラグインのコールバック中で「Attempt to read property」エラーが発生する問題を修正しました。
- 画像処理関係のメソッドで画像フォーマットが拡張子と異なる時、または画像処理に失敗した時に 500エラーになる問題を修正し、エラーログにエラーを出力するようにしました。

## 2023\-09\-19

ver.3\.522 / version 2\.7522

- mt:includeタグの不正なコンパイル・キャッシュが生成されるケースを修正しました。
- PAMLのバージョン3以下のサポートを打ち切りました。

## 2023\-09\-14

version 3\.52 / version 2\.752

- 環境変数「use\_casket」を追加しました。アプリケーション・キャッシュをメモリに保存して動作の高速化をはかります。初期値は trueです。
- 環境変数「filter\_archive\_active」を追加しました。URLの「有効なアーカイブ」フィルタに「mime\_type」の配列またはカンマ区切りテキストを指定することができます。
- ファンクションタグ「mt:assetthumbnailurl」に属性「keep\_aspect」を指定できるようになりました。widthと heightを指定してサムネイルを作成する時はみ出した部分はカットしてアスペクト比を維持したサムネイルを作成します。
- ファンクションタグ「mt:assetthumbnailurl」に属性「fit」を指定できるようになりました。「square」とあわせて指定します。長辺を基準に余白あり、トリミングなしで正方形の画像を作成します。属性値に HexColorCodeを指定すると余白の背景色を指定できます。省略時は透過、もしくは白です。
- ファンクションタグ「mt:videothumbnailurl」「mt:videoplaylisturl」「mt:videochapterurl」「mt:videovtturl」を追加しました。
- プラグイン「VideoCaptions」が有効で FFmpegが利用可能な時、動画の幅、高さ、動画とオーディオの再生時間をセットするようにしました。
- プラグイン設定を保存した時・リセットした時に保存されるログのカテゴリを「plugin」に変更しました。
- 「format」「format\_ts」モディファイアに「K\(和暦0埋めなし\)」「k\(和暦0埋めあり\)」を指定可能になりました。
- ユーザーの「入力欄の境界色」カラムに値がない時の初期値を「\#7F9DB9」としました。
- ユーザーのプロフィール画面で自分自身が管理者の時、チェックを外そうとした時に警告・確認メッセージを表示するようにしました。
- そのユーザーがシステムで唯一のユーザーの時、管理者権限を外せないようにしました。
- モデルの設定画面でリレーション型のカラムの「詳細」を開いた時、一覧表示を「なし」「参照」編集表示を「なし」「リレーション」のみを選択可能にしました。
- PTFileMgrクラスにメソッド「touch」を追加しました。
- 一覧画面のオブジェクトの loadの直前に「before\_listing」コールバックを追加しました。
- プラグイン「AWS\_S3」の設定に「除外する拡張子」を追加しました。
- プラグイン「AWS\_S3」の環境変数「aws\_s3\_realtime\_maxsize」の初期値を「104857600\(100MB\)」に変更しました。
- プラグイン「AWS\_S3」の環境変数「aws\_s3\_use\_custom\_mapping」を「true」に設定すると拡張子毎に別のバケットを指定できるようになりました。
- プラグイン「AWS\_S3」でバケットのオブジェクトの一覧からオブジェクトを削除できるようになりました。
- プラグイン「AWS\_S3」で環境変数「aws\_s3\_use\_mediaconvert」を指定すると連携している「AWS Elemental MediaConvert」のジョブの一覧を確認できるようになりました。
- プラグイン「PostOnTwitter」に関する管理画面などの表記を「𝕏」に変更しました。
- プラグインが有効化できなかった時プラグインの「upgrade\_functions」をスキップするようにしました。
- PTUtil::remove\_dirメソッドでディレクトリをリネームしてから削除するようにしました。
- プラグイン「CacheManager」で「File」「APCu」以外を指定しているとき、個別のキャッシュを一覧表示して削除できるようになりました。
- グローバルモディファイア「split」「join」の属性値に「\r」「\n」を指定できるようになりました。
- モデルが「複製」できる設定になっている時、リビジョン一覧画面からリビジョン作成アイコンを削除しました。
- ファンクションタグ「mt:getobjectlabel」で「id」を省略した時、現在のコンテキストのオブジェクトを取得するようにしました。
- リッチテキストエディタ TinyMCEのバージョン 6を利用している時、エディタに「入力欄の境界色」を適用するようにしました。
- GROUP BYでユニークなレコードを抽出している時、カウントの不要なものを DISTINCTに変更することによって、一覧画面などの表示速度が高速化されました。
- 環境変数「sitesync\_binary」「sitemap\_binary」を追加しました。trueを指定するとツリー表示のディレクトリ・ファイル名の大文字小文字を区別するようになります\(falseの方が高速\)。
- 「ts\_job」モデルにカラム「retry\_interval」を追加しました。次の試行までの間隔を秒で指定します。
- キューがスキップされた時、エラーが指定されていないケースではログにエラーが残らないようにしました。
- 開発者モードの時、プラグイン設定ダイアログで保存時にダイアログを閉じないようにしました。
- リレーションのバッジのテキストのスタイルを修正してテキストが省略されないようにしました。
- グローバルモディファイア「zero\_pad」に利用する関数を「sprintf」から「str\_pad」に変更しました。
- PADOクラスにメソッド「query」を追加しました。
- PTMySQLクラスでプリペアドステートメントをキャッシュするようにしました。
- PADO\_DB\_PASSWORD に「#」が含まれている時、「tools/backupSQL\.php」「tools/restoreSQL\.php」が実行できない問題を修正しました。
- PTUtil::normalizeで「⁄」\(Fraction Slash\)を「/」に置き換えるようにしました。
- メニューから「URL」を選択する時、オブジェクトのタイトルなどのプライマリカラムの値で検索できるようになりました。
- 環境変数「max\_batch\_actions」を追加しました。一覧画面のアクションの最大実行数の上限を数値で指定します。
- 環境を移行した時、テーマディレクトリやサポートディレクトリが変更された時にリンクされたテンプレートのパスが変更になる対策として、テーマのパスを相対パス化して保存するようにしました。
- サーバーの環境によって Chunk Uploadに失敗するケースを修正しました。
- システムまたはスペースのタイムゾーンの値が空の時「date\_default\_timezone\_set\(\): Timezone ID '' is invalid 」エラーが残る問題を修正しました。
- プラグイン「LinkChecker」で外部リンクチェックの結果ステータス「303」「307」が返却された時、リダイレクト先をチェックするようにしました。
- テンプレート・タグの name属性に「\.」で配列のキーを指定した時、以降の属性値が正しく展開されない問題を修正しました。
- モデル保存後に遷移後の画面がホワイトアウトするケースを修正しました。
- 一覧画面表示の「pre\_listing」コールバックの呼び出しタイミングを SELECT文の直前に移動して配列にセレクト対象のカラム名を渡すようにしました。
- 「モデル\.json」ファイルによって登録されたモデルに後から「有効期限対応」設定を適用したモデルのオブジェクトが正しくポップアップからの再構築されないケースを修正しました。
- プラグイン「AWS\_S3」のS3バケットの一覧表示で URLが正しくならないケースを修正しました。
- プラグイン「HTMLImporter」で記事やページのカテゴリやフォルダを自動生成する設定の時 Prototypeの set\_languageメソッドでエラーが出るケースを修正しました。
- 画面オプションで「hide\_edit\_options」に指定されたカラムのチェックボックスが表示されない問題を修正しました。
- プラグイン「FileUploader」でファイルをアップロードしなおした時に「Fatal error: Call to undefined method」エラーになる問題を修正しました。
- プラグイン「FileUploader」のファイルモデルの保存時にバリデーションエラーになった時、アップロード・パスが引き継がれない問題を修正しました。
- プラグイン「FileUploader」でファイルに対して URLマップを指定している時、ファイルのプレビューURLがアーカイブのURLになる問題を修正しました。
- プラグイン「SplitPage」と「Abs2Rel」を併用している時、分割対象の最初のページが相対パス変換の対象にならない問題を修正しました。
- プラグイン「SplitPage」でコンテナによる絞り込みが効かない問題を修正しました。
- スケジュールタスクで再構築されたビューの中でサムネイルを作成した時に「Attempt to read property "id" on null」エラーがログに記録される問題を修正しました。
- スケジュールタスク実行時に URLの再パブリッシュ実行時に「Undefined property: PTWorker::$ctx \(2\) occured」エラーがログに記録される問題を修正しました。
- RESTfulAPIでログインせずにオブジェクトの一覧を取得した時に「	Undefined variable $rel_model \(2\) occured」エラーがログに記録される問題を修正しました。
- RESTfulAPI経由でオブジェクトを削除した時、プラグイン「SearchEstraier」の検索インデックスからリアルタイムに削除されない問題を修正しました。
- 環境変数「api\_methods」指定がある時、モデルとスコープに対して「APIを有効化」チェックがなくても RESTfulAPIを利用できるようにしました。
- ソースファイルの拡張子と出力ファイルの拡張子が異なる時サムネイルの作成に失敗する問題を修正しました。
- 環境変数「wait\_export」指定のある時、エクスポートデータのダウンロードが始まらないケースを修正しました。
- 何らかの理由で Prototypeクラスの initメソッドが複数回呼ばれたとき「Cannot redeclare prototype\_image\_resize\(\)」エラーが出る問題を修正しました。
- 環境変数「abs2rel\_preview」指定のある時 URLマッピングの指定のないビューのプレビューで「Undefined array key」エラーログが残る件を修正しました。
- プラグイン「VideoCaptions」で、HLS変換後に作成される URLにスペースの IDがセットされない問題を修正しました。
- 環境変数「wait\_export」指定のある時、生成された ZIPファイルのダウンロードが始まる前に完了後の一覧画面に遷移してしまう問題を修正しました。
- backupSQLの実行時に「Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions,」が出力される問題を修正しました。
- プラグイン「HTMLImporter」で ZIPファイルからのインポートに失敗する問題を修正しました。
- プラグイン「ImageWebP」が有効で環境変数「fmger\_delayed」指定のある時、変換時に「File ファイル名 does not exist\.」エラーが出る問題を修正しました。
- プラグイン「MachineTranslator」の「Webページを翻訳する」機能で文字化けがおこるケースを修正しました。
- プラグイン「SingleSignOn」で設定した秘密鍵・証明書ファイルを読み込めない問題を修正しました。
- プラグイン「SingleSignOn」の「クライアント\(SP\)で署名機能を利用する」設定を有効にできない問題を修正しました。
- Video.jsバージョン8.5を同梱しました。ファイルの編集画面のビデオ再生にはVideo.jsバージョン8.xを利用するようになりました。videojsscriptタグで出力するVideo.jsのバージョンはlink属性で設定します。バージョン8.xを利用する場合はlink属性値に「8」を指定してください。
- 条件タグ「mt:if」と「note」モディファイアを組み合わせている時、意図した結果にならないケースを修正しました。
- ダッシュボードウィジェットの「order」キーが重複している時、オーダーごとに 1つめのウィジェットしか表示されない問題を修正しました。
- PHP設定「max\_input\_vars」の問題を回避するため、階層の管理画面で設定をひとつの JSONデータにまとめて送信するようにしました。
- モデルのステータスの有効期限対応のチェックを入れてから外すと矛盾が生じてステータスが正しくせってできなくなる問題を修正しました。
- プラグイン「UploadUtilities」で「同じパスのファイルを上書きする」にチェックを入れた時、アセットのリビジョンが対象となる問題を修正しました。
- 一覧画面でキーワード検索した時にマッチしたトータルの件数が「0」になるケースを修正しました。
- プラグイン「SiteSync」の翻訳漏れを修正しました。
- 「query\_cache」が有効の時、一部のカラムのみを SELECTした時の不完全なオブジェクトをキャッシュしないようにしました。
- プラグイン「BannedWords」で配列を explodeしようとしてエラーになるケースを修正しました。
- workspace\_idカラムのあるモデルに対するリレーション型のカラムの編集表示をチェックボックスにした時に選択肢が表示されない問題を修正しました。
- 環境変数「logging」が falseの時もエラーログが記録されるケースを修正しました。
- スペースの URLマップでコンテナ指定のある時「同一スコープのオブジェクトのみを対象とする」チェックボックスが表示されない問題を修正しました。
- 画像フォーマットを変更してサムネイルを作成しようとした時、第3引数 $quality が適切なものにならない問題を修正しました。
- スケジュールタスクに task\_idsを指定して実行した時、指定日公開を除外している時に「foreach\(\) argument must be of type array|object, null given」エラーが出る問題を修正しました。
- オブジェクトのタグをループ出力するテンプレート・タグで「Attempt to read property "name" on null」エラーが出るケースを修正しました。
- プラグイン「ComponentBlocks」でフィールドのキーにハイフンを使用すると値が保存できないケースを修正しました。
- プラグイン「ComponentBlocks」を Windows 環境で利用した場合に必要な JavaScript ファイルを読み込めずにエラーとなる問題を修正しました。
- URLマップのビルド時にダイナミックタグが初期化されずに意図したパスを出力しないケースを修正しました。
- 一覧画面の画面オプションの「検索」のカラム指定が無視されていた問題を修正しました。
- 「by\_association\_col」が「user\_id」の時、スペースのオブジェクトの一覧画面で「グループのリスト」のフィルタが効かない問題を修正しました。
- モデルの複数形にスペースを含むときにモデル個別の「per\_rebuild」が指定できない問題を修正しました。
- GitHubからのテーマのエクスポートに失敗したときにエラーが表示されないケースを修正しました。
- プラグイン「SiteMap」でシステムのダッシュボードでシステムスコープの URLが存在しないとき配下のツリー含めて表示されない問題を修正しました。
- プラグイン「AxeRunner」の依存モジュール（axe-core, Puppeteer）を更新しました。既にプラグインを利用している環境ではa11ycheckディレクトリで`npm i`を実行して新しいバージョンのモジュールをインストールします。
- PTFileMgrクラスの「copy\_recursive」メソッドが一部のファイルしかコピーしない問題を修正しました。
- プラグイン「BannedWords」の設定でシステムの設定を継承する時、モデル選択以外の項目を非表示になるようにしました。
- アセットモデルのファイルに対する拡張子の制限を指定している時、一覧画面からのアップロードでチェックが効かない問題を修正しました。
- プラグイン「ComponentBlocks」で「foreach\(\) argument must be of type array|object, null given」エラーが出るケースを修正しました。
- フォーマット「リッチテキスト」以外で編集支援ボタンからルビを振るときにキャンセルボタンをクリックしたときに「null」がルビになるケースを修正しました。
- オブジェクトの編集画面で「保存して複製」ボタンをクリックしてバリデーションエラーになった時の振る舞いを修正しました。

## 2023\-08\-03

version 3\.51 / version 2\.751

- 管理画面の一覧画面のキーワード検索で大量にオブジェクトが登録されている時の処理でメモリを節約するようにしました。
- memory\_limitの制限をファイルのサイズが超えている時、PTFileMgrの copy / renameメソッドに失敗する問題を修正しました。
- プラグイン「ImageInfo」でマルチバイトファイル名を含む PDFの評価に失敗する問題を修正しました。
- プラグイン「MachineTranslator」の翻訳支援機能で主語を含んでいるにも関わらずエラーが出る問題を修正しました。
- プラグイン「ComponentBlocks」でマルチブロックで利用できるブロックを選択しているにもかかわらずバリデーションエラーになる問題を修正しました。
- プラグイン「ComponentBlocks」が PHP 7.4 未満で構文エラーとなる問題を修正しました。
- tableモデルのアップグレード時に「PADOBaseModelException」エラーログが残る問題を修正しました。
- プラグイン「SearchEstraier」で画像のサムネイルを生成する時に「Serialization of 'PDO' is not allowed」エラーが出る問題を修正しました。

## 2023\-08\-01

version 3\.5 / version 2\.75

- プラグイン「ComponentBlocks」を追加しました。ブロックエディタ機能を追加します。
- RESTfulAPIでリレーション先のオブジェクトにステータスがある時、権限のないオブジェクトはデータを返さないようにしました。環境変数「api\_permitted\_objs」に「false」を指定することで従来と同じ振る舞いとなります\(初期値は「true」\)。
- プラグイン「HTTPAuth」を追加しました。管理画面やサイトURLに対して HTTP認証を設定します。
- プラグイン「ImageInfo」で画像からのテキスト抽出が「webp」に対応しました。
- 環境変数「cfg\_encrypt\_key」「encrypt\_dbpassword」を追加しました。両方を指定すると「cfg\_encrypt\_key」の値をキーにして「AES\-128\-ECB」暗号化したパスワードを定数「PADO\_DB\_PASSWORD」に指定することができるようになります。
- 「tools/encryptDBPassword\.php」を追加しました。引数「\-p」にパスワード、「\-r」に「cfg\_encrypt\_key」を更新する場合の文字数を指定して、「db\-config\.php」「config\.json」をアップデートします。
- 環境変数「worker\_debug」を追加しました。各タスクの実行時間と正常に終了したかどうかをログに記録します。
- PTUtil::make\_passwordを追加しました。現在のパスワードポリシーに沿ってパスワードを生成します。
- PTUtil::file\_findでリストアップするパスに、指定したディレクトリ自身を含めないようにしました。
- 「tools/backupSQL\.php」「tools/restoreSQL\.php」に引数「\-\-blob」を指定可能にしました。「PADO\_DB\_BLOB2FILE」指定のある時、ディレクトリのアーカイブを作成してバックアップ・復元します。
- モデル「情報分類」を追加しました。リレーションを設定することによってすべてのスコープのモデルを対象としたタグやカテゴリのように利用することができます。
- 環境変数「tag\_permission」「taxonomy\_permission」を追加しました。指定なしの場合は従来通り、「1」を指定すると、記事などの編集画面からの新規追加が許可されず\(入力したタグが既に存在する場合はタグ付けされ\)「2」を指定すると記事などの編集画面に追加するタグの入力欄が非表示になります。
- プラグイン「Keywords」が「情報分類」の自動セットに対応しました。
- ブロックタグ「mt:relatedobjects」を追加しました。「mt:entrycategories」などのリレーション先のオブジェクトをループ出力するタグと同等の汎用タグです。
- クラス PADOBaseModel の load / load\_iter / count メソッドの第2引数 $args で JOINを指定する時「BETWEEN」「IN」「NOT IN」「!=」などの式の指定ができるようになりました。
- クラス PADOBaseModel の load / load\_iter / count メソッドの第2引数 $args で JOINを指定する時'BINARY'指定ができるようになりました。
- Prototypeクラスのメソッド「bake\_cookie」が PHP 7\.3\.0 以降で使える代替のシグネチャに対応しました。
- Prototypeクラスのメソッド「error」が呼ばれた時にエラーログを保存するようにしました。
- Prototypeクラスのメソッド「can\_do」に対応するコールバックを追加しました。
- プラグイン「MachineTranslator」の文の難易度チェックの和暦と時刻表記のチェックが漢数字に対応しました。
- プラグイン「MachineTranslator」のブロックキャッシュ機能を廃止しました。
- プラグイン「VideoCaptions」で、サムネイル付き、JSON形式のチャプターを作成できるようになりました。
- 環境変数「video\_captions\_thumbnail\_sec」を追加しました。0より大きい数値を指定すると、ビデオにサムネイルを作成できる設定済みの時、初期値となります。
- 「別のモデル名\_id」というカラムを作成して、数値設定されている時、そのオブジェクトが存在する時、リレーションの関連オブジェクトににそのオブジェクトが含まれる問題を修正しました。環境変数「get\_relations\_compat」を trueとすると従前の振る舞いと同等となります。
- プラグインで追加する「システムフィルタ」「アクション」に「parmission」「condition」を指定できるようになりました。
- 環境変数「video\_captions\_hls\_mkdir」を追加しました。falseを指定すると、MP4ファイルと同じディレクトリに HLSのファイル群を作成し、trueを指定するとオリジナルファイルのベースネーム名のディレクトリを生成します\(初期値は「true」\)。
- 設問タイプに「隠し項目\(Input Hidden\)」を追加しました。
- 外部プレビューの POSTリクエストに「\_external\_preview」パラメタを追加しました。
- ウィジェットの作成・編集画面のリッチテキストエディタの高さの初期値を「20」に変更しました。
- 日付型のカラムを「NOT NULL」指定した時オブジェクトの作成画面で現在日時がセットされるようにしました。
- ブロックタグ「mt:workflowusers」にコールバック「post\_load\_objects」を追加しました。
- ブロックタグから呼ばれるすべての「post\_load\_objects」コールバックにタグの「$args」をセットするようにしました。
- 環境変数「\{model\}\_csv\_exclude\_cols」を追加しました。CSVから除外するカラムを配列\(またはJSON\)で指定します。
- 環境変数「\{model\}\_workspace\_id」を追加しました。リレーション選択のダイアログを指定したスコープに向けます。
- 会員登録テンプレートの送信ボタンの二重クリックを防ぐためにクリック時にボタンを disabledにするようにしました。
- ロールのモデルに対する権限に「グループのリスト」「グループのオブジェクト」を追加しました。ユーザーを判別するカラムは環境変数「by\_association\_col」で指定可能です。初期値は「user\_id」です。
- ワークフローの設定に「グループのメンバーのみを選択する」設定を追加しました。
- プラグイン「HTMLImporter」に「\.js」ファイルと「\.css」ファイルをアセット登録する機能を追加しました。
- プラグイン「HTMLImporter」の本文取り込み設定に「HTML全体」を追加しました。
- プラグイン「HTML\_CodeSniffer」で見出しセルのない表\(table\)の扱いを「要確認」から「警告」に変更しました。
- プラグイン「BannedWords」で正規化対象外の文字を指定できるようになりました。初期値は丸付き数字です。
- プラグイン「BannedWords」で和暦を西暦に変換する機能を追加しました。
- プラグイン「BannedWords」の「禁止ワード」「禁止用語」を「修正の提案」に変更しました。
- プラグイン「BannedWords」で複数の修正の提案のある時のみ「全てを選択する」チェックボックスを表示するようにしました。
- プラグイン「BannedWords」の処理のコールバック実行タイミングを「pre\_save」から「save\_filter」に変更しました。
- プラグイン「BannedWords」で修正の提案が検知されたリッチテキスト型のフィールドがハイライトされない問題を修正しました。
- プラグイン「BannedWords」で編集タイプが選択項目のカラムのチェックをスキップするようにしました。
- プラグイン「SimplifiedJapanese」が有効でサーバーに「mecab」がインストールされている時プラグイン「BannedWords」で常用漢字チェックなどいくつかの追加指定が可能になりました。
- プラグイン「SimplifiedJapanese」のモデル「ユーザー辞書」にカラム「固有名詞」を追加しました。
- 再構築、アクション適用後の再構築、CSVのエクスポートデータ生成の待機状態の画面のデザインを変更しました。
- 外部プレビューのパスワード入力画面のデザインを CMSのログイン画面のデザインと統一しました。
- PTRESTfulAPIの各バージョンの初期化直前に、アプリのプロパティをコピーするようにしました。
- プラグイン「VideoCaptions」で HLS変換処理の終了時に所要時間をログに残すようにしました。
- プラグイン「SplitPage」でページ分割処理の終了時に所要時間をログに残すようにしました。
- プラグイン「SplitPage」が日付ベースアーカイブに対応しました。
- モデル「ts\_job」にフラグを追加して、重複実行をしないようにしました。
- モデル「ts\_job」に「max\_per\_once」カラムを追加しました。1回のスケジュールタスクでのキューの実行数上限を指定できます。
- 「mt:entries」などのオブジェクトをループするタグの「post\_load\_objects」コールバックにキー「object\_loop\_canceled」をセットすることで、ビルドの処理をキャンセルできるようになりました。
- 環境変数「splitpage\_delayed\(初期値 true\)」「splitpage\_delayed\_sleep\(初期値10\)」を追加しました。プラグイン「SplitPage」のページ分割処理をバックグラウンドで遅延実行します。
- 環境変数「splitpage\_wait」\(処理が重複した時に前回実行に要した時間待つ\)「splitpage\_skip」\(分割中に次のリクエストが呼ばれたらスキップする\)を追加しました。初期値はいずれも trueです。
- 環境変数「views\_per\_rebuild」の初期値を「5」としました。
- 環境変数「list\_header\_truncate」を追加しました。一覧画面のヘッダ行のカラム名を省略する文字数を指定します。初期値は 10です。
- CSVエクスポートのタイムアウト対策のための環境変数「wait\_export」を追加しました。一覧画面のアクション「CSV」エクスポートで、データが生成されるのを待ってからダウンロードを行います。初期値は trueです。
- 一覧画面のアクションからリビジョンをマスタに適用した時にワークフローのメールが送信されるようになりました。
- モデル「フレーズ」のインポート時、フレーズをキーにして上書きインポートするようにしました。
- アセットなどの 2カラムの編集画面の右カラムの幅を大きくしました。
- プラグイン「ExternalPreview」で個々のオブジェクトごとに個別のパスワードを指定できるようになりました。
- 「URLの再パブリッシュ」の処理を Prototypeクラスの「publish\_obj」から PTPublisherクラスの「publish」メソッドに変更しました。
- プラグイン「ExternalPreview」で編集画面に挿入するコードのテンプレートファイル名を「external\_preview\_footer\.tmpl」として、代替テンプレートを指定できるようになりました。
- プラグイン「ExternalPreview」で「user\_id」カラムのないモデルのバイナリカラムのデータのプレビューができない問題を修正しました。
- PHP設定「max\_input\_vars」の問題を回避するため、モデルの編集画面でカラムの設定をひとつの JSONデータにまとめて送信するようにしました。
- 環境変数「log\_level」に「4」を指定することで、エラーログファイルに出力されるメッセージを管理画面のシステムログにも保存できるようになり、初期値を「4」としました。
- 環境変数「assets\_c」の指定があるとき、1つのオブジェクトに対して 1つだけサムネイル画像を生成するようにしました。
- モデル定義の JSONに「is\_new」を指定することができるようになりました。trueを指定すると、すでに同名のモデルを作成済みの環境ではそのモデルを有効化できなくなります。
- PDOの初期化時に「PDO::ATTR\_STRINGIFY\_FETCHES」を指定するようにしました。環境変数「db\_stringify」に「false」を指定することで無効化できます。
- フォーマットがリッチテキストではない時に表示されるタグ入力補助ボタンを「a」から「button」に変更して title属性を追加しました。
- PTUtil::set\_tags、PTUtil::add\_tagsを追加しました。第二引数にタグの配列またはオブジェクトの配列を渡してタグをセットします。第三引数に「taxonomy」を指定するとタグのかわりに情報分類を関連づけます。
- PTUtil::year\_to\_wareki、PTUtil::str\_to\_christian\_era、PTUtil::knum\_to\_numを追加しました。
- PTUtil::array\_unset、PTUtil::start\_end\_week、PTUtil::end\_widthを追加しました。
- PTUtil::thumbnail\_urlの引数 $args に「extension」を指定して異なるフォーマットのサムネイルを生成できるようになりました。
- オブジェクトの作成・編集画面でバリデーションのエラーがあった時、フィールドに赤い枠線が表示されるようにしました。色指定は環境変数「error\_bordercolor」で設定できます。
- プラグイン設定画面に「cfg\_header」「cfg\_footer」を追加できるようになりました。
- オブジェクトの作成・編集画面で保存ボタンをクリックした際に追加する処理について「await」を追加しました。
- ダイアログからのオブジェクトの選択で「ids\_only」パラメタを付けることでオブジェクトのIDのみをフィールドにセットするモードを用意しました。
- 環境変数「tinymce\_version」の初期値を「6\.3\.2」に変更しました。
- プラグイン「TinyMCE」のデフォルトボタンから「indent」「outdent」とセパレータを削除し「blockquote」を追加しました。
- プラグイン「TinyMCE」の「空要素のフォーマット」の初期値を「xhtml」から「html」に変更しました。
- 画面オプションで一覧画面のソート順を強制している時、画面オプションのダイアログにラベル「ソート」が表示されないようにしました。
- プラグイン「SearchEstraier」「Keywords」「SimplifiedJapanese」の mecabなどに関する環境変数をプラグイン「AppProperties」で統一するようにしました。
- プラグイン「SearchEstraier」の「mt:estraiersearch」タグで「workspace\_ids」に「all」が指定できるようになりました。
- プラグイン「SearchEstraier」で表記統合辞書を利用した表記揺れの吸収を行うようにしました。また、プラグイン設定で表記揺れのパターン追加ができるようになりました。
- オブジェクトの編集画面の「col\-lg\-2」の最大幅指定をレスポンシブ対応しました。
- モデル「URL」のカラムの編集タイプを一部変更しました。
- 一覧画面からオブジェクトのステータスを変更した時にワークフローの設定によりユーザーが変更されたことを記録するログにオブジェクト名が入るようにしました。
- リビジョンの更新日がマスタの更新日より新しい時「このリビジョンの作成後にマスターが更新されています。」のメッセージを出さないようにしました。
- テーマの「\.htaccess」で存在する静的ファイルが pt\-view\.phpに渡るケースを修正しました。
- 「cache\_driver」に「Memcached」を指定している時に初期化できない問題を修正しました。
- 「mt:trans」タグと Prototype/PTPluginクラスの「translate」メソッドで第2引数に「0」を渡した時にパラメタが展開されない問題を修正しました。
- 本文抽出自動処理で HTMLの構造によって「Couldn't fetch DOMElement\. Node no longer exists」エラーが出るケースを修正しました。
- 定数「PADO\_DB\_CLEANUP\_BLOB」を指定している時、アセットの上書きアップロードでアセットのリビジョンのバイナリデータが失われる問題を修正しました。
- 環境変数「hash\_multibyte\_filename」「no\_encode\_filename」指定のない時、空白文字を含むアセットの URLが正しくセットされないケースを修正しました。
- モデル設定「最大リビジョン数」が「0」またはマイナスの値の時、リビジョンをマスタに適用するとリビジョンが残る問題を修正しました。
- カスタム編集タイプの管理画面テンプレートが正しく処理されないケースを修正しました。
- 一覧画面で get\_thumbnailメソッドで画像のサムネイルを取得しようとした時、存在しないオブジェクトのIDを指定すると「Uncaught Error: Call to a member function has\_column\(\) on null」エラーが出る問題を修正しました。
- プラグイン「URLRedirect」のドキュメントに動作させるための前提を追記しました。
- フォームのリッチテキストの高さの初期値を「8」から「12」に変更しました。
- プラグイン「MTMLReference」で「entrytags」などのリレーション先のオブジェクトを取得するタグのドキュメントに属性「include\_draft」の説明を追加しました。
- プラグイン「HTMLImporter」「LinkChecker」でリンク先が取得できないケースを修正しました。
- ワークフローのユーザー選択画面で、管理者ユーザーが公開者に含まれないケースを修正しました。
- リビジョン一覧画面のアクション「マスタに適用」後にオブジェクトがパブリッシュされない問題を修正しました。
- リビジョン一覧画面のアクション「マスタに適用」後にオブジェクトのメタデータが更新されない問題を修正しました。
- 編集表示が選択項目のカラムのオプションに escape 対象の文字が含まれるとき、編集画面で選択済みにならない問題を修正しました。
- RESTfulAPIのエンドポイントに存在しないモデル名を指定した時に「PDOException」エラーログが出力される問題を修正しました。
- プラグイン「SimplifiedJapanese」のメソッド「get\_mecab」で辞書を引数に渡した時に、待機状態となる問題を修正しました。
- 「encode\_js」「encode\_json」「encode\_json\_unescaped\_unicode」モディファイア\(または、escapeモディファイアの当該の引き数指定\)に数値型の値を渡した時、値が出力されない問題を修正しました。
- opモディファイアが渡された値を数値型にキャストさせていた処理を省き、従来と同等の結果を返すようになりました。
- アセットのリビジョンで「ファイル名」が拡張子なしの時、一覧画面からマスタに適用すると拡張子の「\.」が重複する問題を修正しました。
- モデル「table」にカラムを追加してアップグレードした時「PADOBaseModelException: unknown column 'カラム名'」エラーがログに記録される問題を修正しました。
- 一覧画面でサムネイルクリック時ブラウザのコンソールに「Tooltip is transitioning」エラーが出る問題を修正しました。
- 環境変数「assets\_c」の指定があるとき、リビジョンをマスタに適用した際にサムネイル画像が更新されない問題を修正しました。
- オブジェクトの編集画面からリビジョンとして保存した時に「created\_on」カラムの値がユーザーのIDにセットされる問題を修正しました。
- 環境変数「update\_rev\_created」指定のある時、マスタが更新されたことを通知する機能が正しく動作していなかった問題を修正しました。
- ファンクションタグ「mt:offset」で配列のキーの渡し方によって「Cannot unset string offsets」または「TypeError: strpos\(\): Argument \#1 \($haystack\) must be of type string, array given」エラーが出るケースを修正しました。
- 一覧画面下部のアクション選択で入力欄やオプションのドロップダウンが連動して表示切り替えできない問題を修正しました。
- プラグイン「SplitPage」と「Abs2Rel」を併用している時にエラーログ Undefined index: publish\_type \(8\) occured が残る問題を修正しました。
- プラグイン「SplitPage」でエラーログ Undefined variable: tmplObj \(8\) occured が残る問題を修正しました。
- プラグイン「SplitPage」でコンテナ指定のあるアーカイブに「mt:setcointext」タグを指定すると元のコンテキストが失われる問題を修正しました。
- ポップアップウィンドウでの再構築でプラグイン「SplitPage」でページ分割処理を行った後コンテキストが変更され、次の画面が正しくビルドされない問題を修正しました。
- 日付型のカラムを「NOT NULL」指定で追加しようとした時「Incorrect datetime value: '0000\-00\-00 00:00:00' for column カラム名」エラーが出てカラムの追加に失敗する問題を修正しました。
- モデルのカラムに変更がない時も数値型のカラムを ALTER TABLE文でアップデートしに行くケースを修正し、不要な SQLを発行しないようにしました。
- 拡張子「ico」「svg」のファイルがアップロードできない問題を修正しました。
- スペースの一覧画面で「フィルタ」を削除した後、システムスコープの一覧画面に遷移してしまう問題を修正しました。
- プラグイン「UploadUtilities」でオブジェクトのステータスとアセットのステータスを同期する設定の時、関連元のオブジェクトを削除すると他のオブジェクトの状態に関わらずアセットのステータスが終了になる問題を修正しました。
- プラグイン「DisplayOptions」が有効な時、一覧、編集、階層の管理画面に存在しないモデル名を指定した時に「Base table or view not found」エラーがログに残らないようにしました。
- ビューの編集画面を開く時、保存する時にオブジェクトのループを出力するブロックタグの負荷が高くなるケースを修正しました。
- 環境変数「compile\_check」が falseの時、ビューのインクルード先のリストアップをしないようにしました。
- PTPluginクラスのメソッド「edit\_mime\_type」をビューのコンテキストで呼び出した時にメモリ不足で落ちるケースを修正しました。
- プラグイン「PluginStarter」で APIメソッドの「require\_login」が書き出されない問題を修正しました。
- 環境変数「api\_methods」がプラグイン「AppProperties」で設定した環境変数に指定されている時、設定が有効にならない問題を修正しました。
- 環境変数「workflow\_nextprev\_only」が true のとき、ワークフローにレビュワーが未設定だとワークフローを行えない問題を修正しました。
- 環境変数「workflow\_nextprev\_only」が true のとき、差し戻し・承認依頼のドロップダウンに所属している権限グループのユーザーが表示されている問題を修正しました。
- ワークフローの差し戻し・承認依頼ドロップダウンに現在の所有者が含まれている問題を修正しました。
- URLマップのファイル出力設定が「静的\(遅延\)」のオブジェクトを外部プレビューすると、ファイルが出力され URLの削除フラグが外れる問題を修正しました。
- プラグイン「EmailMagazine」「Members」の購読申し込み・会員登録フォームに、リレーション型のカラムの選択肢が表示されない問題を修正しました。
- プラグイン「BatchApproval」が環境変数「workflow\_nextprev\_only」に対応しました。
- PHP8で pt\-check\.php実行時に「Uncaught TypeError: Unsupported operand types: string \* int in」エラーが出る問題を修正しました。
- PHP8でプラグイン「SearchEstraier」で「Uncaught TypeError: Unsupported operand types: string \+ int」エラーが出る問題を修正しました。
- モデル詳細画面で「アクティビティを表示」が 2個表示される問題を修正しました。
- フォームの設問のメールアドレスにテンプレート・タグを含まない時、メールアドレスのバリデーションがエラーを返すケースを修正しました。
- RESTfulAPIでフォームに投稿した時、Permalinkなし、ObjectId・Model指定でオブジェクトの情報が正しくセットされない問題を修正しました。
- URLマップにコンテナの「オブジェクトがない時アーカイブを出力しない」指定のあるモデルがステータスカラムを持っている時、「Attempted to delete an object that should not be deleted」が出てアーカイブが正しく削除されないケースを修正しました。
- スケジュールタスク「URLのリセット」は廃止されました。環境変数「reset\_urlinfo」を trueに指定すると実行できるようになします。
- memory\_limitの制限をファイルのサイズが超えている時、PTFileMgrの copyメソッドに失敗する問題を修正しました。
- ジョブのフィルタから「クラス」を削除しました。
- URLオブジェクトの詳細画面でファイル出力が「静的\(遅延\)」の時表示が「ダイナミック」になる問題を修正しました。
- ワークフローで所有者が変更された時のログのメッセージを適切なものに修正しました。

## 2023\-05\-11

version 3\.4 / version 2\.74

- 環境変数「no\_encode\_filename」の初期値を「true」に変更しました。日本語などのマルチバイトファイル名を含むアセットのファイル名を%エンコードせずにそのままアップロードするように振る舞いが変更されます。
- ユーザーグループ機能を追加しました。ユーザーをグループ化して、ユーザーグループに対してまとめて権限を付与することができます。
- プラグイン「AssetScope」を追加しました。スコープ毎に他のスコープのアセットを利用可能にします。
- プラグイン「AWS\_CloudFront」のプラグイン設定に「常に無効化リクエストを送信するパス」を追加し、パスごとに実行待ち時間を指定できるようにしました。
- プラグイン「AWS\_S3」のプラグイン設定画面から、オブジェクトの一覧を表示し、S3上のオブジェクトの状態を確認できるようになりました。
- プラグイン「AWS\_S3」のプラグイン設定で「ACL」を「指定なし」にできるようになりました。
- プラグイン「AWS\_S3」で「キー」「シークレットアクセスキー」指定のない時「CredentialProvider」を利用するようにしました。
- プラグイン「AWS\_S3」の同期処理の速度を高速化しました。
- 環境変数「asset\_workspace\_id」を追加しました。指定した特定のスコープのアセットを利用します。
- 環境変数「abs2rel\_preview」を追加しました。true を指定するとプレビュー時にパスを変換します。初期値は falseです。
- 環境変数「externalpreview\_attachment\_exts」を追加しました。プレビューする添付ファイルの拡張子を配列で指定します。初期値は「pdf」です。
- 環境変数「plugin\_starter\_can\_existing」を追加しました。存在するプラグインやクラスの重複チェック結果を無視します。初期値は falseです。
- 環境変数「searchestraier\_api\_relative\_url」または「pt\-recommend\-api\.php」に「relative=1」パラメタを追加することで返却する URLをルート相対パスに変換するようにしました。
- 環境変数「searchestraier\_can\_bot」を追加しました。「pt\-recommend\-api\.php」へのリクエストに対するクローラーやボットのアクセスを許可します。初期値は falseです。
- 環境変数「machinetranslator\_can\_bot」を追加しました。ページ翻訳でクローラーやボットのアクセスを許可します。初期値は falseです。
- 環境変数「machinetranslator\_logging」を追加しました。ページ翻訳のログをログファイルに記録します。初期値は trueです。
- 環境変数「machinetranslator\_no\_index」を追加しました。ページ翻訳結果のページに「&lt;meta name=&quot;robots&quot; content=&quot;noindex&quot;&gt;」を追加します。初期値は trueです。
- グローバルモディファイア「basename」を追加しました。パスの最後にあるファイル名を返します。タグ属性に「no\_suffix」を指定すると拡張子を切り落とします。
- グローバルモディファイア「decode\_url\_basename」を追加しました。パスの最後のファイル名をURLデコードしたパスを返します。
- レコメンドAPIのビューのサンプルを画面のスクロール後、レコメンドエリアを表示する直前に非同期通信を開始するように変更しました。
- レコメンドAPIのタイプが「similar」の時、不要な DBへのクエリを省略し、結果をキャッシュするようにしました。
- ビューに含まれるループタグのオブジェクト数が多い時、ビューの編集画面の表示速度を改善しました。
- 画像のフォーマットが拡張子と異なる時、もしくは正しく処理できない画像をアップロードした時にエラーを表示するようにしました。
- 数値型のリレーションカラムを複数設定している時、リレーション型と数値型のリレーション設定がある時、Prototypeクラスの「load\_context\_objs」「load\_related\_objs」がすべての関連オブジェクトを返すようにしました。
- オブジェクトの一覧画面からスペースセレクタでスペースを移動する時、オブジェクトへの権限のない時そのスペースのダッシュボードに遷移するようにしました。
- 「tools/importFromCSV\.php」を追加しました。引数にファイル名、モデル名、ユーザー名を指定してオブジェクトのインポートを実行できます。
- 「pt\-accessanalytics\.php」に「workspace\_id」パラメタを付けることによって「uri」パラメタにルート相対パスを指定できるようになりました。
- 「pt\-recommend\-api\.php」に「workspace\_id」パラメタを付けることによって「uri」パラメタにルート相対パスを指定できるようになりました。
- カラム型「テキスト\(768\)」を追加しました。
- テキスト型のカラム長を変更しようとした時、設定しようとしているカラム長を超える既存のレコードが存在する時にエラーを出すようにしました。
- PTUtil::is\_not\_htmlを追加しました。
- コールバック「mail\_filter」のキー errorにエラーメッセージをセットできるようにしました。
- プラグイン「TinyMCE」に設定「高度な設定\(setup\)」を追加しました。
- プラグイン「TinyMCE」のデフォルトボタンに「pt\-dl\(説明リスト・定義リスト\)」を追加しました。
- プラグイン「HTMLImporter」に前処理\(置換\)を追加しました。
- 単一選択型の「画像」「ファイル」フィールドの選択済みのバッジにアセットを見るリンクを追加しました。
- リレーション型のカラムで選択したアセット以外のオブジェクトにパーマリンクの設定のある時、バッジにリンクを追加するようにしました。
- バイナリデータのハッシュ生成時に md5\_file関数を利用するようにしました。
- ダイアログ型のリレーションの一覧ダイアログと選択済みのバッジに、オブジェクトへの編集権限がない場合もサムネイルを表示するようにしました。
- オブジェクトの作成・編集画面でプラグイン「DisplayOptions」でメニュー表示を非表示にしているモデルに対するリレーション型のカラムを非表示にするようにしました。
- クラス「PTCache」にメソッド「exists」を追加しました。指定したキーのキャッシュが存在する時に「1」を返します。
- プラグイン「FileUploader」で「memory\_limit」を超えるサイズのファイルをアップロードした時、保存時に 500エラーになる問題を修正しました。
- 最大リビジョン数を「0」またはマイナスの値に設定している時、自動保存のリビジョンが作成されないようにしました。
- 「cache\_driver」が「File」以外の時ビューや URLマップのビルドが重複して実行される問題を修正しました。
- プラグイン「QuickEdit」による編集画面への遷移で、リンクURLが正しく解決できないケースを修正しました。
- プラグイン「EmailMagazine」のテストメール送信でメールアドレスに対するバリデーションが機能していない問題を修正しました。
- プラグイン「TinyMCE」のバージョン 6を指定している時、「print」「paste」プラグインの JavaScriptファイルが読み込めないエラーが出る問題を修正しました。
- ファンクションタグ「mt:assetthumbnail」タグを呼び出した時、コンテキストにセットされているオブジェクトがサムネイル出力対象のオブジェクトに変わってしまう問題を修正しました。
- ダイアログ、数値型のリレーションを編集画面に表示する設定にしている時、バイナリカラムのないモデルへのリレーションでサムネイル欄が空白で表示される問題を修正しました。
- プラグイン「ImageInfo」が有効な時、ファイルの拡張子が空になることでファイルがアップロードできなくなる問題を修正しました。
- ダイアログ型のリレーション選択画面を開いた時ステータスアイコンクリックでパラメタが引き継がれない問題を修正しました。
- プラグイン「MTMLReference」のファンクションタグ「mt:objectvar」のドキュメントを修正しました。このタグは管理画面用で、権限のないユーザーには値を返しません。すべてのケースで値を返すには環境変数「allow\_objectvar」を指定してください。
- RESTfulAPIのドキュメントの「update」の誤りの箇所を修正しました。
- ダイアログ・ビュー指定のあるモデルの一覧ダイアログ表示で権限エラーになるケースを修正しました。
- プラグイン「SimplifiedJapanese」によって振り仮名を自動でつけている時「Tシャツ」「Yシャツ」など、英文字1文字\+他の文字で構成される単語が辞書に登録されている単語が含まれる文にランダムな文字列が混じる問題を修正しました。
- プラグイン「SimplifiedJapanese」によって振り仮名を自動でつけている時、カタカナから始まる単語、カタカナで終わる単語の振り仮名を改善しました。
- グローバルモディファイア「encode\_url\_basename」のドキュメントが不足していたので追加しました。
- リッチテキストエディタへアセット・画像を貼り付ける時、ダイアログの一覧でステータスによる絞り込みをした時に必要なパラメタが引き継がれずエディタへの貼り付けができなくなる問題を修正しました。
- リッチテキストエディタへ画像を貼り付ける時、ダイアログの一覧で「自分のアセット」フィルタが効かない問題を修正しました。
- モデル「table」にカラムを追加した時、スキーマアップグレード処理で「PADOBaseModelException: unknown column 'カラム名' for model 'モデル名'」エラーが出る問題を修正しました。
- リッチテキストエディタ「TinyMCE」でエディタの高さの最小値を「400px」から「200px」に変更しました。
- リンクURLを設定している時、機械翻訳結果ページの URLが置換されない問題を修正しました。
- プラグイン「MachineTranslator」でページ翻訳をバーチャルディレクトリで設定している時、パスが置換されたリンクが HTML以外の時、404になる前に元ファイルの URLへリダイレクトするようにしました。
- プラグイン「MachineTranslator」の処理の中で波ダッシュ記号「～」がチルダ「~」に置き換わる問題を修正しました。
- ワークフローの設定のあるオブジェクトでステータスを現在のユーザーに許可されない値に設定した時のワークフローのバッジの displayが blockになっていたのを inlineになるようにしました。
- 環境変数「tidy\_clean\_duplicate\_alt」指定のある時、意図しない画像の alt属性値が空になる問題を修正しました。
- 数値型・ダイアログ型のリレーションの設定のある時、サムネイルのないモデルのバッジにサムネイル該当なしアイコンが表示される問題を修正しました。
- ファイル名が URLエンコードされたアセットのファイル欄のビューの URLが 404になる問題を修正しました。
- 同じモデルに対する数値型のリレーションとリレーション型カラムの設定が複数存在する時、プラグイン「RebuildRelations」のトリガーが数値型のリレーションに対して効かない問題を修正しました。
- アセットのマスタに適用した時タスクと管理画面でファイル名の振る舞いを\(元のファイルベースネームを維持するように\)統一しました。
- ワークフロー利用時にステータスを現在の担当ユーザーが指定できない値に変更した時、現在の担当者へ通知メールが送信されるようにしました。
- プラグイン「AccessAnalytics」のシステムプラグイン設定「除外するUser\-Agent」欄に「除外するIPアドレス」の値が表示される問題を修正しました。
- プラグイン「AccessAnalytics」のシステムプラグイン設定「除外するUser\-Agent」に初期値を設定しました。
- 直列に設定されたワークフローで他のユーザーが担当しているオブジェクトのワークフローが利用できない問題を修正しました。
- ビューの一覧画面に「表示順」が重複表示される問題を修正しました。
- プラグイン「SplitPage」で生成される一覧のページにおいて、セットされた変数が初期化されない問題を修正しました。
- オブジェクトの保存時に必須チェックやプラグイン「BannedWords」のチェックでエラーになった時、ワークフローの状態が引き継がれない問題を修正しました。
- プラグイン「UploadUtilities」でオブジェクトのステータスとアセットのステータスを同期する設定の時、大量のアセットと関連づいているオブジェクトの保存時にメモリ不足で落ちるケースを修正しました。
- 「no\_encode\_filename」指定のない時、アセットのファイル名の「 」が「%20」に置換される問題を修正しました。
- クエリキャッシュクリア時にディレクトリが空の時「No such file or directory」エラーがログに記録される問題を修正しました。
- 「PADO\_DB\_BLOB2FILE」指定のある時、ファイルの実体が何らかの理由で削除されたケースで、サイト・パス配下に出力済みのデータからデータを復旧するようにしました。

## 2023\-04\-03

version 3\.23 / version 2\.723

- URLマップから出力パスを生成する処理と「mt:include」にモジュールを指定した時の処理を高速化し、再構築パフォーマンスが向上しました。
- グローバルモディファイア「url2link」を追加しました。URLをリンクに置換します。属性値に「A」タグの属性値\(文字列または連想配列または'\_blank'\)を指定できます。
- プラグイン「SimplifiedJapanese」によって振り仮名をつける速度を高速化しました。
- 環境変数「dynamic\_ignore\_scope」が「true」で「validate\_url」が falseの時相対 URLでダイナミックページを SELECTするようにしました。
- PADOBaseModelのメソッドと同名のカラム名を指定できないようにしました。
- 環境変数「allowed\_exts」に初期値を設定しました。
- 「mt:entries」などのオブジェクトをループするブロックタグの属性「sort\_by」「sort\_order」に CSV又は配列を指定できるようにしました\(第2〜ソートキー指定を可能になります\)。
- 予約カラム名に「new」を追加しました。
- プラグイン「MachineTranslator」でページ翻訳をバーチャルディレクトリで設定している時、言語のキーに 2階層目までを指定できるようにしました。
- プラグイン「MachineTranslator」でページ翻訳後に「post\_rebuild」コールバックを呼ぶようにしました。
- プラグイン「MachineTranslator」でパラメタ付きの検索結果などのページの翻訳に対応しました。
- プラグイン「MachineTranslator」の環境変数「machinetranslator\_loader\_interval」\(ローディングページの待ち時間ミリ秒\)の初期値を「2500」に変更しました。
- プラグイン「MachineTranslator」「SimplifiedJapanese」が有効でレコメンド機能を利用している時、レコメンドで返されるテキストに振り仮名をつけられるようになりました。
- アクション「ファイル出力」でエディタ用以外のサムネイルも再出力するようにしました。
- プラグイン「HTML\_CodeSniffer」で colorとbackground\-colorをあわせて指定しているのにコントラスト比のエラーが出る問題を修正しました。
- 画像のサムネイルが 0バイトで生成されるケースを修正しました。
- プラグイン「Abs2Rel」で「SCRIPT要素を無視する」設定の時、大きなデータを正規表現で置換しようとして置換に失敗するケースを修正しました。
- プラグイン「SplitPage」で生成される一覧の 2ページ目以降、「Abs2Rel」によるパスの書き換えが効かない件を修正しました。
- プラグイン「SearchEstraier」で動的ページの更新時、内容に変更がなくてもインデックスが更新される問題を修正しました。
- プラグイン「AWS\_S3」でディレクトリに対する「filesize\(\): stat failed」エラーが記録される問題を修正しました。
- プラグイン「MachineTranslator」でページ翻訳を実行時にプラグイン「SearchEstraier」で「Undefined array key "object" \(2\) occured」エラーがログに残る問題を修正しました。
- URLマップに日付ベースの指定をしている時、コンテナ指定がない、またはコンテナに指定したモデルに日付型のカラムがないときにエラーを返すようにしました。
- 環境変数「validate\_url」「dynamic\_ignore\_scope」ともに「false」の時、URLの解決に失敗していた問題を修正しました。
- エディタへの画像貼り付け時に SVGファイルのプレビューが表示されない問題を修正しました。
- エディタへの画像貼り付け時に画像のメタデータが存在しない時「Undefined variable $mime\_type」エラーが出る問題を修正しました。
- アセットの詳細画面で右カラムの「利用状況」が表示されない問題を修正しました。
- 「操作系のボタンを下部に固定する」指定のない時、階層管理の「変更を保存」ボタンの左に余白を設定しました。
- アセットのファイル名に「/」\(ディレクトリの区切り文字\)を指定できないようにしました。
- libxml 2\.10\.x がインストールされている環境で pt\-check\.php を実行すると、「libxmlバージョン 2\.7\.8以上が必要です。」と表示される件を修正しました。
- pt\-check\.phpに「curl」が有効かどうかのチェックと、アップロードファイルサイズ数の上限を表示するようにしました。
- リレーション型のカラムに「NOT NULL」を指定している時、新規オブジェクトの保存時に「PADOBaseModelException: unknown column」エラーが出る問題を修正しました。
- システムスコープのオブジェクト一覧にスペース配下のオブジェクトがある時、リビジョンの差し替え予約の状態が表示されない問題を修正しました。
- mt:includeタグで「cache\_driver」が「File」以外の時 PAMLのコンパイルキャッシュをビューのコンパイル済みカラムの値を利用するようにしました。
- 日付ベースのアーカイブをダイナミック・パブリッシングしている時にページが表示されない問題を修正しました。
- ダイナミック・タグが初期化されていない状態でのビューのコンパイルキャッシュが生成され、結果再構築で特定の内容が正しく出力されない問題を修正しました。
- URLマップからのURL生成で正しい URLが返らないケースを修正しました。
- リビジョンとマスタの URLが異なる時、プラグイン「ExternalPreview」によるプレビューでマスタによって公開済みの URLオブジェクトが削除され、ファイルが消える問題を修正しました。
- 環境変数「force\_build\_map」を追加しました。再構築時に URLマップから URLを生成する時にコンパイルキャッシュを利用せずに正確な URLを生成します。
- プラグイン「AppProperties」で設定した環境変数「dir\_perms」の設定が反映されない問題を修正しました。
- プラグイン「AWS\_S3」で同期するファイル名を urldecodeしないようにしました。

## 2023\-03\-17

version 3\.22 / version 2\.722

- 環境変数「htmlimporter\_force\_basename」を追加しました。既存の URLを上書きする設定の時、ベースネーム指定が既にあるときにもベースネームをセットし直します。
- プラグイン「FileUploader」の「ファイル」オブジェクトをダイアログ型のリレーションで一覧表示した時、リンクのクリックで別ウィンドウではなくダイアログ内に編集画面が表示されるようにしました。
- リレーションのダイアログで一覧画面を開いたとき「全n件を選択する」が効かないケースを修正しました。
- TinyMCE 5系のバージョンを「5\.10\.7」にしました。
- URLマップが設定されていて対応する URLオブジェクトが存在しない時、オブジェクトの編集画面にフォームコントロールが表示されないケースを修正しました。
- ダイアログでオブジェクトの作成・編集画面を開いて編集後「キャンセル」ボタンをクリックした時、ブラウザのページ遷移の警告を非表示にし、代わりに confirmメッセージを表示するようにしました。
- プラグイン「CacheManager」で「cache\_driver」が「File」以外の時、PowerCMS X以外のキャッシュもあわせてクリアされてしまう問題を修正しました。
- すべてのキャッシュをクリアされるタイミングで「cache\_driver」が「File」以外の時、PowerCMS X以外のキャッシュもあわせてクリアされてしまう問題を修正しました。
- プラグイン「HTMLImporter」で大量のファイルをインポートしている時、temp\_dirにのディレクトリが残るケースを修正しました。
- プラグイン「VideoCaptions」で MP3形式のオーディオファイルを HLS形式のファイル群にコンバートできるようになりました。
- relationモデルに対して load\_iterメソッドを発行した時に PDO\(データベース構文エラー\)エラーになる問題を修正しました。
- GIF形式の画像のサムネイルを作成する時にエラーで落ちる問題を修正しました。

## 2023\-03\-15

version 3\.2

- リッチテキストエディタ「TinyMCE」のバージョン6に対応しました。環境変数「tinymce\_version」に「6」を指定すると利用できるようになります。
- プラグイン「TinyMCE」に表に関する複数の設定を追加しました。セルのドラッグの許可、border属性値、均等幅スタイルの適用などが設定できます。
- プラグイン「TinyMCE」にプラグイン設定「ベースURL」を追加しました。
- プラグイン「TinyMCE」にカスタムメニューバーボタン「pt\-dl」を追加しました。説明\(定義\)リストの挿入と編集ができるようになります。
- モデルの編集画面から、スキーマのドキュメントを CSVでエクスポートできるようになりました。
- 環境変数「dynamic\_ignore\_scope」を追加しました。ダイナミック・パブリッシングで pt\-view\.phpの workspace\_idを考慮せずにルート相対パスから URLを解決します。
- グローバルモディファイア「nowrap」を追加しました。改行を空白文字に置換します。属性値に2を指定すると改行を削除します。
- プラグイン「URLRedirect」でタイプ「正規表現」の時コンディションにルート相対 URLを設定できるようにしました。
- モデルの設定変更時、数値型/真偽値形のカラムを「NOT NULL」指定した時、値がNULLのカラム値を「0」にセットするようにしました。
- 環境変数「compile\_check」が falseの時、ビューの編集画面にインクルードモジュールのへのリンクが正しく表示されるようにしました。
- 環境変数「compile\_check」の初期値を trueから数値「2」に変更しました。「1」指定の時従来と同様の振る舞いとなり、「0」を指定するとこれまでの falseと同様になり、「2」を指定するとビューの表示前のチェックをスキップします。
- プラグイン「SearchEstraier」にプラグイン設定画面から検索インデックスの状態を確認する機能を追加しました。
- クラス「template」にメソッド「map」を追加しました。関連づいている URLMappingオブジェクトを返します。
- プラグイン「VideoCaptions」にプラグイン設定「相対パス」を追加しました。管理画面と公開 URLのドメインが異なるときに HLSが表示できないケースで指定します\(サーバー側でエイリアス指定が必要です\)。
- プラグイン「FileUploader」にプラグイン設定「アップロード・パス」を追加しました。
- PADOBaseModelに「\_\_」から始まるコールバックを登録することで、オブジェクトのカスタムメソッドを登録できるようになりました。
- コンパイルチェック結果の開始タグのない閉じタグの行数を表示できるようになりました。
- PTUtil::yaml\_parse、PTUtil::yaml\_dumpを追加しました。
- プラグイン「HTMLImporter」の取り込み設定を YAML形式のファイルにエクスポートできるようになしました。
- プラグイン「HTMLImporter」が Digest認証をサポートしました。
- プラグイン「HTMLImporter」に「前処理」\(削除するポイント指定\)を追加しました。削除する部分を他のカラムにセットすることもできます。
- プラグイン「HTMLImporter」が「srcset」属性に指定されている画像をアセットに登録できるようになりました。
- プラグイン「HTMLImporter」でアセットを取り込む時「href」属性値に「#」が付いている時も正しく取り込めるようになりました。
- PTUtil::loadHTML、PTUtil::saveHTML、PTUtil::innerHTML、PTUtil::outerHTML、PTUtil::afterHTMLを追加しました。
- PTUtil::formatLF、PTUtil::to\_utf8、PTUtil::sec\_to\_hms を追加しました。
- 環境変数「htmlimporter\_settings\_paths」を追加しました。YAMLファイルを設置して「HTMLImporter」プラグインを有効化したときに、取り込み設定をインポートします。
- 環境変数「db\_can\_reconnect」を追加しました。データベース処理に失敗した時、データベースに再接続して処理をリトライします。初期値は「true」です。オブジェクトの保存失敗時にトランザクションをロールバックしたいケースでは「false」を指定してください。
- 日付を処理するいくつかのメソッドで、「0日」を「1日」に設定するようにしました。
- 「tools/orphanRecords\.php」で、バイナリカラムを外部ファイル化しているときに実ファイルが存在しないのにカラムに値が含まれるとき、カラムを空にする処理を追加しました。
- 環境変数「auto\_upgrade\_schemes\(スキーマアップグレードをスケジュールタスクで自動実行する\)」「auto\_upgrade\_backup\(スケジュールタスクでのスキーマアップグレード前に DBのバックアップを行う\)」「auto\_upgrade\_plugins\(プラグインアップグレードをスケジュールタスクで自動実行する\)」を追加しました。バックアップについては適切に設定されている必要があります。
- 環境変数「disallow\_pwd\_login」を追加しました。login, start\_recover, recover\_passwordメソッドに対してエラーを返します。
- ログイン画面にテンプレート変数を指定できるようになりました。add\_login\_action\_bar\(「ログイン」ボタンの並びに追加するデータ\)、alternative\_login\_screen\(disallow\_pwd\_login指定のある時に表示するデータ\)の2つです。
- プラグイン「Minifier」で JavaScriptの圧縮に JShrinkを利用するようになりました。従来との互換性を保つときには環境変数「minifier\_use\_jshrink」を「false」としてください。初期値は「true」です。
- クラス「PADO」の「count\_group\_by」メソッドの第4引数にプレースホルダの配列を指定できるようになりました。
- ブロックタグ「mt:countgroupby」に join属性\(連結するモデル、モデルのカラム、連結先のカラム、フィルタ対象のカラム、フィルタ条件の配列\)を指定できるようになりました。
- 再構築のポップアップウィンドウに、URLマップに対応するビューのステータスがすべて無効なモデルを表示しないようにしました。
-「relation」テーブルの load時に関連オブジェクトを JOINして「status」「rev\_type」を指定した読み込みができるようになりました。これによりリビジョンや下書きのオブジェクトの多いオブジェクトをループタグで取得する速度が向上しました。
- gif形式の画像について、exif情報に関する処理をスキップするようにしました。
- プラグイン「AWS\_S3」で一時ディレクトリに書き込まれたファイルの検索をスキップするようにしました。
- 一覧画面の作成者\(created\_by\)、更新者\(modified\_by\)がユーザーのログインIDで表示されるものについて、ログインIDから表示名に変更しました。
- プラグイン「Abs2Rel」で動的生成を無効に設定している時、Formへのポストや検索など、静的URLに対する動的リクエストが置換対象にならないようにしました。
- 「設問タイプ」「設問」「フィールド型」「フィールド」及び設定画面の保存時にテンプレート・タグのコンパイルチェックを行うようにしました。
- 一覧画面からのアクション適用後の再構築単位を少なくしました\(規定値の半分\)。
- 一覧画面からのアクション適用後の再構築で、最後のリクエスト時に実行される再構築トリガーをバックグラウンドで実行するようにしました。
- 一覧画面からのアクション適用後の再構築時に、「max\_execution\_time」を環境変数「max\_exec\_time」の指定値に延長するようにしました。
- 環境変数「compile\_cols」を追加しました。モデル名をキー、カラム名を値に追加することで保存時にテンプレート・タグのコンパイルチェックを追加することができます。
- PTUtil::asset\_from\_fileメソッドを追加しました。ファイルパス、ディレクトリ、スコープの IDを引数に渡してアセットを登録します。
- debug\_backtraceメソッドに 3\(DEBUG\_BACKTRACE\_DUMP\)を指定した時、コマンドラインからの実行でないとき preタグを出力するようにしました。
- ビューの編集画面を開く時のコンパイルチェックで URLマップからコンテキストをセットするようにしました。
- 「cache\_driver」が「File」以外の時、システム標準のロケールをファイルキャッシュとして扱うように変更しました。
- モデル「ビュー」「URLマップ」のデフォルトリストカラムを設定しました。
- プラグイン「MachineTranslator」の翻訳ボタンのアイコンを変更しました。
- ファンクションタグ「mt:var」に opモディファイアを指定して valueモディファイアを省略した時の結果を PowerCMSと同様になるようにしました\(PAML4のみ\)。
- 階層型のリレーション指定しているとき、リレーション元の作成・編集画面から階層を編集した後に適用する際のテンプレートをプラグインでカスタマイズ可能にしました。
- 一覧画面のカラム「表示順」のセルの幅を小さくしました。
- 階層付きモデルの階層の管理画面の「変更を保存」ボタンを下部に固定できるようにしました。
- クラス「PADO」を stdClassを継承したクラスに変更しました。
- プラグイン「DocumentSearch」のドキュメントを更新しました。Xpdfは非推奨となりました。popplerの pdftotextコマンドをインストールしてそれを利用するようにしてください。
- PHP8\.2でスケジュールタスク実行時に「Creation of dynamic property PTWorker::$delayed\_dependencies is deprecated」エラーが出る問題を修正しました。
- プラグイン「SearchEstraier」でタイトルや本文を Xpathや CSSから取得するように設定した時「Attempt to read property "length" on bool \(2\) occured」が出るケースを修正しました。
- アップロード済みのアセットを違うファイル名にリネームまたは差し替えた後、同じパスのアセットをアップロードした時にファイル名に連番が付く問題を修正しました。
- 「mt:archivetitle」を含むビューの編集画面を開いた時に「preg\_replace\(\): Passing null to parameter \#3 \($subject\) of type array|string is deprecated」エラーが出るのを修正しました。
- プレビュー対象のオブジェクトが 1件もない時、ビューのコンテキストでプレビューが実行されるケースを修正しました。
- 環境変数「validate\_url」が trueの時に別スコープのマルチバイトファイル名を含む URLが表示されないことがある問題を修正しました。
- 一度送信したワークフローのメッセージが残り続けて、同一オブジェクトの複数ワークフロー実行時に複数回送信される問題を修正しました。
- プラグイン「DocumentSearch」でタイトル以外のメタデータがタイトルにセットされる問題を修正しました。filters/estfxpdftohtml2 を利用している場合は /usr/local/share/hyperestraier/filter/estfxpdftohtml2 を差し替えてください。
- システムの設定画面とスペースの設定画面の一部のタイムゾーンの表記が間違っていたのを修正しました。
- コンパイルチェックの結果のエラーの行数が 1行ずれていたのを修正しました。
- ログインした状態でプラグイン「ExternalPreview」によるプレビュー時の不具合を修正しました。
- オブジェクトの編集画面でテキストエリアの先頭の改行が失われる問題を修正しました。
- フレーズの翻訳で第二引数を省略した時に落ちるケースを修正しました。
- オブジェクトの作成・編集画面でフィールドを読み込む時に「order\(表示順\)」が無視されていたのを考慮するようにしました。
- PHP8\.1以降で PTTags / PTListActionsクラスで「preg\_replace\(\): Passing null to parameter \#3 \($subject\) of type array|string is deprecated in」が出る問題を修正しました。
- プラグイン「TinyMCE」が有効な時、JavaScriptエラーになるケースの対策をしました。
- ワークフローの設定が直列の時、直前のユーザーへの差し戻しができない問題を修正しました。
- PADO\_DB\_BLOB2FILEを指定しているとき、すでに削除されたバイナリカラムにデータがあると誤判別されて、編集画面に「ビュー」「ダウンロード」ボタンが出るケースを修正しました。
- プラグイン「HTMLImporter」で Undefined variable $origURL, Undefined variable $tagName がエラーーログに出力されるケースを修正しました。
- 画面に非表示になっているフィールドがある時、プラグイン「BannedWords」がエラーとなりオブジェクトの保存ができない問題を修正しました。
- 環境変数「keep\_published\_on」指定のあるとき、オブジェクトの Dateタグに format属性を指定すると正しい日付が取得できない問題を修正しました。
- 階層付きモデルのインポート時に親オブジェクトをラベルで指定している時、別のスコープのオブジェクトに紐づいてしまうケースを修正しました。
- 設問タイプ「テキストエリア」で行の高さが反映されない問題を修正しました。
- 「ファイル」を単一選択のリレーションで関連づけたモデルの作成・編集画面で選択時にアイコンがセットされない問題を修正しました。
- プラグイン「AWS\_S3」でシステム設定を利用するを選択していない時、設定が取得できず同期に失敗する問題を修正しました。
- プラグイン「AWS\_S3」でシステムスコープのファイルを同期できない問題を修正しました。
- 「tools/backupSQL\.php」実行時に環境によって「Undefined array key 0 \(2\) occured」エラーが出る問題を修正しました。
- 「HTMLImporter」で設定によって日本語・英語以外のコンテンツが文字化けするケースを修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグでリレーション型のカラムの「NOT」指定をしている時、その関連付けされたオブジェクトが 0件の時、ループが出力されない問題を修正しました。
- プラグイン「AppProperties」で設定した環境変数「file\_perms」の設定が反映されない問題を修正しました。
- テーマの管理画面で翻訳漏れがあったのを修正しました。
- テーマを GitHubで管理している時、pullしたテーマの翻訳ファイルが適用されない問題を修正しました。
- プラグイン「Theme\_GitHub」でテーマ管理画面からテーマフォルダを開けない問題を修正しました。

version 2\.72

- リッチテキストエディタ「TinyMCE」のバージョン6に対応しました。環境変数「tinymce\_version」に「6」を指定すると利用できるようになります。
- プラグイン「TinyMCE」に表に関する複数の設定を追加しました。セルのドラッグの許可、border属性値、均等幅スタイルの適用などが設定できます。
- プラグイン「TinyMCE」にプラグイン設定「ベースURL」を追加しました。
- プラグイン「TinyMCE」にカスタムメニューバーボタン「pt\-dl」を追加しました。説明\(定義\)リストの挿入と編集ができるようになります。
- モデルの編集画面から、スキーマのドキュメントを CSVでエクスポートできるようになりました。
- 環境変数「dynamic\_ignore\_scope」を追加しました。ダイナミック・パブリッシングで pt\-view\.phpの workspace\_idを考慮せずにルート相対パスから URLを解決します。
- グローバルモディファイア「nowrap」を追加しました。改行を空白文字に置換します。属性値に2を指定すると改行を削除します。
- モデルの設定変更時、数値型/真偽値形のカラムを「NOT NULL」指定した時、値がNULLのカラム値を「0」にセットするようにしました。
- 環境変数「compile\_check」が falseの時、ビューの編集画面にインクルードモジュールのへのリンクが正しく表示されるようにしました。
- 環境変数「compile\_check」の初期値を trueから数値「2」に変更しました。「1」指定の時従来と同様の振る舞いとなり、「0」を指定するとこれまでの falseと同様になり、「2」を指定するとビューの表示前のチェックをスキップします。
- プラグイン「SearchEstraier」にプラグイン設定画面から検索インデックスの状態を確認する機能を追加しました。
- クラス「template」にメソッド「map」を追加しました。関連づいている URLMappingオブジェクトを返します。
- プラグイン「FileUploader」にプラグイン設定「アップロード・パス」を追加しました。
- PADOBaseModelに「\_\_」から始まるコールバックを登録することで、オブジェクトのカスタムメソッドを登録できるようになりました。
- コンパイルチェック結果の開始タグのない閉じタグの行数を表示できるようになりました。
- PTUtil::yaml\_parse、PTUtil::yaml\_dumpを追加しました。
- プラグイン「HTMLImporter」の取り込み設定を YAML形式のファイルにエクスポートできるようになしました。
- プラグイン「HTMLImporter」が Digest認証をサポートしました。
- プラグイン「HTMLImporter」に「前処理」\(削除するポイント指定\)を追加しました。削除する部分を他のカラムにセットすることもできます。
- プラグイン「HTMLImporter」が「srcset」属性に指定されている画像をアセットに登録できるようになりました。
- プラグイン「HTMLImporter」でアセットを取り込む時「href」属性値に「#」が付いている時も正しく取り込めるようになりました。
- PTUtil::loadHTML、PTUtil::saveHTML、PTUtil::innerHTML、PTUtil::outerHTML、PTUtil::afterHTMLを追加しました。
- PTUtil::formatLF、PTUtil::to\_utf8、PTUtil::sec\_to\_hms 
- 環境変数「htmlimporter\_settings\_paths」を追加しました。YAMLファイルを設置して「HTMLImporter」プラグインを有効化したときに、取り込み設定をインポートします。
- 環境変数「db\_can\_reconnect」を追加しました。データベース処理に失敗した時、データベースに再接続して処理をリトライします。初期値は「true」です。オブジェクトの保存失敗時にトランザクションをロールバックしたいケースでは「false」を指定してください。
- 日付を処理するいくつかのメソッドで、「0日」を「1日」に設定するようにしました。
- 「tools/orphanRecords\.php」で、バイナリカラムを外部ファイル化しているときに実ファイルが存在しないのにカラムに値が含まれるとき、カラムを空にする処理を追加しました。
- プラグイン「Minifier」で JavaScriptの圧縮に JShrinkを利用するようになりました。従来との互換性を保つときには環境変数「minifier\_use\_jshrink」を「false」としてください。初期値は「true」です。
- クラス「PADO」の「count\_group\_by」メソッドの第4引数にプレースホルダの配列を指定できるようになりました。
- 環境変数「auto\_upgrade\_schemes\(スキーマアップグレードをスケジュールタスクで自動実行する\)」「auto\_upgrade\_backup\(スケジュールタスクでのスキーマアップグレード前に DBのバックアップを行う\)」「auto\_upgrade\_plugins\(プラグインアップグレードをスケジュールタスクで自動実行する\)」を追加しました。バックアップについては適切に設定されている必要があります。
- 環境変数「disallow\_pwd\_login」を追加しました。login, start\_recover, recover\_passwordメソッドに対してエラーを返します。
- ログイン画面にテンプレート変数を指定できるようになりました。add\_login\_action\_bar\(「ログイン」ボタンの並びに追加するデータ\)、alternative\_login\_screen\(disallow\_pwd\_login指定のある時に表示するデータ\)の2つです。
- ブロックタグ「mt:countgroupby」に join属性\(連結するモデル、モデルのカラム、連結先のカラム、フィルタ対象のカラム、フィルタ条件の配列\)を指定できるようになりました。
- 再構築のポップアップウィンドウに、URLマップに対応するビューのステータスがすべて無効なモデルを表示しないようにしました。
- gif形式の画像について、exif情報に関する処理をスキップするようにしました。
- プラグイン「AWS\_S3」で一時ディレクトリに書き込まれたファイルの検索をスキップするようにしました。
- 一覧画面の作成者\(created\_by\)、更新者\(modified\_by\)がユーザーのログインIDで表示されるものについて、ログインIDから表示名に変更しました。
- プラグイン「Abs2Rel」で動的生成を無効に設定している時、Formへのポストや検索など、静的URLに対する動的リクエストが置換対象にならないようにしました。
-「relation」テーブルの load時に関連オブジェクトを JOINして「status」「rev\_type」を指定した読み込みができるようになりました。これによりリビジョンや下書きのオブジェクトの多いオブジェクトをループタグで取得する速度が向上しました。
- 「設問タイプ」「設問」「フィールド型」「フィールド」及び設定画面の保存時にテンプレート・タグのコンパイルチェックを行うようにしました。
- 一覧画面からのアクション適用後の再構築単位を少なくしました\(規定値の半分\)。
- 一覧画面からのアクション適用後の再構築で、最後のリクエスト時に実行される再構築トリガーをバックグラウンドで実行するようにしました。
- 一覧画面からのアクション適用後の再構築時に、「max\_execution\_time」を環境変数「max\_exec\_time」の指定値に延長するようにしました。
- 環境変数「compile\_cols」を追加しました。モデル名をキー、カラム名を値に追加することで保存時にテンプレート・タグのコンパイルチェックを追加することができます。
- PTUtil::asset\_from\_fileメソッドを追加しました。ファイルパス、ディレクトリ、スコープの IDを引数に渡してアセットを登録します。
- debug\_backtraceメソッドに 3\(DEBUG\_BACKTRACE\_DUMP\)を指定した時、コマンドラインからの実行でないとき preタグを出力するようにしました。
- ビューの編集画面を開く時のコンパイルチェックで URLマップからコンテキストをセットするようにしました。
- 「cache\_driver」が「File」以外の時、システム標準のロケールをファイルキャッシュとして扱うように変更しました。
- モデル「ビュー」「URLマップ」のデフォルトリストカラムを設定しました。
- プラグイン「MachineTranslator」の翻訳ボタンのアイコンを変更しました。
- 階層型のリレーション指定しているとき、リレーション元の作成・編集画面から階層を編集した後に適用する際のテンプレートをプラグインでカスタマイズ可能にしました。
- 一覧画面のカラム「表示順」のセルの幅を小さくしました。
- 階層付きモデルの階層の管理画面の「変更を保存」ボタンを下部に固定できるようにしました。
- クラス「PADO」を stdClassを継承したクラスに変更しました。
- プラグイン「DocumentSearch」のドキュメントを更新しました。Xpdfは非推奨となりました。popplerの pdftotextコマンドをインストールしてそれを利用するようにしてください。
- PHP8\.2でスケジュールタスク実行時に「Creation of dynamic property PTWorker::$delayed\_dependencies is deprecated」エラーが出る問題を修正しました。
- プラグイン「SearchEstraier」でタイトルや本文を Xpathや CSSから取得するように設定した時「Attempt to read property "length" on bool \(2\) occured」が出るケースを修正しました。
- アップロード済みのアセットを違うファイル名にリネームまたは差し替えた後、同じパスのアセットをアップロードした時にファイル名に連番が付く問題を修正しました。
- 「mt:archivetitle」を含むビューの編集画面を開いた時に「preg\_replace\(\): Passing null to parameter \#3 \($subject\) of type array|string is deprecated」エラーが出るのを修正しました。
- プレビュー対象のオブジェクトが 1件もない時、ビューのコンテキストでプレビューが実行されるケースを修正しました。
- 環境変数「validate\_url」が trueの時に別スコープのマルチバイトファイル名を含む URLが表示されないことがある問題を修正しました。
- 一度送信したワークフローのメッセージが残り続けて、同一オブジェクトの複数ワークフロー実行時に複数回送信される問題を修正しました。
- プラグイン「DocumentSearch」でタイトル以外のメタデータがタイトルにセットされる問題を修正しました。filters/estfxpdftohtml2 を利用している場合は /usr/local/share/hyperestraier/filter/estfxpdftohtml2 を差し替えてください。
- システムの設定画面とスペースの設定画面の一部のタイムゾーンの表記が間違っていたのを修正しました。
- コンパイルチェックの結果のエラーの行数が 1行ずれていたのを修正しました。
- ログインした状態でプラグイン「ExternalPreview」によるプレビュー時の不具合を修正しました。
- オブジェクトの編集画面でテキストエリアの先頭の改行が失われる問題を修正しました。
- フレーズの翻訳で第二引数を省略した時に落ちるケースを修正しました。
- オブジェクトの作成・編集画面でフィールドを読み込む時に「order\(表示順\)」が無視されていたのを考慮するようにしました。
- PHP8\.1以降で PTTags / PTListActionsクラスで「preg\_replace\(\): Passing null to parameter \#3 \($subject\) of type array|string is deprecated in」が出る問題を修正しました。
- プラグイン「TinyMCE」が有効な時、JavaScriptエラーになるケースの対策をしました。
- ワークフローの設定が直列の時、直前のユーザーへの差し戻しができない問題を修正しました。
- PADO\_DB\_BLOB2FILEを指定しているとき、すでに削除されたバイナリカラムにデータがあると誤判別されて、編集画面に「ビュー」「ダウンロード」ボタンが出るケースを修正しました。
- プラグイン「HTMLImporter」で Undefined variable $origURL, Undefined variable $tagName がエラーーログに出力されるケースを修正しました。
- 画面に非表示になっているフィールドがある時、プラグイン「BannedWords」がエラーとなりオブジェクトの保存ができない問題を修正しました。
- 環境変数「keep\_published\_on」指定のあるとき、オブジェクトの Dateタグに format属性を指定すると正しい日付が取得できない問題を修正しました。
- 階層付きモデルのインポート時に親オブジェクトをラベルで指定している時、別のスコープのオブジェクトに紐づいてしまうケースを修正しました。
- 設問タイプ「テキストエリア」で行の高さが反映されない問題を修正しました。
- 「ファイル」を単一選択のリレーションで関連づけたモデルの作成・編集画面で選択時にアイコンがセットされない問題を修正しました。
- 「tools/backupSQL\.php」実行時に環境によって「Undefined array key 0 \(2\) occured」エラーが出る問題を修正しました。
- 「HTMLImporter」で設定によって日本語・英語以外のコンテンツが文字化けするケースを修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグでリレーション型のカラムの「NOT」指定をしている時、その関連付けされたオブジェクトが 0件の時、ループが出力されない問題を修正しました。
- プラグイン「AppProperties」で設定した環境変数「file\_perms」の設定が反映されない問題を修正しました。
- テーマの管理画面で翻訳漏れがあったのを修正しました。
- テーマを GitHubで管理している時、pullしたテーマの翻訳ファイルが適用されない問題を修正しました。

## 2023\-02\-13

version 3\.10

- PHP8\.2に対応しました。ダイナミック・プロパティが禁止されたことに伴い、property\_existsでプロパティのチェックを行なっているプラグインなどのコードは新たに追加された PTUtil::property\_exists を利用するようにしてください。
- モデルのプロパティ「ディレクトリ・パス」を追加しました。「extra\_path」カラムを追加します。このカラムは保存時に正しいディレクトリのパスにサニタイズされます。
- プラグイン「AxeRunner」のプラグイン設定に「システム設定を利用する」を追加しました。
- プラグイン「AxeRunner」で meta refreshによるリダイレクト指定のあるコンテンツについて、リダイレクト元のページをチェックするようにしました。
- 入力フィールドを動的に増減できる「複数」指定のあるフィールドのラベルの横に、フィールドを追加するボタンを追加しました。
- 条件タグ「mt:ifextensionloaded」を追加しました。「name」属性に指定された PHP拡張モジュールがロードされている場合にブロックが評価されます。
- 環境変数「contact\_csv\_add\_cols」を追加しました。コンタクトの CSVエクスポート時に含める追加カラムを配列で指定します。初期値は\["created\_on"\]です。
- プラグイン「HTML\_CodeSniffer」で検査の遅延ミリ秒を指定する「html\_codesniffer\_set\_timeout」の初期値を「300」から「1200」に変更しました。
- プラグイン「ImageInfo」でアセットモデルに「A11Y検証済み」カラムを追加しました。
- プラグイン「ImageInfo」でアセットのアップロード時に自動検証を行うことができるようになりました。チェック対象は「画像」「PDF」「HTML\(AxeRunnerプラグインが必要\)」です。
- プラグイン「ImageInfo」で画像のコントラスト比の検証を PHPコードのみで行うように変更し、helperディレクトリ以下のコマンドラインツールを削除しました。
- プラグイン「ImageInfo」でアセットの一覧画面に画像のコントラスト比と種別を表示するようにして、アクションで自動検査を実行できるようにしました。
- プラグイン「ImageInfo」と「AxeRunner」が連携し、HTMLの検証結果をアセットの一覧画面に反映できるようになりました。
- プラグイン「ImageInfo」で画像の情報ダイアログを保存した際にアセットのラベルが空になるケースを修正しました。
- プラグイン「ImageInfo」が「SVG」形式のファイルをサポートしました。拡張モジュール「imagick」が必要です。
- プラグイン「ImageInfo」の情報ダイアログで「写真」「グラフィックス」に加え「ロゴ」を選択できるようにしました。
- プラグイン「ImageInfo」でアセットの一覧画面から直接画像と PDFの情報ダイアログを開けるようにしました。
- プラグイン「ImageInfo」の情報ダイアログで PDFファイルのテキスト抽出に失敗するケースを修正しました。
- プラグイン「ImageInfo」で一部の機能が暗号化されている情報を正しく取得できない問題を修正しました。
- プラグイン「VideoCaptions」で MP4形式の動画を HLS形式のファイル群にコンバートできるようになりました。
- プラグイン「VideoCaptions」でファイルの編集画面に作成後の VTTファイル、字幕合成後のファイルを削除するボタンを追加しました。
- プラグイン「VideoCaptions」で VTT作成後に字幕合成を行った時、プレビューの URLが字幕合成後の URLにならない問題を修正しました。
- プラグイン「VideoCaptions」で日本語などのマルチバイトファイル名のファイルが正しく扱えない問題を修正しました。
- RESTfulAPIに対して同一バージョンの APIに対してプラグインで複数のエンドポイントを登録できない問題を修正しました。
- 一覧画面のアクション「置換」のラベルを「'検索文字列'を置換」に変更しました。
- 環境変数「default\_ts」を追加しました。初期値は「CURRENT\_TIMESTAMP」です。オブジェクトの保存時に NOT NULL指定のカラムに現在時刻をセットします。falseを指定するとオブジェクトの保存時に値が入力されていない時にエラー画面を返します。
- オブジェクトの作成・編集画面の 2カラムレイアウト時の左カラムの最大幅を設定しました。
- 編集タイプが「ファイル」以外のバイナリカラムが存在しているモデルの一覧画面のアクションに「ファイル出力」が表示されないようにしました。
- 「mt:assetthumbnailurl」タグで生成したサムネイルがプラグイン「SiteSync」の同期対象にならない問題を修正しました。
- 「mt:assetthumbnailurl」タグで生成したサムネイルの URLオブジェクトが生成されないケース\(結果としてS3への同期ができないケース\)を修正しました。
- Protptypeクラスの「set\_default」メソッドで「NOT NULL」指定された datetime型のカラムに現在時刻をセットするようにしました。
- アセットの一覧でアクションを適用した後にアップロードするとヘッダにアラートメッセージが残る問題を修正しました。
- Windowsサーバーで ZIPファイルを生成したとき、ディレクトリの区切り文字がパスに残る問題を修正しました。
- アクティブなアーカイブの URLオブジェクトを削除しようとした時にエラーログにエラーを残し、削除をキャンセルするようにしました。
- プラグイン「UniqueURL」で URLマップがオブジェクトのファイルを出力しない条件に合致する時、オブジェクトを保存できない問題を修正しました。
- プラグイン「UniqueURL」が有効なとき「post\_max\_size」を超えるファイルをアップロードしたときに 500エラーになる問題を修正しました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)に「status\_gt」属性を指定できるようにしました\(ステータスが指定の値より大きい\)。
- 「status\_not」「status\_lt」「status\_gt」属性の指定されているオブジェクト複数形のブロックタグ \(mt:entries等\)をライブプレビューの対象外とするようにしました。
- WebP形式の画像処理でアルファチャンネルを維持できない問題を修正しました。
- プラグイン「SimplifiedJapanese」の処理の中で波ダッシュ記号「～」がチルダ「~」に置き換わる問題を修正しました。
- PhpWordを最新版にしている時、プラグイン「SimplifiedJapanese」で Wordファイルのエクスポートができない問題を修正しました。
- オブジェクトの一覧画面に変数「can\_delete」「can\_delete\_any」\(システムスコープで配下のいずれかのスペースに対する削除の権限があるかどうか\)をセットするようにしました。
- オブジェクトの一覧画面でフィルタを作成した後にエンターキーを押下した時に現在の設定を適用するようにしました。
- グローバルモディファイア「trim\_to」に空文字を渡した時、元のテキストをそのまま返すようにしました。
- 環境変数「reply\_trim\_to」を追加しました。コンタクトの編集画面でメールの「返信する」ボタンをクリックしたときのメールを指定文字数に切り捨てます。グローバルモディファイア「trim\_to」に指定する値の形式を利用できます。
- 「日付と時刻」型のカラムを「NOT NULL」指定で追加する際に SQLエラーになる問題を修正しました。
- 「ワークフローを隠す」ボタンが画面幅が極端に狭い時上のドロップダウンと重なる問題を修正しました。
- 「操作系のボタンを下部に固定する」設定が有効な時、プラグイン「HTML\_CodeSniffer」のチェックボックス表示位置が揃わない問題を修正しました。
- Windowsサーバーでバイナリカラムに設定したリサイズが行えない問題を修正しました。
- 環境変数「auto\_orient」「remove\_exif」の設定がファイルアップロード時に効いていなかった問題を修正しました。
- 環境変数「use\_imagine」を追加しました。画像系の処理に「php\-imagine」を利用するかどうかを指定します。初期値は trueです。
- 環境変数「keep\_published\_on」指定のあるとき、リビジョンのプレビューで date/publishedonタグでマスタの公開日を出力するようにしました。
- PTUtilクラスの normalizeメソッドで全角チルダを波ダッシュに置換するようにしました。
- 権限保存時にスコープに同じユーザーが登録されいるとき、保存時にエラーになるようにしました。
- ワークフローの作成・編集画面で「ユーザー変更時に通知する」にチェックがない時「メールのFrom」「Fromアドレス」を必須ではなく任意になるようにしました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)をフィールドで絞り込む属性を指定している時に、SQLエラーが発生して意図通りに絞り込まれない問題を修正しました。
- 管理画面のスペースセレクタでスペースの件数が「ws\_selector\_limit」を超えている時、ダイアログでキーワード検索を行うと権限の無いスペースが検索結果に含まれる問題を修正しました。
- プラグイン「HTMLImporter」でモデル毎にインポートの設定を複数保存できるようになりました。環境変数「htmlimporter\_setting\_by\_scope」でスコープ毎に、「htmlimporter\_setting\_by\_user」でユーザー毎に設定を保存できます。初期値は両方とも falseです。
- プラグイン「HTMLImporter」でサイトURLがトップレベルディレクトリでない時にアセットが意図したパスにインポートされない問題を修正しました。
- プラグイン「HTMLImporter」でタイトルの取得が「タイトル」以外の時、本文から抽出した部分が削除されるようにしました。
- プラグイン「HTMLImporter」で本文エリアから form, noscript, コメントを削除するようにしました。
- プラグイン「HTMLImporter」でリンクをルート相対パスに置換するようにしました。
- プラグイン「HTMLImporter」で西暦と和暦を含む日付を処理できるようにしました。
- プラグイン「HTMLImporter」でプラグインなどでパターンを識別するための入力欄を追加しました。パラメタ「html\_identifier」で値を取得できます。
- プラグイン「HTMLImporter」で取得中の URLをまず画面に出力するようにしました。
- プラグイン「HTMLImporter」で各フィールドの条件指定欄にテンプレート・タグが使えるようになりました。
- プラグイン「HTMLImporter」で抽出できなかったカラムがあった時に画面にエラーが出力されるようになりました。
- プラグイン「HTMLImporter」で「その他のカラムからタイトルを削除する」指定のある時、UTF\-8以外のコンテンツをインポートしたときに文字化けが発生するケースを修正しました。
- プラグイン「HTMLImporter」で進捗画面のインポート結果を編集画面へのリンクにしました。
- プラグイン「HTMLImporter」でインポート結果のレポートをエクスポートできるようにしました。
- プラグイン「HTMLImporter」に環境変数「htmlimporter\_show\_import\_from」を追加しました。trueを指定すると、オブジェクトの編集画面に移行元ページへのリンクを表示します。
- プラグイン「HTMLImporter」でタイトルのセパレータをカンマ区切りで複数指定できるようになりました。先頭から順にマッチするまで置換を実行します。
- オブジェクトのカラム値を出力するファンクションタグで、未保存のオブジェクトのプレビュー時に既存の別のオブジェクトの値が出力されるケースを修正しました。
- 外部プレビューの時に生成される makemp3タグの音声ファイル作成時に言語が取得できない問題を修正しました。
- PHP8\.2でクラス「PADO」で「Creation of dynamic property」エラーが出るケースを修正しました。
- PHP8\.2で「mb\_convert\_encoding\(\): Handling HTML entities via mbstring is deprecated」エラーが出るケースを修正しました。
- インポートなどの実行中にエラーが発生したした時に、iframe内の画面にはナビゲーションが表示されないようにしました。
- サムネイルを生成した時、ファイルに差分がなくても強制的にファイルを書き込むようにしました。
- 定数「PADO\_DB\_CLEANUP\_BLOB」を指定しているとき、リビジョン作成時にバイナリカラムのデータが削除される問題を修正しました。
- 保存しようとしているオブジェクトとオリジナルオブジェクトのリレーションとメタデータのいずれかが空の配列の時、変更内容があってもリビジョンが生成されない問題を修正しました。
- 一覧画面のアクション・バーで HTMLの要素の idが重複している問題を修正しました。
- プラグイン「DocumentSearch」で、アセットを削除したときに検索インデックスから URLが削除されない問題を修正しました。
- URLマップの設定やタグの評価条件が変更された時、再構築トリガーによる再構築で URLが付け変わらない問題を修正しました。
- グローバルモディファイア「format\_size」で小数点以下の末尾が 0の時も桁を揃えて値を返すようにしました。
- モデルの作成・保存時に「ラベル」と「複数形」にマルチバイト文字を含む時エラーになるようにしました。
- 環境変数「republish\_date\_based」がコンテナにしか対応していなかったため、再構築トリガーにも対応させるようにしました。
- 環境変数「republish\_date\_based」が有効でコンテナまたは再構築トリガーで日付アーカイブを再構築する処理をバックグラウンドで行うようにしました。
- Prototypeクラスの publish\_obj メソッドで同一オブジェクトと同一 URLマップ指定時のパブリッシュをスキップするようにしました。
- ログの削除時に「publish_obj」メソッドを呼ばないようにしました。
- URLマップの作成・編集画面で単一出力指定のインデックス以外のアーカイブに再構築トリガーを指定した時、警告が表示されるようにしました。
- URLマップの作成・編集画面でインデックス以外の同一モデルのトリガーを指定しようとした時に警告を表示するようにしました。
- Prototypeクラスの component メソッドで、lib/Prototype/配下のクラスオブジェクトを取得できるようにしました。
- プラグイン「UploadUtilities」で ZIPファイルを展開してアセットを登録するときに一部のコールバックが呼ばれない問題を修正しました。
- プラグイン「FileUploader」でアップロードしたファイルを一覧画面から削除した時「dirname\(\): Passing null to parameter \#1 \($path\) of type string is deprecated」エラーが出る問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで「workspace\_id」属性に別のスコープのIDを単一指定している時、リレーションをタグ属性で指定している時にオブジェクトが取得できない問題を修正しました。
- 環境変数「hash\_multibyte\_filename」を追加しました。マルチバイと文字列を含むファイルアップロード時にランダムなハッシュ文字列のファイル名に変換します。この設定は「no\_encode\_filename」設定より優先されます。
- プラグイン「SearchEstraier」でタイトルの抽出ポイントに「XPath」「CSSセレクタ」本文の抽出ポイントに「CSSセレクタ」を指定できるようになりました。
- 「tidy\_outputfilter」指定がなく「publish\_callbacks」指定のある時にバイナリカラムのファイル出力がスキップされる問題を修正しました。
- スペースからシステムスコープのオブジェクトをリレーション・ダイアログで選択するとき「全n件を選択する」が有効にならない問題を修正しました。
- コールバックが明示的に falseを返した時のみエラーとなるように振る舞いを変更しました。
- プラグイン「SimplifiedJapanese」の「mt:makemp3」タグに langまたは language属性を渡せるようにしました。
- PHP8\.2でプラグイン「Abs2Rel」で「Creation of dynamic property URIConverter\URI::$normalized\_path is deprecated」エラーが出る問題を修正しました。
- ワークフローが有効な状態でリビジョンをマスタに適用したとき、メールの件名に担当ユーザー名による操作となっていたのを、実際に操作したユーザー名が入るように修正しました。
- ワークフローが有効な状態でリビジョンをマスタに適用したとき、現在のユーザーがマスタのステータスについての権限がない時にユーザーを変更するようにしました。
- ワークフローが有効な状態でステータス変更によって所有者が変更されたときのログとメールの件名が適切でなかったのを修正しました。
- PTTagsクラスで init\_tagsに trueを指定している時に初期化がスキップされるケースを修正しました。
- 「ctype\_digit\(\): Argument of type int will be interpreted as string in the future」エラーが出るケースを修正しました。
- プラグイン「LivePreview」で権限のないリビジョンのバイナリファイルのプレビューができない問題を修正しました。
- URLオブジェクトからファイルを再パブリッシュした時、ファイルに差分がなければタイムスタンプを最終更新時にセットするようにしました。
- 環境変数「enable\_on\_demand」を追加しました。オンデマンド・パブリッシングが適切に設定されている時に trueを指定します。
- テーマの「\.htaccess」で 403に対する pt\-view\.phpへのリライト設定を追加しました。
- 管理画面におけるクロスサイト・スクリプティングの脆弱性を修正しました。
- 一覧画面に表示されているカラムと画面オプションでチェックされているカラムが完全に一致しない問題を修正しました。
- PADOのメソッド「model」の引数をサニタイズするようにしました。
- 環境変数「csv\_with\_bom」を追加しました。エクスポートする CSVファイルに BOMを追加します。初期値は「true」です。
- ログインに失敗してロックアウト画面にリダイレクトしたときに一部の WAFでエラーが検知される問題を修正しました。
- オブジェクトの作成・編集画面でアクティブなフィールド追加選択項目がないとき、select要素自体を非表示にするようにしました。
- 「no\_encode\_filename」「hash\_multibyte\_filename」いずれの指定もない時、マルチバイト文字をファイル名に含むファイル名を「basename\_len\(初期値40\)」に設定された数値を基準にリネームするようにしました。
- GIF形式のファイルのサムネイル作成に失敗するケースを修正しました。
- スペースのカラム「URL」の一覧画面と編集画面のタイプを「URL」に変更しました。
- 一覧画面の画面オプションで、環境変数「list\_max\_cols」「dialog\_max\_cols」を超えた数のチェックを入れたとき、アラートが出るようにしました。
- 「dialog\_max\_cols」の設定が効いていなかったのを修正しました。また、初期値を「5」に変更しました。
- プラグイン「RebuildRelations」のプラグイン設定「参照元モデル」で数値型 1:1 でリレーション指定しているモデルが設定できない問題を修正しました。
- プラグイン「RebuildRelations」のプラグイン設定「参照元モデル」に同じモデルが重複して表示される問題を修正しました。
- プラグイン「VideoCaptions」が有効の時、ファイルオブジェクトを数値型リレーションで関連づけているとき、ダイアログで作成時にキャンセルボタンでキャンセルできない問題を修正しました。
- Prototypeクラスの「publish」メソッドで URLマップのスペースがコンテキストに正しくセットされないケースを修正しました。
- プラグイン「FileUploader」で追加した「ファイル」モデルへダイアログ型のリレーションで関連づけている時、参照元の作成・編集画面にサムネイルを表示するようにしました。
- 一覧画面と編集画面の画面オプションをリセットするボタンを追加しました。
- PADOクラスの loadメソッドに対して limit / offsetに負の値が渡された時 SQLエラーになる問題を修正しました。
- 複数のスキーマアップグレードがある時、1つずつ行うことを推奨するメッセージを表示させるようにしました。

version 2\.71

- PHP8\.2に対応しました。ダイナミック・プロパティが禁止されたことに伴い、property\_existsでプロパティのチェックを行なっているプラグインなどのコードは新たに追加された PTUtil::property\_exists を利用するようにしてください。
- モデルのプロパティ「ディレクトリ・パス」を追加しました。「extra\_path」カラムを追加します。このカラムは保存時に正しいディレクトリのパスにサニタイズされます。
- 入力フィールドを動的に増減できる「複数」指定のあるフィールドのラベルの横に、フィールドを追加するボタンを追加しました。
- 条件タグ「mt:ifextensionloaded」を追加しました。「name」属性に指定された PHP拡張モジュールがロードされている場合にブロックが評価されます。
- 環境変数「contact\_csv\_add\_cols」を追加しました。コンタクトの CSVエクスポート時に含める追加カラムを配列で指定します。初期値は\["created\_on"\]です。
- プラグイン「HTML\_CodeSniffer」で検査の遅延ミリ秒を指定する「html\_codesniffer\_set\_timeout」の初期値を「300」から「1200」に変更しました。
- 一覧画面のアクション「置換」のラベルを「'検索文字列'を置換」に変更しました。
- 環境変数「default\_ts」を追加しました。初期値は「CURRENT\_TIMESTAMP」です。オブジェクトの保存時に NOT NULL指定のカラムに現在時刻をセットします。falseを指定するとオブジェクトの保存時に値が入力されていない時にエラー画面を返します。
- オブジェクトの作成・編集画面の 2カラムレイアウト時の左カラムの最大幅を設定しました。
- 編集タイプが「ファイル」以外のバイナリカラムが存在しているモデルの一覧画面のアクションに「ファイル出力」が表示されないようにしました。
- 「mt:assetthumbnailurl」タグで生成したサムネイルがプラグイン「SiteSync」の同期対象にならない問題を修正しました。
- 「mt:assetthumbnailurl」タグで生成したサムネイルの URLオブジェクトが生成されないケース\(結果としてS3への同期ができないケース\)を修正しました。
- Protptypeクラスの「set\_default」メソッドで「NOT NULL」指定された datetime型のカラムに現在時刻をセットするようにしました。
- アセットの一覧でアクションを適用した後にアップロードするとヘッダにアラートメッセージが残る問題を修正しました。
- Windowsサーバーで ZIPファイルを生成したとき、ディレクトリの区切り文字がパスに残る問題を修正しました。
- アクティブなアーカイブの URLオブジェクトを削除しようとした時にエラーログにエラーを残し、削除をキャンセルするようにしました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)に「status\_gt」属性を指定できるようにしました\(ステータスが指定の値より大きい\)。
- 「status\_not」「status\_lt」「status\_gt」属性の指定されているオブジェクト複数形のブロックタグ \(mt:entries等\)をライブプレビューの対象外とするようにしました。
- WebP形式の画像処理でアルファチャンネルを維持できない問題を修正しました。
- プラグイン「SimplifiedJapanese」の処理の中で波ダッシュ記号「～」がチルダ「~」に置き換わる問題を修正しました。
- オブジェクトの一覧画面に変数「can\_delete」「can\_delete\_any」\(システムスコープで配下のいずれかのスペースに対する削除の権限があるかどうか\)をセットするようにしました。
- オブジェクトの一覧画面でフィルタを作成した後にエンターキーを押下した時に現在の設定を適用するようにしました。
- グローバルモディファイア「trim\_to」に空文字を渡した時、元のテキストをそのまま返すようにしました。
- 環境変数「reply\_trim\_to」を追加しました。コンタクトの編集画面でメールの「返信する」ボタンをクリックしたときのメールを指定文字数に切り捨てます。グローバルモディファイア「trim\_to」に指定する値の形式を利用できます。
- 「日付と時刻」型のカラムを「NOT NULL」指定で追加する際に SQLエラーになる問題を修正しました。
- 「ワークフローを隠す」ボタンが画面幅が極端に狭い時上のドロップダウンと重なる問題を修正しました。
- 「操作系のボタンを下部に固定する」設定が有効な時、プラグイン「HTML\_CodeSniffer」のチェックボックス表示位置が揃わない問題を修正しました。
- Windowsサーバーでバイナリカラムに設定したリサイズが行えない問題を修正しました。
- 環境変数「auto\_orient」「remove\_exif」の設定がファイルアップロード時に効いていなかった問題を修正しました。
- 環境変数「use\_imagine」を追加しました。画像系の処理に「php\-imagine」を利用するかどうかを指定します。初期値は trueです。
- 環境変数「keep\_published\_on」指定のあるとき、リビジョンのプレビューで date/publishedonタグでマスタの公開日を出力するようにしました。
- PTUtilクラスの normalizeメソッドで全角チルダを波ダッシュに置換するようにしました。
- 権限保存時にスコープに同じユーザーが登録されいるとき、保存時にエラーになるようにしました。
- ワークフローの作成・編集画面で「ユーザー変更時に通知する」にチェックがない時「メールのFrom」「Fromアドレス」を必須ではなく任意になるようにしました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)をフィールドで絞り込む属性を指定している時に、SQLエラーが発生して意図通りに絞り込まれない問題を修正しました。
- 管理画面のスペースセレクタでスペースの件数が「ws\_selector\_limit」を超えている時、ダイアログでキーワード検索を行うと権限の無いスペースが検索結果に含まれる問題を修正しました。
- プラグイン「HTMLImporter」でモデル毎にインポートの設定を複数保存できるようになりました。環境変数「htmlimporter\_setting\_by\_scope」でスコープ毎に、「htmlimporter\_setting\_by\_user」でユーザー毎に設定を保存できます。初期値は両方とも falseです。
- プラグイン「HTMLImporter」でサイトURLがトップレベルディレクトリでない時にアセットが意図したパスにインポートされない問題を修正しました。
- プラグイン「HTMLImporter」でタイトルの取得が「タイトル」以外の時、本文から抽出した部分が削除されるようにしました。
- プラグイン「HTMLImporter」で本文エリアから form, noscript, コメントを削除するようにしました。
- プラグイン「HTMLImporter」でリンクをルート相対パスに置換するようにしました。
- プラグイン「HTMLImporter」で西暦と和暦を含む日付を処理できるようにしました。
- プラグイン「HTMLImporter」でプラグインなどでパターンを識別するための入力欄を追加しました。パラメタ「html\_identifier」で値を取得できます。
- プラグイン「HTMLImporter」で取得中の URLをまず画面に出力するようにしました。
- プラグイン「HTMLImporter」で各フィールドの条件指定欄にテンプレート・タグが使えるようになりました。
- プラグイン「HTMLImporter」で抽出できなかったカラムがあった時に画面にエラーが出力されるようになりました。
- プラグイン「HTMLImporter」で「その他のカラムからタイトルを削除する」指定のある時、UTF\-8以外のコンテンツをインポートしたときに文字化けが発生するケースを修正しました。
- プラグイン「HTMLImporter」で進捗画面のインポート結果を編集画面へのリンクにしました。
- プラグイン「HTMLImporter」でインポート結果のレポートをエクスポートできるようにしました。
- プラグイン「HTMLImporter」に環境変数「htmlimporter\_show\_import\_from」を追加しました。trueを指定すると、オブジェクトの編集画面に移行元ページへのリンクを表示します。
- プラグイン「HTMLImporter」でタイトルのセパレータをカンマ区切りで複数指定できるようになりました。先頭から順にマッチするまで置換を実行します。
- 外部プレビューの時に生成される makemp3タグの音声ファイル作成時に言語が取得できない問題を修正しました。
- PHP8\.2でクラス「PADO」で「Creation of dynamic property」エラーが出るケースを修正しました。
- PHP8\.2で「mb\_convert\_encoding\(\): Handling HTML entities via mbstring is deprecated」エラーが出るケースを修正しました。
- インポートなどの実行中にエラーが発生したした時に、iframe内の画面にはナビゲーションが表示されないようにしました。
- サムネイルを生成した時、ファイルに差分がなくても強制的にファイルを書き込むようにしました。
- 定数「PADO\_DB\_CLEANUP\_BLOB」を指定しているとき、リビジョン作成時にバイナリカラムのデータが削除される問題を修正しました。
- 保存しようとしているオブジェクトとオリジナルオブジェクトのリレーションとメタデータのいずれかが空の配列の時、変更内容があってもリビジョンが生成されない問題を修正しました。
- 一覧画面のアクション・バーで HTMLの要素の idが重複している問題を修正しました。
- プラグイン「DocumentSearch」で、アセットを削除したときに検索インデックスから URLが削除されない問題を修正しました。
- URLマップの設定やタグの評価条件が変更された時、再構築トリガーによる再構築で URLが付け変わらない問題を修正しました。
- グローバルモディファイア「format\_size」で小数点以下の末尾が 0の時も桁を揃えて値を返すようにしました。
- モデルの作成・保存時に「ラベル」と「複数形」にマルチバイト文字を含む時エラーになるようにしました。
- 環境変数「republish\_date\_based」がコンテナにしか対応していなかったため、再構築トリガーにも対応させるようにしました。
- 環境変数「republish\_date\_based」が有効でコンテナまたは再構築トリガーで日付アーカイブを再構築する処理をバックグラウンドで行うようにしました。
- Prototypeクラスの publish\_obj メソッドで同一オブジェクトと同一 URLマップ指定時のパブリッシュをスキップするようにしました。
- ログの削除時に「publish_obj」メソッドを呼ばないようにしました。
- URLマップの作成・編集画面で単一出力指定のインデックス以外のアーカイブに再構築トリガーを指定した時、警告が表示されるようにしました。
- URLマップの作成・編集画面でインデックス以外の同一モデルのトリガーを指定しようとした時に警告を表示するようにしました。
- Prototypeクラスの component メソッドで、lib/Prototype/配下のクラスオブジェクトを取得できるようにしました。
- プラグイン「UploadUtilities」で ZIPファイルを展開してアセットを登録するときに一部のコールバックが呼ばれない問題を修正しました。
- プラグイン「FileUploader」でアップロードしたファイルを一覧画面から削除した時「dirname\(\): Passing null to parameter \#1 \($path\) of type string is deprecated」エラーが出る問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで「workspace\_id」属性に別のスコープのIDを単一指定している時、リレーションをタグ属性で指定している時にオブジェクトが取得できない問題を修正しました。
- 環境変数「hash\_multibyte\_filename」を追加しました。マルチバイと文字列を含むファイルアップロード時にランダムなハッシュ文字列のファイル名に変換します。この設定は「no\_encode\_filename」設定より優先されます。
- プラグイン「SearchEstraier」でタイトルの抽出ポイントに「XPath」「CSSセレクタ」本文の抽出ポイントに「CSSセレクタ」を指定できるようになりました。
- スペースからシステムスコープのオブジェクトをリレーション・ダイアログで選択するとき「全n件を選択する」が有効にならない問題を修正しました。
- コールバックが明示的に falseを返した時のみエラーとなるように振る舞いを変更しました。
- プラグイン「SimplifiedJapanese」の「mt:makemp3」タグに langまたは language属性を渡せるようにしました。
- PHP8\.2でプラグイン「Abs2Rel」で「Creation of dynamic property URIConverter\URI::$normalized\_path is deprecated」エラーが出る問題を修正しました。
- ワークフローが有効な状態でリビジョンをマスタに適用したとき、メールの件名に担当ユーザー名による操作となっていたのを、実際に操作したユーザー名が入るように修正しました。
- ワークフローが有効な状態でステータス変更によって所有者が変更されたときのログとメールの件名が適切でなかったのを修正しました。
- ワークフローが有効な状態でリビジョンをマスタに適用したとき、現在のユーザーがマスタのステータスについての権限がない時にユーザーを変更するようにしました。
- PTTagsクラスで init\_tagsに trueを指定している時に初期化がスキップされるケースを修正しました。
- 「ctype\_digit\(\): Argument of type int will be interpreted as string in the future」エラーが出るケースを修正しました。
- プラグイン「LivePreview」で権限のないリビジョンのバイナリファイルのプレビューができない問題を修正しました。
- URLオブジェクトからファイルを再パブリッシュした時、ファイルに差分がなければタイムスタンプを最終更新時にセットするようにしました。
- 環境変数「enable\_on\_demand」を追加しました。オンデマンド・パブリッシングが適切に設定されている時に trueを指定します。
- テーマの「\.htaccess」で 403に対する pt\-view\.phpへのリライト設定を追加しました。
- 一覧画面に表示されているカラムと画面オプションでチェックされているカラムが完全に一致しない問題を修正しました。
- PADOのメソッド「model」の引数をサニタイズするようにしました。
- 環境変数「csv\_with\_bom」を追加しました。エクスポートする CSVファイルに BOMを追加します。初期値は「true」です。
- パッケージに含まれる「config\.json\-original\.json」の paml\_versionを修正しました。
- ログインに失敗してロックアウト画面にリダイレクトしたときに一部の WAFでエラーが検知される問題を修正しました。
- オブジェクトの作成・編集画面でアクティブなフィールド追加選択項目がないとき、select要素自体を非表示にするようにしました。
- 「no\_encode\_filename」「hash\_multibyte\_filename」いずれの指定もない時、マルチバイト文字をファイル名に含むファイル名を「basename\_len\(初期値40\)」に設定された数値を基準にリネームするようにしました。
- GIF形式のファイルのサムネイル作成に失敗するケースを修正しました。
- スペースのカラム「URL」の一覧画面と編集画面のタイプを「URL」に変更しました。
- 一覧画面の画面オプションで、環境変数「list\_max\_cols」「dialog\_max\_cols」を超えた数のチェックを入れたとき、アラートが出るようにしました。
- 「dialog\_max\_cols」の設定が効いていなかったのを修正しました。また、初期値を「5」に変更しました。
- プラグイン「RebuildRelations」のプラグイン設定「参照元モデル」で数値型 1:1 でリレーション指定しているモデルが設定できない問題を修正しました。
- プラグイン「RebuildRelations」のプラグイン設定「参照元モデル」に同じモデルが重複して表示される問題を修正しました。
- Prototypeクラスの「publish」メソッドで URLマップのスペースがコンテキストに正しくセットされないケースを修正しました。
- プラグイン「FileUploader」で追加した「ファイル」モデルへダイアログ型のリレーションで関連づけている時、参照元の作成・編集画面にサムネイルを表示するようにしました。
- 一覧画面と編集画面の画面オプションをリセットするボタンを追加しました。
- PADOクラスの loadメソッドに対して limit / offsetに負の値が渡された時 SQLエラーになる問題を修正しました。
- 複数のスキーマアップグレードがある時、1つずつ行うことを推奨するメッセージを表示させるようにしました。

## 2022\-12\-13

version 3\.09

- プラグイン「NuHtmlChecker」で「警告」と「エラー」の数字が逆になる問題を修正しました。
- プラグイン「NuHtmlChecker」のエラーメッセージの翻訳漏れを修正しました。
- プラグイン「ImageInfo」で PDFの情報タイアログの「Download MP3」の翻訳漏れを修正しました。
- 「PADO\_DB\_BLOB2FILE」設定のある時ビューのビルド・キャッシュが壊れるケースを対策しました。
- プラグイン「AppProperties」で「Indirect modification of overloaded property Prototype::$properties has no effect\.」エラーが出るケースを修正しました。
- 「delete\_flag」カラムのないモデルの一覧画面のフィルタに「削除フラグあり」「削除フラグなし」が表示される問題を修正しました。
- 「mt:archivelist」タグで日付ベースのアーカイブに「sort\_order」属性に「descend」を指定してときに正しくソートされない問題を修正しました。
- リビジョンの保存時に「base64\_encode\(\): Passing null to parameter \#1 \($string\) of type string is deprecated」エラーが出るケースを修正しました。
- カウント系のタグに「archive\_type」属性を追加し、日付ベースアーカイブのタイプを指定できるようになりました。
- 環境変数「update\_rev\_created」を追加しました。リビジョンの作成時に「created\_by」「created\_on」カラムを更新して、リビジョン作成後にマスタが更新されたことを編集画面に表示します。
- libxml 2\.9\.14 でテンプレートのコンパイル時に意図しないランダムな文字列が残る問題を修正しました。
- build\_path\_with\_mapが falseを返した時に削除されるべきアーカイブが残るケースを修正しました。
- 「tools/orphanRecords\.php」を追加しました。孤立した不要なレコードをクリーンアップします。
- 環境変数「publish\_callbacks」が指定されている時「scheduled\_replacement」コールバックが実行されない問題を修正しました。
- プラグイン「Members」でユーザー名またはパスワードを空文字でメンバーログインした時「members\_login」テンプレートが利用されない問題を修正しました。
- 一覧画面からの一括承認時に「Undefined array key」「Attempt to read property "nickname" on null」エラーが出るケースを修正しました。
- 「cache\_driver」が「Memcached」「Redis」の時 flushメソッドの ttl引数が効いていない問題を修正しました。
- PHP8環境で「cache\_driver」が「APCu」「Redis」の時キャッシュの保存時に「Cannot use a scalar value as an array」エラーが出る問題を修正しました。
- ビューの編集画面でシンタックスエラーがエラーを誤検知するケースを修正しました。
- mt:include内で「mt:setvartemplate」タグを利用するとコンパイルキャッシュにヒットした時に結果が正しくならない問題を修正しました。
- 「workspace\_id」カラムのあるシステムのオブジェクトに一覧画面から遷移した時「workspace\_id=\*\*指定なし\*\*」パラメタが付与される問題を修正しました。
- プラグイン「MachineTranslator」で非同期通信バージョンの文字数が翻訳文字数の制限を超えている時、エラーを返さずにオリジナルのテキスト配列を返すようにしました。
- プラグイン「MachineTranslator」のリッチテキストエディタの翻訳ボタンに事前に原文をチェックして逆翻訳結果とともに問題箇所を指摘する機能を追加しました。
- 「任意」のモデルへのリレーションを設定しているモデルが SearchEstraierのインデックス対象になっている時、インデックスの生成で落ちる問題を修正しました。
- プラグイン「ImageInfo」の情報ダイアログでデバッグモードの時にアクションボタンが隠れる問題を修正しました。
- 「upload」「upload\_multi」メソッドの冒頭で「max\_execution\_time」をセットするようにしました。
- Prototypeクラスの「load\_related\_objs」の第2引数に存在しないモデルを指定した時に SQLエラーになる問題を修正しました。
- テーマのエクスポートと適用時にプラグイン「SplitPage」の URLマップの設定と「オブジェクトがない時アーカイブを出力しない」の設定を設定できるようにしました。
- プラグイン「SearchEstraier」の「mt:estraiersearch」タグの取得結果が「limit」モディファイアの指定値より 1件多くなるケースを修正しました。
- プラグイン「SearchEstraier」の「mt:estraiersearch」タグに「limit」「default_limit」のいずれも指定がない時に取得結果が0件となる問題を修正しました。
- tools/backupSQL\.php実行時に「\-\-no\-tablespaces \-\-single\-transaction」オプションを追加しました。
- 「tmpl/include/edit/entry/title\.tmpl」に初期値が反映されない問題を修正しました。
- MTMLリファレンスの「convert\_break」を「convert\_breaks」に修正しました。
- プラグイン「HTMLImporter」で XPathで DOMTextを指定した時、値が取得出来ない問題を修正しました。
- プラグイン「HTMLImporter」で 「workspace\_id」カラムのないコンテンツのインポート時にエラーログにエラーが記録される問題を修正しました。
- プラグイン「HTMLImporter」で同じパスのアセットがリネームされて複数登録されるケースを修正しました。
- プラグイン「HTMLImporter」で同じ URLをスキップするようにしました。
- プラグイン「HTMLImporter」でその他のカラムとフィールドの値をトリミングするようにしました。
- プラグイン「HTMLImporter」でライブラリ「laminas\-dom」のインストールなしで CSSセレクタを指定できるようになりました。
- プラグイン「HTMLImporter」でプライマリカラムのタイプが「テキスト」の時タイトルと本文にあたるカラムが重複する問題を修正しました。
- プラグイン「HTMLImporter」の「その他のカラム」にリレーション型のカラム名を指定できるようになりました。リレーション型のカラムについては、取得した値とプライマリカラムの値の一致するオブジェクトを関連付けます。
- プラグイン「HTMLImporter」で日付型のカラムに Xpath/CSSセレクタを指定した時、単一の値を取得するようにしました。
- アセットに大文字の拡張子のファイルをアップロードすると、拡張子が重複したファイル名になる問題を修正しました。
- 環境変数「searchestraier\_re\_index\_at\_rebuild」の初期値を falseにしました。ポップアップウィンドウからの再構築時にインデックス更新をスキップします。
- フォームのメールアドレスにカンマ区切りで複数のメールアドレスを指定できるようにしました。
- 環境変数「list\_max\_cols」「dialog\_max\_cols」を追加しました。一覧画面の表示カラム数の最大値を指定します。初期値は「10」「7」です。
- 1つのリクエストでユーザー・メンバーのセッションを延長するためのクッキーが重複して発行されていた問題を修正しました。
- ブロックタグ「mt:for」の stepが「0」指定された時にエラーで落ちる問題を修正しました。
- リダイレクト後にクッキーを発行しようとしてエラーログにエラーが残るケースを修正しました。
- フォームのメールアドレス欄に MTタグを利用している時、バリデーションをスキップするようにしました。
- プラグイン「PluginStarter」でメニューのラベルに「'」を入力すると保存できない問題を修正しました。
- ループタグに「workspace\_ids」とリレーションの「OR」フィルタを指定した時に結果が取得できないケースを修正しました。
- PTPublisherクラスからの再構築時にコンテキストにセットされた値がプラグインから取得できないケースを修正しました。
- 操作系のボタンを下部に固定する設定にしている時、アクション・バーよりメニューが背面になる問題を修正しました。
- プラグイン「SimplifiedJapanese」のグローバルモディファイア「textnode\_to\_json」を「textnode\_furigana\_to\_json」にリネームし、HTMLを部分的に適用しても動作するようにしました。
- アセットのリビジョンのファイルを差し替えた後承認依頼を行い、承認者がマスタに適用した時に送信されるメールにアセットの URLが含まれなくなるケースを修正しました。
- 既存のモデルに「UUID」カラムを追加した時、既存のオブジェクトに UUIDが付与されないケースを修正しました。
- モデルの編集画面から jsonエクスポートした時に含まれる翻訳フレーズに、選択項目のオプションとヒント、モデル名の翻訳フレーズを追加しました。
- フレーズをモデルの JSONファイルからインポートする時に大文字と小文字を区別するようにしました。
- 冗長化構成で翻訳フレーズのキャッシュがマシンごとに保存されていた問題を修正しました。
- PAML4でテンプレートの処理後に末尾に空の行が追加される問題を修正しました。
- 「cache\_driver」が「MySQL」「SQLite」の時、キャッシュのレコードが重複するケースを修正しました。
- コンパイルエラーでビューの保存に失敗した時、エラーの詳細が表示されない問題を修正しました。
- 「furigana」モディファイアで漢字の間にひらがなを含む単語単位でルビが振られる時、ルビを分割できるケースでは分割するようにしました。
- モディファイア「textnode\_furigana\_to\_json」の結果をキャッシュするようにしました。
- プラグイン「DynamicCaching」に環境変数「dynamiccaching\_cache\_with\_query」を追加しました。trueを指定するとパラメタ付きの GETリクエストをキャッシュします。
- プラグイン「HTMLTidy」を追加しました。Tidyを利用してパースされたマークアップに設定に基づく誤りの修正を行います。
- 「mt:setcontext」タグで「Illegal string offset 'BINARY'」エラーが出るケースを修正しました。
- 環境変数「machinetranslator\_loader\_interval」を追加しました。進捗インジケーターのページのリロードまでの待ち時間\(ミリ秒\)を指定します。リロードを繰り返してしまうケースでは値を大きく設定してください。
- 一覧画面のフィルタでステータスのラベルが翻訳されない問題を修正しました。
- 環境変数「var\_nullable」を追加しました。条件タグ「mt:isset」で値が nullの時互換性を確保します。
- プラグイン「DocumentSearch」でスコープでチェックされていない拡張子のファイルのインデックス登録に失敗した不要なログが残る問題を修正しました。
- 複数のメールアドレスにメールを送信する時、不正なメールアドレスでエラーではなくそのアドレスをスキップするように変更しました。
- キャッシュディレクトリへの書き込み権限がない時、管理者ユーザーのダッシュボードにエラーを表示するようにしました。
- サイトパスとステージング環境パスが前方一致する時、プラグイン「SiteSync」による公開環境への同期が失敗する問題を修正しました。
- プラグイン「UploadUtilities」が有効の時、ログアウトしたユーザーがアセットの一覧を開こうとした時に「Trying to get property 'is\_superuser' of non\-object」エラーログに出力される問題を修正しました。
- キャッシュファイルの存在しない時にキャッシュクリア時のエラーログを抑止するようにしました。
- 環境変数「contact\_not\_save\_post\_save」を追加しました。データベースに保存しない設定のフォーム保存時にも「post\_save」コールバックをコールします。
- 何らかの原因でプラグイン設定が重複保存されている時、常に新しい方を正として、古いレコードをクリアするようにしました。
- プラグイン「NuHtmlChecker」でアセットが「text/html」の時「ビューまたはモデルが指定されていません。」エラーが出る問題を修正しました。
- プラグイン「SyteSync」で「Undefined variable: args」エラーが出るケースを修正しました。
- 階層の管理画面で大量の項目を作成しているとき、max\_input\_varsの値を超えても不整合が起きないように階層のデータを formの先頭に移動しました。
- プラグイン「CacheManager」で「cache\_driver」が「File」以外の時、アプリケーションキャッシュの一部がファイルキャッシュになっているためキャッシュクリアでキャッシュが残る問題を修正しました。
- jQuery UI 1\.13\.xのセキュリティ・フィックスを適用しました。
- 設問タイプの設定のない設問を作成しているフォームからの投稿時に「Attempt to read property "basename" on null」エラーが出るケースを修正しました。
- ベースネームの前後に「\_」を設定できるようにしました。
- フィールドを必須にしているとき、値に「0」を指定した時に必須エラーとなる問題を修正しました。
- プラグイン「UniqueURL」で、インデックス・テンプレートの URLが重複していないケースでエラーになるものを修正しました。
- プラグイン「AxeRunner」で管理画面からの再検証に失敗するケースを修正しました。
- プラグイン「AxeRunner」のレポートの詳細の不要な escapeを削除しました。
- プラグイン「AxeRunner」でチェックのタイミングをページ読み込み後にするようにしました。
- プラグイン「AxeRunner」でレポートに問題箇所の CSSセレクタを表示するようにしました。
- 環境変数「keep\_published\_on」を追加しました。trueを指定すると、リビジョンの予約差し替え実行時にマスタの公開日を維持します。
- プラグイン「AWS\_S3」でシステム設定を利用する設定の時、リージョンの設定が引き継がれない問題を修正しました。
- 一覧画面で特定のフィルタを適用している時に、「全n件を選択する」の件数が合わないケースを修正しました。
- プラグイン「AxeRunner」でダッシュボードのレポートをスケジュールタスクでアップデートするようにしました。
- プラグイン「AxeRunner」で一覧画面で、WCAGの項目ごとに一覧をフィルタリングできるようにしました。
- プラグイン「AppProperties」で JSON型の値が保存時に配列に変わってしまう問題を修正しました。
- カラムの選択項目のオプションを「=」で繋いでいる時、一覧表示で値ではなく選択名を表示させるようにしました。
- 環境変数「include\_realtime」を追加しました。trueを指定すると、mt:includeタグに file属性を指定した時、コンパイル時ではなく、そのタイミングのファイルを常にインクルードします。初期値は falseです。
- ファンクションタグ「mt:require」を追加しました。file属性で指定したファイルをインクルードしてファイルのデータを返します。
- 環境変数「can\_includes」を追加しました。「mt:include」「mt:require」タグでインクルードできるファイルの拡張子を指定します。初期値は\['txt', 'tpl', 'tmpl', 'inc', 'html'\]です。
- PHP のバージョンが 8 以上の場合、プラグイン「PostOnTwitter」で利用する Twitter API のバージョンを v2 に変更しました。
- 階層対象のオブジェクトがない状態で「階層の管理」から新規にオブジェクトを作成すると 500エラーになる問題を修正しました。
- オブジェクトの作成・編集画面で単一選択・ダイアログ型のリレーションでオブジェクトを選択した時、HTMLが二重にエスケープされる問題を修正しました。
- 「mt:archivelist」タグでstash「current\_urlmapping」が変わってしまう問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで「workspace\_ids」属性に別のスコープのIDを単一指定している時、リレーションをタグ属性で指定している時にオブジェクトが取得できない問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで「workspace\_ids」属性に「all」を指定している時、リレーションをタグ属性で指定している時にオブジェクトが取得できないケースを修正しました。
- モデル「asset」に「NOT NULL」指定のカラムを追加した時、一覧画面へのドラッグ&ドロップでのアップロード時に SQLエラーになる問題を修正しました。
- ロールの編集画面の各モデルのリストのチェックボックスが重複表示されるケースを修正しました。

version 2\.70

- プラグイン「NuHtmlChecker」で「警告」と「エラー」の数字が逆になる問題を修正しました。
- プラグイン「NuHtmlChecker」のエラーメッセージの翻訳漏れを修正しました。
- 「PADO\_DB\_BLOB2FILE」設定のある時ビューのビルド・キャッシュが壊れるケースを対策しました。
- プラグイン「AppProperties」で「Indirect modification of overloaded property Prototype::$properties has no effect\.」エラーが出るケースを修正しました。
- 「delete\_flag」カラムのないモデルの一覧画面のフィルタに「削除フラグあり」「削除フラグなし」が表示される問題を修正しました。
- 「mt:archivelist」タグで日付ベースのアーカイブに「sort\_order」属性に「descend」を指定してときに正しくソートされない問題を修正しました。
- リビジョンの保存時に「base64\_encode\(\): Passing null to parameter \#1 \($string\) of type string is deprecated」エラーが出るケースを修正しました。
- カウント系のタグに「archive\_type」属性を追加し、日付ベースアーカイブのタイプを指定できるようになりました。
- 環境変数「update\_rev\_created」を追加しました。リビジョンの作成時に「created\_by」「created\_on」カラムを更新して、リビジョン作成後にマスタが更新されたことを編集画面に表示します。
- libxml 2\.9\.14 でテンプレートのコンパイル時に意図しないランダムな文字列が残る問題を修正しました。
- build\_path\_with\_mapが falseを返した時に削除されるべきアーカイブが残るケースを修正しました。
- 「tools/orphanRecords\.php」を追加しました。孤立した不要なレコードをクリーンアップします。
- 環境変数「publish\_callbacks」が指定されている時「scheduled\_replacement」コールバックが実行されない問題を修正しました。
- プラグイン「Members」でユーザー名またはパスワードを空文字でメンバーログインした時「members\_login」テンプレートが利用されない問題を修正しました。
- 一覧画面からの一括承認時に「Undefined array key」「Attempt to read property "nickname" on null」エラーが出るケースを修正しました。
- PHP8環境で「cache\_driver」が「APCu」「Redis」の時キャッシュの保存時に「Cannot use a scalar value as an array」エラーが出る問題を修正しました。
- 「cache\_driver」が「Memcached」「Redis」の時 flushメソッドの ttl引数が効いていない問題を修正しました。
- PHP8環境で「cache\_driver」が「APCu」「Redis」の時キャッシュの保存時に「Cannot use a scalar value as an array」エラーが出る問題を修正しました。
- ビューの編集画面でシンタックスエラーがエラーを誤検知するケースを修正しました。
- mt:include内で「mt:setvartemplate」タグを利用するとコンパイルキャッシュにヒットした時に結果が正しくならない問題を修正しました。
- 「workspace\_id」カラムのあるシステムのオブジェクトに一覧画面から遷移した時「workspace\_id=\*\*指定なし\*\*」パラメタが付与される問題を修正しました。
- プラグイン「MachineTranslator」で非同期通信バージョンの文字数が翻訳文字数の制限を超えている時、エラーを返さずにオリジナルのテキスト配列を返すようにしました。
- 「任意」のモデルへのリレーションを設定しているモデルが SearchEstraierのインデックス対象になっている時、インデックスの生成で落ちる問題を修正しました。
- 「upload」「upload\_multi」メソッドの冒頭で「max\_execution\_time」をセットするようにしました。
- Prototypeクラスの「load\_related\_objs」の第2引数に存在しないモデルを指定した時に SQLエラーになる問題を修正しました。
- テーマのエクスポートと適用時にプラグイン「SplitPage」の URLマップの設定と「オブジェクトがない時アーカイブを出力しない」の設定を設定できるようにしました。
- プラグイン「SearchEstraier」の「mt:estraiersearch」タグの取得結果が「limit」モディファイアの指定値より 1件多くなるケースを修正しました。
- プラグイン「SearchEstraier」の「mt:estraiersearch」タグに「limit」「default_limit」のいずれも指定がない時に取得結果が0件となる問題を修正しました。
- tools/backupSQL\.php実行時に「\-\-no\-tablespaces \-\-single\-transaction」オプションを追加しました。
- 「tmpl/include/edit/entry/title\.tmpl」に初期値が反映されない問題を修正しました。
- MTMLリファレンスの「convert\_break」を「convert\_breaks」に修正しました。
- プラグイン「HTMLImporter」で XPathで DOMTextを指定した時、値が取得出来ない問題を修正しました。
- プラグイン「HTMLImporter」で 「workspace\_id」カラムのないコンテンツのインポート時にエラーログにエラーが記録される問題を修正しました。
- プラグイン「HTMLImporter」で同じパスのアセットがリネームされて複数登録されるケースを修正しました。
- プラグイン「HTMLImporter」で同じ URLをスキップするようにしました。
- プラグイン「HTMLImporter」でその他のカラムとフィールドの値をトリミングするようにしました。
- プラグイン「HTMLImporter」でライブラリ「laminas\-dom」のインストールなしで CSSセレクタを指定できるようになりました。
- プラグイン「HTMLImporter」でプライマリカラムのタイプが「テキスト」の時タイトルと本文にあたるカラムが重複する問題を修正しました。
- プラグイン「HTMLImporter」の「その他のカラム」にリレーション型のカラム名を指定できるようになりました。リレーション型のカラムについては、取得した値とプライマリカラムの値の一致するオブジェクトを関連付けます。
- プラグイン「HTMLImporter」で日付型のカラムに Xpath/CSSセレクタを指定した時、単一の値を取得するようにしました。
- アセットに大文字の拡張子のファイルをアップロードすると、拡張子が重複したファイル名になる問題を修正しました。
- 環境変数「searchestraier\_re\_index\_at\_rebuild」の初期値を falseにしました。ポップアップウィンドウからの再構築時にインデックス更新をスキップします。
- フォームのメールアドレスにカンマ区切りで複数のメールアドレスを指定できるようにしました。
- 環境変数「list\_max\_cols」「dialog\_max\_cols」を追加しました。一覧画面の表示カラム数の最大値を指定します。初期値は「10」「7」です。
- 1つのリクエストでユーザー・メンバーのセッションを延長するためのクッキーが重複して発行されていた問題を修正しました。
- ブロックタグ「mt:for」の stepが「0」指定された時にエラーで落ちる問題を修正しました。
- リダイレクト後にクッキーを発行しようとしてエラーログにエラーが残るケースを修正しました。
- フォームのメールアドレス欄に MTタグを利用している時、バリデーションをスキップするようにしました。
- プラグイン「PluginStarter」でメニューのラベルに「'」を入力すると保存できない問題を修正しました。
- ループタグに「workspace\_ids」とリレーションの「OR」フィルタを指定した時に結果が取得できないケースを修正しました。
- PTPublisherクラスからの再構築時にコンテキストにセットされた値がプラグインから取得できないケースを修正しました。
- 操作系のボタンを下部に固定する設定にしている時、アクション・バーよりメニューが背面になる問題を修正しました。
- プラグイン「SimplifiedJapanese」のグローバルモディファイア「textnode\_to\_json」を「textnode\_furigana\_to\_json」にリネームし、HTMLを部分的に適用しても動作するようにしました。
- アセットのリビジョンのファイルを差し替えた後承認依頼を行い、承認者がマスタに適用した時に送信されるメールにアセットの URLが含まれなくなるケースを修正しました。
- 既存のモデルに「UUID」カラムを追加した時、既存のオブジェクトに UUIDが付与されないケースを修正しました。
- モデルの編集画面から jsonエクスポートした時に含まれる翻訳フレーズに、選択項目のオプションとヒント、モデル名の翻訳フレーズを追加しました。
- フレーズをモデルの JSONファイルからインポートする時に大文字と小文字を区別するようにしました。
- 冗長化構成で翻訳フレーズのキャッシュがマシンごとに保存されていた問題を修正しました。
- PAML4でテンプレートの処理後に末尾に空の行が追加される問題を修正しました。
- 「cache\_driver」が「MySQL」「SQLite」の時、キャッシュのレコードが重複するケースを修正しました。
- コンパイルエラーでビューの保存に失敗した時、エラーの詳細が表示されない問題を修正しました。
- 「furigana」モディファイアで漢字の間にひらがなを含む単語単位でルビが振られる時、ルビを分割できるケースでは分割するようにしました。
- モディファイア「textnode\_furigana\_to\_json」の結果をキャッシュするようにしました。
- プラグイン「DynamicCaching」に環境変数「dynamiccaching\_cache\_with\_query」を追加しました。trueを指定するとパラメタ付きの GETリクエストをキャッシュします。
- 「mt:setcontext」タグで「Illegal string offset 'BINARY'」エラーが出るケースを修正しました。
- 一覧画面のフィルタでステータスのラベルが翻訳されない問題を修正しました。
- 環境変数「var\_nullable」を追加しました。条件タグ「mt:isset」で値が nullの時互換性を確保します。
- プラグイン「DocumentSearch」でスコープでチェックされていない拡張子のファイルのインデックス登録に失敗した不要なログが残る問題を修正しました。
- 複数のメールアドレスにメールを送信する時、不正なメールアドレスでエラーではなくそのアドレスをスキップするように変更しました。
- キャッシュディレクトリへの書き込み権限がない時、管理者ユーザーのダッシュボードにエラーを表示するようにしました。
- サイトパスとステージング環境パスが前方一致する時、プラグイン「SiteSync」による公開環境への同期が失敗する問題を修正しました。
- プラグイン「UploadUtilities」が有効の時、ログアウトしたユーザーがアセットの一覧を開こうとした時に「Trying to get property 'is\_superuser' of non\-object」エラーログに出力される問題を修正しました。
- キャッシュファイルの存在しない時にキャッシュクリア時のエラーログを抑止するようにしました。
- 環境変数「contact\_not\_save\_post\_save」を追加しました。データベースに保存しない設定のフォーム保存時にも「post\_save」コールバックをコールします。
- 何らかの原因でプラグイン設定が重複保存されている時、常に新しい方を正として、古いレコードをクリアするようにしました。
- プラグイン「NuHtmlChecker」でアセットが「text/html」の時「ビューまたはモデルが指定されていません。」エラーが出る問題を修正しました。
- プラグイン「SyteSync」で「Undefined variable: args」エラーが出るケースを修正しました。
- 階層の管理画面で大量の項目を作成しているとき、max\_input\_varsの値を超えても不整合が起きないように階層のデータを formの先頭に移動しました。
- プラグイン「CacheManager」で「cache\_driver」が「File」以外の時、アプリケーションキャッシュの一部がファイルキャッシュになっているためキャッシュクリアでキャッシュが残る問題を修正しました。
- jQuery UI 1\.13\.xのセキュリティ・フィックスを適用しました。
- 設問タイプの設定のない設問を作成しているフォームからの投稿時に「Attempt to read property "basename" on null」エラーが出るケースを修正しました。
- ベースネームの前後に「\_」を設定できるようにしました。
- フィールドを必須にしているとき、値に「0」を指定した時に必須エラーとなる問題を修正しました。
- 環境変数「keep\_published\_on」を追加しました。trueを指定すると、リビジョンの予約差し替え実行時にマスタの公開日を維持します。
- 一覧画面で特定のフィルタを適用している時に「全n件を選択する」の件数が合わないケースを修正しました。
- プラグイン「AppProperties」で JSON型の値が保存時に配列に変わってしまう問題を修正しました。
- カラムの選択項目のオプションを「=」で繋いでいる時、一覧表示で値ではなく選択名を表示させるようにしました。
- 環境変数「include\_realtime」を追加しました。trueを指定すると、mt:includeタグに file属性を指定した時、コンパイル時ではなく、そのタイミングのファイルを常にインクルードします。初期値は falseです。
- ファンクションタグ「mt:require」を追加しました。file属性で指定したファイルをインクルードしてファイルのデータを返します。
- 環境変数「can\_includes」を追加しました。「mt:include」「mt:require」タグでインクルードできるファイルの拡張子を指定します。初期値は\['txt', 'tpl', 'tmpl', 'inc', 'html'\]です。
- PHP のバージョンが 8 以上の場合、プラグイン「PostOnTwitter」で利用する Twitter API のバージョンを v2 に変更しました。
- 階層対象のオブジェクトがない状態で「階層の管理」から新規にオブジェクトを作成すると 500エラーになる問題を修正しました。
- オブジェクトの作成・編集画面で単一選択・ダイアログ型のリレーションでオブジェクトを選択した時、HTMLが二重にエスケープされる問題を修正しました。
- 「mt:archivelist」タグでstash「current\_urlmapping」が変わってしまう問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで「workspace\_ids」属性に別のスコープのIDを単一指定している時、リレーションをタグ属性で指定している時にオブジェクトが取得できない問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで「workspace\_ids」属性に「all」を指定している時、リレーションをタグ属性で指定している時にオブジェクトが取得できないケースを修正しました。
- モデル「asset」に「NOT NULL」指定のカラムを追加した時、一覧画面へのドラッグ&ドロップでのアップロード時に SQLエラーになる問題を修正しました。
- ロールの編集画面の各モデルのリストのチェックボックスが重複表示されるケースを修正しました。
- リレーションの付け替えをして保存した後に、コンテナ指定のある付け替え元オブジェクトのアーカイブが再構築されない問題を修正しました。

## 2022\-10\-06

version 3\.084

- リッチテキストエディタへ画像やファイルを挿入できなくなる問題を修正しました。
- プラグイン「SplitPage」が有効な時、分割対象のビューの再構築トリガーによる再構築でオブジェクトのコンテキストが失われるケースを修正しました。
- ファンクションタグの呼び出しのタイミングでアーカイブのコンテキストが失われた時に再取得してセットするようにしました。
- URLマップが割り当てられているビューを削除しようとした時に「Undefined variable $obj \(2\) occured」エラーが出る問題を修正しました。
- PHP7\.x環境でシステムテンプレートからモジュールがインクルードできないケースを修正しました。
- プラグイン「SearchEstraier」のタグ「mt:estraiersearch」のループの中で予約変数「\_\_last\_\_」が取得できない問題を修正しました。

version 2\.664

- リッチテキストエディタへ画像やファイルを挿入できなくなる問題を修正しました。
- プラグイン「SplitPage」が有効な時、分割対象のビューの再構築トリガーによる再構築でオブジェクトのコンテキストが失われるケースを修正しました。
- ファンクションタグの呼び出しのタイミングでアーカイブのコンテキストが失われた時に再取得してセットするようにしました。
- URLマップが割り当てられているビューを削除しようとした時に「Undefined variable $obj \(2\) occured」エラーが出る問題を修正しました。
- PHP7\.x環境でシステムテンプレートからモジュールがインクルードできないケースを修正しました。
- プラグイン「SearchEstraier」のタグ「mt:estraiersearch」のループの中で予約変数「\_\_last\_\_」が取得できない問題を修正しました。

## 2022\-10\-04

version 3\.08

- MySQL8\.0\.17以降に対応するために、数値データ型のカラムの表示幅の指定を廃止しました。
- MySQL8\.0\.17以降で「tools/repair\.php」を実行したあとも SQL文が出力される問題を修正しました。
- プラグイン「AxeRunner」を追加しました。axe\-coreを利用して CMSで管理するすべての HTMLページのアクセシビリティチェックを定期実行します。
- ワークフローのメールの Fromアドレスを指定できるようにしました。ユーザーのメールアドレス、システムのメールアドレス、独自に指定から選択できます。
- 一覧画面のオブジェクトにチェックを入れてアクションや削除を実行した際に、現在の表示順の設定を反映した順番でオブジェクトを処理するようにしました。
- 環境変数「appproperties\_allow\_override」を追加しました。「config\.json」で指定済みの環境変数を管理画面から上書き可能にします。
- プラグイン「VideoCaptions」で合成動画の作成をキュー経由で実行できるようにしました。環境変数「video\_captions\_bake\_queue」に trueを指定します。
- プラグイン「VideoCaptions」で合成動画の作成の同時実行数の上限を指定できるようにしました。環境変数「video\_captions\_bake\_parallel」に数値を指定します\(初期値:1\)。
- プラグイン「VideoCaptions」が作成するサムネイルの URLオブジェクトのクラス名のスペルが間違っていたのを修正しました。
- プラグインの未定義プロパティを取得しようとしたときに、Notice: Undefined variableエラーが出る問題を修正しました。
- プラグイン「SimplifiedJapanese」にグローバルモディファイア「textnode\_to\_json」を追加しました。HTML内のテキストノードと変換したテキストをキーバリュー形式のJSONで返却します。
- プラグイン「SimplifiedJapanese」のやさしい日本語への変換結果に意図せずランダムな文字列が含まれる問題を修正しました。
- 「tools/repair\.php」実行時に「Syntax error or access violation: 1061 Duplicate key name\.\.\.」エラーが出るケースを修正しました。
- 「tools/repair\.php」で、relation, sessionなどの管理画面で管理していないモデルも対象になるようにしました。
- 「tools/repair\.php」にデータの状態を確認するためのオプション「\-\-debug 1」を追加しました。
- プラグイン「MachineTranslator」で翻訳 APIがエラーを返した時、ログにエラーを保存するようにしました。
- プラグイン「MachineTranslator」「ImageInfo」で Azure Cognitive Servicesのマルチサービス リソースを使用している時、プラグイン設定にリージョンを指定する欄を追加しました。
- 「cache\_driver」が「File」以外の時、言語ファイルの更新がキャッシュをクリアするまで反映されない問題を修正しました。
- 無効なプラグインの READMEが表示できない問題を修正しました。
- オブジェクトの編集画面からオブジェクトの削除に失敗するケースを修正しました。
- アセットにのディレクトリに「\.」を含むパスを指定できない問題を修正しました。
- 非同期読み込み等の処理とのバッティングでプラグイン「HTML\_CodeSniffer」による検証でエラーになるケースの対策のために、プラグイン設定で「遅延時間\(ミリ秒\)」を指定できるようにしました。
- テーマの「table\-striped」指定のある table、の行のコントラスト比、クラス「recommend\-date」のコントラスト比が不足している問題を修正しました。
- フォームのラジオボタンの id属性が重複する問題を修正しました。
- プラグイン「ImageInfo」の PDFチェック機能で、読み上げに失敗するケースを修正しました。
- カラムのタイプを「真偽値」型から「数値」型に変更した時、データの有無のチェックをスキップするようにしました。
- 無効化されているユーザーや退会済みのメンバーがパスワードをリセットできてしまう問題を修正しました。
- モデル「URL」のシステムフィルタに「有効なHTMLのURL」を追加しました。
- プラグイン「DataMigrator」で Movable Type形式のファイルからのインポートが、PowerCMS Xの「フィールド」に対応しました。
- 設問の編集画面で、一部の設問タイプを指定した時に placeholderの入力欄が消える問題を修正しました。
- 設問タイプが「メールアドレス \(確認\)」のフォームの確認部分のラベルが翻訳されない問題を修正しました。
- 設問タイプが「メールアドレス \(確認\)」の時、バリデーションの設定がないときもメールアドレスの一致を確認するようにしました。
- モデル「設問」「設問タイプ」にカラム「area\_label」を追加しました。複数のコントロールをセットにする時、カンマ区切りで「area\-label」属性を指定できます。
- フォームの設問「日付」の初期値が正しくセットされない問題を修正しました。
- iOSの Safariで文字サイズ200%以上に設定している時テーマのハンバーガーメニューの下部が選択できないアクセシビリティ上の問題を修正しました。
- プラグイン「MachineTranslator」で環境変数「machinetranslator\_auto\_detect」指定のある時、翻訳元言語を自動判別して設定と逆の翻訳をできるようにしました。
- 環境変数「loopfilter\_compat」を追加しました。false指定すると、リレーションの「AND」「OR」でのフィルタリング時に小文字の「and」「or」を区別するようになります。
- ブロックタグ「mt:objectcontext」のドキュメントを追加しました。
- プラグイン「LivePreview」で cols指定のある objectloopタグの結果が1件になるケースを修正しました。
- 環境変数「htmlimporter\_timeout」を追加し\(初期値15秒\)、プラグイン「HTMLImporter」がファイル取得に失敗したときにも処理を継続するようにしました。
- 拡張子 phpの URLで Not Foundページが表示されない問題を修正しました。
- コンタクトの CSVエクスポート時に添付ファイルがあるとき「file\_put\_contents : Failed to open stream: No such file or directory」エラーがログに出力される問題を修正しました。
- プラグイン「BannedWords」でプラグイン設定に入力した値が無視されるケースを修正しました。
- フィールドに値のあるオブジェクトを CSVエクスポートした時に、JSONファイルの valueが 255文字で切れる問題を修正しました。
- タイプ「数値」編集タイプ「リレーション」モデル「アセット」「添付ファイル」のファイルが CSVエクスポートされない問題を修正しました。
- タイプ「数値」編集タイプ「リレーション」モデル「アセット」「添付ファイル」のファイル付きの CSVからインポートした時にファイルに URLが発行されない問題を修正しました。
- ブロックタグ「mt:archivenext」「mt:archiveprevious」が前後のアーカイブの有無をチェックせずに単純に前後の日付を返していたのを修正してアーカイブのあるものを対象にセットするようにしました。
- RESTfulAPIでワークフローを利用する時、プラグイン「MultipleNotifications」の設定が反映されるようにしました。
- ファンクションタグ「mt:getvar」が「op」モディファイアをサポートしました。変数の値を変えずに演算結果を出力する場合に使用します。
- ブロックタグ「mt:customfieldvalues」の model属性を省略可能にしました。省略時は現在のコンテキストのモデルから取得します。
- プラグイン「MTMLReference」のタグリファレンスで、「op」モディファイアに対応しているタグの属性の説明にドキュメントへのリンクを追加しました。
- プラグイン「HTMLImporter」で MT形式でインポートを実行したときのその他のカラムの設定が引き継がれてしまう問題を修正しました。
- ビューの「mt:include」タグの「module」と「workspace\_id」属性に変数を指定している時、ビューの編集画面でインクルード先が正しく取得できない問題を修正しました。
- リビジョンの保存時にバリデーションエラーになった時、編集画面のオブジェクトの IDがマスタの IDにセットされてしまう問題を修正しました。
- 環境変数「leave\_revisions」を設定している時に一部のテキストが翻訳されない問題を修正しました。
- プラグイン「BannedWords」が有効な時、禁止ワードチェックに該当した時に「リビジョンとして保存」リビジョン編集画面での「マスタに適用」「マスタに変更」ボタンを引き継ぐようにしました。
- 環境変数「build\_pre\_parse」を追加しました。ビューの編集時「mt:include」タグの属性に変数を指定している時、インクルード先を正しく取得できるようになります。
- 環境変数「build\_pre\_parse」「1」または「true」とすると、インクルードモジュール内のインクルードモジュールを含めてリストアップし、「2」を指定すると、直接インクルードしているもののみを対象とします。
- リビジョン・タイプが「自動」のリビジョンをワークフローに回した時、リビジョン・タイプを「リビジョン」に変更するようにしました。
- プラグイン「SiteSync」の同期予約完了ログのメタデータに予約ジョブの情報を含めるようになりました。
- 環境変数「ctx\_cache\_ttl」の初期値を「604800」\(1週間\)に変更しました。
- テーマ「Website」に含まれるビュー内のファンクションタグ「mt:math」を「op」モディファイアによる実装に変更しました。
- テーマ「Media」に含まれるビュー内のファンクションタグ「mt:math」を「op」モディファイアによる実装に変更しました。
- プラグイン「SearchEstraier」に同梱されているサンプルコードのファンクションタグ「mt:math」を「op」モディファイアによる実装に変更しました。
- PTUtil::send\_mailの第4引数 $headersを省略可能にしました。省略時の Fromアドレスにはシステムのメールが使われます。
- プラグイン「DisplayOptions」の設定で「workspace\_id」カラムのないモデルの設定について、workspace\_idパラメタを無視してシステムの設定を適用するようにしました。
- Websiteテーマのパンくずリストの nav要素の aria\-labelを「breadcrumb」から「パンくずリスト」に修正しました。
- 画像をオブジェクトに添付して保存した時に「Undefined property: stdClass::$thumbnail\_square」エラーが出るケースを修正しました。
- キャプション付きVTTのファイル存在チェックを誤判定するケースを修正しました。
- ループタグを数値型のリレーションカラムでフィルタする時「Undefined variable $is\_not occured」エラーが出力される問題を修正しました。
- ループタグを数値型のリレーションカラムでフィルタする時、ラベル名にスペースを含む時スペースを「\_」に置き換えた属性値でフィルタできるようにしました。
- 階層の管理画面でオブジェクト名またはベースネームが長い文字列の時、はみ出したボタンが重なる問題を修正しました。
- プラグイン「UploadUtilities」で「タグの入力補助を利用する」を有効にしている時、タグの入力補助の欄でタグ名が表示されない問題を修正しました。
- プラグイン「BannedWords」に「H:i:s」形式の時刻を「H時i分s秒」形式の時刻に置換する設定を追加しました。
- config\.jsonへの HTTPアクセスチェックをダッシュボードのメッセージのキャッシュがある時は行わないようにしました。
- プラグイン「HTMLImporter」でインポート時に異なるスコープにアセットが存在する時にリンクや画像のパスが他のファイルのパスに置き換わる問題を修正しました。
- 予約カラム名に「can\_access」を追加しました。
- 「furigana」モディファイアで分かち書きを行なった時、HTMLエンティティが分割されてしまう問題を修正しました。
- 一覧画面からリビジョンを作成した時にベースネームの末尾に数字が追加される問題を修正しました。
- 同梱されている「Video\.js」でフルスクリーンモードの切替もしくは画面サイズ変更時に VTTの字幕の位置が一時的にずれる問題を修正しました。
- プレビュー時にモジュールインクルード後にテンプレート内の変数が初期化されてしまうケースを修正しました。
- オブジェクトのバイナリカラムのデータを削除または差し替えしてオブジェクトを保存した時、サムネイルのキャッシュが残る問題を修正しました。
- クラス「PAML」をver\.4にアップデートしました。ビューのコンパイルのロジックを変更し、コンパイルされていないテンプレートのコンパイル速度を10%程度高速化しました。
- バイナリカラムのファイルを拡張子の違うファイルに変更した時、古いサムネイルが残る問題を修正しました。
- プレビュー時にインクルードモジュール内で unsetした変数が呼び出し元のテンプレートで消えない問題を修正しました。
- ユーザーの編集画面とプラグイン「Members」のプロフィールの編集画面で意図せずパスワード欄がオートコンプリートされて「パスワードが一致しません」エラーが出るケースを修正しました。
- URLの一覧画面にフィルタ「削除フラグなし」「削除フラグ付き」を追加しました。
- プラグイン「EmailMagazine」のメールマガジンの作成・編集画面で「メルマガ購読者」を選択するダイアログで、システムスコープの時、すべてのスコープのメルマガ購読者を選択できるようにしました。
- 環境変数「login\_by\_workspace」を追加しました。workspace\_idカラムのある カスタマイズしたモデルでログインする時、スペースのIDを考慮してユーザーロックアウトを行います。
- モデルのJSONを設置するディレクトリにディレクトリを置いている時に「Undefined array key "extension"」エラーが出る問題を修正しました。
- RESTfulAPI経由でオブジェクトを作成・更新した時に送信される承認依頼・差し戻しメールの管理画面 URLが APIエンドポイントの URLになる問題を修正しました。
- RESTfulAPIでキャッシュにヒットした時環境変数「api\_pretty\_print」「api\_unescaped\_unicode」の設定が反映されない問題を修正しました。
- 前後のオブジェクトを取得する「mt:entrynext」「mt:entryprevious」等のブロックタグに「sort\_by」属性の指定が可能になりました。
- ワークフローのラジオボタンをクリックした時の挙動を改善しました。
- プラグイン「UploadUtilities」で ZIPファイルの展開時に環境変数「can\_upload\_hidden」の設定が無視される問題を修正しました。
- 環境変数「machinetranslator\_language\_all」を追加しました。ユーザーの選択した翻訳言語をすべてのスコープで共通化します。
- プラグイン「SimplifiedJapanese」のやさしい日本語エディタにプラグイン「MachineTranslator」の言語選択ボタンを表示する設定を追加しました。
- 環境変数「machinetranslator\_auto\_detect」指定のある時、プラグイン「MachineTranslator」のリッチテキストエディタの翻訳処理の時、常に言語判定をするようにしました。
- プラグイン「MachineTranslator」のリッチテキストエディタの翻訳処理の時、ルビと分かち書きを削除してから翻訳するようにしました。
- やさしい日本語エディタでリッチテキストのみを利用できる設定を追加しました。
- 「設定」画面の「メインウィジェット」インストール画面の「ライセンスコード」のラベル要素の id名が間違っていたのを修正しました。
- 環境変数「ignore\_default\_widget」を追加しました。インストール時にメインウィジェットを空\(mt:ignoreタグで囲む\)にします。
- プラグイン「EmailMagazine」のメールマガジンの作成・編集画面のメールアドレス選択のドロップダウンでオブジェクトが存在しないモデルを非表示にしました。
- 環境変数「emailmagazine\_duplicate\_filter」を追加しました。メールマガジンの作成・編集画面のメールアドレスの選択ダイアログでフィルタをかけた時、デフォルトのフィルタを無視するときに falseを指定します。初期値は trueです。
- テーマにプラグインを含んでいる時にテーマの適用でエラーになる問題を修正しました。
- テーマにモデルまたはプラグインのモデルを含めている時、テーマの適用時に正しくモデルが生成されない問題を修正しました。
- インストール直後のログイン時に不要なアップグレード処理が走る問題を修正しました。
- 「config\.json」にあらかじめ「activation\_code」「system\_email」を記載しておくことで、新規インストール時に値が予めセットされるようにしました。
- プラグイン「LinkChecker」で JavaScriptコード中のリンクを無視するようにしました。
- 再構築で「workspace\_id」のないモデルのアーカイブの中で「workspace\_id」カラムのあるモデルの一覧が正しく出力されない問題を修正しました。
- モデルの JSONファイルに「disp\_upgrade」を指定できるようにしました。環境変数「unchange\_disp\_upgrade」より優先され、trueを指定するとアップグレード実行時にカラムのラベル、表示順、編集表示、一覧表示の設定を変更します。
- テンプレート・タグのコンパイルチェックで、開始タグのないブロックタグの閉じタグを検知してエラーとするようにしました。
- コンパイルチェックの改良にともない、管理画面テンプレートの再チェックを行い、エラーを修正しました。
- プラグイン「VideoCaptions」の環境変数「video\_captions\_can\_bake」の初期値を falseにして「AppProperties」のブラックリストに追加しました。
- プラグイン「VideoCaptions」の環境変数「video\_captions\_bake\_queue」の初期値を trueにしました。
- tools/test\.php に引数「\-\-files\(ファイル・パスのカンマ区切り\)」「\-\-logging\(テンプレートファイルのブロックタグを削除後のソースをログに残す\)」を追加しました。
- プラグイン「LinkChecker」でシステムのプラグイン設定で「すべてのスペースを対象に含める」にチェックのある時、バッチ実行時のメールに各スペースのレポートを含めるようにしました。
- プラグイン「URLRedirect」でスコープの IDが正しく取得できずにリダイレクト設定とマッチしないケースを修正しました。
- 環境変数「include\_scope\_compat」を追加しました。falseを指定すると「mt:include」タグの workspace\_idに「0」を指定した時にシステムのモジュールが利用されない問題を修正します。
- 「mt:include」タグが「parent」属性をサポートしました。
- プラグイン「SearchEstraier」でサムネイルを作成する箇所で不要なループを削除しました。
- プラグイン「Theme\_GitHub」の無効化時に「Undefined variable $table」「Attempt to read property "id" on null」エラーが出る問題を修正しました。
- クラス「PAML」で未定義プロパティへのアクセス箇所を修正しました。
- クラス「PAML」のコンパイルキャッシュでプロパティ「meta」の位置をコードの末尾に移動しました。
- 環境変数「searchestraier\_convert\_utf8」を追加しました。UTF8以外の文字コードの HTMLをインデックスに含める時に trueを指定します。
- プラグイン「UniqueURL」で、インデックス・テンプレート以外のビューの保存時に重複を誤判定するケースを修正しました。
- 環境変数「date\_tag\_compat」を追加しました。 falseを指定すると、モデルにカラム「date」がある時、モデル名+Dateタグでそちらを優先するようになります。
- やさしい日本語エディタで認証エラーになった時処理を続行せずにエラーを返すようにしました。
- リッチテキストエディタの「やさしい日本語にする」「分かち書きをする」「ふりがなをつける」で、HTMLの要素をすべて選択してからボタンをクリックして変換後、元の要素がハイライトされるようにしました。
- リッチテキストエディタの「翻訳」「やさしい日本語にする」「分かち書きをする」「ふりがなをつける」で、HTMLの要素をすべて選択してからボタンをクリックして変換後、元の要素がハイライトされるようにしました。
- リッチテキストエディタの「翻訳」ボタンをクリックして翻訳する時、日本語に付けられたルビや分かち書きを無視して翻訳するようにしました。
- 「cache\_driver」が「MySQL」の時、「query\_cache」が無効になるようにして、MySQL server has gone away エラーが出る問題を修正しました。
- スケジュールタスクでリビジョン数の上限を超えたリビジョンを削除する処理について、ワークフローリビジョンを削除しないようにしました。
- 「tools/restoreSQL\.php」でリストアを実行した後にキャッシュをクリアするようにしました。
- 環境変数「ws\_selector\_limit」を追加しました。スペースのセレクタに表示するスペースの上限を指定します。初期値は15です。
- スペースのセレクタ上限を超えてダイアログからの選択時、スペースの新規作成ボタンを非表示にしました。
- プラグイン「SiteMap」でスコープに URLオブジェクトが存在しない時、ウィジェットを非表示にしました。
- プラグイン「SearchEstraier」のタグ「estraiersearch」「estraierjson」で環境変数「searchestraier\_definitely」指定のある時、件数を正確に取得するようにしました。
- システムフィルタの呼び出し元で第5〜7引数「args」「extra」「ex\_vals」を追加しました。
- プラグイン「PluginStarter」からシステムフィルタをエクスポートした時メソッドの引数「option」「args」「extra」「ex\_vals」を追加しました。
- ユーザーのプロフィール編集画面に「操作系のボタンを下部に固定する」設定を追加しました。オブジェクトの作成・編集画面、ダイアログで一覧画面を開いた時に、一定の画面の高さがある時に操作系のボタンを画面下部に固定します。
- 環境変数「aws\_s3\_setting\_by\_scope」を追加しました。trueを指定するとスコープごとにプラグイン「AWS\_S3」の「アクセスキー」「シークレットアクセスキー」を設定できるようになります。
- 環境変数「aws\_cloudfront\_setting\_by\_scope」を追加しました。trueを指定するとスコープごとにプラグイン「AWS\_CloudFront」の「アクセスキー」「シークレットアクセスキー」を設定できるようになります。
- プラグイン「LinkChecker」でスケジュールタスク実行時のメール送信に失敗した時、結果ログのメッセージが送信エラーのメッセージになってしまう問題を修正しました。
- プラグイン「LinkChecker」でリンクチェック対象のページの拡張子が「php」のページを Webアクセスするようにしました。
- プラグイン「CacheManager」が RESTFulAPIのキャッシュの削除に対応しました。
- 「password」型の inputに要素に「autocomplete="new\-password"」属性を追加しました。
- 並列型のワークフローでドロップダウンに同一のユーザーが重複するケースを修正しました。
- ステータスが非公開の添付ファイルのサムネイルがプレビューできない問題を修正しました。
- やさしい日本語エディタでやさしい日本語ボタンクリック時、認証もしくは文字数超過の時、エラーが JSONで出力される問題を修正しました。
- 「config\.json」への HTTPアクセスチェックの時ステータスコードを確認するようにしました。
- 一覧画面でリファレンス型カラムに値のない時「\*指定なし\*」を表示するようにしました。
- 条件タグ「mt:ifusercan」の属性「action」に「any」属性を渡すことによって、何らかの権限\(「workspace\_id」属性指定時にはそのスコープに何らかの権限\)があるかどうかを判別できるようになりました。
- アセットの一覧表示の権限のない時、リッチテキストエディタの「ファイルの挿入」「画像の挿入」ボタンを非表示にしました。TinyMCEプラグインの設定がある時はカスタマイズの必要があります。
- プラグイン「TinyCME」の設定に「空要素のフォーマット」を追加しました。
- やさしい日本語エディタの初期設定状態で GoogleFontが読み込めない問題を修正しました。
- 「mt:archivelist」タグで dailyを指定した時に正しいリストが取得できない問題を修正しました。
- 「mt:archivenext」タグで同日のコンテキストがセットされる問題を修正しました。
- プラグイン「AppProperties」で数値型の環境変数に「0」をセットできない問題を修正しました。
- 管理者以外がモデル「user」を保存した時に「unknown column\(user\_uuid\) in model user\.」エラーが出る問題を修正しました。
- プラグイン「UploadUtilities」でアセットとオブジェクトのステータスを同期する設定をしているモデルのオブジェクトの保存時に 500エラーが出る問題を修正しました。
- プラグイン「HTMLImporter」でモデル選択のラジオボタンの選択がない時に JavaScriptエラーが出る問題を修正しました。

version 2\.66

- MySQL8\.0\.17以降に対応するために、数値データ型のカラムの表示幅の指定を廃止しました。
- MySQL8\.0\.17以降で「tools/repair\.php」を実行したあとも SQL文が出力される問題を修正しました。
- ワークフローのメールの Fromアドレスを指定できるようにしました。ユーザーのメールアドレス、システムのメールアドレス、独自に指定から選択できます。
- 一覧画面のオブジェクトにチェックを入れてアクションや削除を実行した際に、現在の表示順の設定を反映した順番でオブジェクトを処理するようにしました。
- 環境変数「appproperties\_allow\_override」を追加しました。「config\.json」で指定済みの環境変数を管理画面から上書き可能にします。
- プラグインの未定義プロパティを取得しようとしたときに、Notice: Undefined variableエラーが出る問題を修正しました。
- プラグイン「SimplifiedJapanese」にグローバルモディファイア「textnode\_to\_json」を追加しました。HTML内のテキストノードと変換したテキストをキーバリュー形式のJSONで返却します。
- プラグイン「SimplifiedJapanese」のやさしい日本語への変換結果に意図せずランダムな文字列が含まれる問題を修正しました。
- 「tools/repair\.php」実行時に「Syntax error or access violation: 1061 Duplicate key name\.\.\.」エラーが出るケースを修正しました。
- 「tools/repair\.php」で、relation, sessionなどの管理画面で管理していないモデルも対象になるようにしました。
- 「tools/repair\.php」にデータの状態を確認するためのオプション「\-\-debug 1」を追加しました。
- 「cache\_driver」が「File」以外の時、言語ファイルの更新がキャッシュをクリアするまで反映されない問題を修正しました。
- 無効なプラグインの READMEが表示できない問題を修正しました。
- オブジェクトの編集画面からオブジェクトの削除に失敗するケースを修正しました。
- アセットにのディレクトリに「\.」を含むパスを指定できない問題を修正しました。
- 非同期読み込み等の処理とのバッティングでプラグイン「HTML\_CodeSniffer」による検証でエラーになるケースの対策のために、プラグイン設定で「遅延時間\(ミリ秒\)」を指定できるようにしました。
- テーマの「table\-striped」指定のある tableの行のコントラスト比が不足している問題を修正しました。
- フォームのラジオボタンの id属性が重複する問題を修正しました。
- テーマの「table\-striped」指定のある table、の行のコントラスト比、クラス「recommend\-date」のコントラスト比が不足している問題を修正しました。
- カラムのタイプを「真偽値」型から「数値」型に変更した時、データの有無のチェックをスキップするようにしました。
- 無効化されているユーザーや退会済みのメンバーがパスワードをリセットできてしまう問題を修正しました。
- モデル「URL」のシステムフィルタに「有効なHTMLのURL」を追加しました。
- プラグイン「DataMigrator」で Movable Type形式のファイルからのインポートが、PowerCMS Xの「フィールド」に対応しました。
- 設問の編集画面で、一部の設問タイプを指定した時に placeholderの入力欄が消える問題を修正しました。
- 設問タイプが「メールアドレス \(確認\)」のフォームの確認部分のラベルが翻訳されない問題を修正しました。
- 設問タイプが「メールアドレス \(確認\)」の時、バリデーションの設定がないときもメールアドレスの一致を確認するようにしました。
- モデル「設問」「設問タイプ」にカラム「area\_label」を追加しました。複数のコントロールをセットにする時、カンマ区切りで「area\-label」属性を指定できます。
- フォームの設問「日付」の初期値が正しくセットされない問題を修正しました。
- iOSの Safariで文字サイズ200%以上に設定している時テーマのハンバーガーメニューの下部が選択できないアクセシビリティ上の問題を修正しました。
- ブロックタグ「mt:objectcontext」のドキュメントを追加しました。
- プラグイン「LivePreview」で cols指定のある objectloopタグの結果が1件になるケースを修正しました。
- 環境変数「htmlimporter\_timeout」を追加し\(初期値15秒\)、プラグイン「HTMLImporter」がファイル取得に失敗したときにも処理を継続するようにしました。
- 拡張子 phpの URLで Not Foundページが表示されない問題を修正しました。
- コンタクトの CSVエクスポート時に添付ファイルがあるとき「file\_put\_contents : Failed to open stream: No such file or directory」エラーがログに出力される問題を修正しました。
- プラグイン「BannedWords」でプラグイン設定に入力した値が無視されるケースを修正しました。
- フィールドに値のあるオブジェクトを CSVエクスポートした時に、JSONファイルの valueが 255文字で切れる問題を修正しました。
- タイプ「数値」編集タイプ「リレーション」モデル「アセット」「添付ファイル」のファイルが CSVエクスポートされない問題を修正しました。
- タイプ「数値」編集タイプ「リレーション」モデル「アセット」「添付ファイル」のファイル付きの CSVからインポートした時にファイルに URLが発行されない問題を修正しました。
- ブロックタグ「mt:archivenext」「mt:archiveprevious」が前後のアーカイブの有無をチェックせずに単純に前後の日付を返していたのを修正してアーカイブのあるものを対象にセットするようにしました。
- ファンクションタグ「mt:getvar」が「op」モディファイアをサポートしました。変数の値を変えずに演算結果を出力する場合に使用します。
- ブロックタグ「mt:customfieldvalues」の model属性を省略可能にしました。省略時は現在のコンテキストのモデルから取得します。
- プラグイン「MTMLReference」のタグリファレンスで、「op」モディファイアに対応しているタグの属性の説明にドキュメントへのリンクを追加しました。
- プラグイン「HTMLImporter」で MT形式でインポートを実行したときのその他のカラムの設定が引き継がれてしまう問題を修正しました。
- ビューの「mt:include」タグの「module」と「workspace\_id」属性に変数を指定している時、ビューの編集画面でインクルード先が正しく取得できない問題を修正しました。
- リビジョンの保存時にバリデーションエラーになった時、編集画面のオブジェクトの IDがマスタの IDにセットされてしまう問題を修正しました。
- 環境変数「leave\_revisions」を設定している時に一部のテキストが翻訳されない問題を修正しました。
- プラグイン「BannedWords」が有効な時、禁止ワードチェックに該当した時に「リビジョンとして保存」リビジョン編集画面での「マスタに適用」「マスタに変更」ボタンを引き継ぐようにしました。
- 環境変数「build\_pre\_parse」を追加しました。ビューの編集時「mt:include」タグの属性に変数を指定している時、インクルード先を正しく取得できるようになります。
- 環境変数「build\_pre\_parse」「1」または「true」とすると、インクルードモジュール内のインクルードモジュールを含めてリストアップし、「2」を指定すると、直接インクルードしているもののみを対象とします。
- リビジョン・タイプが「自動」のリビジョンをワークフローに回した時、リビジョン・タイプを「リビジョン」に変更するようにしました。
- 環境変数「ctx\_cache\_ttl」の初期値を「604800」\(1週間\)に変更しました。
- テーマ「Website」に含まれるビュー内のファンクションタグ「mt:math」を「op」モディファイアによる実装に変更しました。
- テーマ「Media」に含まれるビュー内のファンクションタグ「mt:math」を「op」モディファイアによる実装に変更しました。
- プラグイン「SearchEstraier」に同梱されているサンプルコードのファンクションタグ「mt:math」を「op」モディファイアによる実装に変更しました。
- PTUtil::send\_mailの第4引数 $headersを省略可能にしました。省略時の Fromアドレスにはシステムのメールが使われます。
- プラグイン「DisplayOptions」の設定で「workspace\_id」カラムのないモデルの設定について、workspace\_idパラメタを無視してシステムの設定を適用するようにしました。
- Websiteテーマのパンくずリストの nav要素の aria\-labelを「breadcrumb」から「パンくずリスト」に修正しました。
- 画像をオブジェクトに添付して保存した時に「Undefined property: stdClass::$thumbnail\_square」エラーが出るケースを修正しました。
- ループタグを数値型のリレーションカラムでフィルタする時「Undefined variable $is\_not occured」エラーが出力される問題を修正しました。
- ループタグを数値型のリレーションカラムでフィルタする時、ラベル名にスペースを含む時スペースを「\_」に置き換えた属性値でフィルタできるようにしました。
- 階層の管理画面でオブジェクト名またはベースネームが長い文字列の時、はみ出したボタンが重なる問題を修正しました。
- プラグイン「UploadUtilities」で「タグの入力補助を利用する」を有効にしている時、タグの入力補助の欄でタグ名が表示されない問題を修正しました。
- プラグイン「BannedWords」に「H:i:s」形式の時刻を「H時i分s秒」形式の時刻に置換する設定を追加しました。
- config\.jsonへの HTTPアクセスチェックをダッシュボードのメッセージのキャッシュがある時は行わないようにしました。
- プラグイン「HTMLImporter」でインポート時に異なるスコープにアセットが存在する時にリンクや画像のパスが他のファイルのパスに置き換わる問題を修正しました。
- 予約カラム名に「can\_access」を追加しました。
- 「furigana」モディファイアで分かち書きを行なった時、HTMLエンティティが分割されてしまう問題を修正しました。
- 一覧画面からリビジョンを作成した時にベースネームの末尾に数字が追加される問題を修正しました。
- 同梱されている「Video\.js」でフルスクリーンモードの切替もしくは画面サイズ変更時に VTTの字幕の位置が一時的にずれる問題を修正しました。
- プレビュー時にモジュールインクルード後にテンプレート内の変数が初期化されてしまうケースを修正しました。
- オブジェクトのバイナリカラムのデータを削除または差し替えしてオブジェクトを保存した時、サムネイルのキャッシュが残る問題を修正しました。
- バイナリカラムのファイルを拡張子の違うファイルに変更した時、古いサムネイルが残る問題を修正しました。
- プレビュー時にインクルードモジュール内で unsetした変数が呼び出し元のテンプレートで消えない問題を修正しました。
- ユーザーの編集画面とプラグイン「Members」のプロフィールの編集画面で意図せずパスワード欄がオートコンプリートされて「パスワードが一致しません」エラーが出るケースを修正しました。
- URLの一覧画面にフィルタ「削除フラグなし」「削除フラグ付き」を追加しました。
- プラグイン「EmailMagazine」のメールマガジンの作成・編集画面で「メルマガ購読者」を選択するダイアログで、システムスコープの時、すべてのスコープのメルマガ購読者を選択できるようにしました。
- 環境変数「login\_by\_workspace」を追加しました。workspace\_idカラムのある カスタマイズしたモデルでログインする時、スペースのIDを考慮してユーザーロックアウトを行います。
- モデルのJSONを設置するディレクトリにディレクトリを置いている時に「Undefined array key "extension"」エラーが出る問題を修正しました。
- 前後のオブジェクトを取得する「mt:entrynext」「mt:entryprevious」等のブロックタグに「sort\_by」属性の指定が可能になりました。
- ワークフローのラジオボタンをクリックした時の挙動を改善しました。
- プラグイン「UploadUtilities」で ZIPファイルの展開時に環境変数「can\_upload\_hidden」の設定が無視される問題を修正しました。
- やさしい日本語エディタでリッチテキストのみを利用できる設定を追加しました。
- 「設定」画面の「メインウィジェット」インストール画面の「ライセンスコード」のラベル要素の id名が間違っていたのを修正しました。
- 環境変数「ignore\_default\_widget」を追加しました。インストール時にメインウィジェットを空\(mt:ignoreタグで囲む\)にします。
- プラグイン「EmailMagazine」のメールマガジンの作成・編集画面のメールアドレス選択のドロップダウンでオブジェクトが存在しないモデルを非表示にしました。
- 環境変数「emailmagazine\_duplicate\_filter」を追加しました。メールマガジンの作成・編集画面のメールアドレスの選択ダイアログでフィルタをかけた時、デフォルトのフィルタを無視するときに falseを指定します。初期値は trueです。
- テーマにプラグインを含んでいる時にテーマの適用でエラーになる問題を修正しました。
- テーマにモデルまたはプラグインのモデルを含めている時、テーマの適用時に正しくモデルが生成されない問題を修正しました。
- インストール直後のログイン時に不要なアップグレード処理が走る問題を修正しました。
- 「config\.json」にあらかじめ「activation\_code」「system\_email」を記載しておくことで、新規インストール時に値が予めセットされるようにしました。
- プラグイン「LinkChecker」で JavaScriptコード中のリンクを無視するようにしました。
- 再構築で「workspace\_id」のないモデルのアーカイブの中で「workspace\_id」カラムのあるモデルの一覧が正しく出力されない問題を修正しました。
- モデルの JSONファイルに「disp\_upgrade」を指定できるようにしました。環境変数「unchange\_disp\_upgrade」より優先され、trueを指定するとアップグレード実行時にカラムのラベル、表示順、編集表示、一覧表示の設定を変更します。
- テンプレート・タグのコンパイルチェックで、開始タグのないブロックタグの閉じタグを検知してエラーとするようにしました。
- コンパイルチェックの改良にともない、管理画面テンプレートの再チェックを行い、エラーを修正しました。
- tools/test\.php に引数「\-\-files\(ファイル・パスのカンマ区切り\)」「\-\-logging\(テンプレートファイルのブロックタグを削除後のソースをログに残す\)」を追加しました。
- プラグイン「LinkChecker」でシステムのプラグイン設定で「すべてのスペースを対象に含める」にチェックのある時、バッチ実行時のメールに各スペースのレポートを含めるようにしました。
- 環境変数「include\_scope\_compat」を追加しました。falseを指定すると「mt:include」タグの workspace\_idに「0」を指定した時にシステムのモジュールが利用されない問題を修正します。
- 「mt:include」タグが「parent」属性をサポートしました。
- プラグイン「SearchEstraier」でサムネイルを作成する箇所で不要なループを削除しました。
- クラス「PAML」で未定義プロパティへのアクセス箇所を修正しました。
- クラス「PAML」のコンパイルキャッシュでプロパティ「meta」の位置をコードの末尾に移動しました。
- 環境変数「searchestraier\_convert\_utf8」を追加しました。UTF8以外の文字コードの HTMLをインデックスに含める時に trueを指定します。
- 環境変数「date\_tag\_compat」を追加しました。 falseを指定すると、モデルにカラム「date」がある時、モデル名+Dateタグでそちらを優先するようになります。
- やさしい日本語エディタで認証エラーになった時処理を続行せずにエラーを返すようにしました。
- 「cache\_driver」が「MySQL」の時、「query\_cache」が無効になるようにして、MySQL server has gone away エラーが出る問題を修正しました。
- スケジュールタスクでリビジョン数の上限を超えたリビジョンを削除する処理について、ワークフローリビジョンを削除しないようにしました。
- 「tools/restoreSQL\.php」でリストアを実行した後にキャッシュをクリアするようにしました。
- 環境変数「ws\_selector\_limit」を追加しました。スペースのセレクタに表示するスペースの上限を指定します。初期値は15です。
- スペースのセレクタ上限を超えてダイアログからの選択時、スペースの新規作成ボタンを非表示にしました。
- プラグイン「SiteMap」でスコープに URLオブジェクトが存在しない時、ウィジェットを非表示にしました。
- プラグイン「SearchEstraier」のタグ「estraiersearch」「estraierjson」で環境変数「searchestraier\_definitely」指定のある時、件数を正確に取得するようにしました。
- システムフィルタの呼び出し元で第5〜7引数「args」「extra」「ex\_vals」を追加しました。
- プラグイン「PluginStarter」からシステムフィルタをエクスポートした時メソッドの引数「option」「args」「extra」「ex\_vals」を追加しました。
- ユーザーのプロフィール編集画面に「操作系のボタンを下部に固定する」設定を追加しました。オブジェクトの作成・編集画面、ダイアログで一覧画面を開いた時に、一定の画面の高さがある時に操作系のボタンを画面下部に固定します。
- プラグイン「LinkChecker」でスケジュールタスク実行時のメール送信に失敗した時、結果ログのメッセージが送信エラーのメッセージになってしまう問題を修正しました。
- プラグイン「LinkChecker」でリンクチェック対象のページの拡張子が「php」のページを Webアクセスするようにしました。
- 「password」型の inputに要素に「autocomplete="new\-password"」属性を追加しました。
- 並列型のワークフローでドロップダウンに同一のユーザーが重複するケースを修正しました。
- ステータスが非公開の添付ファイルのサムネイルがプレビューできない問題を修正しました。
- やさしい日本語エディタでやさしい日本語ボタンクリック時、認証もしくは文字数超過の時、エラーが JSONで出力される問題を修正しました。
- 「config\.json」への HTTPアクセスチェックの時ステータスコードを確認するようにしました。
- 一覧画面でリファレンス型カラムに値のない時「\*指定なし\*」を表示するようにしました。
- 条件タグ「mt:ifusercan」の属性「action」に「any」属性を渡すことによって、何らかの権限\(「workspace\_id」属性指定時にはそのスコープに何らかの権限\)があるかどうかを判別できるようになりました。
- アセットの一覧表示の権限のない時、リッチテキストエディタの「ファイルの挿入」「画像の挿入」ボタンを非表示にしました。TinyMCEプラグインの設定がある時はカスタマイズの必要があります。
- プラグイン「TinyCME」の設定に「空要素のフォーマット」を追加しました。
- やさしい日本語エディタの初期設定状態で GoogleFontが読み込めない問題を修正しました。
- 「mt:archivelist」タグで dailyを指定した時に正しいリストが取得できない問題を修正しました。
- 「mt:archivenext」タグで同日のコンテキストがセットされる問題を修正しました。
- プラグイン「AppProperties」で数値型の環境変数に「0」をセットできない問題を修正しました。
- 管理者以外がモデル「user」を保存した時に「unknown column\(user\_uuid\) in model user\.」エラーが出る問題を修正しました。
- プラグイン「UploadUtilities」でアセットとオブジェクトのステータスを同期する設定をしているモデルのオブジェクトの保存時に 500エラーが出る問題を修正しました。
- プラグイン「HTMLImporter」でモデル選択のラジオボタンの選択がない時に JavaScriptエラーが出る問題を修正しました。

## 2022\-08\-08

version 3\.07

- 環境変数「leave\_revisions」を追加しました。trueに指定されている時、オブジェクトの削除時にリビジョンを残し、後で復帰することができます。
- プラグイン「ImageInfo」の PDFチェック機能に、画像の代替テキストのチェック機能を追加しました。
- プラグイン「ImageInfo」の PDFチェック機能で、テキスト抽出が読み上げ順を考慮するようになりました。
- プラグイン「ImageInfo」の PDFチェック機能で、抽出したテキストの読み上げ音声を MP3形式のファイルにエクスポートできるようになりました。
- プラグイン「VideoCaptions」にファンクション・タグ「mt:videothumbnail」を追加しました。ビデオのサムネイルを生成してその URLを出力します。
- プラグイン「VideoCaptions」で他の字幕合成プロセスが実行中の時、重複実行せずにメッセージを出すようにしました。
- プラグイン「ImageInfo」にファンクション・タグ「mt:pdfthumbnail」を追加しました。PDFのサムネイルを生成してその URLを出力します。
- 同梱されている「Video\.js」ベースの動画プレイヤーが、MPEG\-DASH形式の動画をサポートしました。
- 環境変数「searchestraier\_task\_usleep」を追加しました。インデックスの洗い替え時にマイクロ秒単位で実行間隔を空けます。初期値は「0」です。
- ステータスが「公開以外の時」フォームのプレビューが公開終了状態になる問題を修正しました。
- 環境変数「api\_caching」の初期値を falseにしました。
- フィールドを保存する時、すべてのスコープでベースネームが重複しないようにしました。
- 環境変数「sitesync\_show\_reserved」を追加しました。trueを指定するとプラグイン「SiteSync」のツリーに予約状況を表示するようになります。
- ジョブの実行時のログをスコープのログに保存するようにしました。
- ユーザーに設定した開発者モードが有効にならない問題を修正しました。
- テンプレート・タグの属性値に渡す変数の値が「$」の時に値が出ない問題を修正しました。
- プラグイン「MachineTranslator」が有効な時、翻訳ボタンの表示レイヤーをモーダルダイアログより上にしました。
- プラグイン「BannedWords」に半角カナ、全角英数字、正規化対象文字列の置換設定を追加しました。
- プラグイン「BannedWords」に「Y/m/d」形式の日付を「Y年m月d日」形式の日付に置換する設定を追加しました。
- プラグイン「UniqueURL」を追加しました。オブジェクトの保存時やアセットのアップロード時にURLの重複チェックを行い、重複時にエラーを返します。
- 外部プレビューの時、添付ファイル数をカウントするタグの返り値が0になる問題を修正しました。
- pt\-view\.php に「allow\_login」指定のある時、プレビュー時にクッキーをセットするようにしました。
- フォームのメールアドレス欄にテンプレート・タグを含む時に、フォームが保存できない問題を修正しました。
- PTUtil::set\_object\_fieldsの第二引数にフィールドの値の配列を指定してオブジェクトのフィールドをセットできるようになりました。
- 環境変数「unchange\_disp\_upgrade」を追加しました。trueを指定するとアップグレード実行時にカラムのラベル、表示順、編集表示、一覧表示の設定を変更しません。
- プラグイン「HTMLImporter」がオブジェクトのフィールドのデータのインポートに対応しました。
- 標準モデルに「ユーザーをアサイン」を新たに設定した時、プラグイン「ExternalPreview」で外部プレビューができない問題を修正しました。
- リビジョンのバイナリカラムを削除してマスタに適用した時、マスタのバイナリカラムが削除されない問題を修正しました。
- 環境変数「http\_proxy」指定のある時、プラグイン「LinkChecker」で外部リンクチェックができない問題を修正しました。
- 環境変数「http\_proxy」指定のある時、プラグイン「Recaptcha」が正常に動作しない問題を修正しました。
- 環境変数「http\_proxy」指定のある時、PTUtil::stream\_context\_create メソッドでプロキシーサーバーを指定するようにしました。
- プラグイン「DisplayOptions」が無効の時、プラグインの管理画面で Base table or view not found: 1146 Table 'powercmsx\.mt\_displayoption' doesn't exist エラーが出る問題を修正しました。
- オブジェクトの保存時にバリデーションエラーになった時「外部プレビュー」のチェックボックスのチェックが引き継がれない問題を修正しました。
- オブジェクトの保存時にバリデーションエラーになった時、オブジェクトの作成者・更新者・作成日・更新日が引き継がれない問題を修正しました。
- 一覧画面に「直前のユーザー」カラムを表示させるように設定している時、「引き戻し\(取り戻し\)」ボタンが表示されない問題を修正しました。
- 削除されたバイナリカラムに対応する URLを閲覧した時に、404エラーになるようにしました。
- リビジョンのバイナリカラムを削除してマスタに適用した時、対応する URLが削除されない問題を修正しました。
- 階層の管理画面から新規にオブジェクトを作成した時、初期値がセットされるようにしました。
- プラグイン「BatchApproval」で一覧画面からワークフローを実行した時、直前のユーザーが正しくセットされない問題を修正しました。
- 未保存のオブジェクトの添付ファイルをプレビューした時にファンクションタグ「mt:attachmentfilename」タグの値が %エンコードされてしまう問題を修正しました。
- ファンクションタグ「estraierjson」に取得したい属性を配列かカンマ区切りで取得する「attributes」属性を追加しました。「all」を指定するとすべての属性を結果に含めます。
- 一覧画面の画面オプションで「ユーザー」指定のない時引き戻しでエラーになる問題を修正しました。
- URLマップが存在せず、バイナリ型・編集表示「ファイル」のカラムが存在する時、オブジェクトの一覧画面にリンク、編集画面のプライマリカラムの下に URLとリンクを表示するようにしました。
- 「mt:entries」などのオブジェクトをループするブロックタグで複数のスコープをまたがってオブジェクトを取得している時、タグなど各スコープに作られるリレーションのフィルタが効くようになりました。
- 一覧画面で検索実行した時、画面オプションが未保存のユーザーにアクション「置換」が表示されない問題を修正しました。
- 「mt:include」「mt:cacheblock」のキャッシュの有効期限を環境変数「token\_expires\(初期値7200\)」から「cache\_expires\(初期値86400\)」に変更しました。
- 「tinymce\_insert\_empty\_html」を追加しました\(初期値 true\)。HTMLの部分編集で、文字の選択がなくてもソースを追加できます。
- プラグイン「TinyMCE」の設定に「テキストとしてペースト」を追加しました。
- プラグイン「EmailMagazine」でメンバーを選択する時、フィルタ「無効なメンバー」が無視される問題を修正しました。
- いくつかのプラグインの設定画面にドキュメントへのリンクを追加しました。
- 「mt:if」の tag属性にブロックタグを指定した時、判別できない問題を修正しました。
- プラグイン「LivePreview」でブロックタグの「unique」属性がリビジョンに対して効かない問題を修正しました。
- 一覧画面の画面オプションで「ID」カラムを選択している時、リビジョンの一覧画面で ID列を表示するようにしました。
- クラス Prototypeの get\_relationsメソッドの第3引数に trueを指定することでリレーション型と数値型の1対1オブジェクトの両方を返すようにしました。
- プラグイン「UploadUtilities」のプラグイン設定画面でステータスの同期対象のオブジェクトに、数値型リレーションとフィールドでアセットを指定しているモデルを含めるようにしました。
- 添付ファイルモデルに対する権限がない時、オブジェクトに付けた添付ファイルをプレビューできない問題を修正しました。
- オブジェクトの保存時に値が「0」のカラムの値が空文字に変換されてしまう問題を修正しました。
- 「オブジェクトがない時アーカイブを出力しない」を指定した時、生成済みのアーカイブに対するオブジェクトがなくなった時にファイルが削除されない問題を修正しました。
- 環境変数「allow\_login」の指定があり、CMSと公開 URLのドメインが異なる時、公開されているページに対してもログイン画面が表示されてしまう問題を修正しました。
- プラグイン「Recaptcha」のプラグイン設定「会員ページ」が無効の時、フォームで mt:recaptchaaddtoken が動作しない問題を修正しました。
- プラグイン「HTMLImporter」でアセットのファイルサイズが大きいことによるインポートに失敗した時にエラーを表示して処理をスキップするようにしました。
- オブジェクトの保存に失敗した時、データベースに再接続するようにしました。
- オブジェクトの編集画面でリレーション先のオブジェクトのバイナリカラムの容量が大きい時にメモリ不足で編集画面の描画がコンテンツ途中で終わってしまう問題を修正しました。
- プラグイン「PluginStarter」のコールバック対象モデルに「読み取り専用」モデルが表示されるようにしました。
- プラグイン「LinkChecker」のリンクチェックで、会員サイトのメンバーを指定している時、セッションクッキーが正しくセットされていなかった問題を修正しました。
- プラグイン「LinkChecker」のリンクチェックが Digest認証をサポートしました。
- プラグイン「VideoCaptions」の字幕合成がタイム・アウトするケースを修正しました。
- ダイナミック・パブリッシングで意図したスコープの 404テンプレートが使われないケースを修正しました。
- 読み取り専用オブジェクトの詳細画面のページタイトル・見出しを\(例\)「ログの編集」から「ログの詳細」に変更しました。
- 「設問」のバリデーションがメールアドレスの時、管理者向けのメールの「Reply\-To」に指定するためのチェックボックスを追加しました。
- 一覧画面で「表示順を保存」する時「全n件を選択する」にチェックがある時、アラートのメッセージに非表示オブジェクトには影響を及ぼさない旨のメッセージを追加しました。
- 「model\_paths」に複数の同名ファイルがある時パスの長いものを優先するようになりました。
- アセットのリビジョンに同名ファイルを差替えて「マスタに適用」した時拡張子の前に「\.」が余分に追加される問題を修正しました。
- プラグイン「Members」で会員登録時・会員情報の編集時に String型のカラムのカラム長を超えた値に対してエラーが出るようにしました。
- メールを送信する時に To、Cc、Bccに配列を指定しているケースで、配列の項目中の空文字をエラーを出さずにスキップするようにしました。
- ワークフローウィジェットに表示する日付カラムをモデルごとにカスタマイズできるようにしました。
- ワークフローが有効なモデルの一覧画面のシステムフィルタから「自分の」オブジェクトを削除しました。
- 削除に失敗した metaデータが残っている時、古い画像のサムネイルが出力されるケースを修正しました。
- ユーザーのテキストフォーマットの設定が「改行を変換」の時、初期値が正しくセットされなかった問題を修正しました。
- プラグイン「Members」で会員登録時、サインアップ待ちのメンバーを重複チェックの対象に入れるようにしました。
- プラグイン「Members」で会員登録確定処理の時に、セッションを登録完了を待たずに削除し、重複チェックを強化しました。
- 「tools/clearThumbnails\.php」を追加しました。サムネイルのキャッシュをクリアします。
- CSVエクスポートで PHPが「fputcsv」に失敗した時、CSVに含まれる「"」が正しくエクスポートされない問題を修正しました。

version 2\.65

- 環境変数「leave\_revisions」を追加しました。trueに指定されている時、オブジェクトの削除時にリビジョンを残し、後で復帰することができます。
- 環境変数「searchestraier\_task\_usleep」を追加しました。インデックスの洗い替え時にマイクロ秒単位で実行間隔を空けます。初期値は「0」です。
- ステータスが「公開以外の時」フォームのプレビューが公開終了状態になる問題を修正しました。
- フィールドを保存する時、すべてのスコープでベースネームが重複しないようにしました。
- 環境変数「sitesync\_show\_reserved」を追加しました。trueを指定するとプラグイン「SiteSync」のツリーに予約状況を表示するようになります。
- ジョブの実行時のログをスコープのログに保存するようにしました。
- ユーザーに設定した開発者モードが有効にならない問題を修正しました。
- テンプレート・タグの属性値に渡す変数の値が「$」の時に値が出ない問題を修正しました。
- プラグイン「BannedWords」に半角カナ、全角英数字、正規化対象文字列の置換設定を追加しました。
- プラグイン「BannedWords」に「Y/m/d」形式の日付を「Y年m月d日」形式の日付に置換する設定を追加しました。
- 外部プレビューの時、添付ファイル数をカウントするタグの返り値が0になる問題を修正しました。
- pt\-view\.php に「allow\_login」指定のある時、プレビュー時にクッキーをセットするようにしました。
- フォームのメールアドレス欄にテンプレート・タグを含む時に、フォームが保存できない問題を修正しました。
- PTUtil::set\_object\_fieldsの第二引数にフィールドの値の配列を指定してオブジェクトのフィールドをセットできるようになりました。
- 環境変数「unchange\_disp\_upgrade」を追加しました。trueを指定するとアップグレード実行時にカラムの表示順、編集表示、一覧表示の設定を変更しません。
- プラグイン「HTMLImporter」がオブジェクトのフィールドのデータのインポートに対応しました。
- 標準モデルに「ユーザーをアサイン」を新たに設定した時、プラグイン「ExternalPreview」で外部プレビューができない問題を修正しました。
- リビジョンのバイナリカラムを削除してマスタに適用した時、マスタのバイナリカラムが削除されない問題を修正しました。
- 環境変数「http\_proxy」指定のある時、プラグイン「LinkChecker」で外部リンクチェックができない問題を修正しました。
- 環境変数「http\_proxy」指定のある時、プラグイン「Recaptcha」が正常に動作しない問題を修正しました。
- 環境変数「http\_proxy」指定のある時、PTUtil::stream\_context\_create メソッドでプロキシーサーバーを指定するようにしました。
- プラグイン「DisplayOptions」が無効の時、プラグインの管理画面で Base table or view not found: 1146 Table 'powercmsx\.mt\_displayoption' doesn't exist エラーが出る問題を修正しました。
- オブジェクトの保存時にバリデーションエラーになった時「外部プレビュー」のチェックボックスのチェックが引き継がれない問題を修正しました。
- オブジェクトの保存時にバリデーションエラーになった時、オブジェクトの作成者・更新者・作成日・更新日が引き継がれない問題を修正しました。
- 一覧画面に「直前のユーザー」カラムを表示させるように設定している時、「引き戻し\(取り戻し\)」ボタンが表示されない問題を修正しました。
- 削除されたバイナリカラムに対応する URLを閲覧した時に、404エラーになるようにしました。
- リビジョンのバイナリカラムを削除してマスタに適用した時、対応する URLが削除されない問題を修正しました。
- 階層の管理画面から新規にオブジェクトを作成した時、初期値がセットされるようにしました。
- プラグイン「BatchApproval」で一覧画面からワークフローを実行した時、直前のユーザーが正しくセットされない問題を修正しました。
- 未保存のオブジェクトの添付ファイルをプレビューした時にファンクションタグ「mt:attachmentfilename」タグの値が %エンコードされてしまう問題を修正しました。
- ファンクションタグ「estraierjson」に取得したい属性を配列かカンマ区切りで取得する「attributes」属性を追加しました。「all」を指定するとすべての属性を結果に含めます。
- 一覧画面の画面オプションで「ユーザー」指定のない時引き戻しでエラーになる問題を修正しました。
- URLマップが存在せず、バイナリ型・編集表示「ファイル」のカラムが存在する時、オブジェクトの一覧画面にリンク、編集画面のプライマリカラムの下に URLとリンクを表示するようにしました。
- 「mt:entries」などのオブジェクトをループするブロックタグで複数のスコープをまたがってオブジェクトを取得している時、タグなど各スコープに作られるリレーションのフィルタが効くようになりました。
- 一覧画面で検索実行した時、画面オプションが未保存のユーザーにアクション「置換」が表示されない問題を修正しました。
- 「mt:include」「mt:cacheblock」のキャッシュの有効期限を環境変数「token\_expires\(初期値7200\)」から「cache\_expires\(初期値86400\)」に変更しました。
- 「tinymce\_insert\_empty\_html」を追加しました\(初期値 true\)。HTMLの部分編集で、文字の選択がなくてもソースを追加できます。
- プラグイン「TinyMCE」の設定に「テキストとしてペースト」を追加しました。
- プラグイン「EmailMagazine」でメンバーを選択する時、フィルタ「無効なメンバー」が無視される問題を修正しました。
- いくつかのプラグインの設定画面にドキュメントへのリンクを追加しました。
- 「mt:if」の tag属性にブロックタグを指定した時、判別できない問題を修正しました。
- プラグイン「LivePreview」でブロックタグの「unique」属性がリビジョンに対して効かない問題を修正しました。
- 一覧画面の画面オプションで「ID」カラムを選択している時、リビジョンの一覧画面で ID列を表示するようにしました。
- クラス Prototypeの get\_relationsメソッドの第3引数に trueを指定することでリレーション型と数値型の1対1オブジェクトの両方を返すようにしました。
- プラグイン「UploadUtilities」のプラグイン設定画面でステータスの同期対象のオブジェクトに、数値型リレーションとフィールドでアセットを指定しているモデルを含めるようにしました。
- 添付ファイルモデルに対する権限がない時、オブジェクトに付けた添付ファイルをプレビューできない問題を修正しました。
- オブジェクトの保存時に値が「0」のカラムの値が空文字に変換されてしまう問題を修正しました。
- 「オブジェクトがない時アーカイブを出力しない」を指定した時、生成済みのアーカイブに対するオブジェクトがなくなった時にファイルが削除されない問題を修正しました。
- 環境変数「allow\_login」の指定があり、CMSと公開 URLのドメインが異なる時、公開されているページに対してもログイン画面が表示されてしまう問題を修正しました。
- プラグイン「HTMLImporter」でアセットのファイルサイズが大きいことによるインポートに失敗した時にエラーを表示して処理をスキップするようにしました。
- オブジェクトの保存に失敗した時、データベースに再接続するようにしました。
- オブジェクトの編集画面でリレーション先のオブジェクトのバイナリカラムの容量が大きい時にメモリ不足で編集画面の描画がコンテンツ途中で終わってしまう問題を修正しました。
- プラグイン「PluginStarter」のコールバック対象モデルに「読み取り専用」モデルが表示されるようにしました。
- プラグイン「LinkChecker」のリンクチェックで、会員サイトのメンバーを指定している時、セッションクッキーが正しくセットされていなかった問題を修正しました。
- プラグイン「LinkChecker」のリンクチェックが Digest認証をサポートしました。
- ダイナミック・パブリッシングで意図したスコープの 404テンプレートが使われないケースを修正しました。
- 読み取り専用オブジェクトの詳細画面のページタイトル・見出しを\(例\)「ログの編集」から「ログの詳細」に変更しました。
- 一覧画面で「表示順を保存」する時「全n件を選択する」にチェックがある時、アラートのメッセージに非表示オブジェクトには影響を及ぼさない旨のメッセージを追加しました。
- 「model\_paths」に複数の同名ファイルがある時パスの長いものを優先するようになりました。
- アセットのリビジョンに同名ファイルを差替えて「マスタに適用」した時拡張子の前に「\.」が余分に追加される問題を修正しました。
- プラグイン「Members」で会員登録時・会員情報の編集時に String型のカラムのカラム長を超えた値に対してエラーが出るようにしました。
- メールを送信する時に To、Cc、Bccに配列を指定しているケースで、配列の項目中の空文字をエラーを出さずにスキップするようにしました。
- ワークフローウィジェットに表示する日付カラムをモデルごとにカスタマイズできるようにしました。
- ワークフローが有効なモデルの一覧画面のシステムフィルタから「自分の」オブジェクトを削除しました。
- 削除に失敗した metaデータが残っている時、古い画像のサムネイルが出力されるケースを修正しました。
- ユーザーのテキストフォーマットの設定が「改行を変換」の時、初期値が正しくセットされなかった問題を修正しました。
- プラグイン「Members」で会員登録時、サインアップ待ちのメンバーを重複チェックの対象に入れるようにしました。
- プラグイン「Members」で会員登録確定処理の時に、セッションを登録完了を待たずに削除し、重複チェックを強化しました。
- 「tools/clearThumbnails\.php」を追加しました。サムネイルのキャッシュをクリアします。
- CSVエクスポートで PHPが「fputcsv」に失敗した時、CSVに含まれる「"」が正しくエクスポートされない問題を修正しました。

## 2022\-06\-27

version 3\.06

- プラグイン「VideoCaptions」で動画のチャプターの作成・編集ができるようになりました。
- 拡張子「m3u8」「mpd」「ts」「m4s」のファイルをビデオとして扱うようにしました。
- 同梱されている「Video\.js」ベースの動画プレイヤーが、HLS形式の動画をサポートしました。
- プラグイン「LinkChecker」のプラグイン設定に「除外パス」を追加しました。
- 環境変数「ip\_unlock」を追加しました。キーをモデル名\(userまたはmember\)、値を解除する秒\(数値\)に指定した配列で指定します。指定することで、ロックアウトから一定時間経過した禁止IPアドレスのロックアウトを解除します。
- テーマの「config\.json」のフォーマットが不正な時、テーマの管理画面でエラーを出しそのテーマをスキップするようにしました。
- テーマに同梱されている .htaccess 用のビューにおいて不要なキャプチャを削除しました。
- テーマに同梱されている .htaccess 用のビューにおいてディレクトリ・ファイルが存在しない場合に RewriteCond にマッチしない問題を修正しました。
- 「set\_loop\_vars」メソッドを呼んでいないブロックタグの出力がプレビュー時に出ない問題を修正しました。
- 単一リレーションのコンテキストをセットするブロックタグで、プレビュー時に選択したオブジェクトが反映されない問題を修正しました。
- データベース名に「\-」を含む時、pt\-check\.php でデータベースチェック時にエラーが出る問題を修正しました。
- プラグイン「BatchTriggerControl」を追加しました。一覧画面からURLマップの再構築トリガーを一括設定します。
- 環境変数「searchestraier\_thumb\_minimum\_area」を追加しました。サムネイル対象とする画像の最小面積\(widthとheight属性の積\)を指定します。初期値は1500です。
- 環境変数「searchestraier\_thumb\_minimum\_size」を追加しました。widthとheight属性が省略された画像をサムネイル対象とする最小のサイズ\(バイト数\)を指定します。初期値はありません。
- プラグイン「Text2OgImage」が生成した画像の URLに mime\_type がセットされない問題を修正しました。
- ユーザーの作成・編集画面で「スペースの表示順」の選択肢が翻訳されない問題を修正しました。
- 環境変数「image\_quality」が「0」のとき、PNG画像の圧縮レベルが正しくセットされない問題を修正しました。
- 環境変数「max\_image\_pixel」を追加しました。アップロード画像の長辺が指定のピクセル値を超えている時、指定の値に縮小します。プラグイン「FileUploader」でのアップロードについては対象外です。
- モデル「member」の編集画面に階層型のリレーションを指定している時、メンバーのサインアップ画面のコンパイルキャッシュが不正になる問題を修正しました。
- プラグイン「UploadUtilities」で「同じパスのファイルを上書きする」にチェックを入れた時、ZIPファイルがリネームされてしまう問題を修正しました。
- プラグインの言語ファイルが読み込まれないケースを修正しました。
- プラグイン「ImageInfo」の Linux用のヘルパーを 32bit版から 64bit版に変更しました。
- プラグイン「ExportContents」で管理者ユーザーがスペースのコンテンツエクスポート画面を開いた時権限エラーになる問題を修正しました。
- プラグイン「DocumentSearch」のプラグイン設定のモデルと拡張子の初期値を「指定なし」に変更しました。
- プラグイン「DocumentSearch」で PDFなどのファイルのインデックスが文字化けするケースを修正しました。
- リレーションのループの中で、関連オブジェクトのコンテキストをセットしている時、プレビュー時に正しいコンテキストがセットされないケースを修正しました。
- libxmlのバージョンが必要バージョンを満たしていない時、pt\-check\.php のエラーメッセージが翻訳されない問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで cols指定のないカラムの値を取得しようとした時に、データベースから当該のレコードのみを再取得して出力するようにしました。
- やさしい日本語エディタの復元ボタンクリック時のアラートメッセージが翻訳されていなかったのを修正しました。
- サムネイルを生成すると、コンテキスト・オブジェクトの読み込まれたカラムが失われる問題を修正しました。
- 環境変数「api\_caching」の初期値を falseにしました。
- テーマのディレクトリ名に「\.」が含まれている時、テーマが選択できない問題を修正しました。
- テーマディレクトリがリネームされた時にテーマ名が「」になる問題を修正しました。
- 空の文字列をメールアドレスチェックした時に、正しいメールアドレスとして評価する問題を修正しました。
- ログイン画面とパスワード再設定画面のデザインを変更しました。
- メニュータイプ「読み取り専用」のオブジェクトの一覧画面で検索を実行した時、アクション「置換」が表示されないようにしました。
- ファイルをアップロードした時にメモリ不足などで保存に失敗した際に、他のアセットの URLオブジェクトが論理削除されてしまう問題を修正しました。
- 一覧画面で検索タイプが「フレーズ」の時、検索文字列の全角スペースが半角スペースに変更されないようにしました。
- PHP8環境で RESTfulAPIの初期化時にエラーになる問題を修正しました。
- RESTfulAPIで「X\-PCMSX\-Authorization」ヘッダが取得できないケースを修正しました。
- RESTfulAPIでワークフローを利用する時対象のユーザーが得られないケースを修正しました。
- RESTfulAPIが「Preflight request」に対応しました。環境変数「api\_allowed\_origin」に、許可するドメインを配列で指定してください。
- 環境変数「api\_acc\_ctrl\_allow\_headers」を追加しました。初期値は["Content-Type", "X-PCMSX-Authorization", "access_token"]です。
- PADOBaseModelを stdClassを継承したクラスにしました。
- 階層の管理画面でコンパイルキャッシュ生成後の階層表示が崩れる問題を修正しました。
- 階層の管理画面で編集ボタンや追加ボタンをクリックしたときにレイアウトが崩れる問題を修正しました。
- 同名のオブジェクトが存在する時、階層型のリレーションカラムのインポート時に最上位の階層のオブジェクトが指定できない問題を修正しました。
- 同じモデルに対するリレーション型と数値1対1型のカラムが両方設定されている時、プラグイン「RebuildRelations」が数値型カラムで関連付けされたオブジェクトを再構築できない問題を修正しました。
- PTUtil::convert2absメソッドが正規化された URLを返すようになりました。
- プラグイン「LinkChecker」でリンク元と同一ドメインのリンクチェック時にファイルの存在チェックを追加しました。
- 設問のバリデーション「日付と時刻」を選択した時保存時に選択が解除される問題を修正しました。
- リビジョン対応モデルの一覧画面でフィルタや検索を適用した時、表示が極端に遅くなる問題を修正しました。
- プラグイン「PluginStarter」で追加できるコールバックに「post\_save\_clone」「post\_save\_revision」を追加しました。
- クラス Prototypeの logメソッドにオブジェクトを指定できるようになりました。
- 環境変数「debug」\(デバッグモード\)指定のある時、フッターに管理画面テンプレートのパスと、コンパイルキャッシュファイルのパスを出すようにしました。
- chache\_driver が「File」でない時、プラグインの versionがキャッシュされてバージョンアップが認識されない問題を修正しました。
- スキーマの定義ファイルをキャッシュするようにしました。
- プラグイン初期化時に不要な SQLクエリが発行されないようにしました。
- ログインしているユーザーが管理者の時「デバッグモード」「開発者モード」を自分のみを対象に設定できるようになりました。
- 管理者権限のあるユーザーの権限チェックについて、処理の無駄な部分をスキップするようにしました。
- プラグイン「Members」のサインアップ画面で、選択項目型のカラムの値が保存されない問題を修正しました。
- プラグイン「Members」のプロフィールの編集画面で、チェックボックス型の選択項目でチェックを外した時に反映されない問題を修正しました。
- カラムの編集表示が「選択項目」のとき、オプションにテンプレート・タグが指定できるようになりました。
- 「階層」付きのオブジェクトをパスを保ってエクスポート&インポートできるようになりました。
- 「ソート可」のオブジェクトを一覧画面からアクションで処理する順番を「order」カラムの昇順にしました。
- 環境変数「export\_int2label」\(インポート&エクスポートで数値型リレーションカラムの値をオブジェクトのラベル\(プライマリカラムの値\)で扱う\)の初期値を trueに変更しました。
- 添付ファイルモデルに対する権限がない時、オブジェクトに付けた添付ファイルをプレビューできない問題を修正しました。
- ワークフローで承認依頼・差し戻しをした時に直前のユーザーが承認依頼・差し戻しを行ったユーザーに設定されてしまう問題を修正しました。
- ワークフローを設定しているオブジェクトの編集画面で、オブジェクトが削除されたユーザーに割り当てられている時、次のユーザーのアサインができない問題を修正しました。
- ワークフローの「引き戻し\(取り戻し\)」に対応しました。ステータスが「下書き」「レビュー」「承認待ち」で、直前のユーザーが自分であるオブジェクトの承認を取り下げることができます。環境変数「can\_pull\_back」を falseに指定することで無効化できます。 
- モデル名\+dateタグの format属性が正しく効かない問題を修正しました。

version 2\.64

- 拡張子「m3u8」「mpd」「ts」「m4s」のファイルをビデオとして扱うようにしました。
- プラグイン「LinkChecker」のプラグイン設定に「除外パス」を追加しました。
- 環境変数「ip\_unlock」を追加しました。キーをモデル名\(userまたはmember\)、値を解除する秒\(数値\)に指定した配列で指定します。指定することで、ロックアウトから一定時間経過した禁止IPアドレスのロックアウトを解除します。
- テーマの「config\.json」のフォーマットが不正な時、テーマの管理画面でエラーを出しそのテーマをスキップするようにしました。
- テーマに同梱されている .htaccess 用のビューにおいて不要なキャプチャを削除しました。
- テーマに同梱されている .htaccess 用のビューにおいてディレクトリ・ファイルが存在しない場合に RewriteCond にマッチしない問題を修正しました。
- 「set\_loop\_vars」メソッドを呼んでいないブロックタグの出力がプレビュー時に出ない問題を修正しました。
- 単一リレーションのコンテキストをセットするブロックタグで、プレビュー時に選択したオブジェクトが反映されない問題を修正しました。
- データベース名に「\-」を含む時、pt\-check\.php でデータベースチェック時にエラーが出る問題を修正しました。
- 環境変数「searchestraier\_thumb\_minimum\_area」を追加しました。サムネイル対象とする画像の最小面積\(widthとheight属性の積\)を指定します。初期値は1500です。
- 環境変数「searchestraier\_thumb\_minimum\_size」を追加しました。widthとheight属性が省略された画像をサムネイル対象とする最小のサイズ\(バイト数\)を指定します。初期値はありません。
- ユーザーの作成・編集画面で「スペースの表示順」の選択肢が翻訳されない問題を修正しました。
- 環境変数「image\_quality」が「0」のとき、PNG画像の圧縮レベルが正しくセットされない問題を修正しました。
- 環境変数「max\_image\_pixel」を追加しました。アップロード画像の長辺が指定のピクセル値を超えている時、指定の値に縮小します。プラグイン「FileUploader」でのアップロードについては対象外です。
- モデル「member」の編集画面に階層型のリレーションを指定している時、メンバーのサインアップ画面のコンパイルキャッシュが不正になる問題を修正しました。
- プラグイン「UploadUtilities」で「同じパスのファイルを上書きする」にチェックを入れた時、ZIPファイルがリネームされてしまう問題を修正しました。
- プラグインの言語ファイルが読み込まれないケースを修正しました。
- プラグイン「DocumentSearch」のプラグイン設定のモデルと拡張子の初期値を「指定なし」に変更しました。
- プラグイン「DocumentSearch」で PDFなどのファイルのインデックスが文字化けするケースを修正しました。
- リレーションのループの中で、関連オブジェクトのコンテキストをセットしている時、プレビュー時に正しいコンテキストがセットされないケースを修正しました。
- libxmlのバージョンが必要バージョンを満たしていない時、pt\-check\.php のエラーメッセージが翻訳されない問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグで cols指定のないカラムの値を取得しようとした時に、データベースから当該のレコードのみを再取得して出力するようにしました。
- やさしい日本語エディタの復元ボタンクリック時のアラートメッセージが翻訳されていなかったのを修正しました。
- サムネイルを生成すると、コンテキスト・オブジェクトの読み込まれたカラムが失われる問題を修正しました。
- テーマのディレクトリ名に「\.」が含まれている時、テーマが選択できない問題を修正しました。
- テーマディレクトリがリネームされた時にテーマ名が「」になる問題を修正しました。
- 空の文字列をメールアドレスチェックした時に、正しいメールアドレスとして評価する問題を修正しました。
- ログイン画面とパスワード再設定画面のデザインを変更しました。
- メニュータイプ「読み取り専用」のオブジェクトの一覧画面で検索を実行した時、アクション「置換」が表示されないようにしました。
- ファイルをアップロードした時にメモリ不足などで保存に失敗した際に、他のアセットの URLオブジェクトが論理削除されてしまう問題を修正しました。
- 一覧画面で検索タイプが「フレーズ」の時、検索文字列の全角スペースが半角スペースに変更されないようにしました。
- PADOBaseModelを stdClassを継承したクラスにしました。
- 階層の管理画面でコンパイルキャッシュ生成後の階層表示が崩れる問題を修正しました。
- 階層の管理画面で編集ボタンや追加ボタンをクリックしたときにレイアウトが崩れる問題を修正しました。
- 同名のオブジェクトが存在する時、階層型のリレーションカラムのインポート時に最上位の階層のオブジェクトが指定できない問題を修正しました。
- 同じモデルに対するリレーション型と数値1対1型のカラムが両方設定されている時、プラグイン「RebuildRelations」が数値型カラムで関連付けされたオブジェクトを再構築できない問題を修正しました。
- PTUtil::convert2absメソッドが正規化された URLを返すようになりました。
- プラグイン「LinkChecker」でリンク元と同一ドメインのリンクチェック時にファイルの存在チェックを追加しました。
- 設問のバリデーション「日付と時刻」を選択した時保存時に選択が解除される問題を修正しました。
- リビジョン対応モデルの一覧画面でフィルタや検索を適用した時、表示が極端に遅くなる問題を修正しました。
- プラグイン「PluginStarter」で追加できるコールバックに「post\_save\_clone」「post\_save\_revision」を追加しました。
- クラス Prototypeの logメソッドにオブジェクトを指定できるようになりました。
- 環境変数「debug」\(デバッグモード\)指定のある時、フッターに管理画面テンプレートのパスと、コンパイルキャッシュファイルのパスを出すようにしました。
- chache\_driver が「File」でない時、プラグインの versionがキャッシュされてバージョンアップが認識されない問題を修正しました。
- スキーマの定義ファイルをキャッシュするようにしました。
- プラグイン初期化時に不要な SQLクエリが発行されないようにしました。
- ログインしているユーザーが管理者の時「デバッグモード」「開発者モード」を自分のみを対象に設定できるようになりました。
- 管理者権限のあるユーザーの権限チェックについて、処理の無駄な部分をスキップするようにしました。
- プラグイン「Members」のサインアップ画面で、選択項目型のカラムの値が保存されない問題を修正しました。
- プラグイン「Members」のプロフィールの編集画面で、チェックボックス型の選択項目でチェックを外した時に反映されない問題を修正しました。
- カラムの編集表示が「選択項目」のとき、オプションにテンプレート・タグが指定できるようになりました。
- 「階層」付きのオブジェクトをパスを保ってエクスポート&インポートできるようになりました。
- 「ソート可」のオブジェクトを一覧画面からアクションで処理する順番を「order」カラムの昇順にしました。
- 環境変数「export\_int2label」\(インポート&エクスポートで数値型リレーションカラムの値をオブジェクトのラベル\(プライマリカラムの値\)で扱う\)の初期値を trueに変更しました。
- 添付ファイルモデルに対する権限がない時、オブジェクトに付けた添付ファイルをプレビューできない問題を修正しました。
- ワークフローで承認依頼・差し戻しをした時に直前のユーザーが承認依頼・差し戻しを行ったユーザーに設定されてしまう問題を修正しました。
- ワークフローを設定しているオブジェクトの編集画面で、オブジェクトが削除されたユーザーに割り当てられている時、次のユーザーのアサインができない問題を修正しました。
- ワークフローの「引き戻し\(取り戻し\)」に対応しました。ステータスが「下書き」「レビュー」「承認待ち」で、直前のユーザーが自分であるオブジェクトの承認を取り下げることができます。環境変数「can\_pull\_back」を falseに指定することで無効化できます。 
- モデル名\+dateタグの format属性が正しく効かない問題を修正しました。

## 2022\-05\-25

version 3\.05

- プラグイン「ImageInfo」に PDFファイルのアクセシビリティチェック機能を追加しました。
- プラグイン「ImageInfo」でプラグイン「FileUploader」のファイルに対する「画像からテキストを抽出する」がエラーになる問題を修正しました。
- プラグイン「DocumentSearch」でアセットのアップロード時に「Object of class PADOMySQL could not be converted to int」エラーが出るのを修正しました。
- データベースのバージョンによって tools/PADO配下の cleanupBlobs\.php、convertBlob2File\.php、convertFile2Blob\.php が正常に動作しないケースを修正しました。
- chache\_driver が MySQLの時、tools/PADO配下の cleanupBlobs\.php、convertBlob2File\.php、convertFile2Blob\.php でエラーになるケースを修正しました。
- プラグイン「ImageInfo」で画像の情報を取得した時に一時ディレクトリとファイルが残る問題を修正しました。
- 「PADO\_DB\_BLOB2FILE」指定のある時、プラグイン「UploadUtilities」の「ZIPファイルを展開する」でアセットを登録するときに ZIPファイルのバイナリデータがディスクに残る問題を修正しました。
- 環境変数「no\_encode\_filename」指定のある時、アセットの作成・編集画面からファイルをアップロードした時にファイル名から拡張子が削除されてしまう問題を修正しました。
- 同梱のツール ( rebuildFiles\.php など ) を実行した際に環境変数「path\_verify」で不正な URL と判断された場合に PHP の処理が途中で止まる問題を修正しました。
- 一度公開したオブジェクトを非公開にしたとき URLが変更されても古い URLが取得されてしまう問題を修正しました。
- モデルを保存した時に「Undefined array key 0」エラーが出力される問題を修正しました。
- プラグイン「Members」でモデル「member」に編集タイプ「数値」のカラムを追加した時にプロフィールの編集画面に入力欄が出ない問題を修正しました。
- プラグイン「Members」が提供するサインアップ画面・プロフィール情報の編集画面で、カラムに設定したカスタムCMSバリデーションが動作しない問題を修正しました。
- 環境変数「searchestraier\_auto\_keywords」が trueの時プラグイン「DocumentSearch」でファイルのインデックス作成ができない問題を修正しました。
- ダイナミック・パブリッシングでページが見つからない時の 404HTTPステータスヘッダの送出をコールバックの後に移動しました。
- PAML3で「\.」を含むテンプレート変数名に配列を格納すると要素が取得できないケースを修正しました。
- プラグイン「Members」でサインアップ時のコールバック配列に「$values」を追加しました。
- プラグイン「Members」のアプリケーションの各画面のテンプレートに代替テンプレートを指定できるようにしました。
- プラグイン「Text2OgImage」のプラグイン設定でフォントのウェイトが保存出来ない問題を修正しました。
- プラグイン「Text2OgImage」「VideoCaptions」のプラグイン設定でフォントを変更した時、フォントのウェイトをリセットするようにしました。
- プラグイン「PluginStarter」でtemplateモデルに対する「404\-error」コールバックをドロップダウンに追加するようにしました。
- プラグイン「SimplifiedJapanese」で指定可能なフォントを増やしました。
- プラグイン「SimplifiedJapanese」のやさし日本語エディタのリッチテキストエディタに、ふりがなを消す、一時保存、一時データを復元ボタンを追加しました。
- クラス「PAML3」によるビューの出力で「\x\{A0\}」を半角スペースに置換して出力するようにしました。
- 再構築・ダイナミック・パブリッシングでビューのコンパイルキャッシュファイルが生成されていない時、ビルドの前にコンパイルキャッシュファイルを生成するようにしました。
- クラスが「アーカイブ」のビューを保存した時にコンパイルキャッシュファイルを生成するようにしました。
- 重複した URLの別オブジェクトがある時、特定条件で URLが物理削除されてしまう問題を修正しました。
- 一覧画面の「ステータス」カラムに差し替え予約状況を表示するようにしました。
- 一覧画面のシステムフィルタに「差し替え予約中のオブジェクト」を追加しました。
- プラグイン「MachineTranslator」が有効の時、やさしい日本語エディタに翻訳ボタンが表示されない問題を修正しました。
- プラグイン「ImageInfo」による画像 / PDFの情報表示ダイアログの lang属性に誤りがあり、スクリーンリーダーで日本語が適切に読み上げられない問題を修正しました。
- プラグイン「VideoCaptions」で、ダイアログのプレビューを行った後、キャプションの作成をクリックした時にデータが残る問題を修正しました。
- プラグイン「LinkChecker」で「tel:」から始まるリンクのチェックをスキップするようにしました。
- プラグイン「LinkChecker」で、ダイナミック・パブリッシングページのリンクチェックでチェックするページのソースが正しくならない問題を修正しました。
- モデルに「UUID」のチェックを入れて保存した時、既存オブジェクトの UUIDがセットされるようにしました。
- URLマップの一覧画面にアクション「再構築トリガーの削除」を追加しました。
- 「階層の管理」画面で、オブジェクトのプライマリカラムとベースネームの編集、オブジェクトの追加・削除ができるようになりました。
- 「階層の管理」画面で、オブジェクトの編集画面へのリンクと、オブジェクトのパーマリンクがあるとき、ページへのリンクを追加しました。
- 「階層」付きのオブジェクトの作成・編集画面に「階層の管理」へのリンクを追加しました。
- オブジェクトの作成・編集画面で編集タイプがリレーション、階層の時、選択済み項目のプライマリ指定のラベルが「指定なし」になっていた問題を修正しました。
- RESTfulAPIで mime\_typeが「image/jpeg」のバイナリデータを挿入できない問題を修正しました。
- メニュータイプが読み取り専用のとき、CSVエクスポートのカラムから「created\_on」「created\_by」カラムを削除しないようにしました。
- プラグイン「PluginStarter」で「リストアクション」を作成した時、ログの保存コードが含まれるようにしました。
- プラグイン「MTMLReference」のタグリファレンスで、ブロックタグ「mt:loop」に非対応の「sort\_order」属性の記載があるのを削除しました。
- オブジェクトの保存時の再構築で、日付型のカラムの値が null の時「0000\-00\-00 00:00:00」が出力される問題を修正しました。
- RESTfulAPIで insert を実行した時、コールバックでセットしたオブジェクトの値が保存されない問題を修正しました。
- HTTP/2 で RESTfulAPIを利用した時「X\-PCMSX\-Authorization」ヘッダが取得できず認証が通らない問題を修正しました。
- PAML3で tag\_delimiter「Mustache」を指定している時タグ内以外の「|」が空白文字に置換される問題を修正しました。
- プラグイン「VideoCaptions」で詳細のプレビュー後に他のカードをクリックしたときに JavaScriptエラーが出る問題を修正しました。
- プラグイン「Recaptcha」を追加しました。フォームと会員登録フォームに reCAPTCHA 機能を提供します。
- プラグイン「URLRedirect」を追加しました。URLのリダイレクトを管理画面で設定できるようにします。
- オブジェクトの差分抽出時に「base64\_encode」にオブジェクトが渡されてエラーになるケースを修正しました。
- 差分のないリビジョンをマスタに適用した時、リビジョンがそのまま残るケースを修正しました。
- ブロックタグ「mt:block」をネストした時、内側の「mt:block」が正常に動作しないケースを修正しました。

version 2\.63

- プラグイン「DocumentSearch」でアセットのアップロード時に「Object of class PADOMySQL could not be converted to int」エラーが出るのを修正しました。
- データベースのバージョンによって tools/PADO配下の cleanupBlobs\.php、convertBlob2File\.php、convertFile2Blob\.php が正常に動作しないケースを修正しました。
- chache\_driver が MySQLの時、tools/PADO配下の cleanupBlobs\.php、convertBlob2File\.php、convertFile2Blob\.php でエラーになるケースを修正しました。
- 「PADO\_DB\_BLOB2FILE」指定のある時、プラグイン「UploadUtilities」の「ZIPファイルを展開する」でアセットを登録するときに ZIPファイルのバイナリデータがディスクに残る問題を修正しました。
- 環境変数「no\_encode\_filename」指定のある時、アセットの作成・編集画面からファイルをアップロードした時にファイル名から拡張子が削除されてしまう問題を修正しました。
- 同梱のツール ( rebuildFiles\.php など ) を実行した際に環境変数「path\_verify」で不正な URL と判断された場合に PHP の処理が途中で止まる問題を修正しました。
- 一度公開したオブジェクトを非公開にしたとき URLが変更されても古い URLが取得されてしまう問題を修正しました。
- モデルを保存した時に「Undefined array key 0」エラーが出力される問題を修正しました。
- プラグイン「Members」でモデル「member」に編集タイプ「数値」のカラムを追加した時にプロフィールの編集画面に入力欄が出ない問題を修正しました。
- プラグイン「Members」が提供するサインアップ画面・プロフィール情報の編集画面で、カラムに設定したカスタムCMSバリデーションが動作しない問題を修正しました。
- 環境変数「searchestraier\_auto\_keywords」が trueの時プラグイン「DocumentSearch」でファイルのインデックス作成ができない問題を修正しました。
- ダイナミック・パブリッシングでページが見つからない時の 404HTTPステータスヘッダの送出をコールバックの後に移動しました。
- プラグイン「Members」でサインアップ時のコールバック配列に「$values」を追加しました。
- プラグイン「Members」のアプリケーションの各画面のテンプレートに代替テンプレートを指定できるようにしました。
- プラグイン「SimplifiedJapanese」で指定可能なフォントを増やしました。
- プラグイン「SimplifiedJapanese」のやさし日本語エディタのリッチテキストエディタに、ふりがなを消す、一時保存、一時データを復元ボタンを追加しました。
- 再構築・ダイナミック・パブリッシングでビューのコンパイルキャッシュファイルが生成されていない時、ビルドの前にコンパイルキャッシュファイルを生成するようにしました。
- クラスが「アーカイブ」のビューを保存した時にコンパイルキャッシュファイルを生成するようにしました。
- 重複した URLの別オブジェクトがある時、特定条件で URLが物理削除されてしまう問題を修正しました。
- 一覧画面の「ステータス」カラムに差し替え予約状況を表示するようにしました。
- 一覧画面のシステムフィルタに「差し替え予約中のオブジェクト」を追加しました。
- プラグイン「MachineTranslator」が有効の時、やさしい日本語エディタに翻訳ボタンが表示されない問題を修正しました。
- プラグイン「LinkChecker」で「tel:」から始まるリンクのチェックをスキップするようにしました。
- プラグイン「LinkChecker」で、ダイナミック・パブリッシングページのリンクチェックでチェックするページのソースが正しくならない問題を修正しました。
- モデルに「UUID」のチェックを入れて保存した時、既存オブジェクトの UUIDがセットされるようにしました。
- URLマップの一覧画面にアクション「再構築トリガーの削除」を追加しました。
- 「階層の管理」画面で、オブジェクトのプライマリカラムとベースネームの編集、オブジェクトの追加・削除ができるようになりました。
- 「階層の管理」画面で、オブジェクトの編集画面へのリンクと、オブジェクトのパーマリンクがあるとき、ページへのリンクを追加しました。
- 「階層」付きのオブジェクトの作成・編集画面に「階層の管理」へのリンクを追加しました。
- オブジェクトの作成・編集画面で編集タイプがリレーション、階層の時、選択済み項目のプライマリ指定のラベルが「指定なし」になっていた問題を修正しました。
- メニュータイプが読み取り専用のとき、CSVエクスポートのカラムから「created\_on」「created\_by」カラムを削除しないようにしました。
- プラグイン「PluginStarter」で「リストアクション」を作成した時、ログの保存コードが含まれるようにしました。
- プラグイン「MTMLReference」のタグリファレンスで、ブロックタグ「mt:loop」に非対応の「sort\_order」属性の記載があるのを削除しました。
- オブジェクトの保存時の再構築で、日付型のカラムの値が null の時「0000\-00\-00 00:00:00」が出力される問題を修正しました。
- オブジェクトの差分抽出時に「base64\_encode」にオブジェクトが渡されてエラーになるケースを修正しました。
- 差分のないリビジョンをマスタに適用した時、リビジョンがそのまま残るケースを修正しました。
- ブロックタグ「mt:block」をネストした時、内側の「mt:block」が正常に動作しないケースを修正しました。

## 2022\-04\-15

version 3\.04

- プラグイン「ImageInfo」を追加しました。画像に関する様々な情報を取得してアクセシビリティを検証します。
- プラグイン「Text2OgImage」を追加しました。テキストを画像化して og:image を作成してアセットに登録します。
- プラグイン「ExportContents」を追加しました。サイト・パス配下のコンテンツを ZIPファイルでエクスポートする機能を提供します。
- プラグイン「VideoCaptions」に「音声ガイドを作成して合成する」機能を追加しました。
- プラグイン「VideoCaptions」で合成字幕作成時に動画の長さを超えた開始時間のキャプション用の画像作成処理をスキップするようにしました。
- プラグイン「VideoCaptions」でタブ区切りテキストに行単位でペーストできない問題を修正しました。
- プラグイン「VideoCaptions」で\.vttファイルの改行が反映されるようになりました。
- プラグイン「VideoCaptions」でファイル名にスペースやマルチバイト文字を含む時、動画が切り替わらない問題を修正しました。
- プラグイン「VideoCaptions」でキャプションに選択できるフォントを増やしました。
- プラグイン「VideoCaptions」でカードのふりがなボタンでのふりがな追加をキャンセルした時に処理をスキップするようにしました。
- プラグイン「VideoCaptions」でキャプションが 1つだけの時、開始時間と終了時間が無視される問題を修正しました。
- プラグイン「SimplifiedJapanese」で「&」を含むテキストの音声ファイルエクスポート時にエラーとなるケースを修正しました。
- プラグイン「SimplifiedJapanese」で MP3ファイル作成時に高低アクセントを指定することができるようになりました。
- スキーマアップグレード時にカラムが「選択項目」の時の選択肢を更新しないようにしました。
- 「pt\-check\.php」の画面に libxml のバージョンを表示するようにしました。
- ダイナミック・パブリッシングで、URLオブジェクトに対応するオブジェクトが存在しないケースでエラーを返すようにしました。
- 「rebuild\_async」指定のある時、オブジェクトの保存時にバイナリファイルを先に出力するようにしました。
- 「mt:entries」などのオブジェクトをループするブロックタグにリレーションのカラムのフィルタを複数指定している時、OR検索の指定後に and\_or指定が残ってしまう問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグにリレーションのカラムのフィルタを複数指定している時、OR検索を使用するといずれかのリレーションカラムにマッチしたデータが全て表示されてしまう問題を修正しました。
- モデルの更新時に「Undefined constant PADO\_DB\_BLOBPATH」エラーが出るケースを修正しました。
- プラグイン「LivePreview」でアーカイブの URLオブジェクトが生成されているオブジェクトのバイナリカラムのファイルが 404 not found となるケースを修正しました。
- ポップアップウィンドウでの再構築時間が正しく表示されなくなっている問題を修正しました。
- プラグイン「PluginStarter」でメニューのスコープを「すべて」に指定している時、config\.jsonのメニューの項目のスコープが正しくセットされない問題を修正しました。
- プラグイン「DisplayOptions」が有効な時、スペースの再構築ボタンが表示されないケースを修正しました。
- 代替テンプレートに「include/edit/edit\_type\_編集タイプ\.tmpl」を指定できるようになりました。
- エディタへのアセットの挿入画面でプレビューアイコンのリンク先が正しくセットされない問題を修正しました。
- URLに「%20」文字列を含む時ダイナミック・パブリッシングでページが表示できないケースを修正しました。
- スケジュールタスクの実行時に Undefined array key 0 \(2\) occuredエラーが出力される問題を修正しました。
- URLマップに「\.\./」を含む時、深夜のスケジュールタスクの実行時にURLが付け替えられてしまう問題を修正しました。尚、URLマップに「\.\./」を含むのは非推奨となります。
- 「%20」を含むURLが深夜のスケジュールタスクの実行時に「%20」が「 」\(半角スペース\)に置き換えられてしまう問題を修正しました。
- アセットのリビジョンを作成した時にオリジナルのファイルがディスクから削除される問題を修正しました。
- プラグイン「Members」が提供するプロフィール編集画面でカラムに設定されているバリデーションが行われない問題を修正しました。
- プラグイン「DynamicCaching」でポップアップからの再構築時にトリガー設定によるキャッシュのクリアを行わないようにしました。
- グローバルモディファイア「encode\_url\_basename」を追加しました。URLのファイル名のみを urlencodeします。
- プラグイン「Abs2Rel」でパスのない URL がエラーとなる問題を修正しました。
- テーマ「Website」のページ見出しのサイズを調整しました。
- RESTfulAPIのキャッシュクリアをバックグラウンドで実行するようにしました。
- プラグイン「DisplayOptions」の「メニューの表示調整」画面で、システムスコープの時に不要なモデルが表示される問題を修正しました。
- PTCacheクラスの flushメソッドでのキャッシュの全クリアをバックグラウンドで1回だけ実行するようにしました。
- プラグイン「SearchEstraier」でタグ属性 workspace\_ids、include\_workspaces による絞り込みが適切に作用しない問題を修正しました。
- プラグイン「SimplifiedJapanese」の summarizeメソッドでstrongなどの一部のタグを含む時に Undefined variable: element \(8\) occured エラーが出るのを修正しました。

## 2022\-04\-15

version 2\.62

- プラグイン「SimplifiedJapanese」で「&」を含むテキストの音声ファイルエクスポート時にエラーとなるケースを修正しました。
- プラグイン「SimplifiedJapanese」で MP3ファイル作成時に高低アクセントを指定することができるようになりました。
- スキーマアップグレード時にカラムが「選択項目」の時の選択肢を更新しないようにしました。
- 「pt\-check\.php」の画面に libxml のバージョンを表示するようにしました。
- ダイナミック・パブリッシングで、URLオブジェクトに対応するオブジェクトが存在しないケースでエラーを返すようにしました。
- 「rebuild\_async」指定のある時、オブジェクトの保存時にバイナリファイルを先に出力するようにしました。
- 「mt:entries」などのオブジェクトをループするブロックタグにリレーションのカラムのフィルタを複数指定している時、OR検索の指定後に and\_or指定が残ってしまう問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグにリレーションのカラムのフィルタを複数指定している時、OR検索を使用するといずれかのリレーションカラムにマッチしたデータが全て表示されてしまう問題を修正しました。
- モデルの更新時に「Undefined constant PADO\_DB\_BLOBPATH」エラーが出るケースを修正しました。
- プラグイン「LivePreview」でアーカイブの URLオブジェクトが生成されているオブジェクトのバイナリカラムのファイルが 404 not found となるケースを修正しました。
- ポップアップウィンドウでの再構築時間が正しく表示されなくなっている問題を修正しました。
- プラグイン「PluginStarter」でメニューのスコープを「すべて」に指定している時、config\.jsonのメニューの項目のスコープが正しくセットされない問題を修正しました。
- プラグイン「DisplayOptions」が有効な時、スペースの再構築ボタンが表示されないケースを修正しました。
- エディタへのアセットの挿入画面でプレビューアイコンのリンク先が正しくセットされない問題を修正しました。
- URLに「%20」文字列を含む時ダイナミック・パブリッシングでページが表示できないケースを修正しました。
- スケジュールタスクの実行時に Undefined array key 0 \(2\) occuredエラーが出力される問題を修正しました。
- URLマップに「\.\./」を含む時、深夜のスケジュールタスクの実行時にURLが付け替えられてしまう問題を修正しました。尚、URLマップに「\.\./」を含むのは非推奨となります。
- 「%20」を含むURLが深夜のスケジュールタスクの実行時に「%20」が「 」\(半角スペース\)に置き換えられてしまう問題を修正しました。
- アセットのリビジョンを作成した時にオリジナルのファイルがディスクから削除される問題を修正しました。
- プラグイン「Members」が提供するプロフィール編集画面でカラムに設定されているバリデーションが行われない問題を修正しました。
- プラグイン「DynamicCaching」でポップアップからの再構築時にトリガー設定によるキャッシュのクリアを行わないようにしました。
- プラグイン「Abs2Rel」でパスのない URL がエラーとなる問題を修正しました。
- テーマ「Website」のページ見出しのサイズを調整しました。
- プラグイン「DisplayOptions」の「メニューの表示調整」画面で、システムスコープの時に不要なモデルが表示される問題を修正しました。
- PTCacheクラスの flushメソッドでのキャッシュの全クリアをバックグラウンドで1回だけ実行するようにしました。
- プラグイン「SearchEstraier」でタグ属性 workspace\_ids、include\_workspaces による絞り込みが適切に作用しない問題を修正しました。
- プラグイン「SimplifiedJapanese」の summarizeメソッドでstrongなどの一部のタグを含む時に Undefined variable: element \(8\) occured エラーが出るのを修正しました。

## 2022\-03\-22

version 3\.03

- プラグイン「VideoCaptions」を追加しました。アップロードしたビデオにキャプションを追加する機能を追加します。
- プラグイン「Watermark」を追加しました。画像とビデオに透かしを追加します。
- プラグイン「Members」の「mt:iflogin」タグでログインセッションのクッキーをセットする headerが複数回送信されるケースを修正しました。
- プラグイン「Members」の「pt\-members\.php」による画面で、コンパイルキャッシュが効いていないため画面のビルドに時間がかかる問題を修正しました。 
- ワークフローの通知メールのビューで利用可能なテンプレート変数に「object\_model」を追加しました。
- フォームの「コンタクトを1人1通に制限する」機能が正しく動作しない問題を修正しました。
- フォームの「必須でなく、カスタムバリデーションが設定されている」設問を未入力で投降するとメールに設問自体が記載されない問題を修正しました。
- basenameの編集表示「なし」の時リビジョンとして保存時にbasenameが空になるケースを修正しました。
- プラグイン「FileUploader」のリレーション型のファイル選択ダイアログで選択時にバッジに編集アイコンが表示されない問題を修正しました。
- 数値型リレーションの選択フィールドで新規オブジェクトを作成した時に、解除ボタンとサムネイルが表示されない問題を修正しました。
- プラグイン「FileUploader」が有効な時、フィールド型に「ビデオ」「ビデオ \(複数\)」を追加しました。
- プラグイン「FileUploader」でアップロードしたファイルの拡張子が変わってしまうケースを修正しました。
- プラグイン「UploadUtilities」の「ZIPファイルを展開する」でアセットを登録するとき、環境変数「can\_upload\_hidden」を参照して \. から始まるファイルの登録可否を制御できるようになりました。
- プラグイン「UploadUtilities」の「オブジェクトのステータスとアセットのステータスを同期」設定にスコープを問わず「システムに表示」が有効なモデルのみが表示される問題を修正しました。
- プラグイン「DynamicCaching」でトリガー指定しているページのキャッシュが一部クリアされない問題を修正しました。
- プラグイン「SimplifiedJapanese」で音声ファイルエクスポート時にエラーとなるケースを修正しました。
- プラグイン「Keywords」で自動要約を行った時プラグイン「SimplifiedJapanese」の環境変数が初期化されてしまう問題を修正しました。
- ユーザー一覧で権限の付与をする時に一覧の下部のアクションにシステム、スペースの選択肢が出ない問題を修正しました。
- Chromeでドロップダウンメニューの横スクロールバーが表示される問題を修正しました。
- リストアクションの「タグの追加」などでテキスト入力欄が表出しているとき、Enter キー押下で反応するボタンを「削除」から「Go」に変更しました。
- ファンクションタグ「mt:entrymodifiedon」などの日付系のタグの一部で「format\_name」モディファイアが正常に動作しないケースを修正しました。
- モデル「searchword」にカラム「remote\_ip」を追加して、IPアドレスを保存するようにしました。
- 環境変数「linkchecker\_retry\_outlink」を追加しました。外部リンクのチェック時に HEADリクエストがエラーになった時に GETリクエストを送信して再チェックします。初期値は falseです。
- ユーザー一覧のアクション「権限の付与」のスコープ選択ドロップダウンが上下同期しない問題を修正しました。
- システムスコープのみに作成可能なオブジェクトへのリレーション設定をダイアログにしている時、作成権限があるのにオブジェクトの編集画面で作成\(\+\)ボタンが表示されない問題を修正しました。
- モデル設定「最大リビジョン数」が 0 の場合にタスク「remove\_old\_revisions」による自動保存リビジョンの整理が行われない問題を修正しました。
- カラムの編集タイプが選択項目の時「翻訳」にチェック指定のない時も選択肢が翻訳されてしまう問題を修正しました。
- リッチテキストエディタ「TinyMCE」のブランド表示を trueとしました。

## 2022\-03\-22

version 2\.6

- プラグイン「Members」の「mt:iflogin」タグでログインセッションのクッキーをセットする headerが複数回送信されるケースを修正しました。
- プラグイン「Members」の「pt\-members\.php」による画面で、コンパイルキャッシュが効いていないため画面のビルドに時間がかかる問題を修正しました。 
- ワークフローの通知メールのビューで利用可能なテンプレート変数に「object\_model」を追加しました。
- フォームの「コンタクトを1人1通に制限する」機能が正しく動作しない問題を修正しました。
- フォームの「必須でなく、カスタムバリデーションが設定されている」設問を未入力で投降するとメールに設問自体が記載されない問題を修正しました。
- basenameの編集表示「なし」の時リビジョンとして保存時にbasenameが空になるケースを修正しました。
- プラグイン「FileUploader」のリレーション型のファイル選択ダイアログで選択時にバッジに編集アイコンが表示されない問題を修正しました。
- 数値型リレーションの選択フィールドで新規オブジェクトを作成した時に、解除ボタンとサムネイルが表示されない問題を修正しました。
- プラグイン「FileUploader」が有効な時、フィールド型に「ビデオ」「ビデオ \(複数\)」を追加しました。
- プラグイン「FileUploader」でアップロードしたファイルの拡張子が変わってしまうケースを修正しました。
- プラグイン「UploadUtilities」の「ZIPファイルを展開する」でアセットを登録するとき、環境変数「can\_upload\_hidden」を参照して \. から始まるファイルの登録可否を制御できるようになりました。
- プラグイン「UploadUtilities」の「オブジェクトのステータスとアセットのステータスを同期」設定にスコープを問わず「システムに表示」が有効なモデルのみが表示される問題を修正しました。
- プラグイン「SimplifiedJapanese」で音声ファイルエクスポート時にエラーとなるケースを修正しました。
- プラグイン「Keywords」で自動要約を行った時プラグイン「SimplifiedJapanese」の環境変数が初期化されてしまう問題を修正しました。
- ユーザー一覧で権限の付与をする時に一覧の下部のアクションにシステム、スペースの選択肢が出ない問題を修正しました。
- Chromeでドロップダウンメニューの横スクロールバーが表示される問題を修正しました。
- リストアクションの「タグの追加」などでテキスト入力欄が表出しているとき、Enter キー押下で反応するボタンを「削除」から「Go」に変更しました。
- ファンクションタグ「mt:entrymodifiedon」などの日付系のタグの一部で「format\_name」モディファイアが正常に動作しないケースを修正しました。
- モデル「searchword」にカラム「remote\_ip」を追加して、IPアドレスを保存するようにしました。
- 環境変数「linkchecker\_retry\_outlink」を追加しました。外部リンクのチェック時に HEADリクエストがエラーになった時に GETリクエストを送信して再チェックします。初期値は falseです。
- ユーザー一覧のアクション「権限の付与」のスコープ選択ドロップダウンが上下同期しない問題を修正しました。
- システムスコープのみに作成可能なオブジェクトへのリレーション設定をダイアログにしている時、作成権限があるのにオブジェクトの編集画面で作成\(\+\)ボタンが表示されない問題を修正しました。
- モデル設定「最大リビジョン数」が 0 の場合にタスク「remove\_old\_revisions」による自動保存リビジョンの整理が行われない問題を修正しました。
- カラムの編集タイプが選択項目の時「翻訳」にチェック指定のない時も選択肢が翻訳されてしまう問題を修正しました。
- リッチテキストエディタ「TinyMCE」のブランド表示を trueとしました。

## 2022\-02\-21

version 3\.02

- プラグイン「DynamicCaching」を追加しました。ダイナミック・パブリッシングのページをキャッシュします。
- 環境変数「dynamic\_init\_tags\_later」を追加しました。ダイナミック・パブリッシングでダイナミック・タグの初期化タイミングをビルドの直前に移動します。
- 環境変数「rebasename\_clone」\(複製時にベースネームを付け直す\)、「publish\_clone」\(複製時に URLを発行する\)を追加しました。初期値はいずれも falseですが、最新版の config\.jsonで trueがデフォルト指定されています。
- プラグイン「SearchEstraier」の表記揺れの吸収の対象について、タイトル、本文に加え、メタデータを対象にするようにしました。
- プラグイン「HTMLImporter」でコンテンツの抽出に CSSセレクタを利用できすようになりました。
- テキストフォーマットを選択できるモデルのオブジェクト保存時に Markdownを処理してからプラグイン「Keywords」での自動概要生成を行うようにしました。
- ワークフローの設定が「並列」の時、操作中のユーザーが自分自身に対して担当をアサインできるようになりました。
- 「tools/upgrader\.php」を追加しました。引数 \-\-models\(モデル名のカンマ区切り\)指定でコマンドラインからモデルのアップグレードを行うことができます。
- 「tools/repair\.php」を追加しました。モデルに作成されているカラムと実際のデータベースのテーブルに不整合が発生した時、引数 \-\-models\(モデル名のカンマ区切り\)指定で実行することで修復を行います。
- プラグイン「SimplifiedJapanese」のやさしい日本語エディタで「やさしい日本語にする」ボタンクリック後に表示される2つめの見出し「やさしい日本語」を「言い換えの提案」に変更しました。
- プラグイン「SimplifiedJapanese」の定数 BRACKETS に 】『』を追加しました。
- プラグイン「SimplifiedJapanese」で音声ファイルエクスポート時にキャプション表示用の JavaScriptファイルを含められるようにしました。
- プラグイン「SimplifiedJapanese」のリッチテキストのボタンで、やさしい日本語エディタ以外では rtタグにスタイルを付けないようにしました。
- PTPluginクラスにメソッド「set\_cache」「get\_cache」「flush\_cache」を追加しました。
- オブジェクトの新規作成画面でプラグインのメソッド「edit\_mime\_type」が値を返さないケースを修正しました。
- プラグイン「SearchEstraier」のインデックス生成を非同期で行っており、動的ページのインデックスを生成する設定の時、ダイナミック・タグが初期化されない問題を修正しました。
- プラグイン「Members」のログイン画面でログインに失敗した時、スコープが引き継がれない問題を修正しました。
- プラグイン「Members」のログイン画面でログインに失敗した時、「return\_url」パラメタが引き継がれない問題を修正しました。
- プラグイン「SimplifiedJapanese」で HTMLエンティティが分かち書きされる問題を修正しました。
- リッチテキスト型のフィールドをドロップダウンで選択してオブジェクト作成・編集画面に追加した時、リッチテキストエリアの値が消えて編集できなくなる問題を修正しました。
- 画面オプションでフィールドのソート順を変更した時、リッチテキストエリアの値が消えて編集できなくなる問題を修正しました。
- プラグイン「LinkChecker」の外部リンクチェック時に Basic認証の設定が反映されない問題を修正しました。
- プラグイン「LinkChecker」のリンクチェックでエラーが補足できないケースを修正しました。
- プラグイン「LinkChecker」のリンクチェックで「User\-Agent」ヘッダが正しくセットされない問題を修正しました。
- プラグイン「Keywords」の要約の自動生成対象から「ol」「ul」「dt」「table」「blockquote」要素を除外しました。
- プラグイン「Keywords」の要約の自動生成時に削除対象や処理対象の要素の 2つ目以降の要素が正しく処理されない問題を修正しました。
- プラグイン「Keywords」の要約生成時に文章の出現順が考慮されていなかった問題を修正しました。
- 「urlinfo」オブジェクトを SELECTする時に「Incorrect DATETIME value: ''」エラーが出るケースを修正しました。
- マルチバイト文字列を含むファイル名のファイルをアセットにアップロードした時に生成される URLがダイナミック・パブリッシングが無効の時に閲覧できない URLになっていた問題を修正しました。環境変数「encode\_filename\_compat」を指定すると従前の URLになります。
- 一覧画面のアクションで「検索&置換」を行った時、Method name must be a string エラーが出る問題を修正しました。
- プラグイン「TinyMCE」のデフォルトボタンに「pastetext」を追加しました。
- 環境変数「republish\_date\_based」を追加しました。trueを指定するとオブジェクトの更新時に日付ベースアーカイブをすべて再構築し直します。
- 「mt:include」タグで読み込んだモジュール内のダイナミック・タグが正しく処理されないケースを修正しました。
- 遅延再構築時にダイナミック・タグが正しく処理されないケースを修正しました。
- アセットの保存時のメタデータ「basename」に拡張子付きのファイル名が保存される問題を修正しました。
- オブジェクトの作成・編集画面でファイルアップロード後に「ダウンロードボタン」をクリックした時、ページ遷移を確認する確認メッセージを出さないようにしました。
- ベースネームの重複を許可しているモデルの新規作成時に、URLマッピングで利用しているタグによってはダイナミック・タグが初期化されない問題を修正しました。
- スケジュールタスク「clean\_up\_duplicate\_urls」実行時に意図せず URL オブジェクトが全件物理削除される問題への対応を行いました。
- iframe が存在する HTML の場合にプラグイン「HTML\_CodeSniffer」でレポートが見られない問題を修正しました。
- アセットの一覧で、検索結果の画面からドラッグ&ドロップでアセットをアップロードした時に「414 Request\-URI Too Large」エラーが出るケースを修正しました。
- 環境変数「mail\_language」に「uni」を指定している時、添付ファイル付きメールが適切に送信できない問題を修正しました。
- 環境変数「mail\_encording」は「mail\_encoding」に修正されました。
- アセットの一覧をダイアログで開いた状態でファイルアップロードした後の一覧画面に、検索やフィルタなどの状態を維持しないようにしました。
- ブロックタグ「mt:for」の from属性に「0」を指定した時に正しくループされない問題を修正しました。
- プラグイン「FileUploader」で、ファイルの一覧画面で画像が表示された以降、画像以外のアイコンが正しく表示されない問題を修正しました。
- プラグイン「FileUploader」で画像をアップロードした時、ファイルアップロード後の一時ディレクリが残る問題を修正しました。
- オブジェクトに対する作成権限がない時オブジェクトの編集画面から添付ファイルがアップロードできない問題を修正しました。
- スペースの「モデル」ダッシュボードで作成権限のないユーザーに「作成」ボタンが表示される問題を修正しました。
- PHP8環境で特定の文字列に対して「furigana」モディファイアを適用したときに処理が途中で落ちる問題を修正しました。
- RESTful APIへの認証付きアクセスに付与する HTTP\_HEADER のキーを「access\_token」から「X\-PCMSX\-Authorization」に変更しました。互換性は保たれています。
- プラグイン「Members」でアプリのURLが常にアクセス時点のものに付け替えられないようにしました。

## 2021\-12\-17

version 3\.01

- プラグイン「SimplifiedJapanese」に「hiragana」「katakana」モディファイアを追加しました。
- プラグイン「SimplifiedJapanese」が、MP3形式のファイルエクスポートをサポートしました。AWSの Pollyを利用してテキストを合成音声化します。
- プラグイン「SimplifiedJapanese」にファンクション・タグ「mt:makemp3」を追加しました。パスとテキストを指定して、テキストを読み上げた MP3ファイルを生成し、その URLを返します。
- プラグイン「SimplifiedJapanese」が追加する「ruby」タグ内の「rb」要素を削除しました。
- プラグイン「SimplifiedJapanese」で Noticeエラーが出るケースを修正しました。
- プラグイン「SimplifiedJapanese」のやさしい日本語エディタのページで「やさしい日本語」ボタンをクリックした際に、ルビの代わりに括弧内にふりがなを追加する設定を追加しました。
- モデル「Keyword」に代替フレーズカラムを追加し、プラグイン「SearchEstraier」の検索でキーワードの表記揺れの吸収に利用できるようになりました。
- プラグイン「SearchEstraier」のブロックタグ「mt:estraiersearch」の属性「workspace\_id」に「this」を指定した時、常に 0がセットされる問題を修正しました。
- プラグイン「SearchEstraier」の全文検索で、プラグイン「Keywords」のキーワードモデルに代替フレーズ付きのキーワードを登録することで、表記の揺れを吸収できるようになりました。
- プラグイン「SearchEstraier」のスケジュールタスクでのインデックス洗い替えの時、大きなページのインデックスが途中で切れる問題を修正しました。
- 「Media」テーマでプラグイン「SearchEstraier」のブロックタグ「mt:estraiersearch」内でサムネイルが表示されない問題を修正しました。
- 「Media」「Website」テーマの検索フォームに「role」属性を追加しました。
- 「Media」テーマの検索ボックスに「aria\-label」属性を追加しました。
- 「Media」テーマの「mt:entrydate」を time要素で囲みました。
- 「Media」テーマのスタイルを全体的に調整しました。
- 「Media」テーマでフォーム項目「チェックボックス」「ラジオボタン」のコントロールが非表示になる問題を修正しました。
- フォームのラジオボタンで初期値を設定している時に初期値にチェックがつかない問題を修正しました。
- 独自に作成したモデルの画面オプションに、単独で非表示化や並べ替えのできない「公開日」「公開終了日」が表示される問題を修正しました。
- プラグイン「UploadUtilities」で「タグ付けを可能にする」「タグの入力補助を利用する」のチェックのある時に、タグのループが出力されずに意図しないチェックボックスがアップロードダイアログに表示される問題を修正しました。
- 「mt:estraiersearch」タグのドキュメントで一部の属性のドキュメントが翻訳されていないのを修正しました。
- プラグイン「LinkChecker」で link要素に rel="preconnect" または rel="dns\-prefetch" 指定のあるリンクをリンクチェックから除外しました。
- 代替テンプレートでパスの長いものが優先されなくなるケースを修正しました。
- プラグイン「LivePreview」の設定が有効の時、設定日時が当該オブジェクトの非公開設定日時を超えている時 404エラーになるようにしました。
- プラグイン「LivePreview」の設定が有効の時、承認待ち、公開予約、公開以外のステータスのオブジェクトのページを 404エラーになるようにしました。
- プラグイン「LivePreview」の設定が有効の時、承認待ち、公開予約のステータスのオブジェクトで公開日が設定日時以前のオブジェクトのページを 404エラーになるようにしました。
- プラグイン「LivePreview」で時限公開・非公開・差し替え設定日時と設定日時が秒単位で一致する時、変更を適用後の状態を再現するようにしました。
- URLオブジェクトの不整合でプラグイン「SiteSync」のステージング同期のツリー表示が機能しないことがある問題を修正しました。
- スケジュールタスクにモデル「urlinfo」の不整合を修復する「URLの修復」処理を追加しました。
- プラグイン「PluginStarter」で「pre\_listing」コールバックをエクスポートした時のメソッドに第6引数「$placeholders」を追加しました。
- プラグイン「PluginStarter」でグローバルモディファイアのリファレンスが正しい形でエクスポートされない問題を修正しました。
- 「mt:entryassets」などのリレーションを取得するブロックタグで、カラム名によるフィルタがプレビュー時に効かない問題を修正しました。
- プラグイン「HTMLImporter」でその他のカラムに存在しない xpathを指定するとエラーで処理が止まる問題を修正しました。
- 一覧からアクションを実行した時に再構築トリガーが走る時、ダイナミック・タグが初期化されない問題を修正しました。
- 一覧からのアクション「ステータス変更」でコンテナの再構築が効かないケースを修正しました。
- TinyMCEのバージョンが 4.x の場合にテーブルセルにテキストのペーストを行うとテーブルメニューの幅が 100% になる問題を修正しました。
- プラグイン「HTMLImporter」でインポートしたオブジェクトのパブリッシュ処理をコールバックの後に移動しました。
- プラグイン「HTML\_CodeSniffer」でプレビュー中に link要素が body内に置かれることでエラーが検出される問題を修正しました。
- アセットの更新で「作成者」が操作したユーザーに変わってしまう問題を修正しました。
- プラグイン「MTMLReference」のタグリファレンスの画面幅を狭くした時、見出しと検索フォームが重なる問題を修正しました。
- 環境変数「force\_filter」指定のないときも、プラグインで定義した「pre\_listing」コールバックを呼ぶようにしました。
- オブジェクトの作成・編集画面からモーダルを開く URLに「ref\_model\(モデル名\)」パラメタを追加しました。
- プラグイン「EmailMagazine」で配信対象のモデルのコンテキストがスコープを考慮していない問題を修正しました。
- サーバーの PHPのバージョンや設定によってビューの保存時にコンパイルチェックのエラーを正しく拾えない問題を修正しました。
- ダイナミック・パブリッシングで 404エラーになった時に変数「theme\_static」が空になりスタイルが崩れる問題を修正しました。
- 日付アーカイブで「オブジェクトがない時アーカイブを出力しない」設定の時、既に出力済みのアーカイブにオブジェクトがない時もファイルが残る問題を修正しました。
- ステータスが下書きのオブジェクトをインポートするとデフォルトのステータスとして登録される問題を修正しました。
- プラグイン「SearchEstraier」のプラグイン設定で、非公開オブジェクトしか存在しないモデルがアーカイブ種別の選択欄に表示されない問題を修正しました。
- メールマガジンの一覧画面で、テキストメールに HTMLメールテンプレートが表示される問題を修正しました。
- インストール画面を一度表示すると「pt\-check\.php」でのシステムチェックで、インストール済みと判断される問題を修正しました。
- 「pt\-check\.php」でのシステムチェックで、supportディレクトリのパスが logディレクトリのパスを参照していた問題を修正しました。
- 「pt\-check\.php」でのシステムチェックで、環境変数「max\_packet」指定のある時「max\_allowed\_packet」をセットしてから値をチェックするようにしました。
- 「pt\-check\.php」でのシステムチェックで、外部 URLへのアクセスのタイムアウト時間を 2秒から 10秒に伸ばしました。
- プラグイン「CSSPreprocessor」のドキュメントで「"minimum\-stability": "dev",」に関する記載を削除しました。
- PAML3を使っているとき、normalizeモディファイアで「Argument \#2 \($form\) must be a a valid normalization」エラーが出る問題を修正しました。
- テーマの管理画面で GitHubの個人アクセストークンの保存時のアラートが翻訳されていなかった問題を修正しました。
- テーマの管理画面で GitHub関連の操作を行うアイコンボタンにツールチップを追加しました。
- プラグイン「MTMLReference」のオブジェクトのループタグの「ignore\_archive\_context」属性値の説明を追加しました。
- プラグイン「Keywords」のブロックタグ「mt:autokeywords」で、title属性値に urlカラムの値がセットされてしまう問題を修正しました。
- プラグイン「Keywords」のブロックタグ「mt:autokeywords」で、tag属性値のある時、そちらを優先するようにしました。
- プラグイン「AccessAnalytics」のトラッキングを取得する PHPプログラムが Googleにインデックスされてしまうケースを修正しました。
- 「user\_id」カラムを持たないモデルのオブジェクトを管理者以外が削除できない問題を修正しました。
- プラグイン「MTMLReference」にファンクションタグ「mt:objectvar」のドキュメントを追加しました。
- リッチテキスト型のフィールドをドロップダウンで選択してオブジェクト作成・編集画面に追加した時、テキストエリアのままでリッチテキストにならない問題を修正しました。
- フィールドをドロップダウンで選択してオブジェクト作成・編集画面に追加した時、フィールドが画面オプションの表示順の位置に配置されない問題を修正しました。
- ダイアログ型のリレーション選択ダイアログで検索やソート順の変更をした時に「権限がありません」メッセージが出てダッシュボードに遷移してしまう問題を修正しました。
- 数値型のカラムでリレーションを設定する時「任意」を選択できないようにしました。
- リレーション型のカラムをラジオボタンに設定している時、バリデーションでエラーになった時に値が引き継がれない問題を修正しました。

## 2021\-11\-08

version 3\.0

- JSON RESTful APIを追加しました。
- 新テーマ「Media」を追加しました。Bootstrapベースのシンプルな情報サイトテーマです。
- 新テーマ「Skeleton」を追加しました。ダイナミック・パブリッシング設定とトップページのみのミニマルなテーマです。
- プラグイン「MachineTranslator」を追加しました。Microsoft Translator APIを利用して管理画面上でコンテンツを機械翻訳でき、公開側のウェブページ翻訳にも対応します。
- プラグイン「AWS\_S3」を追加しました。静的ファイルを Amazon Simple Storage Service\(S3\)に同期します。
- プラグイン「AWS\_CloudFront」を追加しました。静的ファイルのパブリッシュと連動して AWS CloudFront のキャッシュをパージします。
- プラグイン「QuickEdit」を追加しました。公開ページから編集画面へのクイック編集リンク用ブックマークレットを提供します。
- プラグイン「CSSPreprocessor」を追加しました。CSS PreprocessorのコードをCSSにコンパイルします。
- GitHubのリポジトリURLを「theme\.json」の「repository」に指定できるようになりました。管理画面から最新版を適用できるようになります。
- ビューの「ファイルへのリンク」機能をサポートしました。環境変数「linked\_file」に「2」指定で PowerCMS と同じ振る舞いに、「1」を指定すると保存時の書き込みのみ行います。「0」指定では何もしません\(初期値は2\)。
- テーマのバージョンを管理画面から変更できるようになりました。
- テーマディレクトリに「models」「plugins」ディレクトリを追加できるようになりました。
- プラグイン「Theme\_GitHub」を追加しました。管理画面からテーマを GitHubにコミットします。
- 環境変数「composer\_autoload」を追加しました。「phpoffice/phpword」「twilio/sdk」をパッケージから削除し、composerからインストールするように変更しました。
- テンプレートエンジン「PAML」をバージョンアップしました。利用できるタグが増え、記述方法がより柔軟になり、パフォーマンスが向上しました。
- 「theme\.json」のエクスポート時に「JSON\_UNESCAPED\_SLASHES」オプションを追加しました。
- ファンクションタグ「mt:objecttoresource」を追加しました。RESTful APIのリソースと同形式の配列を返します。
- ファンクションタグ「mt:objecttojson」が返す JSONのフォーマットをRESTful APIのリソースと同形式となるようになりました。環境変数「objecttojson\_compat」を指定すると従来のフォーマットで返却します。
- ファンクションタグ「mt:archivetitle」が日付アーカイブ以外のときも現在のアーカイブのタイトルを出力するようにしました。
- ファンクションタグ「mt:archivedescription」「mt:archivogimage」を追加しました。現在のアーカイブの概要と「og:image」を追加します。
- 環境変数「tag\_delimiter」を追加しました。ビューの作成に PHPのテンプレートエンジン「Smarty」「Twig」「Mustache」ライクな記述方法を利用できるようにします。初期値は nullです。
- ファンクションタグ「mt:fetch」に「to\_encoding」「method」「content\_type」「access\_token」「headers」「content」属性を指定可能にしました。
- 「pt\-recommend\-api\.php」にパラメタ mt\(MachineTranslatorを利用して翻訳するフィールドのカンマ区切り\)、lang\(MachineTranslatorを利用して翻訳する言語\)を指定可能になりました。langパラメタがない時もクッキーがセットされている場合は翻訳を行います。
- スコープの設定に「リンクを併記」を指定できるようになりました。リンクURLを別に指定している時、管理画面でサイトURLとリンクURLへのリンクを両方表示します。
- ファンクションタグ「mt:constant」を追加しました。name属性に PHPの定数を渡すことで値を取得します。
- テーマの「\.htaccess」のパス指定をファンクションタグ「mt:constant」を使うことにより Windowsプラットフォームにも対応しました。
- ログの一覧で、エラー及びセキュリティ関連の行に色を付けるようにしました。
- スマートフォンなど画面幅の狭い状態でも一覧画面のヘッダを表示するようにしてカラムをキーにした表示順の変更をできるようにしました。
- プラグイン「Minifier」でスコープごとのプラグイン設定でパブリッシュ時に自動で行う圧縮対象を設定できるようになりました。
- プラグイン「Minifier」で HTMLのコード圧縮に利用するライブラリを Smartyのフィルタから TinyHtmlMinifierに変更しました。
- プラグイン「LinkChecker」のリンクチェックを別ウィンドウで開くようにし、進捗をリアルタイムに都度表示するようにしました。
- プラグイン「LinkChecker」の外部リンクチェックを並列処理によって高速化しました。並列数は環境変数「linkchecker\_parallel」で指定し、初期値は15です。
- プラグイン「LinkChecker」に環境変数「linkchecker\_worker\_async」を追加しました。スケジュールタスクでのリンクチェックを worker\.php とは別プロセスで行います。初期値は trueです。
- プラグイン「LinkChecker」に環境変数「linkchecker\_max\_exec\_time」を追加しました。リンクチェックの最大実行時間を秒で指定します。初期値は 36000\(10時間\)です。
- プラグイン「LinkChecker」で「User\-Agent」によってエラーを返すページへの対策用に、HTTPヘッダを追加しました。
- プラグイン「Mirroring」の「現在の設定を確認する」をモーダルダイアログに変更し、テキストエリアに表示するようにしました。
- 環境変数「fileuploader\_backup」を追加しました。プラグイン「FileUploader」でアップロードされたファイルを supportディレクトリ配下にバックアップします。
- スケジュールされたタスクで残りメモリが不足している時や実行時間が一定時間より長い時に以降のタスクをスキップして処理を次回以降に回すようにしました。
- Websiteテーマでウィジェットのイメージの URLをルート相対パスとし、リンクURL設定のあるとき、og:urlと og:imageの URLを置換するように変更しました。
- ブロックタグ「mt:convert2linkurl」およびグローバルモディファイア「convert2linkurl」を追加しました。サイトURLをリンクURLに置換します。
- グローバルモディファイア「add\_mtime」を追加しました。URLのパラメタにファイルのタイムスタンプを追加します。
- グローバルモディファイア「date\_modify」を追加しました。タイムスタンプを変更します。
- PHPの「max\_execution\_time」を「600」としました。特定の処理\(スケジュールタスクやインポートなど\)では環境変数「max\_exec\_time」の指定値に延長されます。処理機は 9000です。
- 環境変数「work\_dir」を追加しました。スケジュールタスクが利用する一時ディレクトリを指定します。初期値は「/tmp」です。
- アップグレード処理でフィールドのカラム「value」の値を現在のバージョンでの保存時の値と同一にセットする処理を追加しました。
- Websiteテーマの「prism\.css」のコードのコントラスト比を改善しました。
- モデルの「UUID」にチェックを入れてモデルを保存した時にオブジェクトの UUIDを自動でチェックするようにしました。
- CSVからオブジェクトを新規インポートした時に uuidカラムの値を振り直すようにしました。
- スキーマ管理画面のアップグレード処理時に JSONのデコードに失敗した時エラーを表示して処理を継続しないようにしました。
- 環境変数「import\_detach\_binary」を追加しました。指定することで CSVからのインポートでバイナリ型のカラムを空にセットすることでファイルを削除します。
- モデル定義の JSONファイルがデコードできなかった時に処理をストップしてエラーを返すようにしました。
- 1対1のリレーションでアセットモデルを定義している時、CSVのインポート&エクスポートに対応しました。
- アセット編集画面のアセットの利用状況に数値型 1対1のリレーションカラムで関連付けられているオブジェクトが表示されていなかった問題を修正しました。
- 添付ファイルの編集画面に添付ファイルが利用されているオブジェクト名とリンクを追加しました。
- objectpath タグで basenameのないモデルではプライマリカラムの値を separatorで繋げて出すようにしました。
- 削除したカラムが一覧画面の画面オプションに設定されている時、一覧画面で PADOBaseModelException: unknown column エラーが出る問題を修正しました。
- 一部のブラウザ向けに公開日・非公開日入力欄の高さを調整しました。
- 「cache\_driver」が「File」の時、worker\.php 実行時に「PHP Notice:  Trying to get property '\_driver' of non-object in」エラーが出る問題を修正しました。
- オブジェクトの新規作成ボタンの「\+」アイコンを常に出すようにしました。
- ビューの編集画面に「mt:includeblock」で指定したモジュールのリンクが出ない問題を修正しました。
- インストールされる前に管理画面へアクセスした時とスケジュールタスクが実行された時に一部のテーブルが作成される問題を修正しました。
- プラグイン「SimplifiedJapanese」の「furigana」モディファイアでわかち書きを指定している時、「&amp;」などの文字列が分解されてしまう問題を修正しました。
- プラグイン「Keywords」のブロックタグ「mt:autokeywords」で、環境変数「keywords\_use\_mecab」指定のある時、キーワードが拾えない問題を修正しました。
- プラグイン「Keywords」のブロックタグ「mt:autokeywords」で、キーワードモデル以外のモデルを利用できるようになりました。
- プラグイン「Keywords」のブロックタグに指定できる属性が増えました。詳細はプラグイン「Keywords」のドキュメントを参照ください。
- 環境変数「keywords\_use\_mecab」を指定している時、プラグイン「keywords」のブロックタグ「mt:autokeyrowds」タグ内で連続した英単語の間の空白が消える問題を修正しました。
- グローバルモディファイア「assign」を追加しました。「setvar」モディファイアのエイリアスです。
- テンプレート・タグを有効化しているモデル数、カラム数が多い時、コンパイルキャッシュが生成されていない時に一覧画面・編集画面のコンパイルに時間がかかる問題を修正しました。
- コンパイルキャッシュをクリアした時に、一覧、編集、ダッシュボード、階層の管理画面テンプレートを再コンパイルして次回アクセス時の管理画面レスポンスを改善しました。
- アセットのパス、ファイル名を変更した時、エディタへのファイル挿入時に古いパスが選択されるケースを修正しました。
- フィールドが可変長もしくは複数の値を持つ時に値が最初のコントロールの値になってしまう問題を修正しました。
- 画像、アセット型のフィールドのスタイルを調整しました。
- 可変長フィールドのスタイルを調整しました。
- オブジェクトが保存された時にキャッシュがクリアされる前に再構築トリガーやコンテナの再構築が実行される問題を修正しました。
- 環境変数「query\_cache」が trueの時、「mt:mixedobjects」タグが正しい結果を返さない問題を修正しました。
- ログイン中のユーザーのプロフィール編集画面のページタイトルを「ユーザーの編集」から「プロフィールの編集」に変更しました。
- ファンクションタグ「mt:vardump」で変数名に大文字を含む時に値が取得できない問題を修正しました。
- システムの一覧表示権限がない時、プラグイン「AccessAnalytics」のすべてのページビュー、すべての検索ワードが閲覧できないケースを修正しました。
- 日付に関するテンプレート・タグが属性「format\_name」をサポートしました。「rfc822」「iso8601」「RSS」「ATOM」「W3C」などを渡すことができます。
- リバースプロキシを利用している時、外部プレビューのポスト先 URLが公開 URLにならないケースを修正しました。
- モデル「question」のカラム名、グローバルモディファイア「normarize」を「normalize」に修正しました。グローバルモディファイア「normarize」は互換性のために残っています。
- プラグインひな形のコールバック「post\_import」を選択しても保存されない問題を修正しました。
- 環境変数「clean\_up\_published\_url」を追加しました。削除フラグのない URLをスケジュールタスクで整理対象にします。初期値は falseです。
- チェックボックス、ラジオボタン型のフィールドの値が保存されない問題を修正しました。
- 選択できるフィールドが存在しない時、フィールド選択のドロップダウンメニューを非表示にしました。
- PHP設定の「memory\_limit」が「\-1」の時タスクがスキップされる問題を修正しました。
- 静的生成の時「mt:include」タグの「file属性」からサイト URL配下のファイルを取得できない問題を修正しました。
- ファンクション・タグ「mt:extends」を追加しました。インクルードしたビューを親テンプレートとして継承します。
- 「PTMembers」クラスの runメソッドで、return\_argsパラメタをセットするようにしました。
- プラグイン「TinyMCE」のボタンの初期値にフルスクリーンボタンを追加しました。
- 数値型 1対1 のリレーションカラムの設定を変更した際に disp\_edit カラム rel\_model カラムが更新されない問題を修正しました。
- プラグイン「AppProperties」で「fix\_email\_from」でメールアドレスを設定すると値がtrueになってしまう問題を修正しました。
- プラグイン「ExternalPreview」で環境変数「external\_preview\_cookie\_expires」に大きな値を指定している時、異なるモデルの外部プレビューがステータス 404になる問題を修正しました。
- プラグイン「ExclusionControl」でスペースの排他制御が効かない問題を修正しました。
- 「pt\-check\.php」のチェックで拡張モジュール「mbstring」のチェックを追加しました。
- objectloopタグでソート順に field:フィールド名、あわせて limitを指定した時に意図したオブジェクトが取得できない問題を修正しました。
- プラグイン「DisplayOptions」で、新規に画面オプションを作成した後の画面に「この画面を保存するまで設定は有効化されません。」メッセージを追加しました。
- プラグイン「HTMLImporter」のタイトルのラジオボタン選択で Hintが切り替わらない問題を修正しました。
- 環境変数「system\_info\_url」が nullの時、pt\-check\.phpで外部通信を試さないようにしました。
- 環境変数「pt\_check\_url」を追加しました。pt\-check\.phpの URLを指定します。
- プラグイン「PluginStarter」でバリデーションエラーになった時、一部コールバックの設定済の値が引き継がれない問題を修正しました。
- プラグイン「PluginStarter」で「pre\_preview」「post\_preview」コールバックをエクスポートした時にメソッドが PHPファイルに追加されない問題を修正しました。
- リッチテキストエディタの全画面モードにしている時、ファイル選択・アップロードのダイアログがエディタの背面に隠れる問題を修正しました。
- オブジェクトの編集画面におけるクロスサイト・スクリプティングの脆弱性を修正しました。
- テーマの jsファイル、cssファイルから sourceMappingURLを削除しました。
- プラグイン「LivePreview」に同梱している「CMSのドメインとウェブサイトのドメインが異なる時に利用する HTML のサンプルファイル」が期待した動作とならない問題を修正しました。
- アセットと添付ファイルのパーマリンクがサムネイルの URLになるケースを修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグにリレーションのカラムのフィルタを指定している時ライブプレビューによるフィルタが効かない問題を修正しました。
- プラグイン「ImageWebP」で変換した画像が外部プレビューで表示されない問題を修正しました。
- プラグイン「SyteSync」のルートディレクトリが「https:/」になるケースを修正しました。
- メールマガジンの編集画面でメルマガ購読者を選択する画面での全件数が正しくない件を修正しました。
- 再構築画面で main要素が重複していた問題を修正しました。
- プラグイン有効化時に「locale」ディレクトリが存在しないと「upgrade\_functions」が走らない問題を修正しました。
- PADOの countメソッドで limitが効かない問題を修正しました。
- すべてを再構築ボタンの前処理の速度を向上しました。
- スケジュールタスクで「URLの再パブリッシュ」が毎回ログに残るケースを修正しました。
- スケジュールタスクの「テーブルの最適化」でSQLエラーが出るケースを修正しました。
- プレビュー・外部プレビュー・非公開コンテンツではプラグイン「AccessAnalytics」のアクティビティを保存しないようにしました。
- 添付ファイルが存在しなかった時 non\-object エラーが出る問題を修正しました。
- インポート時に workspace\_id が 0になる問題を修正を修正しました。
- 外部プレビューを有効化している画面で JavaScriptエラーが出る問題を修正しました。
- コンパイルキャッシュが生成されていない時、パーマリンクのあるモデルの一覧や編集画面の表示に時間がかかる問題を修正しました。
- 一度に多くのプラグインを有効化・無効化・アップグレードするとレスポンスに時間がかかる問題を修正しました。
- プラグイン「MTMLReference」が生成するタグリファレンスにタグを提供する PHPクラス名と追加されたタグのバージョンを表示するようにしました。
- リレーションの設定のないモデルを一覧画面から全件選択してオブジェクトを一括削除する時に削除に失敗する問題を修正しました。
- idが nullのオブジェクトをクラス Prototypeの remove\_objectメソッドに渡すと全件が削除される問題を修正しました。
- 予約モデル名に「archive」を追加しました。

version 2\.587

- プラグイン「SearchEstraier」の表記揺れの吸収の対象について、タイトル、本文に加え、メタデータを対象にするようにしました。
- PTPluginクラスにメソッド「set\_cache」「get\_cache」「flush\_cache」を追加しました。
- オブジェクトの新規作成画面でプラグインのメソッド「edit\_mime\_type」が値を返さないケースを修正しました。
- テキストフォーマットを選択できるモデルのオブジェクト保存時に Markdownを処理してからプラグイン「Keywords」での自動概要生成を行うようにしました。
- プラグイン「SearchEstraier」のインデックス生成を非同期で行っており、動的ページのインデックスを生成する設定の時、ダイナミック・タグが初期化されない問題を修正しました。
- プラグインを有効化した時に「locale」配下のCSVファイルのフレーズが登録されない問題を修正しました。
- プラグイン「Members」のログイン画面でログインに失敗した時、スコープが引き継がれない問題を修正しました。
- プラグイン「Members」のログイン画面でログインに失敗した時、「return\_url」パラメタが引き継がれない問題を修正しました。
- プラグイン「SimplifiedJapanese」で HTMLエンティティが分かち書きされる問題を修正しました。
- 「tools/upgrader\.php」を追加しました。引数 \-\-models\(モデル名のカンマ区切り\)指定でコマンドラインからモデルのアップグレードを行うことができます。
- プラグイン「SimplifiedJapanese」のやさしい日本語エディタで「やさしい日本語にする」ボタンクリック後に表示される2つめの見出し「やさしい日本語」を「言い換えの提案」に変更しました。
- リッチテキスト型のフィールドをドロップダウンで選択してオブジェクト作成・編集画面に追加した時、リッチテキストエリアの値が消えて編集できなくなる問題を修正しました。
- 画面オプションでフィールドのソート順を変更した時、リッチテキストエリアの値が消えて編集できなくなる問題を修正しました。
- プラグイン「LinkChecker」のリンクチェックでエラーが補足できないケースを修正しました。
- フォームに「プライマリ」指定した設問がない時、コンタクトのエクスポートでその項目が CSVに含まれない問題を修正しました。
- プラグイン「Keywords」の要約の自動生成対象から「ol」「ul」「dt」「table」「blockquote」要素を除外しました。
- プラグイン「Keywords」の要約の自動生成時に削除対象や処理対象の要素の 2つ目以降の要素が正しく処理されない問題を修正しました。
- プラグイン「Keywords」の要約生成時に文章の出現順が考慮されていなかった問題を修正しました。
- 「urlinfo」オブジェクトを SELECTする時に「Incorrect DATETIME value: ''」エラーが出るケースを修正しました。
- 「mt:include」タグでインクルードしたビューの中のダイナミック・タグが正しく処理されない問題を修正しました。
- 遅延再構築時にダイナミック・タグが正しく処理されないケースを修正しました。
- 環境変数「republish\_datebased」を追加しました。trueを指定するとオブジェクトの更新日に日付ベースアーカイブをすべて再構築し直します。
- アセットの保存時のメタデータ「basename」に拡張子付きのファイル名が保存される問題を修正しました。
- ベースネームの重複を許可しているモデルの新規作成時に、URLマッピングで利用しているタグによってはダイナミック・タグが初期化されない問題を修正しました。
- スケジュールタスク「clean\_up\_duplicate\_urls」実行時に意図せず URL オブジェクトが全件物理削除される問題への対応を行いました。
- iframe が存在する HTML の場合にプラグイン「HTML\_CodeSniffer」でレポートが見られない問題を修正しました。
- アセットの一覧で、検索結果の画面からドラッグ&ドロップでアセットをアップロードした時に「414 Request\-URI Too Large」エラーが出るケースを修正しました。
- 環境変数「mail\_language」に「uni」を指定している時、添付ファイル付きメールが適切に送信できない問題を修正しました。
- 環境変数「mail\_encording」は「mail\_encoding」に修正されました。
- アセットの一覧をダイアログで開いた状態でファイルアップロードした後の一覧画面に、検索やフィルタなどの状態を維持しないようにしました。
- プラグイン「FileUploader」で、ファイルの一覧画面で画像が表示された以降、画像以外のアイコンが正しく表示されない問題を修正しました。
- プラグイン「FileUploader」で画像をアップロードした時、ファイルアップロード後の一時ディレクリが残る問題を修正しました。
- オブジェクトに対する作成権限がない時オブジェクトの編集画面から添付ファイルがアップロードできない問題を修正しました。
- スペースの「モデル」ダッシュボードで作成権限のないユーザーに「作成」ボタンが表示される問題を修正しました。
- PHP8環境で特定の文字列に対して「furigana」モディファイアを適用したときに処理が途中で落ちる問題を修正しました。

## 2021\-12\-17

version 2\.586

- 独自に作成したモデルの画面オプションに、単独で非表示化や並べ替えのできない「公開日」「公開終了日」が表示される問題を修正しました。
- プラグイン「UploadUtilities」で「タグ付けを可能にする」「タグの入力補助を利用する」のチェックのある時に、タグのループが出力されずに意図しないチェックボックスがアップロードダイアログに表示される問題を修正しました。
- 「mt:estraiersearch」タグのドキュメントで一部の属性のドキュメントが翻訳されていないのを修正しました。
- プラグイン「SearchEstraier」のスケジュールタスクでのインデックス洗い替えの時、大きなページのインデックスが途中で切れる問題を修正しました。
- モデル「Keyword」に代替フレーズカラムを追加し、プラグイン「SearchEstraier」の検索でキーワードの表記揺れの吸収に利用できるようになりました。
- 代替テンプレートでパスの長いものが優先されなくなるケースを修正しました。
- プラグイン「LivePreview」の設定が有効の時、設定日時が当該オブジェクトの非公開設定日時を超えている時 404エラーになるようにしました。
- プラグイン「LivePreview」の設定が有効の時、承認待ち、公開予約、公開以外のステータスのオブジェクトのページを 404エラーになるようにしました。
- プラグイン「LivePreview」の設定が有効の時、承認待ち、公開予約のステータスのオブジェクトで公開日が設定日時以前のオブジェクトのページを 404エラーになるようにしました。
- プラグイン「LivePreview」で時限公開・非公開・差し替え設定日時と設定日時が秒単位で一致する時、変更を適用後の状態を再現するようにしました。
- スケジュールタスクにモデル「urlinfo」の不整合を修復する「URLの修復」処理を追加しました。
- プラグイン「PluginStarter」で「pre\_listing」コールバックをエクスポートした時のメソッドに第6引数「$placeholders」を追加しました。
- プラグイン「PluginStarter」でグローバルモディファイアのタグリファレンスが正しい形でエクスポートされない問題を修正しました。
- 一覧からアクションを実行した時に再構築トリガーが走る時、ダイナミック・タグが初期化されない問題を修正しました。
- アセットの更新で「作成者」が操作したユーザーに変わってしまう問題を修正しました。
- プラグイン「MTMLReference」のタグリファレンスの画面幅を狭くした時、見出しと検索フォームが重なる問題を修正しました。
- ステータスが下書きのオブジェクトをインポートするとデフォルトのステータスとして登録される問題を修正しました。
- 日付アーカイブで「オブジェクトがない時アーカイブを出力しない」設定の時、既に出力済みのアーカイブにオブジェクトがない時もファイルが残る問題を修正しました。
- サーバーの PHPのバージョンや設定によってビューの保存時にコンパイルチェックのエラーを正しく拾えない問題を修正しました。
- ダイナミック・パブリッシングで 404エラーになった時に変数「theme\_static」が空になりスタイルが崩れる問題を修正しました。
- プラグイン「EmailMagazine」で配信対象のモデルのコンテキストがスコープを考慮していない問題を修正しました。
- プラグイン「SearchEstraier」のプラグイン設定で、非公開オブジェクトしか存在しないモデルがアーカイブ種別の選択欄に表示されない問題を修正しました。
- プラグイン「MTMLReference」のオブジェクトのループタグの「ignore\_archive\_context」属性値の説明を追加しました。
- 「user\_id」カラムを持たないモデルのオブジェクトを管理者以外が削除できない問題を修正しました。
- ダイアログ型のリレーション選択ダイアログで検索やソート順の変更をした時に「権限がありません」メッセージが出てダッシュボードに遷移してしまう問題を修正しました。
- 数値型のカラムでリレーションを設定する時「任意」を選択できないようにしました。
- リレーション型のカラムをラジオボタンに設定している時、バリデーションでエラーになった時に値が引き継がれない問題を修正しました。

## 2021\-11\-08

version 2\.585

- プラグインを無効化できない問題を修正しました。
- 一度に多くのプラグインを有効化・無効化・アップグレードするとレスポンスに時間がかかる問題を修正しました。
- プラグイン「AppProperties」で「fix\_email\_from」でメールアドレスを設定すると値がtrueになってしまう問題を修正しました。
- プラグイン「ExternalPreview」で環境変数「external\_preview\_cookie\_expires」に大きな値を指定している時、異なるモデルの外部プレビューがステータス 404になる問題を修正しました。
- プラグイン「PluginStarter」でバリデーションエラーになった時、一部コールバックの設定済の値が引き継がれない問題を修正しました。
- プラグイン「PluginStarter」で「pre\_preview」「post\_preview」コールバックをエクスポートした時にメソッドが PHPファイルに追加されない問題を修正しました。
- リッチテキストエディタの全画面モードにしている時、ファイル選択・アップロードのダイアログがエディタの背面に隠れる問題を修正しました。
- オブジェクトの編集画面におけるクロスサイト・スクリプティングの脆弱性を修正しました。
- 「pt\-check\.php」のチェックで拡張モジュール「mbstring」のチェックを追加しました。
- 環境変数「system\_info\_url」が nullの時、pt\-check\.phpで外部通信を試さないようにしました。
- 環境変数「pt\_check\_url」を追加しました。pt\-check\.phpの URLを指定します。
- 再構築画面でmain要素が重複していた問題を修正しました。
- プラグイン有効化時に「locale」ディレクトリが存在しないと「upgrade\_functions」が走らない問題を修正しました。
- プラグイン「HTMLImporter」のタイトルのラジオボタンのチェックでヘルプのテキストが切り替わらない問題を修正しました。
- PADOの countメソッドで limitが効かない問題を修正しました。
- すべてを再構築ボタンの前処理の速度を向上しました。
- プラグイン「PluginStarter」で「pre\_preview」「post\_preview」コールバックをエクスポートした時にメソッドが PHPファイルにエクスポートされない問題を修正しました。
- AppPropertiesの「fix\_email\_from」でメールアドレスを設定すると値：trueになってしまう問題を修正しました。
- スケジュールタスクで「URLの再パブリッシュ」が毎回ログに残るケースを修正しました。
- スケジュールタスクの「テーブルの最適化」でSQLエラーが出るケースを修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグでソート順に field:フィールド名、あわせてlimitを指定した時に意図したオブジェクトが取得できない問題を修正しました。
- プラグイン「ExclusionControl」でスペースの排他制御が効かない問題を修正しました。
- プレビュー・外部プレビュー・非公開コンテンツではプラグイン「AccessAnalytics」のアクティビティを保存しないようにしました。
- PTMembersクラスの runメソッドで、return\_argsパラメタをセットするようにしました。
- グローバルモディファイア「normarize」を「normalize」に修正しました。「normarize」は後方互換のために残っています。
- システムの一覧表示権限がない時に、プラグイン「AccessAnalytics」のすべてのページビュー、すべての検索ワードが閲覧できないケースを修正しました。
- 添付ファイルが存在しなかった時 non\-object エラーが出る問題を修正しました。
- インポート時に workspace\_id が 0になる問題を修正を修正しました。
- アプリケーションを設置済みで管理画面からインストールを行っていない状態で、スケジュールタスクを実行するといくつかのテーブルが生成されてしまう問題を修正しました。
- 外部プレビューを有効化している画面で JavaScriptエラーが出る問題を修正しました。
- プラグイン「SimplifiedJapanese」の「furigana」モディファイアで分かち書きを指定している時「&amp;」などの文字列が分解されてしまう問題を修正しました。
- ビューの編集画面に「mt:includeblock」で指定したモジュールのリンクが出ない問題を修正しました。
- プラグイン「LivePreview」に同梱している「CMSのドメインとウェブサイトのドメインが異なる時に利用する HTML のサンプルファイル」が期待した動作とならない問題を修正しました。
- アセットと添付ファイルのパーマリンクがサムネイルの URLになるケースを修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグにリレーションのカラムのフィルタを指定している時ライブプレビューによるフィルタが効かない問題を修正しました。
- プラグイン「ImageWebP」で変換した画像が外部プレビューで表示されない問題を修正しました。
- アセットのパス、ファイル名を変更した時、エディタへのファイル挿入時に古いパスが選択されるケースを修正しました。
- フィールドが可変長もしくは複数の値を持つ時に値が最初のコントロールの値になってしまう問題を修正しました。
- 画像、アセット型のフィールドのスタイルを調整しました。
- 可変長フィールドのスタイルを調整しました。
- 環境変数「query\_cache」が trueの時、「mt:mixedobjects」タグが正しい結果を返さない問題を修正しました。
- ファンクションタグ「mt:vardump」で変数名に大文字を含む時に値が取得できない問題を修正しました。
- コンパイルキャッシュが生成されていない時、パーマリンクのあるモデルの一覧や編集画面の表示に時間がかかる問題を修正しました。
- プラグインひな形のコールバック「post\_import」を選択しても保存されない問題を修正しました。
- 環境変数「clean\_up\_published\_url」を追加しました。削除フラグのない URLをスケジュールタスクで整理対象にします。初期値は falseです。
- チェックボックス、ラジオボタン型のフィールドの値が保存されない問題を修正しました。
- 選択できるフィールドが存在しない時、フィールド選択のドロップダウンメニューを非表示にしました。
- PHP設定の「memory\_limit」が「\-1」の時タスクがスキップされる問題を修正しました。
- 静的生成の時「mt:include」タグの「file属性」からサイト URL配下のファイルを取得できない問題を修正しました。
- 環境変数「keywords\_use\_mecab」を指定している時、プラグイン「keywords」のブロックタグ「mt:autokeyrowds」タグ内で連続した英単語の間の空白が消える問題を修正しました。
- 数値型 1対1 のリレーションカラムの設定を変更した際に disp\_edit カラム rel\_model カラムが更新されない問題を修正しました。
- プラグイン「AppProperties」で「fix\_email\_from」でメールアドレスを設定すると値がtrueになってしまう問題を修正しました。
- プラグイン「SyteSync」のルートディレクトリが「https:/」になるケースを修正しました。
- メールマガジンの編集画面でメルマガ購読者を選択する画面での全件数が正しくない件を修正しました。
- プラグイン「MTMLReference」が生成するタグリファレンスにタグを提供する PHPクラス名と追加されたタグのバージョンを表示するようにしました。
- idが nullのオブジェクトをクラス Prototypeの remove\_objectメソッドに渡すと全件が削除される問題を修正しました。
- プラグイン「Keywords」のブロックタグ「mt:autokeywords」で、title属性値に urlカラムの値がセットされてしまう問題を修正しました。
- リッチテキスト型のフィールドをドロップダウンで選択してオブジェクト作成・編集画面に追加した時、テキストエリアのままでリッチテキストにならない問題を修正しました。
- フィールドをドロップダウンで選択してオブジェクト作成・編集画面に追加した時、フィールドが画面オプションの表示順の位置に配置されない問題を修正しました。

## 2021\-09\-01

version 2\.583

- ワークフローの設定があり、一度のスケジュールタスクで複数のスコープのオブジェクトの時限公開・差し替え実行時にスコープが移動してしまう不具合を修正しました。
- 時限公開・差し替え実行時にログが適切なスコープに保存されない問題を修正しました。
- コンパイルキャッシュが生成されていない時にビューの編集画面を開いた時に画面が白くなる問題を修正しました。
- オブジェクトの保存時にカラムに対するバリデーションが効いていなかった問題を修正しました。
- 環境変数「fmgr\_delayed」が有効な時にファイル操作によるエラーが発生した場合、エラーメッセージを PHP エラーログに残すようにしました。
- 日付アーカイブで「オブジェクトがない時アーカイブを出力しない」設定の時、既に出力済みのアーカイブにオブジェクトがない時もファイルが残る問題を修正しました。
- プラグイン「AccessAnalytics」の「mt:rankedobjects」タグでアクティビティの数値と URLが正しく取得できないケースを修正しました。
- リレーションでの関連オブジェクトをループ出力するタグがプレビューで空になるケースを修正しました。
- プラグイン「ExternalPreview」に環境変数「externalpreview\_cookie\_domain」を追加しました。ワイルドカードドメインなどを指定できるようになりました。
- 「mt:entries」などのオブジェクトをループするブロックタグのフィールドの値による絞り込みで、条件にマッチするオブジェクトが存在しない場合に絞り込みが行われず全件が表示される問題を修正しました。環境変数「search\_by\_field\_compat」に trueを指定すると修正前の挙動となります。初期値は falseです。
- ログイン処理の直前に「post\_load\_object」コールバックを追加しました。
- MySQLの max\_allowed\_packetを超えるファイルアップロード時にエラーを表示させるようにしました。
- プラグイン「UploadUtilities」で ZIPファイルを展開する設定でアップロードした時に、アップロードした ZIPファイルの URLオブジェクトが残る問題を修正しました。
- ファイル出力が「キュー」の URLマップについて、ファイル削除のタイミングを定期実行タスク実行時に変更しました。
- モデルのカラム詳細で数値・リレーション・添付ファイルを選択した時に拡張子欄が表示されない問題を修正しました。
- プラグインの管理画面でアップグレード実行時に無効なプラグインを選択していると有効化される問題を修正しました。
- 数値型、添付ファイル型のカラムの拡張子設定がアップグレード時に「attachmentfile」に変更されてしまう問題を修正しました。
- リレーション型の「添付ファイル」カラムでファイルの拡張子指定ができない問題を修正しました。
- ダッシュボードおよび「pt\-check\.php」で設定ファイル「config\.json」への HTTPアクセスが可能な場合にエラーを出すようにしました。
- ビューの保存時にプレビュー状態になってしまうケースを修正しました。
- オブジェクトのリビジョン一覧を別ウインドウで開いた時に、見出しのリンクをリビジョン一覧へのリンクとなるようにしました。
- プラグイン「SearchEstraier」で文書ドラフト生成時に一部のコンテキストにセットした変数\(例:workspace\_id\)が未定義になる問題を修正しました。
- 未保存のオブジェクトをプレビューした時、意図した MIMEタイプがセットされないケースを修正しました。
- グローバルモディファイア「furigana」で分かち書きした時に英単語間のスペースが削除される問題を修正しました。
- プラグイン「SearchEstraier」でインデックスの洗い替えに失敗する問題を修正しました。
- プラグイン「SearchEstraier」のスケジュールタスクの実行間隔を 20分から 1日に変更しました。タスク実行間隔は環境変数「searchestraier\_update\_idx\_frequency」で調整できます\(単位:秒\)。
- プラグイン「SearchEstraier」のスケジュールタスク用の環境変数「searchestraier\_task\_proc」\(初期値 0\)「searchestraier\_task\_proc\_per」\(初期値 10\) を追加しました。インデックスの洗い替えを並列処理して高速化を図ります。この設定は Windows環境ではサポートされません。
- 日付と時刻フィールドの時刻が空の時に「00:00」をセットするようにしました。
- オブジェクトのフィールドの値のみを変更した時にリビジョンが生成されない問題を修正しました。
- ワークフロー通知設定あり、予約差し替え実行時、複数のスペースのオブジェクトの差し替えを行うと一部のスペースのオブジェクトが別のスペースに移動してしまう問題を修正しました。
- アセットのファイル名を「\.」から始まる文字列に指定したときにファイル名が「\.」になるケースを修正しました。
- アセットのファイル名を修正して保存したときに拡張子が変更されないようにしました。
- 環境変数「can\_upload\_hidden」を指定しているとき、アセットの保存時にファイルのリネームに対するチェックを厳密にしました。
- リッチテキストが複数存在する時、画面オプションダイアログでカラムを並び替えるとリッチテキストに入力ができなくなる問題を修正しました。
- リッチテキスト複数フィールドを並び替えるとリッチテキストが空になる問題を修正しました。
- 数値型カラムに編集タイプリレーションを設定し、NOT NULL指定をしている時必須チェックをすり抜ける問題を修正しました。
- フォームの設問にプライマリ指定の設問がない時、投稿されたコンタクトの CSVエクスポート時に「件名」に格納されたデータが出力されない問題を修正しました。
- フォームの添付ファイル保存時に、デフォルトのステータスに関わらずステータスを「レビュー」にするようにしました。
- 「value」というカラムのあるモデルの投稿時にフィールドの値とバッティングして保存時にフィールドの値が優先される問題を修正しました。
- NOT NULL指定があって、default が「0」のカラムに値がない時、オブジェクトの保存時に必須エラーとなる問題を修正しました。

## 2021\-07\-26

version 2\.582

- 環境変数「comp\_url\_md5」が trueの時、スケジュールされたタスクでファイルの md5値を調べてオブジェクトのカラム値が異なる時値を再セットするようにしました。
- developがオフの時、オブジェクトのカラムごとの代替テンプレートのパスをキャッシュするようにしました。アプリケーション・キャッシュのクリアでキャッシュはクリアされます。
- ファンクションタグ「mt:unsetvar」を追加しました。指定したテンプレート変数の値を unsetします。
- プラグイン「AccessAnalytics」で、アクティビティと検索ワードのグラフおよびランキングを 1ページ目のみに表示するようにしました。
- tools/restoreMenu\.php を追加しました。URLを物理削除後に再構築を行った後、メニューをリストアできます。
- 環境変数「sync\_dirs」を追加しました。同期元と同期先のディレクトリをセットでハッシュで指定します。スケジュールされたタスクの実行時および、システムの設定を保存したタイミングで差分があれば同期を行います。alt\-tmplなどを永続化された低速なディスクから高速なディスクへ同期するなどの用途に利用できます。
- ブロックタグ「mt:setvartemplate」を利用しているビューのビルドでコンパイルキャッシュが利用できない問題を修正しました。
- プラグイン「UploadUtilities」で ZIPファイルを展開する設定でアップロードした時に、アップロードした ZIPファイルがサーバーに残る問題を修正しました。
- 環境変数「cache\_driver」に「APCu」を指定している時、コンパイルキャッシュはファイルキャッシュになるようにしました。
- Prototypeクラスと PTPublisherクラスが同じコンパイルキャッシュを使っていない問題を修正しました。
- Prototypeクラスが index\.php以外から呼び出された時、idを「Custom」となるように仕様を変更しました。
- スペース管理者またはスペースのプラグインに対する権限があるユーザーがプラグインの README\.mdを閲覧しようとした時に権限エラーになる問題を修正しました。
- PTUtilクラスの file\_find メソッドの第3引数にディレクトリの配列が正しくセットされない問題を修正しました。
- PTUtilクラスの file\_find メソッドの戻り値に「\.\.」やディレクトリの末尾の「\.」を含めないようにしました。
- 関数「pt\_file\_put\_contents」「pt\_file\_get\_contents」「pt\_rename」「pt\_unlink」を追加しました。ファイル操作を PTFileMgr クラスを通して行います。
- PTFileMgr クラスにメソッド「test」を追加しました。
- プラグイン「LivePreview」で画像のサムネイルのライブプレビューに対応しました。
- プラグイン「LivePreview」で別ドメインの管理画面に設定ページURLを指定しているとき、ログインを引き継げるようになりました。
- プラグイン「LivePreview」で plugins/LivePreview/static/以下の静的ページを設定ページURLに指定しているとき、ログインクッキーが保存されずライブプレビューができない問題を修正しました。
- cache\_driverに「APCu」を指定している時、スケジュールタスクでクリアしたクエリキャッシュが管理画面では残る問題を修正しました。
- 環境変数「requires」を追加しました。配列で PHPファイルのパスをすると初期化直後にそれらのファイルを require\_once します。
- モデル「ts\_job」にカラム「status」を追加しました。ステータスが「2」のものが実行対象となります。
- プラグイン「DisplayOptions」でカスタムプラグインがクラス Prototype の stash を初期化した時、メニューの設定が反映されなくなる問題を修正しました。
- プラグイン「FileUploader」からアップロードされたファイルのURLに正しい workspace\_idがセットされない問題を修正しました。
- コンパイルキャッシュの有効期限の初期値\(環境変数 ctx\_cache\_ttl\)を 3600秒から 86400秒 \(24時間\) に変更しました。
- 環境変数「ctx\_cache\_ttl」に「0」を指定すると有効期限を指定なし \(永続\)となるようにしました。
- 環境変数「max\_exec\_time」「worker\_period」を 3600秒から 9000秒 \(2時間半\) に変更しました。
- アセットの編集画面の右カラムの「利用状況」でオブジェクトのラベル中の HTMLを削除するようにしました。
- コンパイルキャッシュが生成されていない時、URLマップにダイナミック・タグを指定しているオブジェクトの一覧画面、編集画面の表示速度が遅くなる問題を修正しました。
- 編集画面で呼び出された「mt:includeparts」タグでマッチしたテンプレートのパスをキャッシュするようにして、ディスクが遅い環境での管理画面表示速度を向上させるようにしました。
- プラグイン配下のテンプレートディレクトリや環境変数「tmpl\_paths」で指定したディレクトリ配下に include ディレクトリがあるかどうかをキャッシュするようにして、ディスクが遅い環境での管理画面表示速度を向上させるようにしました。
- config\.jsonのメニュー定義に "target" : "\_blank" を指定できるようになりました。
- 環境変数「livepreview\_open\_external」を追加しました。trueを」指定するとプラグイン「LivePreview」の設定画面を別ウィンドウ\(タブ\)で開くようになります。
- URLマップに日付系のダイナミック・タグを利用している時、オブジェクトの URLが未保存の時に一覧画面でエラーになる問題を修正しました。
- モデルを削除した時、そのモデルに対する他のモデルのリレーション型のカラムを削除するようにしました。
- 削除されたモデルに対する URLオブジェクトが残っている時、プラグイン「SiteMap」「SiteSync」がツリーを生成できない問題を修正しました。
- プラグイン「SimplifiedJapanese」の「furigana」モディファイアにやさしい日本語が適用される問題を修正しました。
- アップロードしたアセットの一部の文字が欠落するケースを修正しました。
- 「rebuild\_async」が有効の時、ポップアップウィンドウでの再構築で最後のモデルの再構築がスキップされるケースを修正しました。
- エラーでプラグインを有効化・無効化できなかった時に有効化・無効化ログが保存される問題を修正しました。
- PTFormクラスの validationメソッドにコールバックを追加しました。
- プラグインを無効化できない問題を修正しました。

## 2021\-06\-25

version 2\.58

- ユーザーの一覧から複数のユーザーを選択して権限を付与する機能を追加しました。
- プラグイン「DisplayOptions」でモデル「ロール」の画面オプションを作成し、「フィールドの非表示を許可」「フィールドのソートを許可」している時、ユーザーが画面オプションを保存すると名前、説明以外の項目が非表示になる問題を修正しました。
- プラグイン「DisplayOptions」でオブジェクトごとの表示オプションを保持する機能が有効にならない問題を修正しました。
- 複数フィールドがキーボードでソートできない問題を修正しました。
- フィールドをドラッグ&ドロップで表示順を入れ替えた時、保存後にその順番で表示されない問題を修正しました。
- 編集表示プライマリのカラムがない時プラグイン「ExternalPreview」が JavaScriptエラーを出す問題を修正しました。
- 環境変数「cache\_driver」に「Memcached」を指定している時、ビューのコンパイルキャッシュも Memcachedに保存するようにしました。
- 環境変数「cache\_driver」に「Memcached」を指定している時にキャッシュが適切にクリアできないケースを修正しました。
- Redisキャッシュをサポートしました。Redisキャッシュを利用するには環境変数「cache\_driver」に「Redis」を指定してください。
- APCuキャッシュをサポートしました。APCuキャッシュを利用するには環境変数「cache\_driver」に「APCu」を指定してください。
- SQLiteキャッシュをサポートしました。SQLiteキャッシュを利用するには環境変数「cache\_driver」に「SQLite」を指定してください。
- MySQLキャッシュをサポートしました。MySQLキャッシュを利用するには環境変数「cache\_driver」に「MySQL」を指定してください。
- ブロックタグ「mt:grouploop」に workspace\_id 属性を指定できるようになりました。
- マルチバイト文字を含むファイルのアップロード時に urlencodeが無効化されていた問題を修正しました。
- 編集タイプ「カラー」を指定したカラムの初期値がオブジェクトの作成画面に反映されない問題を修正しました。
- 一覧からのアクションで「extra\_path」カラムのあるモデルの「extra\_path」カラムの値が空になる問題を修正しました。
- システムスコープの一覧からのアクションでスペースのオブジェクトを更新した時、更新日がスペースのタイムゾーンを反映しない問題を修正しました。
- リレーションの単一選択ダイアログでフィルタを適用した時、ラジオボタンがチェックボックスに変わる問題を修正しました。
- 環境変数「workflow\_nextprev\_only」を追加しました。trueを指定すると前後の権限グループのユーザー以外を非表示にします。
- モデルの設定「複製」「インポート&エクスポート」「ベースネームの重複を許可」がモデルのエクスポート、JSONからのインポートに対応しました。
- プラグイン「DataMigrator」で「ページ」を選択してインポートした時にタグのクラスが「記事」になる問題を修正しました。
- プラグイン「DataMigrator」からインポートした後に一時ディレクトリが残る問題を修正しました。
- プラグイン「DataMigrator」で「記事」「ページ」の保存前に「pre\_import」コールバックをコールするようにしました。
- 「カテゴリ」「フォルダ」「タグ」をリビジョン対応している時、プラグイン「DataMigrator」で記事やページをインポートした時にリビジョンと関連づいてしまうケースを修正しました。
- 一覧画面からリビジョンを作成すると「uuid」カラムの値が変わる問題を修正しました。
- type 属性値が異なる「mt:archivelist」タグを同一のビューに複数指定すると異なるタイプのリストがキャッシュされてしまうケースを修正しました。
- 年別アーカイブで「mt:archivetitle」タグを利用するとフォーマットされずに数値が出力される問題を修正しました。
- モデル「グループ」でダイアログからオブジェクトを選択した時、画像以外の場合にサムネイルが一覧に出ない問題を修正しました。
- プラグイン「ExternalPreview」で、外部プレビュー時にテンプレート変数「\_external\_preview」をセットするようにしました。
- プラグイン「MTMLReference」で、タグリファレンスが 500エラーとなって表示されないケースを修正しました。
- URLマップの保存時に、他の URLマップやアセットなどの URLとの重複チェックを行うようにしました。
- 重複 URLの整理の時、アセットなどのファイルよりアーカイブを優先して残すようにしました。
- プラグイン「SearchEstraier」の検索結果でセットされるテンプレート変数「estcmd\_cmd」にエスケープ済の値をセットするようにしました。
- プラグイン「SearchEstraier」の検索インデックスに JavaScriptソースや CSSが含まれないようにしました。
- システムまたはスペースの設定画面でサイト・パスを変更した時、保存時に確認メッセージを出すようにしました。
- グローバルモディファイア「regex\_replace」で正規表現パターンのサニタイズを行いエラーが出力されないようにしました。
- グローバルモディファイア「encode\_html」を追加しました。escape="html" のエイリアスです。
- インストールされていない状況で「pt\-check\.php」を実行した時に 500エラーになるケースを修正しました。
- 会員制ウェブサイトでアクティビティのログにログインメンバーの情報が保存できないケースを修正しました。
- 一覧画面からオブジェクトを削除する時に意図せず削除フラグ付き URLが追加されるケースを修正しました。
- クエリキャッシュ有効のとき、プラグイン「HTMLImporter」でインポート時にカテゴリやフォルダが重複して作成される問題を修正しました。
- プラグイン「NuHtmlChecker」など一部の操作で \- Fatal error: Cannot declare class urlinfo エラーが発生する問題を修正しました。
- ファンクションタグ「mt:customfieldvalue」タグに「name」属性と「defalut」モディファイアをあわせて指定している時、JSONのキーに該当のキーがなかった時「default」モディファイアの値を出力するようにしました。
- 環境変数「remove\_field\_attr」を追加しました。プレビュー時にフィールドのフォームコントロールの name属性を削除します。初期値は falseです。
- TinyMCE 5系とやさしい日本語エディタの組み合わせでエディタの高さが保存されない問題を修正しました。
- プラグイン「SimplifiedJapanese」のやさしい日本語エディタで、Microsoft Word形式のファイルのエクスポートに対応しました。
- 環境変数「{model}\_date\_based\_col」を追加しました。この環境変数により「公開日\(published\_on\)」以外のカラムを日付ベースアーカイブに利用できるようになります。
- メニューの一覧画面にアクション「URLリストア」を追加しました。
- ブロックタグ「mt:triggersection」を追加しました。ブロックを HTMLコメントで囲み、再構築トリガーによる再構築範囲を限定します。id属性\(必須\)にユニークな値を指定、model属性\(省略可能\)に対象のモデルをカンマ区切りで指定します。
- プラグイン「DisplayOptions」でメニュータイプを「非表示」にしている時、オブジェクトの一覧画面へのアクセスをダッシュボードにリダイレクトするようにしました。
- スペースを保存後「新しいスペース」をクリックするとダッシュボードに移動する問題を修正しました。
- プラグイン「Members」が提供する「mt:iflogin」「mt:membercontext」タグに「model」属性を追加しました。「user」を指定すると会員ではなく管理画面のユーザーでログイン判定・コンテキストをセットするようになります。
- フォームのメソッド\(\_\_mode\)に「make\_magic\_token」を追加しました。確認画面を挟まないフォームで、CSRF対策用の magic\_token を JSONで返却します。
- 「mtvar」「mt:setvar」「mt:setvarblock」「mt:if」「mt:unless」「mt:elseif」タグが「op」モディファイアをサポートしました。「mt:setvartemplate」「mt:getvar」「mt:else」「mt:ifgetvar」はサポートされません。
- アセットの一覧画面から、アップロード・パス、ファイル名を置換した時にファイルを新しいパスにパブリッシュするようにしました。
- プラグイン「Feed」のブロックタグ「mt:getxml2vars」で、Array to string conversion エラーが出るケースを修正しました。
- ダイナミック・パブリッシングでページ表示の直前に「urlinfo」モデルに対する「dynamic\_view」コールバックを追加しました。
- プラグイン「CacheManager」で、プラグインが作成したサポートディレクトリ内のキャッシュをリセットできるようになりました。
- 定期実行タスクでコンパイルキャッシュのクリアのタイミングが「cache\_expires\(初期値 86400\)」となっていたのを「ctx\_cache\_ttl\(初期値 3600\)」に修正しました。
- プラグイン「SearchEstraier」のブロックタグ「mt:estraiersearch」の属性「ad\_attr」「add\_attr」「ad\_condition」「value」に配列もしくは CSVを指定した時に PHP Fatal error となる問題を修正しました。
- ダイナミック・パブリッシングの設定をしている時、ベースネーム「404\-error」のビューが存在する時、モデル「ビュー\(template\)」に対して「404\-error」コールバックが呼ばれるようにしました。
- プラグイン「AccessAnalytics」でアクティビティに「言語」カラムを追加しました。
- プラグイン「AccessAnalytics」のファンクションタグ「mt:accesstracking」に language または lang属性を指定できるようになりました。
- プラグイン「AccessAnalytics」の「pt\-accessanalytics\.php」に language または langパラメタを指定できるようになりました。
- プラグイン「TinyMCE」の「HTMLの部分編集」ボタンで開くモーダルのサイズを大きくしました。
- 記事やページのプレーンテキストエリアの装飾ボタン押下後、フォーカスをセットするようにしました。
- プラグイン「SimplifiedJapanese」の設定画面で「クライアントID」「クライアント・シークレット」欄の input要素の type属性を「password」に変更しました。
- スペースを保存したときに作成者と作成日が更新されてしまう問題を修正しました。
- esdcapeモディファイアに「mail」を指定可能になりました。「@」を「 \[ AT \] 」に「\.」を「 \[DOT\] 」に置換します。
- 「pt\-recommend\-api\.php」にパラメタ field\(取得するフィールドのカンマ区切り\)を指定可能になりました。
- 適切でないコンテキストでモデル名+カラムラベルのファンクション・タグを呼び出した時に無限ループする可能性がある問題を修正しました。
- 環境変数「comp\_url\_md5」の初期値を「false」に変更しました。falseとすることでデータベースに保存された md5値を利用せずに、実際のファイルのハッシュ値と書き出すデータのハッシュ値を比較するようになります。

## 2021\-05\-10

version 2\.571

- モデルの表示順が重複している時、再構築ポップアップに重複している一部のモデルが表示されず再構築できない問題を修正しました。
- プラグイン「AccessAnalytics」で、アクティビティの一覧から、URLを別ウィンドウで開けるようにしました。
- 環境変数「searchestraier\_use\_queue」を追加しました。プラグイン「SearchEstraier」「DocumentSearch」でコンテンツの作成・更新・削除時の検索インデックス更新をキュー経由で行います。冗長化構成の時指定してください。
- tools 以下のスクリプトの実行の時、標準出力に表示されるタイムスタンプが24時間単位になっていなかった問題を修正しました。
- フォームから管理者へ送信されるメールのアプリ名に、スペース名が適用されない問題を修正しました。
- 複数のファイルを再構築している時、初期化済みのダイナミック・タグが途中で失われるケースを修正しました。
- worker\.php でバイナリ型カラムのあるオブジェクトを予約公開した時、初期化済みのテンプレート・タグがリセットされ、結果としてその後のリビジョン差し替えや再構築の時にテンプレート・タグが正しく処理されない問題を修正しました。
- プラグイン「FixDeniedAssets」で、拡張子のないファイルをアセットに登録するとファイルの末尾に「\.」が追加される問題を修正しました。
- アップロード・パスを変更した際に「mt:assetthumbnailurl」タグが既存の URLを返さずに存在しないパスを返す問題を修正しました。
- 「PADO\_DB\_BLOB2FILE」の設定のある時、オブジェクトの保存時にバイナリカラムにアップロードした一時ファイルが削除されない問題を修正しました。
- タッチデバイスで操作している時、スペースのセレクタのツールチップが最初のスペースの表示と被る問題を修正しました。
- tools/rebuildFiles\.php に「\-\-update_before」引数を指定できるようにしました。秒を指定するとその秒以内に更新されているファイルをスキップします。
- プラグインの管理画面で無効なプラグインのスキーマアップグレードのバッジがハイライトされる問題を修正しました。
- プラグインが意図せず無効化されるケースを修正しました。
- プラグイン「SiteSync」の「本番環境」を「公開環境」に修正して統一しました。
- pt\-view\.php の処理の中でオブジェクトを saveすると $app\->workspace()が取得できなくなる問題を修正しました。
- プラグイン「DataMigrator」でタグをセットする時に「Undefined variable $normalize occured」エラーが出る問題を修正しました。
- メモリ不足でプラグインの初期化に失敗した時にプラグインが無効化されてしまう問題を修正しました。
- 「mt:date」タグに unixtime属性を指定している時に date\(\) expects parameter 2 to be int, string given エラーがログに残る問題を修正しました。
- 「mt:date」タグに relative属性を指定している時に Undefined variable: second エラーがログに残る問題を修正しました。
- 「return\_url」が大文字を含むスキーマで指定されている時、もしくは「//」で始まるURLで指定されている時にオープンリダイレクトのチェックをすり抜ける問題を修正しました。
- スケジュールされたタスクで時限公開・差し替え・非公開処理が行われた時、コンテナ指定のある別のスコープの URLマップが再構築対象になる問題を修正しました。
- 「mt:include」でインクルードしているモジュール内で 「mt:setvar」「mt:setvarblock」に append, prepend 属性を指定している時、二重に値が追加されてしまう問題を修正しました。
- 「mt:date」タグに「language」属性を指定できるようにしました。「ja」を指定すると「D」「l」を日本語表記の曜日にします。
- 「theme\.json」に、テーマインストール時に有効化するプラグインを指定できるようにしました。
- 環境変数「objectloop\_order」指定のある時、画面オプションなど管理画面のカラム一覧の順番にも効いてしまう問題を修正しました。

## 2021\-04\-23

version 2\.57

- プラグイン「SimplifiedJapanese」「Keywords」で「String could not be parsed as XML」が発生して要約の自動生成に失敗する問題を修正しました。
- URLマップにベースネームを含む時「basename」カラムを変更してコンテンツを保存・公開した時古い URLがキャッシュされたままになる問題を修正しました。
- 環境変数「select\_preview\_urlmap」を追加しました。モデルに複数の URLマップが割り当てられている時、プレビューする URLマップを選択できるようになりました。
- 環境変数「preview\_redirect」に「tmpfile」を指定するとプレビュー用の一時ファイルを生成してリダイレクトするようにしました。一時ファイルは 5秒後に削除されます。
- 定数「PADO\_DB\_CLEANUP\_BLOB」を指定すると「PADO\_DB\_BLOB2FILE」の設定のある時、ファイルが差し替えられたときなどに古い BLOBファイルを確実に削除できるようになりました。
- CSVインポートでステータス「0」がモデルのステータス初期値にセットされる問題を修正しました。
- 「timestamp」「timestamp\_end」を予約カラム名に追加しました。
- 「mt:trans」タグにモディファイア「noescape」を追加しました。この属性指定時のみ環境変数「esc\_trans」を無視します。
- モデル名に「\_」を含むときプレビュー時にオブジェクトのリレーションをループ出力するタグがプレビューの判別に失敗するケースを修正しました。
- プライマリカラムに値「0」がセットされている時一覧や編集画面でオブジェクト名の表示が「null」となる問題を修正しました。
- 必須項目となっているカラムに文字列「0」が保存できない問題を修正しました。
- 環境変数「denied\_exts」で「htaccess」を禁止拡張子から除外した時「\.htaccess」がアップロードできない問題を修正しました。環境変数「can\_upload\_hidden」の指定があわせて必要になります。
- プラグイン「FileUploader」で同じ画面から再度同名ファイルをドロップした時に連番が付く問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグにリレーションカラムの属性を指定している時プライマリカラムが「0」というオブジェクトでのフィルタが効かない問題を修正しました。
- 「mt:entries」などのオブジェクトをループするブロックタグの「options」属性にカラム名をキーにしたハッシュを指定できるようになりました。
- リレーション型のカラムに「翻訳」指定している時、編集画面で翻訳されないケースを修正しました。
- 記事の編集画面でのカテゴリ、ページの編集画面でのフォルダの選択 UIでラベルを翻訳するようにしました。
- 一覧画面のフィルタで、作成者と更新者を「ユーザー」と同じく「表示名」で検索するように統一しました。
- プラグイン「SearchEstraier」が無効の時プラグイン「DocumentSearch」が有効だとアセットがアップロードできない問題を修正しました。
- オブジェクトのリビジョン作成時\(明示的に作成した時\)に「post\_save\_revision」コールバックを追加しました。
- オブジェクトの複製時に「post\_save\_clone」コールバックを追加しました。
- オブジェクトを複製した時プラグイン「ExternalPreview」で外部プレビューの有効期限を設定された日数後に延長するようにしました。
- プラグイン「TinyMCE」で CDNの URLを利用可能になりました。
- グローバルモディファイア「escape」に「single」を指定可能にしました。「double\_encode」を falseにして htmlspecialchars を通した値を返します。
- グローバルモディファイア「unescape」を追加しました。「decode\_html」と同様にHTMLエンティティを該当する文字に変換します。
- CSV/ZIPファイルからアセットをインポートする時に正しいパスにアップロードされない問題を修正しました。
- 異なるオブジェクトの URLが重複していたことなどが原因で、公開されているべきファイルが一時的に消えてしまった時、pt\-view\.php がリクエストを受けた時にファイルを再生成するようにしました。
- 環境変数「logrotate」を追加しました。数値を指定すると月に1回、指定数だけ「error\.log」ログローテーションを行えます。「\-1」を指定するとローテーション数の制限がなくなります。
- 環境変数「logrotate」に配列を指定することで複数のログファイルを対象にし、期間の指定などの詳細設定ができます\(例:"logrotate" : {"error.log" : ["weekly", 10, "gz"],"performance\.log" : ["monthly", 10, "gz"],"load\_avg\_peak\_memory\.log" : ["daily", 10, "gz"]},\)。
- プラグイン「SiteSync」でステージング環境の指定をしている時、ステージング環境にバーチャルホストを設定している場合にサイトの URLを設定に追加し、ツリーの URLをステージング環境の URLに変更して表示するようにしました。
- プラグイン「MTMLReference」の「mt:getvar」の説明を修正しました。
- リビジョン一覧の画面に「変更メモ」の表示位置を「差分」の最下部に変更しました。
- リビジョン一覧の画面オプションを非表示にするように処理を統一しました。
- リビジョン一覧で「変更メモ」を検索対象に含めるようにしました。
- プラグイン「HTMLImporter」で「ZIPファイル」ラジオボタンを選択した時、ZIPファイルに関するヒントを表示されるようにしました。
- テーマのウィジェットのメインビジュアルの URL指定にブラウザキャッシュ対策のパラメタを追加しました。
- URLオブジェクトの削除時にアクティブな同一ファイルパスの URLが別に存在している時、ファイルを削除しないようにしました。
- 環境変数「sitemap\_sort\_order」「sitesync\_sort\_order」を追加しました。プラグイン「SiteMap」「SyteSync」のツリーの表示順を「ascend」「descend」のいずれかで指定できます。
- 環境変数「sitesync\_assets\_base」を追加しました。プラグイン「SiteSync」はオプションプラグインのため「/PowerCMSX/plugins/SiteSync/assets/」を異なるパスに設置する時、パスを指定します。
- プラグイン「SyteSync」のプラグイン設定に「ステージング環境のURL」「本番環境のURL」を追加しました。「ステージング環境のURL」設定のある時、本番環境同期画面のツリーの URLが「ステージング環境のURL」起点のツリーに変わります。また、同期後に同期先 URLのリンクが表示されるため、同期結果を画面から確認できるようになります。
- プラグイン「SyteSync」で同期対象のファイルが存在しない時、画面にその旨を表示するようにしました。
- プラグイン「SyteSync」で環境変数「sitesync\_workspaces\_in\_system」設定のない時もシステムのツリーにスペースのツリーが一部表示されていた問題を修正しました。
- プラグイン「SyteSync」でツリーのチェックボックスではなくリンクをクリックした時には、チェックボックスについては状態を変更しないようにしました。
- プラグイン「SyteSync」でシステムに URLが存在しない時もツリーの一部が表示される問題を修正しました。
- プラグイン「AppProperty」で値に JSONの配列を指定できるようになりました。
- プレビュー画面を開く時の「\_target」属性値を画面単位に指定するようにしました。
- スペースの編集画面から「一覧へ戻る」をクリックするとダッシュボードに遷移する問題を修正しました。
- プラグイン「DocumentSearch」の環境変数「documentsearch\_skip\_pdf\_test」の初期値を「true」に変更しました。
- プラグイン「FixDeniedAssets」を更新しました。一部のパラメタのサニタイズ処理を追加しました。
- モデル「グループ」で選択したオブジェクトをステータスアイコンのコントラスト比が不足していた問題を修正しました。
- モデル「グループ」で選択したオブジェクトにバイナリ型のカラムのある時、選択したオブジェクトのサムネイルまたはアイコンを表示するようにしました。
- 「workspace\_id」カラムを持つオブジェクトの編集画面へのリクエストに異なる workspace\_idパラメタが渡された時、正しいスコープの画面にリダイレクトするようにしました。
- プラグイン設定をプラグイン毎に1度の SQL文でまとめて取得し、キャッシュするようにしました。
- 管理画面でスペースにいる時にプラグインのアップグレードバッジが付かない問題を修正しました。
- 環境変数「export\_int2label」を追加しました。true指定のある時、CSVインポート&エクスポートで数値型リレーションカラムの値をオブジェクトのラベル\(プライマリカラムの値\)で扱うようになります。
- 日付ベースアーカイブで「オブジェクトがない時アーカイブを出力しない」チェックボックスにチェックが入っている時、最古のページが出力されない問題を修正しました。
- 環境変数「path\_verify」に falseを指定しているときに「\.\./」を含む URLマップの出力ファイルが出力されない問題を修正しました。
- プラグイン「SimplifiedJapanese」の「詳細を表示」欄に形態素解析の結果を表示する設定を追加しました。
- プラグイン「SimplifiedJapanese」「Keywords」プラグインでの自動要約生成時に「Uncaught DivisionByZeroError: Division by zero」エラーが出るケースを修正しました。
- プラグイン「Keywords」で要約を自動生成するときにテキストに含まれている script要素と style要素の内容を除外するようにしました。
- プラグイン「Keywords」で要約を自動生成するときに HTML5のタグが含まれているとエラーログに「Tag タグ名 invalid in Entity」が残る問題を修正しました。
- プラグイン「Keywords」で要約を自動生成するときに句点で終わっていない見出しに句点を補完するようにしました。環境変数「keywords\_add\_punctuation」を falseにすることで設定を無効化できます。
- 一覧画面のアクションでタグを削除した時「Creating default object from empty value」エラーとなる問題を修正しました。
- プラグイン「BatchApproval」が有効な時、ワークフロー設定のあるモデルの一覧でワークルロー以降のアクションを実行するとモーダルを開く問題を修正しました。
- 再構築トリガーを複数設定している時、以前に再構築されたアーカイブのコンテキストが残る問題を修正しました。
- 一部の画面におけるクロスサイト・スクリプティングの脆弱性を修正しました。
- プラグイン「SiteMap」で非公開のオブジェクトをツリーに表示できる設定を追加しました。
- プラグイン「SearchEstraier」のコールバックモデル名を「seaech\_estraier」から「searchestraier」に変更しました。「searchestraier\_callback\_compat」に trueを指定すると修正前のコールバックモデル名に変更されます。初期値は falseです。
- プラグイン「Mirroring」でミラーリング、デバッグ、タスクでのミラーリング終了時に「post\_mirroring」コールバックを追加しました。第3引数にコマンドの実行結果の配列を渡します。
- プラグイン「Members」にログインメンバーのみにファイルを見せたいときにリライト先に指定するプログラムのサンプル「plugins/Members/app/pt-view-members.php」を追加しました。
- プラグイン「Members」で会員の退会処理に環境変数「verify\_form\_referrer」の設定を適用するようにしました。
- フォーム機能のトークンを利用する選択時に「セッションを利用する」オプションを追加しました。クッキーを利用して投稿者が確認画面を表示させたユーザーかどうかを識別してセキュリティを高めます。
- 環境変数「form\_session\_name」を追加しました。フォームにセッションを利用するときにセッションのキーを指定します。初期値は「pcmsx\_form\_token」です。
- 日付ベースアーカイブをプレビューしたときに「mt:archivetitle」タグが正しくセットされない問題を修正しました。
- ブロックタグ「mt:archivenext」「mt:archiveprevious」をサポートしました。このタグは日付ベースアーカイブ専用となります。
- 環境変数「rebuild\_optimizer」を追加しました。「performance\_logging」指定のある時、パフォーマンス・ログからモデルごとの再構築単位を自動設定します。
- 環境変数「rebuild\_request\_time」を追加しました。「rebuild\_optimizer」指定のある時、1回のリクエストが指定秒におさまるように再構築単位を設定します。初期値は40\(秒\)です。
- tools/rebuildOptimizer\.php を追加しました。定期実行タスクとは別に再構築の最適化処理のみを単独で実行します。
- プラグイン「AccessAnalytics」のファンクションタグ「mt:accesstracking」に「relative」モディファイアを指定できるようにしました。
- プラグイン「SearchEstraier」に環境変数「searchestraier\_definitely」を追加しました。初期値は trueです。offset指定のないときにヒット件数が正しくならないケースに対応します。
- header\.tmpl 内の &lt;/div&gt; の開始タグが欠落している箇所を修正しました。
- システムスコープでフィルタによる一覧絞り込み条件にリレーションカラムが含まれていると期待した結果とならないケースを修正しました。
- 環境変数「per\_rebuild」の初期値を「100」から「50」に変更しました。
- WebP形式をサポートしました\(画像として扱え、サムネイル作成などが可能に\)。サーバーの PHPが imagecreatefromwebp/imagewebp 関数をサポートしているか、ImageMagickがインストールされていて環境変数「imagick\_convert\_path」に convertコマンドのパスを指定している時に WebP形式の画像をサポートします。
- プラグイン「ImageWebP」を追加しました。アップロードした画像を WebPフォーマットに変換します。また、グローバルモディファイア「convert2webp」を追加しました。2〜100の数値を指定することで、指定された画質で webp形式の画像に変換し、変換後の URLを返します。
- プラグイン「SiteSync」を ver\.2\.0にアップデートしました。変更内容は plugins/SiteSync/docs/README\.ja\.md を参照してください。 
- アセット以外のモデルにバイナリ型のカラムを追加している時、編集画面から画像を編集するとデータが常に PNG形式で保存される問題を修正しました。
- バイナリカラムに添付されているファイルが GIF形式の時、画像の編集ボタンを非表示にしました。
- CSVインポートでリレーション先のオブジェクトの添付ファイルを更新した時、一覧画面のサムネイルのキャッシュが更新されない問題を修正しました。
- 「thumbnail」を予約カラム名に追加しました。
- 1対1のリレーションでアセットモデルを定義している時、選択されたバッジにサムネイルが表示されない問題を修正しました。
- プラグイン「ExternalPreview」で、リレーションで関連づいている非公開のオブジェクトをプレビューできるようにしました。
- URLマップの作成・編集画面で「コンテナ」ドロップダウンを常に表示するようにしました。
- 環境変数「fmgr\_delayed」を指定している時、画像のサムネイル作成に失敗する問題を修正しました。
- autoloadの処理を見直し、データベースアクセス時のディスクアクセスを減らしました。
- 数値型 1対1のリレーションカラムの disp\_editカラムに「relation」、optionカラムにモデル名をセットするようにしました。
- アセット編集画面のアセットの利用状況に数値型 1対1のリレーションカラムで関連付けられているオブジェクトを追加しました。
- リスト・アクション実行後の post\_saveコールバックをすべてのオブジェクトに対する処理が終了してから実行するようにしました。
- プラグイン「UploadUtilities」でモデルのステータスと同期を指定している時、数値型 1対1のリレーションカラムでアセットを利用しているモデルにも対応しました。
- プラグイン「CacheManager」で期限切れセッションをクリアできるようにしました。
- プラグイン「CacheManager」で画面上部にも「リセット」ボタンを追加しました。
- オブジェクトの作成・編集画面で階層型/数値型のリレーション型モデルのオブジェクトが存在しない時カラムを非表示にするようにしました。
- ファンクションタグ「mt:asseturl」をサポートしました。このタグは「mt:assetfileurl」のエイリアスでアップロードされたアセットのURLを出力します。
- 環境変数「session\_dir」を追加しました。指定のある時 PHPの「session\_save\_path」を変更します。
- プラグイン「DisplayOptions」で一覧画面のソート順を設定できるようにしました。
- プラグイン「DisplayOptions」で画面オプションの「オブジェクトごとのオプションを保存」を指定した時、管理者など除外対象のユーザーに対しても個別のカスタマイズが反映されるようにしました。
- 環境変数「fmgr\_delayed」指定のある時「temp\_dir」配下には即時にファイルを書き出すようにしました。
- 環境変数「objectloop\_order」に「descend」が指定されている時、モデルの設定でカラムの表示順が降順になる問題を修正しました。
- pt\-check\.php にテストメールの送信とディレクトリへの書き込みテストを追加しました。
- 「mt:date」の formatモディファイア、format\_tsモディファイアにエスケープのためのバックスラッシュを指定できるようしました。
- 環境変数「published\_on\_default」指定のある時、一覧のフィルタの日付に現在の日付をセットするようにしました。
- 拡張子のないファイルをアップロードした時に末尾に「\.」が追加される問題を修正しました。
- 選択項目カラムのオプションで、値とラベルをデリミタ「=」で繋いだ形式のデータ指定をサポートしました\(例:値A=ラベルA,値B=ラベルB\)。
- プラグイン設定を保存・リセットした時にログを保存するようにしました。
- tools/rebuildFile\.php に「\-\-sleep」\(タスク開始前の待ち時間秒\)、「\-\-limit」\(対象の件数\)、「\-\-offset」\(スキップする件数\)を指定できるようになりました。
- 環境変数「rebuild\_order」を追加しました。ポップアップウィンドウの再構築のモデルの順番を指定できます。初期値は「ascend」です。環境変数「rebuild\_order\_compat」を指定することでこれまでと同様の並び順にすることができます。
- アセット/画像型のフィールドでダイアログ選択ボタンがスコープを考慮していない問題を修正しました。
- 一覧からのアクションでステータスを変更した時、オブジェクトの更新者が更新されない問題を修正しました。
- Chromeブラウザでテキストエリア内で改行した時にカーソル位置がずれる問題を修正しました。
- やさしい日本語エディタの要約の文章数の初期値をプラグイン設定で指定できるようにしました。
- プラグイン「DisplayOptions」で管理者以外のユーザーがシステムスコープにアクセスした時にメニュー位置のカスタマイズが反映されない問題を修正しました。
- システムの「すべてを再構築」でシステムスコープに権限のないユーザーが権限エラーになる問題を修正しました。
- 定数 PADO\_DB\_BLOB2FILE, PADO\_DB\_BLOBPATH を設定しているとき pt\-check\.phpで「'1'が存在しないか書き込み権限がありません。」エラーが出る問題を修正しました。

## 2021\-03\-22

version 2\.55

- 一覧画面のアクション「置換」を追加しました。メニュータイプが「読み取り専用」以外で、検索タイプが「フレーズ」の時のみ表示されます。
- スペース毎に「タイムゾーン」を設定できるようになりました。環境変数「use\_timezone」に trueを指定することで利用可能になります。
- スペースに「タイムゾーン」を指定している時、ログ及びログファイルはシステムのタイムゾーンで記録されます。スペースでログを表示するとスペースのタイムスタンプに変換されて表示されます。
- グローバルモディファイア「offset\_time」を追加しました。スペースにタイムゾーンを指定している時、タイムスタンプをシステムのタイムスタンプに変換します。
- 環境変数「rebuild\_async」指定のある時進捗プログレスバーが正しく表示されるようにしました。
- モデル「任意」に対するリレーションを指定している時、モデルを変更すると変更前の関連付けが残る問題を修正しました。
- モデル「任意」に対するリレーションを指定している時、エラー画面でモデル選択が外れ、選択済みオブジェクトが空のバッジになる問題を修正しました。
- ダッシュボード「ワークフロー」でオブジェクトの公開日が正しくない日付になっていた問題を修正しました。
- レジストリを「order」キーの昇順でソートするようにしました。
- 極端に縦長もしくは横長の画像のアップロードができないケースを修正しました。
- format、format\_tsモディファイアで日本語の日付を指定している時「D」「l」が日本語表記の曜日を返しますが、これらの文字の前にバックスラッシュを2つ付けることでオリジナルの値を返すようにしました。
- 定期実行タスク内の再構築トリガーで「再構築\(遅延\)」指定のURLマップの再構築を処理の最後に行うようにしました。
- アセットなどの一覧画面からのステータス変更でバイナリファイルが出力されないケースを修正しました。
- テンプレート・パスに include/edit/モデル名/col\_right\.tmpl を設置すると作成・編集画面の右カラムのテンプレートを追加できるようになりました。
- アセットの編集画面にアセットの利用状況の一覧を追加しました。
- 環境変数「tag\_multibyte」を追加しました。falseを指定するとカラムのラベルにマルチバイト文字が含まれる時、エイリアス名でのタグを登録しないようになります。
- 「存在しないモデル名\_id」カラムを作成して1対1リレーションを設定した時、モデル名+存在しないモデル名 を呼び出すとエラーになる問題を修正しました。
- モデル名に「\_」を含む時、ファンクションタグ「モデル名+archivelink」が値を返さない問題を修正しました。
- 一覧からのアクションでオブジェクトが変更されたときコールバック「post\_save」を呼ぶようにしました。
- プラグイン「RebuildRelations」で数値型 1:1 のリレーションをトリガーの対象にできるようになりました。
- システムスコープのビューからシステムスコープのモジュールを「mt:include」タグの「basename」属性指定でインクルードできない問題を修正しました。
- デバッグモード時、ダイアログの表示が崩れるケースを修正しました。
- ブロックタグ「mt:speedmeter」に name属性を指定している時、タグのネストに対応しました。
- ブロックタグ「mt:speedmeter」が計測後にブロックを再評価していた問題を修正しました。
- 一部のブロックタグが内部的に 1回余分にループされていた問題を修正しました。
- 環境変数「support\_dir」の指定のある時 pt\-check\.php がエラーになる問題を修正しました。
- ファンクションタグ「mt:triggererror」を追加しました。message属性に指定した値を引数にして trigger\_errorをコールします。
- Websiteテーマの「\.htaccess」で、publish\_type が「6\(ダイナミック\)」の時のみ DirectoryIndex を pt\-view\.php となるようにしました。
- ログイン画面及び 2段階認証の POST先 URLをルート相対パスに変更しました。
- ログイン後の画面遷移先をログインしたドメインに固定するようにしました。
- 条件タグ「mt:isset」で配列のキーをチェックできるようにしました。
- プラグイン「SiteSync」と「SiteMap」でディレクトリ名の大文字小文字を区別するようにしました。
- 環境変数「path\_upperlower」を追加しました。trueを指定するとファイルの大文字小文字を区別して扱います。
- 「階層の管理」画面で5階層までしかドラッグ&ドロップで配置できない問題を修正しました。
- 環境変数「hierarchy\_max\_depth」を追加しました。「階層の管理」画面で配置可能な階層の数を指定します。初期値は 100です。
- 環境変数「import\_set\_default」を追加しました。CSVからのオブジェクトのインポート及びプラグイン「DataMigrator」でのインポートの時、値のないカラムに対してカラムのデフォルト値をセットします。
- システムスコープでオブジェクトをインポートする時、存在しない workspace\_idが CSVに指定されている行をスキップするようにしました。
- 環境変数「rebuild\_async」指定のある時、ポップアップウィンドウでの再構築で最後のモデルのオブジェクト数が環境変数「per\_rebuild」の数より小さい時、最後のモデルの再構築が重複実行されていた問題を修正しました。
- config\.json のデコードに失敗した時にエラーを返すようにしました。
- pt\-check\.php で config\.json の存在チェックを行うようにしました。
- pt\-check\.php にデータベースの存在チェックを追加し、存在しない場合は作成を試みるようにしました。インストール要件を満たしている場合、「インストールを開始する」ボタンを表示するようにしました。
- 「mt:entries」などのオブジェクトをループするブロックタグに lastn 属性のある時、sort\_by 属性の値を無視して id順に出力される問題を修正しました。
- normalizer が無効な環境でも、一部制限付きですが Unicode正規化処理を行うようにしました。
- リレーションやメタデータのないオブジェクトを一覧から全削除する時、TRUNCATE文を発行するようにして高速化しました。
- エラーログやパフォーマンスログの記録時刻をリクエスト開始時刻から、ログの記録時刻に変更しました。
- モデルを「ダッシュボードに表示」設定している時、プラグイン「DisplayOptions」で非表示にしているスペースではダッシュボードに表示されないようにしました。
- リビジョンの一覧画面からリビジョンを選択した時のメッセージを変更しました。
- リビジョンの編集画面からリビジョンを削除した時、リビジョンの一覧画面にリダイレクトするようにしました。
- ロックアウトや IP制限でのログアウト後のログイン画面にパラメタが引き継がれないようにしました。
- バッジ内のサムネイル取得について、サムネイルのないオブジェクトに表示されるアイコンをアイコンのURLへのリダイレクトで表示させるようにしました。
- プラグイン「HTMLImporter」で XPath以外を指定してインポートした時マルチバイト文字が HTML\-ENTITIES化されてしまう問題を修正しました。
- 環境変数「objectloop\_order」を追加しました。オブジェクト複数形のブロックタグ \(mt:entries等\)で「sort\_by」属性指定があり、「sort\_order」属性指定がない時のデフォルトのソート順を指定します。
- プラグイン「PluginStarter」がリストアクション、システムフィルタの作成をサポートしました。
- プラグイン「PluginStarter」が「template\_source」「template\_output」コールバックプラグインの作成をサポートしました。
- プラグイン「PluginStarter」でプラグイン用の翻訳フレーズを作成できるようになりました。
- プラグイン「PluginStarter」で Prototype クラスを継承した拡張アプリケーションのスケルトンをエクスポートできるようになりました。
- プラグイン「PluginStarter」で、その他のコールバックの種別に応じた引数をエクスポートするようになりました。
- プラグイン「PluginStarter」で、メニューを指定したメソッドを作成した時、管理画面用テンプレートのスケルトンをあわせてエクスポートするようにしました。
- プラグイン「PluginStarter」で、タスクを作成した時、config\.json に正しい形で登録されない問題を修正しました。
- プラグイン「PluginStarter」で「pre\_save」コールバックが選択できない問題を修正しました。
- 環境変数「plugin\_starter\_check\_default\_plugins」を追加しました。true指定\(初期値 true\)の時、環境変数「plugin\_paths」指定パス配下のプラグインの重複チェックをスキップします。
- グローバルモディファイア「regex\_replace」で正規表現がエラーになる書式の時、元の文字列を返すようにしました。環境変数「regex\_replace\_compat」を true指定すると従来通り空文字を返します。
- グローバルモディファイア「regex\_replace」でデリミタを省略できるようになりました。環境変数「regex\_replace\_compat」を true指定するとエラーとなり空文字を返します。
- 環境変数「cache\_driver」指定がない時にも「query\_cache」に一部のキャッシュが保存されるためプラグイン「CacheManager」でクリアできるようにしました。
- キャッシュ管理の画面で、ファイルにキャッシュが保存されているのに名前欄に「\(なし\)」と表示される問題を修正しました。
- プラグイン「Members」で IPアドレスがロックアウトされた時、管理画面のログアウト画面にリダイレクトされる問題を修正しました。
- プラグイン「Members」でユーザーがロックアウトされた時、引き続きログインを試行した時にエラーメッセージが表示されずにログインに失敗する問題を修正しました。
- ダッシュボード・ウィジェット「モデル」のスタイルを変更しました。
- ダッシュボード・ウィジェットのカードの左右上部の角丸が 1px欠けていたのを修正しました。
- 環境変数「weak\_date\_context」を追加しました。trueを指定すると「published\_on」カラムのないオブジェクトのリストでは日付のコンテクストを無視するようになります。
- 環境変数「weak\_count\_context」を追加しました。trueを指定すると「mt:entriescount」などのタグが「mt:archivelist」タグ内で日付以外のコンテキストを無視し「mt:categories」などのタグ内で日付のコンテキストを無視するようになります。
- 環境変数「cache\_driver」指定のない時もフレーズや設定データ、スキーマ情報、ダイナミック・タグなどをキャッシュするようにしました。
- 「変更不可」のカラムを一覧画面の検索対象に含められるようにしました。
- 「mt:include」「mt:includeblock」「mt:cacheblock」にタグ属性「cache\_object\_id」を指定できるようになりました。あわせて triggers属性に単一のモデルを指定している時、特定のオブジェクトに対するキャッシュとすることができます。
- 「mt:include」「mt:includeblock」「mt:cacheblock」にタグ属性「triggers」属性指定のある時、「cache_ttl」に「\-1」を指定すると、有効期限を無期限\(50年\)に設定するようになりました。
- 環境変数「rebuildrelations\_clear\_cache」を追加しました。「mt:include」「mt:includeblock」「mt:cacheblock」にタグ属性「cache\_object\_id」を指定している時、プラグイン「RebuildRelations」による関連オブジェクトの更新でキャッシュをクリアします。
- URLマップのコンテナの更新による再構築で URLオブジェクトの md5カラム値が更新されないケースを修正しました。
- worker\.php の時限公開による再構築を「コンテナ」→「再構築トリガー」の順に実行するようにし、管理画面での更新時と同じ順番になるようにしました。
- 2段階認証を設定している時、管理画面と異なるドメインの非公開コンテンツの閲覧時に確認用コード入力後に管理画面に遷移してしまう問題を修正しました。
- 2段階認証を設定している時、遷移先のパラメタを引き継いでログイン後に適切な画面へ遷移するようにしました。
- 「include\_draft」「status\_not」「status\_lt」属性の指定されているオブジェクト複数形のブロックタグ \(mt:entries等\)をライブプレビューの対象外とするようにしました。
- ダイナミック・パブリッシングで URLの取得に失敗した時、workspace\_idと relative\_path から、URLの再取得を試みるようにしました。
- 日付を出力するテンプレート・タグが「utc」「relative」属性に対応しました。relative="js" には現在のところ対応していません。
- 選択項目型・チェックボックス型のカラムの初期値がオブジェクト作成画面で選択されない問題を修正しました。
- プラグイン「UploadUtilities」によるサーバーの import\_paths に設定された ZIPファイルの展開時にタイムアウトを延長しエラーハンドリングを厳密にするようにしました。
- 環境変数「parallel\_sleep\_time」を追加しました。並列処理スタート時の実行間隔秒を指定します。
- キャッシュファイルの破損を避けるため、ファイル書き込みが終了してから指定のパスにリネームするように処理を変更しました。
- 定期実行タスクで複数のオブジェクトを予約公開・差し替え・非公開にした時に先に処理されたアーカイブで一覧などのリストがその時点のものになってしまい、実際の状態と合わない問題を修正しました。
- 環境変数「parallel\_publish\_objs」を追加しました。数値を指定することで複数のオブジェクトの再構築を並列処理することで高速化を図ります。
- カラムの初期値の文字数制限を 50文字から 255文字に変更しました。
- 「mt:includeblock」タグの中で「mt:membercontext」タグが効かないケースに対応しました。
- メールの本文中の管理画面 URLが、ルート相対パスになるケースに対応しました。
- 新規インストール時にエラーログが記録される問題を修正しました。
- 「フィールド型」に「画像」「画像 \(複数\)」を追加しました。
- フォームの設問タイプとバリデーションタイプに「メールアドレス \(確認\)」を追加しました。
- ダイアログでのダイレクト編集でデバッグモード時保存ボタンがクリックできない問題を修正しました。
- フォームに「コンタクトを1人1通に制限する」機能を追加しました。メールアドレス単位でチェックを行います。
- フォームのコンタクト数の上限を設定できるようになりました。
- 条件タグ「mt:ifformisopen」を追加しました。フォームのステータスが公開中で、コンタクト数の上限に達していない時内容を出力します。
- プラグイン「AppProperties」で、管理画面からの「sess\_timeout」を設定した時に設定が効かない問題を修正しました。
- tools/restoreSQL\.php がエラーとなり正常終了しない問題を修正しました。
- tools/restoreSQL\.php 実行時のプロンプト、メッセージを翻訳して表示するようにしました。
- 環境変数「language」の初期値を「ja」としました。
- ZIPファイル\(CSV\)からのインポート画面とプラグイン「DataMigrator」のインポート画面が Chunk Uploadに対応し、最大で 1GBまでのファイルをアップロードできるようになりました。
- フックの実行順が priority の通りにならない問題を修正しました。
- オブジェクト数をカウントするタグ\(例:mt:entriescount\)に、「\_filter」属性を追加しました。ブロックタグ\(例:mt:entries\)に指定可能なタグ属性を追加して現在のコンテキストでのオブジェクト数を返します。
- 環境変数「temp\_dir」が「/tmp」に指定されている時、pt\-check\.php に変更を促すメッセージを追加しました。
- 存在しないスペースの workspace\_id が指定されたリクエストをすべてダッシュボードにリダイレクトするようにしました。
- 「sort」「direction」「workspace\_ids」など、タグ属性に指定可能ないくつかの値を予約カラム名として追加しました。
- 「table\_id」を予約カラム名として追加しました。
- 一覧画面から表示順を保存した時と、階層の管理で階層の保存をした時に、必要のある時に再構築が必要である旨の表示と再構築ウィンドウへのリンクを表示するようにしました。
- アセットなどのディレクトリ名の検証を厳密に行うようにしました。
- アセットのファイル拡張子を不正に変更できないようにし、アセットの保存時とインポート時に許可されない拡張子への変更ができないようにしました。
- 設問の編集画面で設問タイプが未指定の時に表示されるメッセージが間違っていたのを修正しました。
- 環境変数「path\_verify」を追加しました。1を指定すると、ドキュメント・ルートより上位のディレクトリへアーカイブを出力できず、2を指定すると、サイト・パスより上位のディレクトリへアーカイブを出力できなくなります。デフォルトは 1です。
- 環境変数「verify\_publish」を追加しました。trueを指定すると、拡張子の設定によって禁止されている拡張子のファイルをいずれのケースでも出力しません。初期値は falseです。
- 環境変数「verify\_referrer」を追加しました。データの更新・削除などの際の一時トークンのチェック時にリファラをあわせてチェックします。初期値は falseです。
- 環境変数「verify\_form\_referrer」を追加しました。フォームへの確認画面・投稿時にリファラをチェックします。初期値は falseです。
- 環境変数「esc\_trans」を追加しました。ファンクション・タグ「mt:trans」、グローバルモディファイア「trans」「language」及び Prototypeクラスの「translate」メソッドの結果を常に HTMLエスケープするようになります。初期値は falseです。
- サイト・パスより上位のディレクトリへアーカイブを出力している時、ダイナミック・パブリッシングで 404になる問題を修正しました。
- 一覧画面で「全n件を選択する」にチェックを入れて削除やアクションを実行する際にパラメタ「filter\_params」のチェックを厳格化しました。
- プラグイン「FixDeniedAssets」を追加しました。アセットのパス・ファイル名のサニタイズおよび許可されないファイルへのリネームを禁止します。version 2\.55 未満の環境で必要となります。
- アセットまたは画像型のフィールドで、アセット削除後にフィールドのバッジが残る問題を修正しました。
- アセットを削除した時、フィールドの関連付けデータを削除するようにしました。
- アセットまたは画像型の単数選択フィールドに公開パスへのリンクを追加しました。
- スケジュールされたタスクでの時限公開・差し替え・非公開処理をログに記録するようにしました。
- システムのオブジェクトの URLマップをスペースに作成している時オブジェクトの更新で再構築されない問題を修正しました\(例: ユーザー別記事アーカイブをユーザーの保存時に再構築する\)。
- 複数のファイルをドラッグ&ドロップでアップロードした時、一部のファイルにエラーがあった時もアップロードに成功したファイルがある時は一覧にリダイレクトするようにしました。
- 複数の「\.」を含むファイルがアップロードできないケースを修正しました。
- 「mt:setcontext」タグがライブプレビューに対応しました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)がコンテキストに依存している時、ライブプレビューにコンテキストが反映されるようになりました。
- 環境変数「validate\_url」が falseの時にシステムスコープの URL が表示されないことがある問題を修正しました。
- 環境変数「form\_upper\_limit」+1件の連続投稿が許可されていたのを修正し、指定数以上の投稿をブロックするようにしました。
- 環境変数「form\_upper\_limit」に「0」や負の値を指定すると、制限を撤廃できるようになりました。
- 再構築キューに登録済みの URLオブジェクトの更新をスキップせずに確実にキューに登録するように変更しました。
- スペースを削除した時にスペース配下のログは削除しないようにしました。
- スキーマ定義の jsonファイルの default値を削除してアップグレードした時にカラムの設定に反映されない問題を修正しました。
- プラグイン「UploadUtilities」でオブジェクトとアセットのステータスを同期する設定で、アセット型・画像型のフィールドによる関連付けを考慮するようにしました。
- プラグイン「UploadUtilities」を有効化した時に、アップロードダイアログの各コントロールの余白が変わらないようにしました。
- URLオブジェクトの論理削除時に「publish\_file」カラムの値を「0」にせず、そのまま残すようにしました。
- フォームの添付ファイル型の設問に拡張子の指定がない時、システムの拡張子の許可・不許可設定に応じてエラーを返すようにしました。
- プラグイン「FileUploader」で「allowed\_exts」のチェックがスキップされていたのを修正しました。
- アップロードしたファイルのファイル名から URLに利用できない記号を削除するようにしました。
- Websiteテーマの「Website \(Form\)」モジュールで、エラーメッセージを escapeして表示するようにしました。
- Websiteテーマを最初に適用した時、フッターのメニューとスペースのコピーライトが出力されない問題を修正しました。
- モデルの編集画面でバイナリ型のカラムを削除した時、サムネイルなどの metaデータと PADO\_DB\_BLOB2FILE 指定のあるときは当該の BLOBデータを削除するようにしました。
- プラグイン「SearchEstraier」の属性指定検索で非正規化文字が検索にかからないケースを修正しました。
- スケジュールされたタスクによる重複 URLの整理時に、削除済みオブジェクトの URLが残り、存在するオブジェクトの URLが整理削除されてしまうケースを修正しました。
- URLが重複している時に、外部プレビュー、ライブプレビューで目的のオブジェクトが対象にならず正常に表示できない問題を修正しました。
- tools/PADO/cleanupBlobs\.php を追加しました。PADO\_DB\_BLOB2FILE 指定のある時、削除済みオブジェクトの外部 BLOBファイルをクリーンアップします。
- PADO\_DB\_BLOB2FILE 指定のある時、モデルを削除した時に BLOBを削除するようにしました。
- プラグイン「HTMLImporter」で URL指定でインポートを実行した後に一時ファイルが残らないようにしました。
- グループの関連オブジェクトを再選択した時に、既存で選択済みのオブジェクトのステータスアイコンフォントが多重エスケープされるケースを修正しました。
- プラグイン「TinyMCE」のプラグイン設定に「Microsoft Excelからの表のペースト時にスタイルを削除する」を追加しました。デフォルトは trueです。

## 2021\-02\-22

version 2\.50

- 環境変数「user\_css」「user\_js」を追加しました。管理画面に CSS、JavaScriptを追加します。
- ファンクションタグ「mt:unset」を追加しました。name属性を指定してテンプレート変数を未定義にします。
- last\_compiled, cache\_key, compiled, statusカラムを diffから除外するようにしました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)でリレーション名または関連オブジェクトのモデル名でのフィルタリングに対応しました。AND OR NOT が指定できます。括弧による条件のグルーピングには対応していません。
- オブジェクト複数形のブロックタグ \(mt:entries等\)でタグ属性「author」をサポートしました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)とプラグイン「MixedObjects」の「conditions」属性で nc\(Not Contains\)を指定している時正しくマッチしない問題を修正しました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)で数値タイプのリレーション名を指定した時、\_filterパラメタ指定のある時、フィルタが2重に処理されてしまう問題を修正しました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)で workspace\_idsに「all」を指定した時に期待通りの結果が取得できない問題を修正しました。
- 環境変数「multiplenotifications\_to\_same\_group」を追加しました\(初期値 false\)。trueを指定すると、プラグイン「MultipleNotifications」で同じグループのユーザー間でもメールを通知します。trueの代わりに「2」を指定すると操作した本人を除いたユーザーへ通知します。
- 環境変数「multiplenotifications\_to\_all\_publisher」を追加しました\(初期値 false\)。trueを指定すると、プラグイン「MultipleNotifications」でオブジェクトの公開時に通知メールをすべての公開者に送信します。trueの代わりに「2」を指定すると操作した本人を除いたユーザーへ通知します。
- tools/rebuildFile\.php でステータスが公開でないオブジェクトのサムネイルが出力される問題を修正しました。
- tools/rebuildFile\.php でリビジョンの処理をスキップするようにしました。
- タスクの実行間隔を環境変数「タスクID\_frequency」で指定できるようにしました。
- 特定条件でフィールドセレクタが非表示になる問題を修正しました。
- 「property」というモデルを作成しているときプラグイン「PluginStarter」を有効化すると propertyの編集画面が正常に表示さきなくなる問題を修正しました。
- 「image」というモデルを作成しているときの編集画面が正常に表示さきなくなる問題を修正しました。
- プラグイン「SplitPage」で複数のアーカイブを分割設定している時、ポップアップウィンドウの再構築で2つめ以降のオブジェクトが分割されず全件出力される問題を修正しました。
- プラグイン「SplitPage」でアーカイブにトリガー指定をしている時、時限公開がトリガーで再構築される時分割されたページが再分割される問題を修正しました。
- プラグイン「DocumentSearch」に環境変数「documentsearch\_pdf\_filter」を追加しました。「PHP」を指定すると、フィルタコマンドを使わずに直接 PHPから pdftotextを用いてテキストを抽出します。
- プラグイン「DocumentSearch」に環境変数「documentsearch\_skip\_pdf\_test」を追加しました。pdftotextコマンドが存在するのに「フィルタ「/usr/local/bin/pdftotext」が見つかりませんでした。」が出力される時、trueを指定してください。
- プラグイン「DocumentSearch」に環境変数「documentsearch\_auto\_title」を追加しました。管理画面で入力したファイルのラベルの代わりに文書から抽出したタイトルをインデックス化します。
- URLマップのコンテナとトリガーに同じモデルを指定している時にトリガーがスキップされる問題を修正しました。
- オブジェクトのリレーション項目をループ出力するブロックタグで「ignore\_filter」タグ属性が無視される問題を修正しました。
- 環境変数「publish\_queue\_limit」を追加しました。1度のタスクでの再構築キューの処理数の上限を指定できます。
- worker\.php に引数「\-\-publish\_queue\_limit」\(再構築キューの実行単位\)「\-\-publish\_queue\_offset」\(再構築キューのオフセット\)「\-\-sleep」\(タスク開始前の待ち時間秒\)を渡せるようにしました。
- 定期実行タスクなどによる再構築で performance\.logが記録されない問題を修正しました。
- pt\-check\.php に必要なディレクトリに対する存在チェックと書き込み権限のチェックを追加しました。
- プラグイン「HTMLImporter」で対象モデルの選択が正しくならないケースを修正しました。
- ブロックタグ「mt:loop」の sort\_by属性指定がスペース区切りに対応し、PowerCMSと互換性を保つようになりました。
- モデル「グループ」をトリガーに指定している時、アーカイブ無効の設定のグループのトリガーが引かれない問題を修正しました。
- プラグイン「PostOnTwitter」に含まれるテンプレートファイル名を「edit\_form\_footer.tmpl」から「additional\_edit\_form\_footer.tmpl」に変更しました。
- プラグイン「PostOnTwitter」での HTTP リクエスト時に環境変数「http\_proxy」を利用するようにしました。
- 選択ダイアログで検索を実行し、ヒットするものがなかった時に一覧に戻るとパラメタが不足してしまう問題を修正しました。
- アセットのファイル差し替えでサムネイルやメタデータが更新されないケースを修正しました。
- 一覧からタグを追加・削除した時に再構築結果が正しくならないケースを修正しました。
- PADO\_DB\_BLOB2FILE 指定のある時、リビジョンの作成・マスタへの適用でサムネイルや BLOBデータが消えるケースを修正しました。
- プレビュー時に開くウィンドウに \_target属性を設定し、タブやウィンドウがいくつも開かないようにしました。
- プレビューを行なうとそれ以降フィールドの値が更新されなくなる問題を修正しました。
- プラグイン「SimplifiedJapanese」で要素内に「0」だけがある時、変換結果から内容が欠落する問題を修正しました。
- 一覧画面で「全n件を選択する」にチェックを入れて表示順を保存した時、非表示になっているオブジェクトの表示順が「0」になる問題を修正しました。
- バイナリ型のカラムに添付したファイルを削除した時にプラグイン「DocumentSearch」の検索インデックスに残る問題を修正しました。
- 一覧画面からオブジェクトを選択して削除すると、一覧画面に戻った時に削除したオブジェクトが一定時間残るケースを修正しました。
- 管理画面からの環境変数追加で「publish\_callbacks」の追加をできるようにしました。
- 一覧画面が表示順の降順の時、行をドラッグ&ドロップした時の再ソートを降順にしました。
- 環境変数「list\_reorder\_interval」を追加しました。一覧画面で行をドラッグ&ドロップした時の数値の間隔\(単位\)を指定できます。
- 環境変数「validate\_url」の初期値を trueとしました。ダイナミック・パブリッシングの時、どのスコープで実行されているかに関わらず URLを見て URLオブジェクトを SELECTします。
- ブロックタグ「mt:rankedobjects」内で変数「object\_id」をセットするようにしました。
- フィールド型に「アセット」「アセット \(複数\)」を追加しました。
- プラグイン「HTMLImporter」でインポートしたコンテンツの HTMLコメントが数値参照になる問題を修正しました。
- 環境変数「can\_rebuild\_in\_view」を追加しました。インデックス・アーカイブ以外のビューの編集画面に「保存と再構築」ボタンを追加します。
- ビュー及び URLマップの一覧画面で「表示順を保存」した時にコンパイルキャッシュが壊れ、出力ページの内容やパスが不正になる問題を修正しました。
- 「保存と再構築」ボタンクリック時以外でトリガーが動作しないため、URLマップの作成・編集画面で再構築トリガーからビューを削除しました。
- SQL文を指定してオブジェクトを loadした時、メモリキャッシュに保存しないようにしました。
- リビジョンに対する操作について、ログのメッセージを修正しました。
- モデル名に「\_」を含むモデルのオブジェクトの前後のオブジェクトを取得するタグ名に「\_」が残っていた問題を修正しました。互換性のため「\_」付きのタグもそのまま利用できます。
- CSVインポートでエラーのあったファイル名と行数を画面に出力するようにしました。
- 環境変数「sethashvar\_compat」を追加しました。「false」を指定すると、ブロックタグ「mt:sethashvar」の中で「mt:setvarblock」もハッシュ変数の対象となります。
- リビジョンの保存時に必須チェックなどでエラーとなった場合、見出しとフッタのボタンが編集画面の要素になる問題を修正しました。
- プラグイン「DocumentSearch」で、アセットのファイル名を変更して保存した時に古いファイルが検索インデックスに残る問題を修正しました。
- フィームの設問の日付のバリデーションを修正し、テキスト\(複数欄\)で年月日を渡した時に正しく日付のチェックを行うようにしました。
- リビジョンを保存した時に出力ファイルが消える問題を修正しました。
- リビジョンを作成した時にユニーク指定のあるカラムに「値\(のクローン\)」文字列が追加されないようにしました。
- 作成・編集画面で、一覧表示権限があって作成権限のないユーザーに「一覧に戻る」ボタンを表示するようにしました。
- 公開者がオブジェクトを保存したあとに画面に表示されるワークフローのメッセージをそのメッセージを保存した人のみに表示されるようにしました。
- プラグイン「UploadUtilities」の設定画面で、ステータス同期対象モデルに管理画面から追加したモデルが出ない問題を修正しました。
- URLマップの編集画面で選択済みビューの名前が取得できないケースを修正しました。
- ファンクションタグ「mt:var」の name属性に rerquest\.プレフィックスがあり、「join」属性の指定がある時に値が1つしか取得できない問題を修正しました。
- tools/rebuildFiles\.php 実行時と一覧画面からの「ファイル出力」の時には環境変数「comp\_url\_md5」を「false」に設定するようにしました。
- 環境変数「add\_param\_permalink」を追加しました。環境変数「allow\_login」がともに有効な時、管理画面の非公開のコンテンツ且つドメインが異なる時、パーマリンクに必要な時「\_\_mode=login」を追加します。
- 「変更不可」指定のあるカラムの値について、時限差し替えを行った際にオリジナルの値を引き継ぐようにしました。
- アーカイブが公開済みのオブジェクトのパーマリンクが変更になった時に古い URLがプラグイン「SearchEstraier」のインデックスに残る問題を修正しました。
- プラグイン「FileUploader」を追加しました。データベースのバイナリカラムにデータを格納しないファイルアップロード機能を提供します。設定に依存せずに自由なパス名・ファイル名で最大 2GBまでの大きなファイルをアップロードできます。
- URLの一覧からアクション「物理削除」を実行した時にログを残すようにしました。
- プラグイン「HTMLImporter」で取得した要素が文字化けするケースを修正しました。
- モデルの編集画面で「数値」型のカラムに対して詳細ダイアログで「リレーション」を選択した時「階層」が選択肢に出てこない問題を修正しました。
- プラグイン「PostOnTwitter」のプラグイン設定でコンテナ指定のあるURLマップのモデルがモデルの選択肢に表示されない件を修正しました。
- プラグイン「UploadUtilities」で独自に追加したアセット・リレーション型カラムのステータス同期に対応しました。
- 環境変数「basename\_upper\_lower」を追加しました。trueを指定するとベースネームカラムで大文字の指定ができるようになります。
- プラグイン「SearchEstraier」の文書ドラフトのテンプレートを「html\_draft\.tmpl」にリネームし、代替テンプレートを利用できるようにしました。
- プラグイン「SearchEstraier」で、文書の抽出パターンに「開始点と終了点を指定」「正規表現」「XPath」を追加しました。
- プラグイン「SearchEstraier」で、文書のタイトルに含まれる全角英数記号を含むクエリでヒットしない問題を修正しました。
- 環境変数「searchestraier\_skip\_noindex」を追加しました。meta name=robots content="noindex" 指定のある時、プラグイン「SearchEstraier」の検索インデックスにその文書を含めないようにします。
- 2段階認証の設定をしている時、別ドメインでログインすると管理画面に遷移する問題を修正しました。
- プラグイン「BatchApproval」での一括承認はリビジョンの一覧からは正しく動作しないため、リビジョンの一覧からは選択できないようにしました。
- プラグイン「HTMLImporter」で、XPathの処理で DOMXPath::evaluate の結果が string型でない時に正しく値が取得できない問題を修正しました。
- CSVインポート時に、モデルからリレーション設定しているモデルがリビジョン対応の時、リビジョンの方に関連づいてしまう可能性があるケースを修正しました。
- 環境変数「parallel\_publish\_queue」を追加しました。再構築キューを並列処理・分割処理してメモリ節約と実行時間を短縮できます。この設定は環境によって正しく動作しない可能性があります。動作確認の上ご利用ください。環境変数「php\_binary」の設定が必要です。Windows環境ではサポート外となります。
- 環境変数「publish\_queue\_per」を追加しました。再構築キューを分割処理して利用メモリを節約できます\(結果として実行時間を短縮\)。この設定は環境によって正しく動作しない可能性があります。動作確認の上ご利用ください。環境変数「php\_binary」の設定が必要です。Windows環境ではサポート外となります。
- 環境変数「parallel\_rebuild\_trigger」を追加しました。遅延再構築を並列処理・分割処理してメモリ節約と実行時間を短縮できます。この設定は環境によって正しく動作しない可能性があります。動作確認の上ご利用ください。環境変数「php\_binary」の設定が必要です。Windows環境ではサポート外となります。
- 環境変数「rebuild\_trigger\_per」を追加しました。遅延再構築を分割処理して利用メモリを節約できます\(結果として実行時間を短縮\)。この設定は環境によって正しく動作しない可能性があります。動作確認の上ご利用ください。環境変数「php\_binary」の設定が必要です。Windows環境ではサポート外となります。
- 環境変数「async\_usleep」を廃止しました。
- グローバルモディファイア「urldecode」を追加しました。
- ファンクションタグ「mt:query」タグに values属性を追加しました。配列のキーを空にした値を返します。
- コンタクトの一覧にステータスアイコンを付けて色分けしました。
- コンタクトの一覧にステータスによるシステムフィルタを追加しました。
- 文書に meta keywordsが指定でされている時、pt\-recommend\-api\.php でユーザーの興味・関心に利用するようにしました。
- プラグイン「TinyMCE」のエディタひな形のドロップダウンの表示順を管理画面で設定した「表示順」の昇順になるようにしました。
- ブロックタグ「mt:rankedobjects」にタグ属性「min\_count」を追加しました。指定回数以上アクセスされた URLのみを出力できます。
- ブロックタグ「mt:rankedkeywords」にタグ属性「min\_length」「min\_count」を追加しました。指定文字数以上のキーワード、指定回数以上検索されたキーワードのみを出力できます。
- 「mt:include」タグにタグ属性「triggers」を追加しました。カンマ区切りまたは配列で指定したモデルのオブジェクトの更新によってダイナミック・パブリッシングのキャッシュをクリアします。
- ブロックタグ「mt:includeblock」を追加しました。テンプレート変数'contents'にブロックのコンテンツをセットして、mt:includeタグを呼び出します。
- バイナリ型・ファイル型のカラムの一覧、詳細ページのアイコン種別に「アーカイブ」アイコンを追加しました。
- ファンクションタグ「mt:include」ブロックタグ「mt:cacheblock」に cache\_ttl属性と triggers属性の指定のある時、再構築プロセス終了後もキャッシュを破棄せずに次回以降も再利用されるようにしました。
- 改行を含む値を含む CSVからインポートした際に改行が削除されてしまうケースを修正しました。
- 数値型カラムで編集タイプ「リレーション」モデル「添付ファイル」の時編集画面に SVGファイルのプレビューが表示されるようにしました。
- クエリキャッシュが有効な時、一覧画面からオブジェクトを削除した際に一覧画面にオブジェクトが残ることがある問題を修正しました。
- 環境変数「query\_cache」が trueの場合に、ワークフローを経て公開及びリビジョンの反映時に送信されるメールのコメントが空になる問題を修正しました。
- ビューに登録したメールテンプレートにリビジョンが存在する時、リビジョンが利用されることがある問題を修正しました。
- GIF形式のファイルがアップロードできない問題を修正しました。
- GIF形式のファイルのサムネイルが生成できない問題を修正しました。
- リレーション先のテーブル名に radio、select、dialog、checkbox などの文字列が含まれると編集画面が意図通りにならない問題を修正しました。
- プラグイン「SearchEstraier」でタイトル取得を「title要素」にしている時にタイトルが取得できないケースを修正しました。
- プラグイン「DocumentSearch」でファイルを上書きした時に検索インデックスが更新されない問題を修正しました。
- プラグイン「DocumentSearch」でファイルの拡張子を変更してファイルをアップした時に古いファイルの検索インデックスが残る問題を修正しました。
- 環境変数「members\_member\_in\_worker」「members\_member\_in\_preview」を追加しました。メンバーのIDを数値指定すると、プレビュー時や動的ページの全文検索インデックスを作成する時にそのメンバーのコンテキストをセットします。
- クエリキャッシュが有効な時、プラグインによるフックやコールバックでクエリキャッシュが適切にクリアされないケースを修正しました。
- バッチ処理や1リクエストで複数のページをパブリッシュする際の利用メモリを節約するようになりました。

## 2021\-01\-18

version 2\.4202\-Patch

- 管理画面から作成したモデルを利用する時、autoload が libディレクトリを毎回スキャンして速度低下していた問題を修正しました。
- 「\_」を含むモデルのファイルの URLが取得できない問題を修正しました。
- リビジョンを修正した時に差分が保存されない問題を修正しました。
- オブジェクトの作成・編集画面の単一選択型リレーションで選択後のバッジのラベルがセットされない問題を修正しました。
- 「404\-error」のビューについてリビジョンとステータス無効のものを除外してSELECTするようにしました。
- 添付ファイル型・リレーションカラムへのアップロードチェックに添付ファイルカラムの設定を使うようにしました。
- 添付ファイル型・リレーションカラムがある時、エラーが発生して保存に失敗した時に代替テキスト・ラベルが編集できない問題を修正しました。
- 環境変数「urltag\_compat」を追加しました。オブジェクトのファイルのパスを取得する際、タグ名が現在のコンテキストと異なる時も値を返します\(初期値 true\)。
- オブジェクトを公開以外のステータスで新規保存した時にURLオブジェクトが生成されない問題を修正しました。
- オブジェクトの作成・編集画面で必須項目やバリデーションでのエラー発生時に代替テンプレートが使われない問題を修正しました。
- オブジェクト複数形のブロックタグ \(mt:entries等\)の「conditions」属性で nc\(Not Contains\)を指定している時正しくマッチしない問題を修正しました。

## 2021\-01\-12

version 2\.42

- インストール要件のオプションの PHP拡張から「xdiff」を削除しました。
- pt\-check\.php で Notice: Undefined variable エラーが出ていた問題を修正しました。
- UploadUtilitiesでオブジェクトとアセットのステータス同期の設定をしている時、オブジェクトのステータスを変更しないと添付されたアセットのステータスが変更されない問題を修正しました。
- プラグインのアップグレードを知らせるダッシュボードメッセージが翻訳されていなかった問題を修正しました。
- アセットの一覧画面からのステータス変更でプラグイン「DocumentSearch」で検索対象のファイルのインデックスが更新されない問題を修正しました。
- プラグイン「DisplayOptions」で「オブジェクトごとのオプションを保存」にチェックを入れている時、除外条件にマッチした時に画面オプションが保存できない問題を修正しました。
- 日付アーカイブの中でブロックタグ「mt:archivelist」を利用した時、オブジェクトのカウントが正しく取得できない問題を修正しました。
- Websiteテーマの年別、月別のアーカイブタイトルが正しくならない問題を修正しました。
- オブジェクトを複製したときに所有ユーザーを複製したユーザーにセットするようにしました。
- プラグイン「LivePreview」で livepreview\.html を利用した時、ライブプレビューが有効にならない問題を修正しました。
- プラグイン「AccessAnalytics」で ユーザーエージェントを記録できるようになりました。
- プラグイン「AccessAnalytics」で 除外ユーザーエージェントを設定できるようになりました。
- プラグイン「AccessAnalytics」で 検索キーワードを記録できるようになりました。また、ブロックタグ「mt:rankedkeywords」を追加しました。
- プラグイン「AccessAnalytics」で 404ページのログを記録しないようにしました。
- プラグイン「AccessAnalytics」で 月選択のドロップダウンで月が1桁の時正しく動作していなかった問題を修正しました。
- プラグイン「SearchEstraier」のインデックス生成速度を改善しました。
- プラグイン「keywords」のブロックタグ「mt:autokeyrowds」タグで、アルファベット1文字のキーワードが正しく処理されない問題を修正しました。
- プラグイン「keywords」のブロックタグ「mt:autokeyrowds」タグで title属性が正しくセットされない問題を修正しました。
- プラグイン「keywords」のブロックタグ「mt:autokeyrowds」タグで、アルファベット1文字のキーワードが正しく処理されない問題を修正しました。
- 環境変数「keywords\_use\_mecab」を指定している時、プラグイン「keywords」のブロックタグ「mt:autokeyrowds」タグで登録されている単語を正確に拾うことができるようになりました。
- 現在のコンテキストと異なるモデルのファイルの URLがテンプレート・タグで取得できない問題を修正しました。
- 環境変数「path」について、常に config\.jsonの設定値を優先するようにしました。
- Windows環境で、ブロックタグ「mt:estraiersearch」、ファンクションタグ「mt:estraierjson」が日本語のキーワードを検索できない問題を修正しました。
- stateカラムのあるモデルのアクションでエラーが出る問題を修正しました。
- プライマリカラムの設定のないモデルのアクションでエラーが出る問題を修正しました。
- 環境変数「abs2rel\_caching」を追加しました。trueを指定するとプラグイン「Abs2Rel」によるソースの変換結果をキャッシュします\(初期値 false\)。プラグイン設定を保存するとキャッシュはクリアされます。
- オブジェクト複数形のブロックタグ \(mt:entries等\)で conditions属性を指定している時にデバッグメッセージが出力される問題を修正しました。
- ブロックタグ「mt:setcontext」内のオブジェクト複数形のブロックタグ \(mt:entries等\)で conditions属性を指定している時 conditions指定の id指定が無視される問題を修正しました。
- テーマ同梱の「\.htaccess」で、ディレクトリ・インデックスへのアクセスが pt\-view\.phpを通る問題を修正しました。
- OPCacheが有効な時、ファイルキャッシュ生成時にキャッシュを includeするようにしました。
- プライマリカラムの指定のないモデルにアーカイブまたはバイナリ型のファイルカラムがある時「SiteMap」「SiteSync」でPADOBaseModelExceptionエラーが出る問題を修正しました。
- プラグイン「Members」でメンバー自身が登録内容を変更した際にログを保存するようにしました。
- カラム名に「\_」を含むファイルのURLがテンプレート・タグで取得できない問題を修正しました。
- 一覧画面からリビジョンを作成した時 orderカラムの値を変更しないようにしました。
- プラグイン「PluginStarter」でコールバック対象モデルに一部のモデルが表示されない問題を修正しました。
- グローバルモディファイア escape=&quot;json\_unescaped\_unicode&quot; をサポートしました。JSONエスケープする時 Unicode 文字をそのままの形式で扱います。
- 環境変数「http\_request\_fulluri」を追加しました。環境変数「http\_proxy」が有効な場合に利用され、HTTP コンテキストオプション「request\_fulluri」の値を指定できます。
- プラグイン「DisplayOptions」で一覧画面のカラムの表示順をカスタマイズできるようになりました。
- オブジェクトの編集画面でパーマリンクフィールドに readonly属性を追加しました。
- プラグイン「MTMLReference」で一部のタグの説明にモデル名がセットされない問題を修正しました。
- PHP8環境でプラグイン「MTMLReference」のタグリファレンスを検索した時エラーになって画面が表示できないケースを修正しました。
- プラグイン「SimplifiedJapanese」のやさしい日本語エディタで要約生成の文章数を1〜10に変更しました。
- PHP8\.0\.0で「@エラー制御演算子」指定のある関数でエラーログが記録される問題を修正しました。
- エラー発生時のキャッシュクリア処理を \_\_desutruct時に移動しました。
- モデル名に「\_」を含む改装付きモデルの「path」タグが取得できない問題を修正しました。
- 「ファイル名をエンコードしない」設定でアセットをアップロードした時 URLのファイル名部分が URLエンコードされ、URLオブジェクトのカラム長を超えてしまう問題を修正しました。
- カスタム編集タイプの保存時の処理の第4引数にカラム名、第5引数にエラーの配列を追加しました。
- groupモデルを有効期限対応にした時、編集画面のステータスが1つズレる問題を修正しました。
- Windows環境でアップロード後のアセットのファイルが消えるケースを修正しました。
- ステータスが公開でないオブジェクトの更新・削除で再構築をスキップするようにしました。

## 2020\-12\-14

version 2\.4

- PHP8 に対応しました。
- PHPの対応バージョンを ver\.7\.1 以上に変更しました。
- リットテキストエディタ TinyMCE のバージョンを ver\.5\.5\.1 にバージョンアップしました。
- 環境変数「tinymce\_version」を追加しました。「4\.x」を指定すると ver\.4\.8\.5 を利用できます。
- オブジェクト複数形のブロックタグ \(mt:entries等\)で conditions属性をサポートしました。カラム名をキー、フィルタ条件のカンマ区切りテキスト「条件\(likeなど\),フィルタする値」を値にした配列\(ハッシュ\)を指定します。
- プラグイン「MixedObjects」を追加しました。複数のモデルのオブジェクトを1つにマージしてループ出力するブロックタグ「mt:mixedobjects」を提供します。
- プラグイン「AccessAnalytics」を追加しました。アクティビティを記録し ランキング出力を可能にします。
- プラグイン「AuthTwilio」を追加しました。Twilio SMSを利用した2段階認証をサポートします。
- ファンクションタグ「mt:canonicalurl」「mt:canonicallink」を追加しました。現在のぺージの URL を出力します。
- プラグイン「UploadUtilities」でインポートディレクトリに ZIPファイルがあるときファイル選択のドロップダウンメニューを表示するようにしました。
- プラグイン「CookieUtilities」にファンクションタグ「mt:getenv」を追加しました。
- プラグイン「DisplayOptions」に「オブジェクトごとのオプションを保存」機能を追加しました。
- モデルの編集画面で「アクティビティを表示」を設定可能にしました。
- ファンクションタグ「mt:objecttojson」を追加しました。現在のコンテキストオブジェクトのデータを JSON配列にして出力します。
- 一覧画面の list\_header, list\_footerテンプレートを追加可能にしました。
- 環境変数「image\_paste\_without\_size」を追加しました。リッチテキストエディタへの画像挿入時に width属性と height属性を省略します。
- 環境変数「log\_level」を追加しました。1で基本情報、2でパラメタを記録\(従来と同じ\)、3でバックトレースを記録します。初期値は 3 です。
- 環境変数「mail\_transfer」を追加しました。「debug」を指定するとメール送信を行わずにログにメールの内容を保存します。
- 環境変数「dir\_perms」「file\_perms」を追加しました。「755」「644」など3桁の数値で指定します。
- 環境変数「server\_api」「apache\_version」を追加しました。「apache\_version」については、上位2桁を数値で指定してください\(2\.2の時「22」2\.4の時「24」など)。
- ログをエクスポート対応設定した時、作成者と作成日をエクスポートできるようになりました。
- テーマから出力される「\.htaccess」が Apache 2\.4系でエラーになる問題を修正しました。
- 画像処理ライブラリの php\-imagine のバージョンを ver\.1\.2\.4 にバージョンアップしました。
- プラグイン「SiteMap」と プラグイン「SiteSync」プラグインのツリー表示時に PADOBaseModelException エラーが出ていた問題を修正しました。
- プラグイン「SiteSync」でURL重複のある時、存在するファイルのアイコンがゴミ箱アイコンになるケースを修正しました。
- SiteSyncの実行通知メールの初期テンプレートにミラーリングのエラーメッセージを追加しました。
- 環境変数「mirroring\_lftp\_path」で標準と異なるパスを指定している時、プラグイン「SiteSync」による同期実行後のミラーリングが実行されないケースがある問題を修正しました。
- 環境変数「mirroring\_lftp\_path」で標準と異なるパスを指定してもプラグイン「Mirroring」が有効化できない問題を修正しました。
- プラグイン「Members」で、ログアウト画面から再度ログインした時にログアウト画面に遷移してしまう問題を修正しました。
- プラグイン「Members」でサインアップ時及びプロフィールの編集時にエラーが発生した際にプロフィール画像が引き継がれない問題を修正しました。
- プラグイン「Members」でプロフィールの編集画面にプロフィール画像が表示されない問題を修正しました。
- プラグイン「Abs2Rel」で「SCRIPT要素内を無視する」を有効にしても相対パスに変換されてしまうケースを修正しました。
- プラグイン「DocumentSearch」で添付ファイルを検索インデックス対象としている時、オブジェクトの添付を削除した時に検索インデックスが即時反映されない問題を修正しました。
- query\_cache指定のある時、インデックス・アーカイブの「保存と再構築」でビューの修正が反映されない問題を修正しました。
- ポップアップウィンドウでの再構築で、インデックスアーカイブの再構築の時不要なビューが再構築対象になっていた問題を修正しました。
- ログインしているユーザーにデータのないバイナリカラムのURLが出力される問題を修正しました。
- プラグイン「MTMLReference」で一部のタグ属性の説明が誤っていたのを修正しました。
- プラグイン「MTMLReference」にドキュメントへのリンクを追加しました。
- PHP8環境で、プラグイン「PluginStarter」でカスタム編集タイプ、バリデーションを追加するとプラグインひな形が保存・エクポートできない問題を修正しました。
- プラグイン「AppProperties」で、環境変数を削除した時にキャッシュがクリアされない問題を修正しました。
- 月別・年別・年度別などの日付アーカイブ内のカレンダー内で日付のコンテキストが無視される問題を修正しました。
- タグの選択ダイアログから新規作成を選択した時、モデルを自動的にセットするようにしました。
- オブジェクトの作成画面で、カラム「has\_deadline」の初期値が反映されない問題を修正しました。
- プラグイン「ExternalPreview」で、同一のURLパスが異なるスコープにあった時に外部プレビューに失敗するケースを修正しました。
- プラグイン「PluginStarter」で生成されるドキュメントのタグ属性のキーが間違っていたのを修正しました。
- pt\-check\.php で外部コマンドをパスの存在チェックではなくコマンドの実行結果でチェックするようにしました。
- Windows環境でアーカイブが出力されない問題を修正しました。
- Windows環境でアセットなどバイナリ型のカラムを含むモデルの添付ファイルが出力されない問題を修正しました。
- インストール時にはキャッシュを保存・利用せず assets\_c指定のある時ディレクトリを空にするようにしました。
- 添付ファイル付きのオブジェクトの保存時に「PADOBaseModelException: unknown column x in model attachmentfile」エラーが出る問題を修正しました。
- 特定のケースでオブジェクトのリレーションが重複する問題を修正しました。
- ロールの作成画面で JavaScriptエラーが出ていた問題を修正しました。
- リビジョンの一覧画面で変更メモの表示位置をプライマリカラムへと移動し、差分を広げて見やすく改良しました。
- PHP7\.4以降で Markdownの処理中にエラーが発生する問題を修正しました。
- プラグイン「Mirroring」「LinkChecker」を有効化後に無効化した後で、ロールの保存に失敗する問題を修正しました。
- インストール時には各種キャッシュを無効化し、 assets\_cディレクトリを空にするようにしました。
- ワークフローダッシュボードでリビジョンを識別するバッジが非表示になっていた問題を修正しました。
- 会員サイトのパスワードリセットと二段階認証のメールの Fromアドレスをプラグイン設定で指定のアドレスを使うようにしました。
- システム設定画面にバージョン表記を追加しました。
- 存在しないIDのオブジェクトが CSVインポートで生成されない問題を修正しました。
- 環境変数「can\_upload\_hidden」を追加しました。\.から始まるファイルをアップロード可能にします。初期値は falseです。この機能はプラグイン「UploadUtilities」の ZIPファイルから展開する機能には対応していません。
- アップロード禁止拡張子に「htpasswd」を追加しました。
- 一覧画面にリビジョン作成のアイコンを表示させている時、リビジョンの一覧からもリビジョンが作成できるようになりました。
- オブジェクトの保存時に日付型のカラムの値が存在しない日付になっている時、存在する日付の近似値に丸めて保存するようにしました。
- 夜間に実行される定期実行タスクで、スペースの URLオブジェクトがシステムのパスに付け替えられてしまう問題を修正しました。
- 画面オプションの編集画面の「編集画面」カラムのチェックボックス群をキーボード操作対応させ、ヘルプを追記しました。
- オブジェクトのプレビュー時、リレーションで関連づいている添付ファイルのステータスが非公開の時もループで出力するようにしました。
- オブジェクトのプレビュー時、プラグイン「UploadUtilities」でステータスの同期が有効なモデルの時、リレーションで関連づいているアセットのステータスが非公開の時もループで出力するようにしました。
- プラグイン「PluginStarter」から出力されるタグの種類が異なる問題を修正しました。
- モデル\(table\)の削除時にリレーションや添付ファイルなどの不要なデータが残る問題を修正しました。
- ステータスカラムのないモデルのオブジェクトの添付ファイルのステータスがレビューになる問題を修正しました。
- プラグイン「SimplifiedJapanese」のやさしい日本語エディタで、結果をキャッシュする設定の時にエラーになる問題を修正しました。
- プラグイン「SimplifiedJapanese」のプラグイン設定のスペースのCSSが適用されずにシステムのCSSが適用される問題を修正しました。
- プラグイン「PasswordExpired」のプラグイン設定「同じパスワードによる更新を制限する」を有効にした場合に、異なるパスワードを入力しても「最近使ったパスワードは設定できません。」と表示され保存ができない問題を修正しました。
- クエリキャッシュが有効な状態でプラグイン「PostOnTwitter」が正しく動作しないケースを修正しました。
- ブロックタグ「mt:sethashvars」内に空行がある時エラーログが吐かれる問題を修正しました。
- ブロックタグ「mt:cacheblock」、ファンクションタグ「mt:include」の cache\_key 指定があるとき、mt\_session テーブルのカラム key のカラム長を超えてしまうことがある問題を修正しました。
- ブロックタグ「mt:cacheblock」、ファンクションタグ「mt:include」に trrigers属性を指定可能になりました。モデル名の配列もしくはカンマ区切りテキストを指定します\('user','session','log','urlinfo'は指定できません\)。
- ブロックタグ「mt:menuitems」タグに LivePreviewが効かない問題を修正しました。
- プラグイン「DataMigrator」で、アップロードしたインポートファイルが temp\_dirに残る問題を修正しました。
- プラグイン「LinkChecker」で外部リンクのリンク切れを検出できないケースを修正しました。
- データベースが MariaDBの時 pt\-check\.php で MySQLのバージョンチェックをスキップするようにしました。
- 階層付きモデルに orderカラムのない時、階層の保存時にエラーログが残る問題を修正しました。
- エラーログに保存されるバックトレースに errorHandlerメソッドを含まないようにしました。
- 環境変数「comp\_url\_md5」を追加しました。falseを指定すると、URLオブジェクトの md5カラムの値ではなく常に実ファイルとの差分をチェックします。初期値は trueです。
- キューによる再構築メッセージの翻訳漏れを修正しました。
- キューによる再構築の後にURLオブジェクトの「出力済み」フラグが付かなかった問題を修正しました。
- 画像編集ダイアログのテンプレートファイル名を「edit\_image\.tmpl」から「image\_editor\.tmpl」に変更しました。

## 2020\-11\-10

version 2\.3

- PHP8 で問題になっていたいくつかのエラーを解消しました。
- Diffの取得に利用しているライブラリを「Text\_Diff」から「SebastianBergmann\\Diff」に変更しました。
- プラグインで独自の編集タイプを作成できるようになりました。
- loadメソッドの colsに配列を渡せるようにしました。
- モデル・フレーズの初回修正・保存時に作成者情報が変わる問題を修正しました。
- プラグイン「PasswordExpired」でエラーログに Notice が出る問題を修正しました。
- オブジェクトの SELECT時にカラムの存在チェックを厳密に行うようにしました。また、不整合があった時キャッシュをクリアするようにしました。
- 複数指定をしているフィールドが編集画面で増やせない問題を修正しました。
- 一覧画面の画面オプションで、検索キーワードを維持できるオプションを追加しました。
- 一覧画面の見出しを一覧画面へのリンクにしました。
- フォームの設問に「名前」を追加しました。
- 環境変数「cfg\_admin\_url」の指定のある時、この値を上書きしないようにしました。
- テーマ同梱のフォームに「件名」の設定を追加しました。
- オブジェクトの編集画面の選択型ドロップダウンの幅を広げました。
- カラムの型をテキスト型からリレーションに変更した場合に一覧画面での検索でエラーが発生するケースを修正しました。
- オブジェクトの編集画面でワークフローの選択でステータスが変更されない問題を修正しました。
- build\_path\_with\_mapメソッドが falseを返した時既存ファイルが削除されない問題を修正しました。
- 全般設定にアプリケーション・パスを読み取り専用で追加しました。
- UploadHandler で get\_config\_bytesメソッドがキロバイト以外考慮されていなかった問題を修正しました。
- pre\_import, post\_import コールバックに「is\_new」 キーを追加しました。
- ユニークなカラムの値がマスタと同一の時リビジョンの保存ができない問題を修正しました。
- インポート時に pre\_import コールバックが実行されない問題を修正しました。
- urlinfoモデルの SELECT時に「Incorrect DATETIME value」エラーが出るケースに対応しました。
- 添付ファイルに basenameカラムを追加するとファイル名を維持できるようになりました。
- loadメソッドで sortが効かない問題を修正しました。
- ポート番号が80、443以外のときに admin\_urlに余分なport番号が追加される問題を修正しました。
- ワークフローを経て公開及びリビジョンの反映時に送信されるメールにコメントを付けられるようにしました。
- ブロックタグ \(mt:entries 等\) の order\_by 属性値に ORDER BY 句を記載できてしまう問題を修正しました。
- 標準モデルに追加したバイナリカラムのファイルがプレビューできないケースに対応しました。
- 非同期バックグラウンド処理で、データベースのデータ更新を再構築トリガー処理の前に行うように変更しました。
- プラグイン「PluginStarter」を追加しました。プラグインのスケルトンを管理画面から作成し、エクスポートできるようになります。
- 「mt:entries」などのオブジェクトをループするブロックタグで、「field:basename」「field\_and\_or」属性をサポートしました。
- 「mt:entries」などのオブジェクトをループするブロックタグで、sort\_by属性に「field:basename」「field:basename numeric」を指定できるようにしました。
- プラグイン「SplitPage」が有効の時、インデックス・アーカイブでコンテナの指定ができない問題を修正しました。
- モデルエクスポート時に不要なアラートが出る問題を修正しました。
- モデルのエスケープでキーの順序を変更しました。
- format、format\_tsモディファイアで日本語の日付を指定している時「D」「l」が日本語表記の曜日を返すようになりました。
- db\_caching指定なし、query\_cache指定ありの時、オブジェクトに添付した BlobにURLが振られない問題を修正しました。
- 条件タグ「mt:if」で value属性が指定可能になりました。
- ポップアップウィンドウの再構築で、再構築対象のオブジェクトがない時にエラーになる問題を修正しました。
- 条件タグ「mt:ifuseragent」タグを追加しました。ダイナミック・パブリッシングでデバイスによる分岐を可能にします。
- ファンクションタグ「mt:vardump」に name属性と key属性を指定できるようにしました。
- オブジェクトをループするタグで lastn属性をサポートしました。
- プラグインのアップグレードがある時にバッジを表示するようにしました。
- db\_cacheがオフでも query\_cacheが有効なら query\_cacheを利用できるようにしました。
- pt\-view\.php で、allow\_login環境変数を反映するようにしました。
- 外部プレビューが DynamicMTMLに対応しました。
- 公開サイトで jQueryが読み込めなくても外部プレビューが使えるようにしました。
- 環境変数「error\_document404」指定のある時、スペースのパスをベースにファイルを探すようにしました。
- favicon\.icoを追加しました。
- MTMLリファレンスに不足していたドキュメントを追加しました。
- 「スケジュールされたタスクを実行しました。」ログが特定のスペースのスコープになる問題を修正しました。
- 環境変数「dynamicmtml\_in\_preview」を追加しました。プレビュー時に DynamicMTML の処理を実行します。
- プラグイン「LinkChecker」で不要なログが残る問題を修正しました。
- 一覧画面で編集者権限で検索窓で Returnキーを押下した時にアクションが実行される問題を修正しました。
- URLオブジェクトを削除した時、あるいはパーマリンクが変更された時に、メニューのオブジェクトを付け替えるようにしました。
- ビューの編集画面でシンタックス・ハイライトを有効にしている時 HTML属性の中にテンプレート・タグを書くと赤ハイライトになる問題を修正しました。
- プラグイン「LinkChecker」でアンカー付きURLが取得できない問題を修正しました。
- スキーマアップグレードのバッジが出ない問題を修正しました。
- フィールドに「画面に表示」指定がない時、動的にフィールドを追加できない問題を修正しました。

## 2020\-10\-09

version 2\.2001

- コンパイル済みビューとコンパイル済み URLマップのキャッシュをクリアするとworkspace\_idが0になる不具合を修正しました。
- UploadUtilitiesプラグインで、オブジェクトのステータスとアセットのステータスを同期設定をしている時、一覧からステータス変更をした時にオブジェクトの再構築まで進まない問題を修正しました。
- ビューに変更がない時にもリビジョンができる件を修正しました。
- tools/restoreSQL\.php で、データベースが空でもリストアできるようにしました。
- テンプレートのコンパイルキャッシュ有効期限を 3600秒にしました。環境変数 ctx\_cache\_ttl で値\(秒\)を指定可能です。
- スペースでシステムスコープのモデルにコンテナを指定してアーカイブを作成できるようになりました。例えばスペースでユーザー別の記事アーカイブリストなどを作成できます。
- プラグイン「ExternalPreview」でリビジョンの外部プレビューに対応しました。
- 一覧からのワークフローでレビュアーに承認依頼をした際、ステータスがレビューに切り替わらない問題を修正しました。
- リンクチェッカのタスクが正しく終了しない問題を修正しました。
- 「mt:arrayrand」の limtが1の時、正しく処理されない問題を修正しました。
- 環境変数 immediate\_lockout を追加しました。指定のある時、ログイン中も常にIPロックアウトをチェックするようになります。
- 環境変数 recover\_ip\_at\_reset を追加しました。指定のある時パスワードリカバーでIPロックアウトを解除します。
- インストール時の IPロックアウトの回数の初期値を「5」に変更しました。
- アセットをダイアログで選択する際、ページ送りで遷移した後にアップロードすると、ダッシュボードに遷移してしまう問題を修正しました。
- ログインしていない時ログイン画面の title要素にスペース名を出さないようにしました。
- CSVエクスポートであわせてエクスポートされる JSONファイル内でフィールドの値が単一の時、textカラムの値を空になるようにし、インポート時に textカラムの値を組み立てるようにしました。

## 2020\-10\-01

version 2\.20

- DynamicMTML に対応しました。静的に生成したファイル中のテンプレート・タグを部分的に動的に処理できるようになります。ブロックタグ「mt:dynamicmtml」とファンクション・タグ「mt:ml」が利用可能です。
- UploadUtilitiesプラグインで、オブジェクトのステータスとアセットのステータスを同期できるようになりました。
- モデルの JSONのバージョンアップを上げて、developモードでスキーマアップグレードした時に削除されたカラムをDBに反映するようになりました。
- ファンクションタグ「mt:break」を追加しました。ループの中に記述すると、そこで現在のループを終了します。
- ファンクションタグ「mt:arrayshuffle」を追加しました。name属性に配列名を指定すると、配列をシャッフルします。
- ファンクションタグ「mt:arrayrand」を追加しました。name属性に配列名、num属性に件数を指定すると、ランダムな n件を抽出します。
- ファンクションタグ「mt:arrayslice」を追加しました。name属性に配列名、offset属性とlength属性を指定して、配列の一部を展開し\(切り取り\)ます。
- ブロックタグ「mt:loop」に shuffle, offset, limit属性を追加しました。
- Abs2Relプラグインにグローバルモディファイア「abs2relconvert」を追加しました。URL を相対パスに変換します。
- 真偽値型のカラムに初期値の指定のある時必須マークを非表示にするようにしました。
- オブジェクトの保存時に orderカラムに値のない時、意図した値が入らないケースを修正しました。
- 環境変数 reset\_url\_method を追加しました。"copy"を指定するとURL変更時に元のファイルを消さずにコピーします。初期値は rename です。
- 環境変数 fix\_email\_from を追加しました。メールアドレスか trueが指定可能です。メールの From をすべて指定のアドレスに固定します。
- リビジョンを差し替え予約でマスタに適用した時、ベースネームがマスタのベースネーム付け替えられないようにしました。環境変数 keep\_master\_basename と trueにするとマスタのベースネームを保持します。
- リビジョンからの差し替え実行時にリレーションとメタデータの関連付けが外れる問題を修正しました。
- tools/rebuildFiles\.php に \-\-urlmapping\_ids\(数字のカンマ区切り\)を指定できるようになりました。
- フォームからの投稿時に Windowsで作成した日本語ファイル名がメール添付で消える問題を修正しました。
- フォームの確認画面でエラーがあった時、添付ファイルが引き継がれない問題を修正しました。
- オブジェクトの作成・編集画面で数値型カラム・添付ファイルの時ヒントが2重に表示される問題を修正しました。
- 環境変数 linkchecker\_ignore\_stream\_context を追加しました。指定のある時 file\_get\_contents の第3引数を省略します。
- プラグイン「PostOnTwitter」を追加しました。記事やページ等のオブジェクト公開時に Twitter にツイートする事ができます。
- フォーム画面のヘルプにメールアドレス欄でテンプレート・タグが使える件を追記しました。
- pt\-check\.php で、flush でシステム出力バッファのフラッシュが有効かどうかのチェックを追加しました。
- LinkCheckerプラグインで末尾に「/」のないディレクトリへのリクエストがエラーになっていた問題を修正しました。
- 再構築トリガーの指定で「同一スコープのオブジェクトのみを対象とする」にチェックがない時、異なるスペースのコンテキストで再構築が行われる問題を修正しました。
- モデル urlmapping と template のカラム name をユニーク指定にしました。
- コンテナと日付ベースの指定のある URLマップが LivePreviewに対応できないケースを修正しました。
- URLマップとビューの編集画面にURL一覧へのリンクを追加しました。
- テーマのスタイルでチェックボックスとラジオボタンに枠線を付けるようにしました。
- モデル作成時にプラグインによって予約されているテーブル名や PHP のクラスが存在するかどうかを厳密にチェックするようにしました。
- プラグイン設定保存後に実行されるコールバック「post\_save\_plugin\_config」を追加しました。
- インポート時にアップロードパスの異なる同名アセットが重複とみなされスキップされる問題を修正しました。
- URLマップの編集画面でアーカイブ種別を「インデックス」にしたときコンテナを非表示にして保存時にも値を空にするようにしました。
- オブジェクトの一覧画面で、管理者権限のないユーザーにオブジェクトの user\_idカラムが NULLのオブジェクトが表示されない問題を修正しました。
- ページの読み込みが終わるまで一覧の検索ボタンをクリックできなくしました。
- ブロックタグ「mt:referencedobjects」タグのsort\_orderが正しくセットされないケースを修正しました。
- 削除済みオブジェクトを削除しようとしたときに warnings が出る問題を修正しました。
- 公開URLが異なるドメインのサイトにアクセスした時、環境変数「allow\_login」が有効の時、管理画面からの画面遷移でログイン画面を表示させるようにしました。
- オブジェクトの削除時に再構築トリガーやコンテナの更新の前にユーザーにレスポンスを返すようにしました。
- 環境変数 http\_proxy を追加し、PTUtil::stream\_context\_create メソッドを追加しました。外部への通信にプロキシを利用する時に設定を指定できます。
- ワークフローの設定のあるオブジェクトを公開時、通知設定がないのに関係者への通知メールが送信される問題を修正しました。
- DisplayOptionsプラグインの画面オプションで、モデルごとに利用対象スペースを指定可能になりました。
- オブジェクト数をカウントするタグ\(例:mt:entriescount\)に context属性を追加できるようにしました。
- リビジョンで承認依頼を出したあと、マスタに適用した際にも関係者へメール通知ができるようになりました。
- ワークフローのメールのサイト名がシステムスコープで常に「Prototype」になる問題を修正しました。
- 直前のユーザーが現在ユーザーの時、編集画面のワークフロー部分に直前のユーザーを表示しないようにしました。
- クラス PADOの update\_multiメソッド、remove\_multiメソッドに渡されたオブジェクトに重複のある時、同じオブジェクトに対する処理をスキップするようにしました。
- チェックボックス型のフィールドが保存時に常に trueになる問題を修正しました。
- 設問タイプのラジオボタンの必須分岐の箇所が正しく効いていない問題を修正しました。
- 定数「PADO\_DB\_BLOB2FILE」指定のある時スペースの削除で子オブジェクトが最後まで削除されない問題を修正しました。
- 条件タグ「mt:if」で評価した値が「0」の時比較が実行されない問題を修正しました。
- リストアクション「ステータス変更」実行時にプラグインで追加した post\_save コールバックが実行されない問題を修正しました。
- プラグイン「SiteMap」と プラグイン「SiteSync」プラグインのツリー内のオブジェクト名からHTMLを削除するようにしました。
- オブジェクトに復数のフィールドがある時、2つ目以降フィールドがプレビューできない問題を修正しました。
- コメント/コンタクト/ユーザー編集画面に一覧へのリンクを追加しました。
- 管理画面からコメントを編集して保存した時に、親IDが空になる問題を修正しました。
- 管理画面のURLの判別に $\_SERVER['SERVER\_NAME'] を使っていたのを $\_SERVER['HTTP\_HOST'] に変更しました。
- 環境変数「script\_uri」を追加しました。
- 環境変数「cookie\_domain」を追加しました。指定することでサブドメイン間でログインクッキーを共有することができるようになります。
- pt\-check\.phpの画面が翻訳されないケースを修正しました。
- 管理画面のヘッダに &lt;meta name=&quot;robots&quot; content=&quot;noindex&quot;&gt; &lt;meta name=&quot;robots&quot; content=&quot;nofollow&quot;&gt; を追加しました。
- リビジョン適用時に created\_byカラムが空になる問題を修正しました。
- リビジョン適用時にリレーションとメタ情報が重複する問題を修正しました。
- リビジョン適用時に生成されるリビジョンのIDを元リビジョンのIDにするようにしました。
- アセットのリビジョンにマスタと異なる拡張子のファイルを設定している時、マスタ適用時にファイル名がおかしくなる問題を修正しました。
- URLオブジェクトを論理削除する時、dirnameが「/」になる問題を修正しました。
- 環境変数「worker\_db\_caching」を追加しました。タスク実行時にオンメモリのキャッシュが肥大化してメモリ不足になるケースでは falseを指定してください。
- テーマインストール時、ビューに対するURLマップが1つの時、URLマップを上書きするようにしました。
- フォームから投稿するデータの改行コードを LFに揃えるようにしました。
- インストールがタイムアウトするケースに対する対策を行いました。
- Websiteテーマのサイドバーに年度別以外の日付アーカイブの一覧が表示されなかった問題を修正しました。
- 条件タグ「mt:ifarchivetype」が削除フラグを考慮していなかった問題を修正しました。
- デフォルトのステータスが公開でない時、UploadUtilitiesからアップしたファイルが公開されない問題を修正しました。
- SimplifiedJapaneseプラグインのやさしい日本語エディタで数字にふりがなが被る問題を修正しました。
- SimplifiedJapaneseプラグインのやさしい日本語エディタで「＜」を含むテキストが途中で切れる問題を修正しました。
- SimplifiedJapaneseプラグインのやさしい日本語エディタに、要約機能を追加しました。
- SimplifiedJapaneseプラグインのやさしい日本語エディタで、鉤括弧をネストすると文章が崩れる問題を修正しました。
- SimplifiedJapaneseプラグインのやさしい日本語エディタで環境変数「simplifiedjapanese\_assets\_base」指定のある時に JavaScriptファイルが読み込めない問題を修正しました。
- SimplifiedJapaneseプラグインのやさしい日本語エディタで変更された数字に千位毎にカンマ\(,\)を追加するようにしました。
- リレーションのモデルが「任意」のとき、ブロックタグ内でテンプレート変数「to\_object」にモデル名をセットするようにしました。
- リレーションのモデルが「任意」のとき、関連オブジェクトがタグで取得できない問題を修正しました。
- アップロード時に極端な縦長/横長の画像をアップするとエラーが起きることがある問題を修正しました。
- HTMLImporterプラグインで「アセットをインポート」オプションを利用した際、複数ページで利用している同じアセットがディレクトリごとに複数登録される問題を修正しました。
- 環境変数「x\_forwarded\_for\_last」を追加しました。$\_SERVER['HTTP\_X\_FORWARDED\_FOR']に復数のIPアドレスがある時、最後の値を remote\_ipにセットします。
- SimplifiedJapaneseプラグインで連続した漢字の日本語・中国語を判別するロジックを追加しました。
- SimplifiedJapaneseプラグインで分かち書きやふりがな振りの挙動が違うケースがある問題を修正しました。
- tools/backupSQL.php で mysqldump: [ERROR] unknown variable 'column\-statistics=0' エラーが発生する問題を修正しました。
- workspace削除の前に workspaceの child\_tablesをセットするようにしました。
- Keywordsプラグインを追加しました。キーワードの自動リンク、キーワード・タグ・概要の自動生成を行います。
- ブロックタグ「mt:tables」に has\_column属性を追加しました。
- オブジェクトの保存時にエラーがあった時日付入力欄に意図しない値がセットされる問題を修正しました。
- コマンドラインからのタスク実行時に引数 \-\-max\_exec\_time 指定を可能にしました。
- クラス PADOで一定数のクエリを発行したタイミングでメモリキャッシュをクリアするようにしました。
- 環境変数「db\_cache」指定がなく「query\_cache」指定のある時、キャッシュディレクトリのパスがセットされない問題を修正しました。
- モデルに対する権限のない時、フィールドの編集画面でモデルの選択ができない問題を修正しました。
- 定数 PADO\_DB\_MAX\_PACKET / PADO\_DB\_PERSISTENT / PADO\_DB\_TIMEOUT を追加しました。
- ブロックタグ「mt:estraiersearch」でXMLのパースに失敗した時、画面にエラーが出ないように修正しました。
- プラグイン「SearchEstraier」がインデックス作成するとき meta要素の content属性値が「0」の場合も文書属性値として利用できるようにしました。
- 環境変数「compile\_check」を追加しました。false指定の時各種コードのコンパイルチェックをスキップします。
- プラグイン「AppProperties」で環境変数 debugを指定した時、SQLクエリが表示されない問題を修正しました。
- 条件タグ「mt:ifcomponent」でアクティブでないプラグインの時は falseを返すようにしました。
- 期限切れセッションが重複して保存される問題を修正しました。
- Feedsプラグインを追加しました。XMLや JSONなどの外部リソースを取得してビューで出力することができます。
- ブロックタグ「mt:estraiersearch」に definitely属性指定を可能にしました(estcmd の「\-cd」オブションに相当します)。
- ブロックタグ「mt:loop」に hash属性を追加しました。
- ブロックタグ「mt:loop」で配列のキーが「0」の時意図した変数に値がセットされない問題を修正しました。
- モデル userに workspace\_idカラムを追加した時、nameと emailの重複が workspaceを超えてチェックされない問題を修正しました。この設定は非推奨です。
- 環境変数「theme\_paths」で設定した場所に設置したテーマのサムネイルが表示されない問題を修正しました。
- EmailMagazineプラグインの登録画面と登録完了メールを同時にビューで管理できない問題を修正しました。
- パスワード再設定メール用ビューの件名に値を設定しても「パスワードの再設定」になる問題を修正しました。
- 一覧画面ダイアログに一括選択チェックボックスが表示されない問題を修正しました。
- エラーのあるキャッシュファイルは定期的に削除するようにしました。
- クラス PADOで例外が出た時クエリキャッシュをクリアするようにしました。
- スペースのスコープにおいて「画面オプション」ボタンが非表示の時のデザイン崩れを修正しました。
- \_languageパラメタ付きのフォームへの投稿が適切に翻訳されない問題を修正しました。
- 「画面オプション」ボタンが非表示の時、ヘッダのデザインが崩れるのを修正しました。
- memberモデルのスキーマでカラム lockoutの初期値を「0」に変更しました。
- LinkCheckerプラグインでエラーページ数が合わない問題を修正しました。
- 公開側サイトから登録したメンバーがメールマガジンの送信対象にならない問題を修正しました。
- クラス PADOの loadメソッドで対象のカラムに対して複数条件を指定する際 \[IS NULL\] 及び \[IS NOT NULL\] を指定可能になりました。
- 翻訳フレーズ「%s is too long.」が翻訳漏れしていたのを修正しました。
- LinkCheckerプラグインで rel="nofollow" 属性のあるリンクを無視するようにしました。
- LinkCheckerプラグインでリンクチェックの DirectoryIndex対応、パラメタ付きリンクを考慮するようにしました。
- ダイアログのオブジェクト編集画面で JavaScript のエラーが出ていた問題を修正しました。
- LinkCheckerプラグインでダイナミック・パブリッシングページがリンクチェックの対象にならない問題を修正しました。
- includepartsタグでプラグインのalt-tmplが優先されない問題を修正しました。
- フォームの設問で「改行を削除する」オプションを追加しました。
- PasswordExpiredプラグイン設定の有効期限が過ぎた時の動作が「パスワード変更を強制する」の場合にログインできない問題を修正しました。
- テーマの初回適用後のメッセージにテーマ名が出てこない問題を修正しました。
- DocumentSearchプラグインでPDFのインデックスに失敗する問題を修正しました。
- SQL「SHOW COLUMNS テーブル名」の実行結果をキャッシュするようにしました。
- やさし日本語エディタで Microsoft Wordへのコピー&ペーストに対応しました。
- Internet Explorer 11 で配信済みメールマガジンの編集画面から一覧に遷移できない問題を修正しました。
- 管理画面からメール送信のテストが行えるようになりました。
- \_\_mode=view&\_type=listで存在しないモデルを指定した時にエラー画面が崩れる問題を修正しました。
- ワークフローでユーザーの検索時にフィルタが外れる問題を修正しました。
- 環境変数「csv\_allow\_nl」を追加しました。CSVエクスポートで改行を含むテキストを外部ファイル化できるオプションです。初期値は trueです。
- remote\_ipの取得方法を改良しました。
- includeモジュールでセットしたテンプレート変数が初期化される問題を修正しました。
- pre_login コールバックで falseを返した場合に画面が真っ白になるケースに対応しました。

## 2020\-06\-26

version 2\.16

- \[セキュリティ・アップデート\] オブジェクトの一覧画面におけるクロスサイト・スクリプティングの脆弱性を修正しました。
- バックアップスクリプトの mysqldumpコマンドに「 \-\-column\-statistics=0」オプションを追加しました。
- 静的(遅延)/オンデマンド/キューの時「オブジェクトがない時アーカイブを出力しない」が正常に動作しない問題を修正しました。
- worker\.php の引数「\-\-task\_ids」\(実行するタスク名のカンマ区切り値\)と「\-\-exclude\_ids」\(除外するタスク名のカンマ区切り値\)を指定できるようになりました。
- Worker実行時の pidファイル名にコマンドの引数を考慮したファイル名を生成するようにしました。
- pt\-recommend\-api\.phpに追加属性をパラメタで渡せるようにしました。
- インクルードしているビューでセットしたテンプレート変数がインクルード元のビューや次のインクルードしたビューのビルド時に引き継がれないケースを修正しました。
- PTPublisherクラスの publishメソッドで「current\_container」がセットされない問題を修正しました。
- ポップアップでの再構築の時、不要な URLの再構築が重複して行われている問題を修正しました。
- タグ属性「ignore\_archive\_context」が「date\_based」の時 workspaceの絞り込みが外れる問題を修正しました。
- ステータス無効/ロックアウトユーザーを即座にログアウトさせるようにしました。
- 会員サイトでパスワードリセットメール内の URLが管理画面の URLになってしまう問題を修正しました。
- ID列が空の行を新規オブジェクトとしてインポートできるようにしました。
- publish\_callbacksで$cb['template']が空になるケースを修正しました。
- 読み取り専用オブジェクトに対する「詳細」権限のある時詳細の閲覧と一覧画面からエクスポートを可能にするようにしました。
- clear\_all\_cache メソッドで、更新済みのオブジェクトが更新前の状態に戻ってしまうケースを修正しました。
- ロックアウトのリダイレクトでエラーログが吐かれる問題を修正しました。
- Websiteテーマのリンクの下線スタイルを変更しました。
- グローバル・モディファイア「encode\_json」を追加しました。escape="json" としたときも同じ結果となります。
- 一覧画面のモデル別 screen_header.tmpl をダイアログビューでも読み込むようにしました。
- やさしい日本語エディタのリッチテキストエディタに色設定ボタンを追加した時に色の設定がエディタに反映されない問題を修正しました。
- カスタマイズしたログイン画面でデバッグバーに起因する JavaScriptエラーを抑止するようにしました。
- 一覧からステータスを変更した時、URLマップ設定のないモデルで再構築トリガーが引かれな問題を修正しました。


## 2020\-06\-09

version 2\.15

- view/saveメソッドでid パラメータに数値以外を含む時をエラーを返すようにしました。
- プラグイン「HTMLImporter」で取得先サーバーが無効なSSL証明書のときにスクレイピングインポートができない問題を修正しました。
- countgroupby タグで、ソート順指定をできるようになりました。
- 読み取り専用オブジェクトの「詳細」権限のある時、詳細の閲覧とエクスポートなどのアクションを実行可能にしました。
- オブジェクト数をカウントするタグ\(例:mt:entriescount\)で、リレーションの設定のないアーカイブのコンテキストでオブジェクトをカウントして結果0件になるケースを修正しました。
- メールマガジンの「購読を停止する」ページに確認画面を追加しました。
- メールマガジンを「購読する」ページの確認画面から入力画面へ遷移手段を用意できるようにしました。
- 二重拡張子の PHP ファイルがアップロードできる問題を修正しました。Apacheのコンテンツネゴシエーションを有効にしていて「\.php\.gz」などで終わるファイル名をPHPとして処理するような設定の場合に問題がありました。
- Contact モデルの一覧画面に「新規作成」ボタンが表示されないようにしました。
- ポップアップからの再構築で添付ファイルと前後のオブジェクト再構築処理をスキップするようにしました。
- メルマガ購読者にカラムを追加した時、購読申込時に追加したカラムの値が保存されない問題を修正しました。
- 再構築時、スコープの異なる URLMappingを余分に処理していた問題を修正しました。
- オブジェクトの複製時に添付ファイルが一件しか複製されない問題を修正しました。
- スペースの作成・編集画面のカラムの表示順を修正し、サイトURL / サイト・パスが並んで表示されるようにしました。
- スペースの削除時にキャッシュが残る問題を修正しました。
- mathタグが浮動小数点を扱えるようになりました。
- プラグイン「PasswordExpired」を追加しました。パスワードの有効期限を設定可能にします。
- プラグイン「TinyMCE」で「tinymce\_convert\_urls」をデフォルト falseにしました。
- assetモデルのファイル名をリネームした時、古いパーマリンクが有効なままになり、新しいパーマリンクが有効にならない問題を修正しました。
- 同梱されている \_htaccess で php\_value post\_max\_sizeの追加とアップロードファイル制限を16MBに設定しました。
- オブジェクトを複製した際に、複製後のオブジェクトのステータスを alertエリアに表示するようにしました。
- \_\_mode=get\_thumbnail に column パラメタを渡せるようになりました。
- assets\_c ディレクトリに生成されるサムネイルのファイル名が常に file カラム用の名前になっていた問題を修正しました。
- テーマの再適用でビューに変更がないときにはリビジョンを作成しないようにしました。
- Prototypeクラスの clear\_all\_cache メソッドの第2引数にスコープのIDを指定できるようになりました。
- 会員サイトで、memberのロックアウトが働いていない問題を修正しました。
- 日付が NULLの場合に format\_tsモディファイアを適用すると「1970\-01\-01」になる問題を修正しました\(修正後は空白が返ります\)。
- テーマを再適用した時に、存在するビューが更新されない問題を修正しました。
- MTタグを含まないビューを保存したときに、以降ビューの編集画面が真っ白になる問題を修正しました。
- setcontext ブロックタグを抜けた時に current\_archive\_context がリストアされない問題を修正しました。
- プラグイン「MTMLReference」に「array\_unique」「count\_characters」のドキュメントを追加しました。
- キューの実行時にタスクのログが保存されない問題を修正しました。
- テンプレート変数及び環境変数「admin\_url」を常に管理画面のURL、「script\_uri」を実行中のPHPアプリのURLにするように統一しました。
- 会員サイトのメンバーのサインアップ時にバリデーションを通すようにしました。
- フォームのバリデーションに「ひらがな」「カタカナ」「数値」「半角英数記号」を追加しました。
- 「すべてを再構築」機能を追加しました。複数スコープの再構築権限を持っている時、システムのダッシュボードにボタンが追加されます。
- ヘッダーのプロフィール編集リンクのアイコンをユーザーの写真にするようにしました。
- 管理者ログインのIP制限が有効な時、ログイン済みユーザーが未登録のIPアドレスから公開サイトにアクセスしたときにログアウト画面が表示される問題を修正しました。
- メールアドレスのバリデーションをより厳密にしました。
- pt\-check\.php で XDebugの有効をチェックして警告を出すようにしました。
- Members プラグインのサインアップ確認画面において編集表示「日付」のカラムは時刻を表示しないよう修正しました。
- モディファイア count\_characters\(互換性のため\)を追加しました。count\_chars モディファイアと同じ動作となります。
- 入力したタグがプレビューで反映されない問題を修正しました。
- プレビューで、モデル内で他の同一モデルをループしている時リレーションの値がすべて編集中のオブジェクトのものと同一になるケースを修正しました。
- リレーション\(複数\)指定したオブジェクトの一覧がプレビューで取得できないケースを修正しました。
- Prototypeクラスに debug\_backtrace メソッドを追加しました。
- 一覧画面からアクションでタグの追加・削除を行った時にリビジョンが作成されない問題を修正しました。
- Websiteテーマを適用した際に、一部のアーカイブに「Global Navigation」「Footer Navigation」メニューが出ない問題を修正しました。
- ウィジェットの配色の設定によってウィジェットの本文の字がにじんだようになる問題を修正しました。
- ビルド済みのビューを再度保存すると compiledカラムのデータががビルド済テキストになる問題を修正しました。
- バリデーション「メールアドレス」のエラーメッセージがローカライズされない問題を修正しました。
- sessionモデルのオブジェクト保存時にの有効期限の指定のない場合、自動的に値をセットするようにしました。
- すでにオブジェクトが登録されている「スペースの子テーブル」にチェックを入れると workspace\_idカラムが NULLになり権限によってはデータが管理画面に表示されない問題を修正しました。
- ワークフローの作成者が意図せず消える問題を修正しました。
- プラグイン「Mirroring」の設定で、証明書ファイルの指定が可能になりました。
- プラグイン「Mirroring」で「現在の設定を表示」を alert から prompt に変更し、クリップボードにコピーできるようにしました。
- リビジョンの添付ファイルのステータスを常に下書きにするようにしました。
- statusカラムと text_formatカラムをリビジョン対象から外すようにしました。
- 一覧からのステータス変更で添付ファイルのステータスが変更されないケースを修正しました。
- 下書きのアセットのサムネイルの URLオブジェクトの dirnameが空になる問題を修正しました。
- 非公開のオブジェクトをダイナミックで閲覧する時、サムネイル表示が権限エラーになるケースを修正しました。
- 同一 URLの古い削除フラグ付き URLオブジェクトが存在した時にダイナミック・パブリッシングでページが見えない問題を修正しました。
- テーマ適用時にタイムアウトになることがある問題のを修正しました。
- テーマ適用時など、init\_tags()を複数回実行することでタグの出力が重複する問題を修正しました。
- 2段階認証の確認用コード入力画面に管理画面用のメニューボタンが表示される問題を修正しました。
- 2段階認証の確認用コードが一致しなかった場合、再度正しい確認用コードを入力しても「不正なリクエスト」となる問題を修正しました。
- 条件タグ「unless」に対して match 属性を利用すると評価が逆となる問題を修正しました。
- プラグイン「AppProperties」を追加しました。一部を除いて環境変数を管理画面から指定できるようになります。
- システムスコープでCSVインポートを実施すると workspace\_id が常に「0」になる問題を修正しました。
- オブジェクトの作成・編集画面で「日付」「日付と時刻」カラムが未入力の場合に現在日時が入力される問題を修正しました。
- 環境変数「site\_base\_path」を追加しました。サイト・パスを特定ディレクトリ配下に制限できるようになります。
- ログなど「model」というカラム名のカラムのあるモデルの一覧画面で不要な workspace\_idパラメタがセットされてしまう問題を修正しました。
- プラグイン「TinyMCE」でシステム設定を継承可能になりました。
- PTUtilクラスの「file\_find」メソッドに存在しないディレクトリを指定したときにエラーになる問題を修正しました。
- レコメンド機能の興味関心データをこれまでのクッキー保存から、データベースに保存するように仕様を変更しました。
- プラグイン「Members」で会員ログインに2段階認証を利用している時、ビューで会員のIDが取得できない問題を修正しました。
- プラグイン「EmailMagazine」で送信先の指定が改行区切り、カンマ区切りのいずれにも対応するようになりました。
- データベースに「blob2file」指定のある時 Blob型のカラムの値の diff が trueとなる問題を修正しました。
- ダイナミック出力の時にファイル添付を削除したバイナリ型カラムのURLが表示される問題を修正しました。
- プラグイン「TinyMCE」が有効な時「\_\_add\_content\_styles」変数にURLの配列を追加することで、エディタ用 CSSを追加できるようになりました。
- 管理画面のテンプレート変数「script\_uri」にパラメタが追加されてしまうことがある問題を修正しました。
- プラグイン「SimplifiedJapanese」で PDFファイルのエクスポートに対応しました。また、エディタから直接画像・PDFをエクスポートできるようになりました。
- やさしい日本語エディタへ下書きのアセットを埋め込んでエクスポートできるようになりました。
- プラグイン「SimplifiedJapanese」でリッチテキストエディタに「やさしい日本語にする」「ふりがなをつける」「分かち書きをする」「ふりがなを編集する」ボタンを追加できるようになりました。
- プラグイン「TinyMCE」に「HTMLの部分編集」ボタンを追加しました。
- 既にカラムに値に空文字が保存されているレコードが存在する状態で「テキスト」タイプのカラムを「数値」タイプに変更できない問題を修正しました。
- URLマップでコンテナに menu\_type がパネル以外のモデルも指定できるようになりました。
- エディタへの画像挿入時に代替テキスト欄にアルファベットの「T」が入力できない問題を修正しました。

## 2020\-04\-21

version 2\.10

- プラグイン「SimplifiedJapanese」を追加しました。やさしい日本語の作成を支援する機能を提供します。
- プラグイン「LinkChecker」を追加しました。管理画面からのリンクチェック、定期バッチ処理でのリンクチェック機能を提供します。
- プラグイン「NuHtmlChecker」を追加しました。W3Cのサービスを利用して HTMLの構文チェックを行います。
- プラグイン「UploadUtilities」を追加しました。アセットのアップロード機能を拡張します。Multiライセンス以上に無償バンドルされます。
- プラグイン「EmailMagazine」を追加しました。メールマガジンの管理と配信を行います。Unlimitedライセンスに無償バンドルされます。
- ファンクションタグ「mt:trans」、グローバルモディファイア「language」で、システムやユーザーの言語設定と異なる言語への翻訳がされない問題を修正しました。
- URLマップの作成・編集画面に選択されたビューの編集画面へのリンクを追加しました。
- 環境変数「script\_uri」を追加しました。管理画面の URLを明示的に指定したい時、変更する時に指定してください。
- 管理画面のシステム設定画面にライセンスコードを入力いただくようにしました。ライセンス種別によってアップデートの案内が異なるので、入力をお願いします。
- 「ステータス対応」が有効かつ「有効期限対応」が無効な場合に status カラムの設定が変更出来ない問題を修正しました。
- ロックアウトしたアカウントでログインすると500エラーとなる問題を修正しました。
- プラグイン「CacheManager」でユーザー権限のキャッシュをクリアできるようにしました。
- プラグインの \_\_construct メソッドが複数呼ばれるケースを修正しました。
- リッチテキストエディタに横スクロールバーが出るケースを修正しました。
- リッチテキストエディタで特殊キーを押下しながらのボタンクリックを検知できるようになりました。
- リッチテキストエディタへのアセットの貼付け時に「pre\_insert\_asset」コールバックを追加しました。
- ワークフロー設定のあるオブジェクトの「user\_id」カラムの値が空の時エラーログが残る問題を修正しました。
- データベースに「blob2file」指定のある時「remove\_multi」メソッドの実行に失敗するケースを修正しました。
- リッチテキストエディタにプラグインによってボタンを追加できるようにしました。
- ダイアログのヘッダーに変数「html\_head」の出力を追加しました。
- ダイアログのフッターに変数「html\_body\_footer」の出力を追加しました。
- 「ビュー」モデルにカラム「last\_compiled」を追加しました。
- 「worker\_upgrade\_functions」の仕組みを追加しました。
- プラグイン「CacheManager」でコンパイル済みビューをクリアした時にコンパイルキャッシュが壊れるケースを修正しました。
- 管理画面の h1要素にid="page\-title"を追加しました。
- Websiteテーマのサイドバーのカテゴリリストがスペースをまたがって表示される問題を修正しました。
- オブジェクトをループ出力するタグに id指定のある時、スコープでフィルタリングしないようにしました。
- WebsiteテーマのトップページのビューとURLマップ名を統一しました。
- 承認依頼、承認\(公開\)、差し戻し操作をログに保存するようにしました。
- created\_by カラムのフィルタタイプを数値からリファレンスに変更しました。
- カラムに NOT NULL属性を追加指定した時、既存カラムに初期値をセットするようにしました。
- 代替テンプレートについてパスの長いものを優先するようにしました。
- プラグイン「Members」でサインアップ時と退会時にシステムログを保存するようにしました。
- ログのカテゴリで「insert」と「update」を区別するようにしました。
- post\_saveコールバックに直前に保存した logオブジェクトを渡すようにしました。
- インストール時にカラムの表示順の数値を10刻みの値にするようにしました。
- モデルのステータスの選択項目がスキーマ保存時に初期化されてしまう問題を修正しました。
- URLマップのファイル出力設定が「オンデマンド」の時にファイルが出力されないケースを修正しました。
- プラグイン設定保存時にエラーが発生した時、値を引き継げるようにしました。
- PTUtilクラスにメソッド「convert2abs」を追加しました。
- バリデーション処理で、ひらがなの正規表現に「ーむ」、カタカナに「ー」を追加しました。
- メンバーのサインアップ処理で「\_type」パラメタを空にして POSTすることで確認画面から入力画面に戻せるようになりました。
- 同一モデルで2つのURLマップがある場合に2つとも優先にチェックが付いてしまうケースを修正しました。
- Prototypeクラスのメソッド「load\_related\_objs」「load\_context\_objs」で「ignore\_filter」を指定可能になりました。
- ブロックタグ「mt:referencedobjects」でオブジェクトが取得できない時処理をスキップするようにしました。
- PTPublisherクラスで削除済みオブジェクトに対する再構築処理をスキップするようにしました。

## 2020\-03\-30

version 2\.018

- 管理画面でオブジェクトを保存する際にカラムごとのバリデーションを設定できるようになりました。
- テキスト型のカラムについて、文字数の制限を指定できるようになりました。
- 数値型のカラムについて最小値、最大値を指定できるようになりました。
- ブロックタグ「sethashvar」を追加しました。キー変数名と値のペアをまとめてハッシュ変数に設定するためのブロックタグです。
- Amazon Linux2への HyperEstraierのインストール手順をまとめた「Install\-for\-AmazonLinux2\.docx」を追加しました。
- 条件タグ「mt:ifacceptcomment」を追加しました。現在のコンテキストのオブジェクトがコメントを受け付けるかどうかを判別します。
- pt\-members\.php にプラグインでメソッドを追加できるようになりました。
- プラグインで追加するメソッドでアプリケーション idを指定可能になりました。
- ブロックタグ「mt:grouploop」でグループに属するアイテムが 0件でもループが回る問題を修正しました。
- ファンクションタグ「mt:var」で、value属性を指定しても変数にセットされない問題を修正しました。
- カラム名にモデル名を含む時、カラムが削除できない問題を修正しました。
- モデル名を含むカラムを保存するとき冒頭にモデル名が追加されない問題を修正しました。
- alt\-tmplで setvartemplateを利用しているときにキャッシュがおかしくなる問題を修正しました。
- tools/rebuildFiles\.phpで、システムのビューを再構築する時にスペースのコンテキストが残る問題を修正しました。
- ブロックタグ「mt:nestableobject」でステータスによるフィルタリングが効かない問題を修正しました。
- オブジェクトのパーマリンクが変更される前に画面遷移することがあるため、オブジェクトが保存された時、パーマリンクを非同期に取得するようにしました。
- 公開以外のステータスでのオブジェクトの保存時にパーマリンクが更新されないことがあるケースに対する修正をしました。
- プラグイン「MTMLReference」でブロックタグ「mt:loop」のドキュメントから offset, limitを削除しました。
- モデル「タグ」の作成・編集画面でクラスをスコープに応じて出し分けるようにしました。
- 一覧画面もしくはダイナミック・パブリッシングでの条件指定検索の時、リレーションのフィルタリングで異なるスコープのオブジェクトを対象外とするようにしました。
- pt\-members\.php で、該当のスコープのビューが反映されない問題を修正しました。
- プラグインに「pre\_save\_plugin\_config」メソッドがある時、config\.jsonにコールバックの指定がないときも自動的に実行するようにしました。
- コメント通知でビューのカラム「subject」が空の時、デフォルトの件名をセットするようにしました。
- urlmapping削除時に優先の付替えが行われない問題を修正しました。
- オブジェクトをループするブロックタグの「post\_load\_objects」コールバックに args\(タグ属性の配列\)を追加しました。
- user モデルに workspace\_id カラムがある時、スペースを削除すると全てのユーザーが削除される問題を修正しました。
- オブジェクトをループするブロックタグで「ids」属性を渡した時、配列が空の時はループを出力しないようにしました。
- メンバーのサインアップ確認画面/プロフィール編集でファイル名が出ない問題を修正しました。
- メンバーのサインアップ/プロフィール編集画面でリレーションの階層表示でオブジェクトが出ない問題を修正しました。
- pt\-membersが送信するメール中の URLに languageパラメタを追加するようにしました。
- プラグイン「Members」で、パラメタ「language」指定がある時、動的ページの言語をその言語にセットするようにしました。
- query\_cacheが有効の時、管理画面から追加した blobカラムを get\_blob\_colsメソッドで認識できない問題を修正しました。
- オブジェクトをループするブロックタグでコンテキストがセットされている時、関連付けの設定がない時はコンテキストを無視するようにしました。
- \{\{〜\}\}形式のタグ記述で閉じタグの/が外れる問題を修正しました。
- PTPluginクラスに set\_languageメソッドを追加しました。
- グループの一覧のラベル「ステータス」を「アーカイブに名称変更しました。
- プラグインのアップグレード時にアップグレードされていないプラグインのログが残る問題を修正しました。
- 管理画面でユーザーの言語が優先されない問題を修正しました。
- モデルにカラム「type」のある時リレーションの編集画面でカラムタイプが取得できなくなる問題を修正しました。
- スコープの言語が英語の時一部のメニューが翻訳されない問題を修正しました。
- プラグイン「Members」で、会員サイトでメンバーの言語がセットされない問題を修正しました。
- アセットに繰り返しファイルをアップすると、データが空の sessionレコードができてファイルがアップロードできない問題を修正しました。
- 連続した&lt;&lt;、&gt;&gt;でビュー\(テンプレート\)が壊れる問題を修正しました。
- 日付アーカイブが削除されるときにコールバックが呼ばれない問題を修正しました。
- プラグイン「SearchEstraier」で日付アーカイブを検索対象にした時、文書のタイトルがおかしくなる問題を修正しました。
- プラグイン「SearchEstraier」でオブジェクトの削除時に特定条件でインデックスが削除されない問題を修正しました。
- プラグイン「SearchEstraier」で環境変数「searchestraier\_force\_mecab」指定のある時、強制的に形態素解析を利用し「東京都」と「京都」を区別できるようになります。
- プラグイン「SearchEstraier」が文書ドラフトを作成する時に呼ばれるコールバック「get\_draft」を追加しました。
- プラグイン「SearchEstraier」にて環境変数「searchestraier\_extract」を追加しました。指定値が「auto」以外の時、HTML文書全体をインデックスの対象にします。
- プラグイン「SearchEstraier」が生成する文書ドラフトで、cdate がフォーマットされない問題を修正しました。
- オブジェクトの削除の際に start\_publishコールバックが呼ばれない問題を修正しました。
- プラグインの locale/配下の CSVの空行を無視するようにしましたｌ．
- mt:objectvar タグでパスワード型のデータを除外し、権限のチェックを追加しました。
- パスワード再設定時のページ遷移先をパラメタ「return\_url」で指定できるようになりました。
- 添付ファイルの一覧画面に新規作成ボタンが表示されないようにしました。
- バイナリ型のカラムに画像を添付した時、サムネイルが正方形にならない問題を修正しました。
- 添付ファイルが CSVエクスポートでエクスポートできない問題を修正しました。
- インポート時に CSVに添付ファイル欄があって、値が空の時にエラーとなる問題を修正しました。
- 特定の条件下で urlinfoオブジェクトが生成されない問題を修正しました。
- 再構築トリガーの「同一スコープのみを対象とする」設定が無視される問題を修正しました。
- ファイル名を rawurlencode する際に、マルチバイト文字のみを対象とするようにしました。
- PTPublisher の publishメソッドで重複 URLを整理する際に、厳密に同一かどうかをチェックするようにしました。
- オブジェクトをループするブロックタグで、offset指定あり、limit指定のない時に offsetが無視される問題を修正しました。
- フォームの添付ファイルが保存されない問題を修正しました。
- publish\_callbacksに $ctxを渡すようにしました。
- ダイナミック・パブリッシングの404ページでスペースが正しく判別されないケースを修正しました。
- ブロックタグ「mt:for」で、increment、decrement属性が正しく作用しない問題を修正しました。
- ビューのプレビュー処理で、ビューが変更されていない時はコンパイルチェックをスキップするようにしました。
- "Overwrite files with the same path"の翻訳漏れを修正しました。
- セッションのクリーンアップ時に紐付いた一時ファイルを削除するようにしました。
- プラグイン「Members」で、delete\_flag付きのメンバーがログインできる問題を修正しました。
- 環境変数「debug」\(デバッグモード\)指定のある時、プラグインの taskの frequencyを無視するようにしました。
- ブロックタグ「mt:membercontext」内でsetvarした値が、ブロックの外で参照できない問題を修正しました。
- 定期実行タスクの実行時に意図せず「basename」の値が変更されてしいまうケースを修正しました。
- 設問用のカスタムバリデーションに force オプションを追加しました。
- プレビューで添付ファイルのコンテキストがセットされない問題を修正しました。
- プラグイン「Members」で、「start\_recover」テンプレートをカスタマイズできるようになりました。
- モデルのリレーションの対象カラムではバイナリ型のカラムを選択できないようにしました。
- モデルの編集画面でモデルのカラム一覧を Ajaxリクエストで取得する部分で、GETリクエストに対するパラメタ magic\_token を削除しました。
- 年度別アーカイブの再構築時に post\_rebuildコールバックの$cb['urlmapping']が空になる問題を修正しました。
- 存在しない id のURLオブジェクトの編集画面が表示できる問題を修正しました。
- ユーザー/メンバーのカラム photo、スペースのカラム imageの設定が誤っていて、画像が保存できなかった問題を修正しました。
- PTWorkerクラスに executedプロパティを追加しました。work メソッドに対応するプラグインなどで、どのタスクが実行済かの判断が可能になります。
- プラグイン「Mirroring」で、除外条件にマッチすると残りの処理がスキップされる問題を修正しました。
- urlinfo モデルの mime\_type に「application/vnd\.openxmlformats\-officedocument\.spreadsheetml\.sheet」などの値が収まらないためカラム長を255文字に変更し、アップグレード処理で正しい値をセットするようにしました。
- 異なるモデルにタグが存在するとき、別のモデルのタグが保存できない問題を修正しました。
- &lt;mt:var name=&quot;x&quot; key=&quot;y&quot;&gt; / &lt;mt:gethashvar name=&quot;x.y&quot;&gt; / &lt;mt:gethashvar name=&quot;x&quot; index=&quot;y&quot;&gt; がいずれも同じ結果を出力するようにしました。
- ステータスが公開でなくなったときにサムネイルを削除するようにしました。
- バイナリファイルのファイル出力コールバックを追加しました。
- プラグイン「CacheManager」で Mamcachedを指定しているとき表示が正しくなくなるケースがある問題を修正しました。

## 2020\-03\-09

version 2\.016

- 環境変数「asset\_overwrite」を追加しました。指定のある時、アセットのアップロードで同一パスのファイルを上書きすることが可能になります。
- 編集画面でリレーションのフィルタを指定してダイアログを開いた時、フィルタを変更できない問題を修正しました。
- ファイルアップロード時にマルチバイト文字を含まないファイル名をURLエンコードしないようにしました。
- モデル「ユーザー」「メンバー」「スペース」に画像が添付できない問題を修正しました。
- ブロックタグ「sethashvar」を追加しました。キー(変数名)と値のペアをまとめてハッシュ変数に設定します。
- 異なるモデルに登録されているタグが他のモデル指定で保存できない問題を修正しました。
- リレーションの一覧・編集表示でリレーションやバイナリファイル型のカラムを指定できないようにしました。
- プラグイン「Mirroring」で、除外条件にマッチしたとき、以降のファイルに対する処理がスキップされてしまう問題を修正しました。
- スコープ毎の設定画面で、document\_root を設定できるようになりました。
- URLマップのファイル出力が「オンデマンド」または「キュー」の時に再構築トリガーが指定できない問題を修正しました。
- プラグイン「Members」で、会員が退会処理をした後の遷移先 URLを「return\_url」パラメタで指定できるようになりました。
- フォーマット「改行を変換」の処理のロジックを変更しました。
- ブロックタグ「mt:estraiersearch」の sort\_order 属性に「STRA\(文字列の昇順\)」「STRD\(文字列の降順\)」「NUMA\(数値/日付の昇順\)」「NUMD\(数値/日付の降順\)」を指定可能になりました。
- ベースネームの重複を許可する設定が有効なモデルで、新規オブジェクトの保存時に重複URLのチェックが走らない問題を修正しました。
- ブロックタグ「mt:queries」の中で正しく値が出ていなかった問題を修正しました。
- フォームやコメントの formがダイナミック・パブリッシングで表示されている時、magic\_token がデフォルトではセットされないようにしました。
- URLマップのファイル出力が「再構築\(遅延\)」の時、古いurlinfoが削除されない問題を修正しました。
- URLマップのファイル出力が「再構築\(遅延\)」の時、コメント投稿時などに再構築が反映されない問題を修正しました。
- プラグイン「SearchEstraier」のブロックタグ「mt:estraiersearch」に渡す追加コンディションのルールを統一しました。
- URLマップ作成時のファイル出力の既定値を「1\(静的\)」にしました。環境変数「publish\_file」で変更可能です。
- プラグイン「SearchEstraier」のタスクで動的ページなどがインデックス対象にならない問題を修正しました。
- 環境変数「check\_int\_null」指定のある時、階層付きモデルの保存ができない問題を修正しました。
- 条件タグ「mt:if」に tag属性指定と name属性指定がある時に正しく動作しない問題を修正しました。
- 管理画面上で、リレーションを選択する UIの関連モデルの表示順を指定する環境変数「モデル名\_カラム名\_sort\_order」「モデル名\_カラム名\_sort\_by」を追加しました。
- pt\-check\.php に GDの JPEG Support / PNG Supportチェックを追加しました。
- モデル「column」の optionsカラムのカラム長制限を撤廃しました。
- 削除済のアセットと同名のファイルをアップロードした時、連番が付与される問題を修正しました。
- URLマップの設定によって、プレビュー時に適切な mime\_typeを取得できない問題を修正しました。
- ファイル名にスペースを含む時、スペースが rawurlencodeされる問題を修正しました。
- 環境変数「no\_genarate\_basename」を追加しました。対象のモデルを配列で指定します。指定のある時、そのモデルのbasenameカラムの値を自動生成しません。
- アセットのアップロードで、不正な拡張子のファイルをアップした後に正常なファイルを上げても画面遷移しない問題を修正しました。
- ブロックタグ「mt:archivelist」で、urlmapping属性を与えることで、モデル+日別アーカイブの一覧を取得できるようになりました。
- アーカイブの設定を静的からダイナミックに変更した時に空のディレクトリが残る問題を修正しました。
- モデル+日別アーカイブが URL一覧画面で正しく翻訳されるようになりました。
- URLオブジェクトの一覧画面に「archive\_date」カラムを追加しました。
- 再構築時に URLオブジェクトの「archive\_date」カラムがセットされない問題を修正しました。
- モデルの編集画面で、同名のカラムを複数登録できてしまう問題を修正しました。
- プラグイン「Members」のサインアップ画面で、数値型、テキストエリア、単一リレーション型のカラムに対応しました。
- 管理画面からオブジェクトを保存する処理で、トランザクションのコミット直前に「before\_save」コールバックを追加しました。
- ブロックタグ「mt:referencedobjects」が sort\_by, sort\_order属性指定をサポートしました。
- プラグイン「Mirroring」の設定で2つめ以降のステージングのパスが無視される問題を修正しました。
- スペースの数が多い時、スペース選択ダイアログが管理者以外で権限エラーになる問題を修正しました。
- Mirroringプラグインの設定で、隠しファイルの除外設定をオフにした時同期に失敗する問題を修正しました。
- ビューに構文エラーがあった時、プレビュー画面でエラー結果をフィードバックするようにしました。
- 一部の「日付と時刻」型のカラムに formatモディファイアが効かない問題を修正しました。
- ブロックタグ「mt:workspaces」でスペースのコンテキストをセットするようにしました。
- グローバルモディファイア「sanitize」を追加しました。値に対して、HTMLの除去フィルターを適用します。
- Membersプラグインが提供する Webアプリの画面のヘッダ・フッタなどが常にシステムのものとなる問題を修正しました。
- 標準テーマの「\.htaccess」に全角ダブルコーテーションが含まれていた問題を修正しました。
- meta\_object\_idに該当する削除済みオブジェクトのメタデータがあった時 HTMLインポートに失敗する問題を修正しました。
- リビジョン一覧で画面オプションを更新するとカラム設定がリセットされる問題を修正しました。
- リビジョン選択画面では「リビジョンの管理」ボタンを非表示にしました。
- リビジョン用の変更メモを入力するとその後常に表示されてしまう問題を修正しました。
- 権限の画面オプションで「スペース」を非表示にしました。
- リビジョン一覧から複製・リビジョン作成・パーマリンクアイコンを削除しました。
- クラス「PAML」の buil\_pageメソッドでキャッシュが効いている時、引数に渡された変数の配列がに格納されない問題を修正しました。
- プラグイン「TinyMCE」で convert\_urlsの設定を追加しました。
- キューに対する処理がエラーとなった時、キューを残し指定回数リトライ処理を行うようにしました。
- 環境変数「force\_compile」 trueの時 worker\.php がエラーで終了する問題を修正しました。
- モデル「queue\(キュー\)」にmodel, object\_idカラムを追加しました。
- current\_contextがない時 aliasタグの値が出ない問題を修正しました。
- リッチテキスト切り替えの select要素にラベルを追加しました。
- メンバーにオプトインカラムを追加し、新規サインアップ時に規約とプライバシーポリシーに同意チェックボックスを追加しました。
- 環境変数「members\_require\_agreement」に falseを指定すると規約とプライバシーポリシーへの同意チェックを省略できます。
- プラグイン一覧画面でプラグイン名を翻訳しないようにしました。
- 環境を初期化して新規インストールする時にエラーログが記録される問題を修正しました。
- hook「start\_app」内で $app->redirect() を実行すると Fatal error: Out of memory …となる問題を修正しました。
- ZIPアーカイブ生成に失敗した時にコマンドを用いてリトライするようにしました。
- PTPublisher クラスで変数の初期化によるフォームなどの処理に関する不具合を修正しました。

## 2020\-02\-03

version 2\.015

- \[セキュリティ・アップデート\] アセットのアップロード・パスに不正な文字列を渡すことでサイト・パス以外の場所にファイルをアップロードできてしまう問題を修正しました。
- 変数のキーに大文字を含む時、小文字の変数が同時に登録されてしまう問題を修正しました。
- 環境変数「validate\_url」を追加しました。ダイナミック・パブリッシングで異なるスペースに該当のルート相対パスのURLがある時に、本来存在しないページのデータが出力されるケースで trueを設定いてください。
- プラグイン「SearchEstraier」の pt\-recommend\-api\.phpのレスポンスにある日時のタイムゾーン指定が正しくない問題を修正しました。
- DataMigrator プラグインで import ディレクトリに設置したファイルを選択可能になりました。
- グローバル・モディファイア「array\_pop」の戻り値が正しく返らない問題を修正しました。
- ブロックタグ「mt:countgroupby」がステータスやリビジョンを考慮していなかった問題を修正しました。
- ファンクションタグ「mt:assetthumbnail」が force属性に対応しました。指定した値が画像のサイズより大きいときも指定したサイズのサムネイルを作成します。
- フォームに添付ファイルを追加した時、通知メールのメールヘッダが正しくならない問題を修正しました。

## 2020\-01\-22

version 2\.014

- エディタへの画像・ファイルの挿入で、画像・アイコンクリックでファイルを別ウィンドウで開けるようにしました。
- グローバルモディファイア「array\_unique」を追加しました。
- 環境変数「modifier\_funcs」を追加しました。モディファイア名と PHPの関数名をハッシュ配列で指定することグローバルモディファイアを追加できます。
- ファンクションタグ「mt:date」に unixtime 属性が追加されました。
- 複数ファイルアップロード画面でアップロード・パスの履歴を利用可能になりました。
- リレーション選択からオブジェクトを作成・編集した時に一覧のフィルタが解除される問題を修正しました。
- リレーション選択時に「すべてを選択」チェックボックスが利用できるようになりました。
- 一覧画面に limit=-1 パラメタを渡すことで全件表示できるようにしました。
- プラグイン「SearchEstraier」の pt\-recommend-api\.php に workspace\_id パラメタを渡せるようにしました。
- プラグイン「SearchEstraier」で動的ページがインデックスされない問題を修正しました。
- スペースの言語設定対象の辞書の初期化処理を追加しました。
- 複数ファイルアップロード画面にスペースのアセット・パスが反映されない問題を修正しました。
- ステータス下書きの画像をエディタに貼れない問題を修正しました。
- [ユーザー変更時に通知]が有効なワークフローで公開後にオブジェクトを保存すると[正しいメールアドレスを指定してください。]エラーとなる問題を修正しました。
- 添付ファイルのダイレクト修正後ダイアログが閉じない問題を修正しました。
- 画像の挿入画面に「オリジナルへリンク」オプションを追加しました。
- スペースでの一覧画面でステータスをクリックすると&workspace\_id=n パラメタが外れてしまう問題を修正しました。
- テーマ適用時に template\_compiled がおかしくなるケースを修正しました。
- PTUtil::send\_mail メソッドの引数 $to が配列で渡された場合にエラーとなる問題を修正しました。
- インストール時にサイト・パスの末尾の「/」を削除するようにしました。
- システムレベルのオブジェクトにスペースのオブジェクトに対するコンテナを指定している時、コンテナを更新した時システムのURLマップがロードされない問題を修正しました。
- プラグイン「DisplayOptions」で編集画面のオプションを非表示にした時にカラムの表示順が反映されない問題を修正しました。
- アクティビティダッシュボードで1月の後に12月が来る問題を修正しました。
- 単一オブジェクトのリビジョンのページ送りができない問題を修正しました。
- JSONファイルによりモデルを追加した時、default\_models がリセットされる問題を修正しました。
- 動的ページで不要なリストフィルタがロードされていた処理をスキップするようにしました。
- 画面オプションを有効、カスタマイズにチェックがない場合、編集画面でjQueryでエラーとなる問題を修正しました。
- 日付アーカイブのスコープ判別処理を修正しました。
- 日付アーカイブ対象のオブジェクトのフィルタリングが正しくされないケースを修正しました。
- 年度別アーカイブが1月スタートの時正しく出力されない問題を修正しました。
- 日別アーカイブが再構築で出力されない問題を修正しました。
- 添付ファイル(複数)を削除した時にリビジョンが作成されず、ログのメタデータも記録されない問題を修正しました。
- Job / Queue 機能を追加しました。
- 環境変数「develop」が falseの時、モデルの編集画面で自動監査のチェックが外れる問題を修正しました。
- ALTER TABLE 時にエラーがあった時、画面にエラーをフィードバックするようにしました。
- NOT NULL指定のカラムに値のない時のField 'カラム名' doesn't have a default valueエラーが出る問題を修正しました。
- ヘッダのメニュー数が多い時にドロップダウンメニューをスクロール可能にしました。
- スコープの異なるフィールドが混じって表示される問題を修正しました。
- ワークフローの差し戻しユーザーが自分になるケースを修正しました。
- リダイレクト処理を重複して実行されないようにしました。
- PTUtil::send\_mail メソッドの第6引数に callback 配列を渡せるようにしました。
- mail\_filterコールバックを追加しました。
- 削除済み URLの削除フラグが消えるケースに対する修正を行いました。
- URLのフィルタで削除済のものが出ない問題を修正しました。
- バイナリカラムに対する再アップロード時に拡張子変更時の重複URLが生成される問題を修正しました。
- テンプレート・タグと「,」の組み合わせでフォームのメールアドレスがエラーになる問題を修正しました。
- オブジェクトが非公開時、バイナリカラムに添付したファイルの拡張子変更がURLに反映されない問題を修正しました。
- デフォルトリビジョン数を 20に設定しました。
- モデルにリビジョン対応にチェックのある時、自動監査にチェックが入るようにしました。
- プラグイン「SiteMap」のファイル名 truncate の文字数を 14文字から24文字に変更しました。
- プラグイン「ExternalPreview」でオブジェクトに添付されている添付ファイルを見られるようにしました。
- プラグイン「ExternalPreview」でオブジェクトのバイナリカラムに添付されているファイルを見られるようにしました。
- 環境変数「add\_perms\_for\_user」でユーザー作成権限をロールに追加できるようにしました。
- プラグイン「Abs2Rel」で、// から始まる外部ドメインの URL を置換対象から除外するようにしました。
- プラグイン管理者権限のあるユーザーがスキーマアップグレードをできるようにしました。
- permissison 指定なし、condition のみでメニューの表示制御を可能にしました。
- バージョンアップ・スキーマアップグレード時にログを残すようにしました。
- config\.jsonがない時、configure\_from\_json をスキップするようにしました。
- ファイルがパブリッシュされていないときCSVエクスポートで添付ファイルがエクスポートされない問題を修正しました。
- プラグイン「HTMLImporter」でコメント・タグがタイトルに入る問題を修正しました。
- ログ\(query\_string\)などからpasswordとmagic\_tokenを除外するようにしました。

## 2019\-12\-11

version 2\.010

- プラグイン「MTMLReference」を追加しました。管理画面でテンプレート・タグリファレンスを参照・検索できます。
- プラグイン「SearchEstraier」でインデックスに含めるメタタグを指定可能になりました。
- プラグイン「SearchEstraier」に環境変数「searchestraier\_force\_ngram」を追加し、ブロックタグ「mt:estraiersearch」タグに「ngram」属性を追加できるようになりました。
- スコープの設定に「リンクURL」を追加し、管理画面からの「ページを見る」リンクをカスタマイズできるようにしました。
- PHP7\.4 向けに「preload\.php」を追加しました。
- ブロックタグ「mt:\(model名\)+tags」に「include\_private」属性を追加しました。
- スコープごとの設定で「ファイルを出力」にチェックのない時サムネイルを出力しないようにしました。
- ファンクションタグ「mt:assetthumbnailurl」タグで widthもしくはheightが空もしくは0指定でエラーになる問題を修正しました。
- ブロックタグ「mt:estraiersearch」タグで属性「add\_conditions」が有効にならない問題を修正しました。
- ファンクションタグ「mt:columnproperty」タグがテーブルを特定せずに値を読み込む問題を修正しました。
- リレーションの選択ダイアログ内でキーワード検索してからオブジェクトを選択した時、追加オブジェクト以外のリレーションが外れる問題を修正しました。
- プラグイン「HTMLImporter」で抽出条件で「XPath」指定時に「substring\-after」などの条件指定時に値が取得できない問題を修正しました。
- PHP7\.4 で 一部の処理で warnings が出ていた問題を修正しました。
- Windows 環境で文字コード UTF\-8 のCSV/テーマのインポートに失敗する問題を修正しました。
- theme\.jsonに「publish\_theme」を指定可能になりました。「false」を指定するとテーマの適用時に再構築処理を行いません。
- プラグイン「BannedWords」で「タグ」の置換設定をしても置換されない問題を修正しました。
- PADOクラスの「get\_by\_key」メソッドで'BINARY'=>'value'や配列を指定した時に値がセットされない問題を修正しました。
- URLマップのファイル出力「静的 \(遅延\)」を選択した時、再構築トリガーのチェックボックスが表示されない問題を修正しました。
- フィールドデータをテーマに含められるようになりました。
- プラグイン「BatchApproval」でオブジェクトの user\_id のユーザーが削除済だった時にエラーになる問題を修正しました。
- ワークフロー機能で承認依頼済みのオブジェクトの公開時に承認依頼者へメールが飛ばない問題を修正しました。
- プラグイン「LivePreview」で、ログアウト時にクッキーをクリアするようにしました。
- ログイン・ログアウト処理に対応するコールバックを追加しました。
- 「take\_down」フックを追加しました。
- ダイナミック・パブリッシングで、一旦非公開したものを再公開した時に削除フラグが外れない問題を修正しました。
- 新規オブジェクトの作成時に「perlmalink」が作成されないケースに対する修正をしました。
- 一覧画面でフィルタを連続して適用すると正しくフィルタされない問題を修正しました。
- 環境変数「cache\_driver」が「Memcached」の時、プラグインの localeが更新されない問題を修正しました。
- 環境変数「cache\_driver」が「Memcached」の時にコンパイルキャッシュディレクトリがセットされない問題を修正しました。
- temp\_dirの古いディレクトリを定期実行タスクでクリーンアップするようにしました。
- 画像の編集機能で画像を回転させた時に Canvasにフィットさせるようにしました。
- 添付ファイルの削除にチェックを入れた後にファイルを再アップロードした時に削除のチェックが外れない問題を修正しました。
- ログインユーザーが下書きページを見る時、正しいURLのみ見せるようにし、変更されたURLではページを見られないようにしました。
- 同一アーカイブに複数のURLがある時 get\_permalinkが正しい値を返さないことがあるケースを修正しました。
- 重複URLを定期実行タスクでクリーンアップするようにしました。
- 管理画面のサムネイル表示について、透過画像用に格子模様の背景画像を指定するようにしました。
- Prototypeクラスの「build\_path\_with\_map」処理後にコンテキストをリセットするようにしました。
- Internet Explorer で一部のチェックボックスがチェックできない問題を修正しました。
- テーマに対する権限をインポート+ビューの公開+URLマップの作成権限のAND条件に変更しました。
- 環境変数「allow\_static」で閲覧可能対象とする拡張子について環境変数「denied\_exts」に沿ってブラックリストでチェックするようにしました。
- アセットオブジェクトに対して同名ファイルをアップロードした時にリネームするようにしました。
- 環境変数「remove4byte」を追加しました。データベースが4バイト文字を扱えない時、リクエストの値からから4バイト文字を削除し、アップロードファイル名では4バイト文字を rawurlencodeします。

## 2019\-11\-22

version 2\.000

- version 番号を変更しました。

### アップグレード方法

- データベースとアプリケーションファイルのバックアップを作成します。「tools/backupSQL\.php」を利用することができます。
- PrivateTmp が有効な環境では、worker\.php実行時のキャッシュのクリアがうまく行かない時があります。その場合は、環境変数「temp\_dir」に、/tmp以外のパスを指定してください
- ファイルを差し替えまたは上書きします。
- 管理画面にログインして、スキーマの管理画面に移動します。
- 大量のオブジェクトが登録されているモデルについては個別に、そうでないものについてはチェックを一括で入れてスキーマのアップグレードを行います。
- 以上でアップグレードは完了です。

### 一部の新機能の有効化について

- 並列再構築を有効化するには環境設定ファイルで「rebuild\_async」を「true」にし、「async\_max\_proc」にコア数またはコア数*nの値を指定します\(初期値は4\)。
- データベースのクエリキャッシュを有効化するには、「cache\_driver」に "File"「query\_cache」を trueとするか、または「cache\_driver」に"Memcached"、「query\_cache」に"Memcached"を指定します。
- 一覧画面からのリビジョン作成を有効化するには、「allow\_revision\_in\_list」または「allow\_revision\_in\_list\_モデル名」を指定してください。
- コメント機能を有効にするには環境変数「use\_comment」を trueに設定して、各スコープの設定画面で「コメントを許可」にチェックを入れてください。
- コメントを利用するためのモジュールは新しい Websiteテーマに含まれています。

### 互換性について

- 一覧画面からのアセットのアップロード機能では、ユーザーの権限に関わらずモデルのステータス初期値となっていましたが、ver\.2ではユーザーの権限に応じたステータスとなります。
- オブジェクトの数をカウントするタグでは、タグを利用する箇所のコンテキストが反映されるようになります。
- オブジェクトの数をカウントするタグには、ignore\_archive\_context属性を追加することでコンテキストを無視します。指定できる値は「1」\(すべて\)、モデル名、「date\_based」のいずれかです。
- リレーションをループ出力するタグで、ループを抜けた後に最後に呼ばれた関連オブジェクトのコンテキストがクリアされない問題を修正しました。
- Protptypeクラスの build\_path\_with\_map メソッドで処理後にコンテキストをリセットするようにしました。
- 環境変数「upload\_compat」「tag\_count\_compat」「tag\_relations\_compat」「permalink\_compat」を trueに指定することで、それぞれ従来と同等の動作となります。
- テーマの管理についての権限は、これまでの「インポート」から「インポート」AND「ビューの有効化 \(公開\)」AND「URLマップの作成」権限を有するユーザーに変更されました。

## 2019\-11\-20

version 1\.208

- テーマの「(Website) HTML Header」にhead要素が重複していた問題を修正しました。
- 依存関係の再構築のうち、日付アーカイブが出力されない問題を修正しました。
- BOMを含むCSVファイルで、上書きインポートできない問題を修正しました。
- フィールドの値がプレビューに表示できない問題を修正しました。
- プラグイン「SearchEstraier」に「pre\_search\_estraier」コールバックを追加しました。第3引数に検索キーワード、第4引数にタグ属性の配列が格納されます。
- プレビュー時に階層付き関連オブジェクトの順序が正しくならない問題を修正しました。
- プレビュー時に、異なるコンテキストの時、バイナリ型ファイルのURLが意図通りに出ない問題を修正しました。
- 未保存のオブジェクトのプレビュー時に異なるバイナリファイルのURLを返す問題を修正しました。
- フィールドの値が保存時の再構築時に正しく反映されない問題を修正しました。
- 管理画面でダイナミック・タグを利用するオプションの環境変数「init\_tags」を追加しました。
- publish\_objメソッド内で、タグの初期化と workspaceのコンテキストセットを行うようにしました。
- プラグイン「DisplayOptions」で、除外条件が正しく反映されないケースを修正しました。
- バイナリ型のカラムにファイルを一度削除してから再アップした時、再構築でファイルの URLが出力されない問題を修正しました。

## 2019\-11\-18

version 1\.207

- 一覧画面からオブジェクトのリビジョンを作成できるようになりました。機能を有効化するには環境変数「allow\_revision\_in\_list」または「allow\_revision\_in\_list\_モデル名」を指定してください。
- フィールドデータのエクスポート&インポートに対応しました。
- worker\.php に \-\-verboseオプション\(進捗表示\)を追加しました。
- worker\.php で不要な依存関係のアーカイブが再構築される問題を修正しました。
- オブジェクト数をカウントするタグ\(例:mt:entriescount\)でコンテキストを正しくセットするようにしました。
- オブジェクト数をカウントするタグで、意図せず数字が変わる場合、環境変数「tag\_count\_compat」を指定することで以前と同じ振る舞いことで従来の値が取得できるようになります。
- オブジェクト数をカウントするタグに、タグ属性「ignore\_archive\_context」を指定できるようになりました。
- オブジェクト数をカウントするタグのタグ属性「ignore\_archive\_context」では、「1\(すべて\)」、「date\_based\(日付\)」またはコンテキストに指定されているモデル名を指定可能です。
- プラグイン「CacheManager」で大量のビューがある時にキャッシュクリア時にタイムアウトになる問題を修正しました。
- 条件タグ「mt:if」のtag属性指定での評価時に属性値を渡せるようになりました。
- 条件タグ「mt:if」のtest属性値の実行結果を eq, likeなどで比較できるようになりました。
- 管理画面テンプレートのタグの文法違反\(閉じタグの不足など\)を複数修正しました。
- オブジェクトの取得数がパラメタ limit の値で割り切れる時、ページネーションのサンプルコードが意図した表示にならない問題を修正しました。
- リビジョン一覧にステータスアイコンを追加しました。
- 一時ディレクトリ、空ディレクトリ削除処理を最後に移動しました。
- Websiteテーマに再構築トリガーの設定を追加しました。
- システムスコープの階層付きモデルの一覧で検索が効かない問題を修正しました。
- プラグイン「SearchEstraier」で、時限公開・差し替え処理を行ったページがリアルタイムにインデックスに反映されない問題を修正しました。
- プラグイン「SearchEstraier」で、ページを削除した時にリアルタイムにインデックスに反映されない問題を修正しました。
- プラグイン「ExclusionControl」の設定で、対象モデル「すべて」にチェックを入れて保存しても保存できない問題を修正しました。
- URLを物理削除した時、エディタで挿入したアセットのサムネイルを再生成できるようになりました。
- 同一モデルの json ファイルが複数設置されている時、標準モデルの jsonを 設定を優先するようにしました。
- バイナリ型のカラムがあるモデルで、basenameが意図せず変わる問題を修正しました。
- フォームで、「投稿をデータベースに保存しない」にチェックを入れている時に、システムログにエラーが残る問題を修正しました。
- ファンクションタグ「mt:math」で、四則演算\('%', '/', '+', '\-' , '\*'\)をサポートしました。
- ビューの編集画面で、条件タグの外で「mt:else」「mt:elseif」「mt:elseifgetvar」が利用されている時に警告を表示して、保存されないようにしました。
- ビューの編集画面で PHPコードに変換されたコンパイル済みコードの構文チェックを追加し、エラーの際には保存に失敗するようにしました。
- フォームからの管理者への通知メールでテンプレート変数が正しくセットされない問題を修正しました。
- プラグイン「SiteMap」で「添付ファイルを含む」が正しくフィルタされない問題を修正しました。
- プラグイン「BatchApproval」のメールの翻訳漏れを修正しました。
- フォームの保存時のメールアドレスのバリデーションを修正し、「名前&lt;address@example.com&gt;」形式のメールアドレスをサポートしました。
- 検索にヒットした件数が「limit」パラメタで割り切れる数字になる時、ページネーションのサンプルコードが意図した表示にならないのを修正しました。
- プラグイン「DisplayOptions」で、権限のないユーザーに対してメニューが表示される問題を修正しました。
- Chromeでワークフローのユーザー変更の表示が崩れる問題を修正しました。
- プラグイン「BatchApproval」でレビュワーが権限を超えてオブジェクトを公開できる問題を修正しました。
- コンパイルエラー時にはビューを保存できないようにしました。
- ビュー内に PHPコードが記述されている時、警告を表示するようにしました。
- チェックボックス、ラジオボタン、ドロップダウン、階層などでカラムの「変更不可」設定が有効にならない問題を修正しました。
- リビジョンの一覧で、自動保存と作成したリビジョンのフィルタを追加しました。
- バイナリ型ファイル\(任意\)の時、アップロード可能なファイルの拡張子を指定できるようにしました。
- モデルの「テンプレート・タグ」のチェックを変更した時に、ビューとURLマップを再コンパイルするようにしました。
- tools/test\.php を追加しました。テンプレート、PHPのコンパイルチェック、jsonのデコードチェックを行い、エラーを指摘します。

## 2019\-11\-06

version 1\.206

- 一覧画面からオブジェクトを削除する処理を分割して処理するようにして、オブジェクトが多い時にタイムアウトにならないようにしました。
- 一覧画面からのアクション、タグの追加・タグの削除、ステータス変更、プラグイン「BatchApproval」のワークフローについて、実行後の再構築処理を分割処理するようにしました。
- 一覧からのアクション完了時に処理件数を表示するようにしました。
- 環境変数「remove\_async」を追加しました。一覧画面からの削除処理について、関連オブジェクトの削除処理を非同期遅延・分割処理します\(初期値は true\)。
- テーマ適用時にCSVからインポートしたオブジェクトが他のスコープのオブジェクトとリレーション付けされる問題を修正しました。
- Websiteテーマ適用時にサイドバーの年度別アーカイブのリストが表示されない問題を修正しました。
- Windows環境で、正しい mime\_typeが取得できない問題を修正しました。
- 環境変数「publish\_nextprev」「モデル複数形\(小文字\)\_publish\_nextprev」を追加しました。オブジェクト更新時に前後のオブジェクトを再構築します。
- ORマッパ「PADO」のloadメソッドが、NOT INに対応しました。
- 一覧画面の画面オプションの検索項目を変更しても結果が変わらない問題を修正しました。
- 一覧画面の画面オプションの検索条件で、「AND」を選択して保存できない問題を修正しました。
- プラグイン「Abs2Rel」で 「HTMLコメント内を無視する」「BASE要素を変換しない」設定が共に有効な時、BASE要素がHTMLコメントに置き換わってしまう問題を修正しました。
- scheduled\_unpublishコールバックを追加しました。

## 2019\-11\-01

version 1\.205

- コメント機能を追加しました。コメント機能を有効にするには環境変数「use\_comment」を trueに設定して、各スコープの設定画面で「コメントを許可」にチェックを入れてください。
- プラグイン「Abs2Rel」でlink rel="canonical"を相対パス変換から除外するようにしました。
- 環境変数「fmgr\_delayed」を追加しました。ファイルの書き込みを遅延処理します。速度の遅いディスクでの体感処理速度を向上します。
- 環境変数「fmgr\_use\_tmp」を追加しました。初期値は trueで、ファイルの上書き時に一時ファイルを生成してから元ファイルと差し替えます。
- 環境変数「memory\_limit」を追加しました。PHPの memory\_limit に値をセットします。
- 環境変数「load\_monitoring」を追加しました。ピークメモリ、ロードアベレージ、リクエストの処理時間をログに記録します。
- 環境変数「assets\_c」「assets\_c\_path」を追加しました。指定のある時、一覧画面用のサムネイルを静的画像ファイルとして生成します。
- 「extra\_path」を予約カラム名に追加しました。extra\_pathカラムでは保存時に末尾に「/」が追加されます。
- プラグイン「CacheManager」にビューと URLマップの再コンパイル処理を追加しました。
- モデルが有効期限対応している場合しか Previous, Nextブロックタグが使用できない問題を修正しました。
- プラグイン「SearchEstraier」に環境変数「searchestraier\_content\_threshold」「searchestraier\_thumbnail\_min\_pixel」を追加しました。
- 一覧画面の画面オプションで時、タグを追加・削除した時に再構築画面が無限ループするケースがある問題を修正しました。
- パスワードのリセットメールに失敗した時にエラーメッセージを表示するようにしました。
- SELECT * の時のみ単一オブジェクトのキャッシュを保存するようにしました。あわせて、ビューのテンプレートを含まないキャッシュが利用されることで、再構築結果が空になる問題の対策をしました。
- PADOBaseModel クラスで、存在するカラムに対する has\_column が falseになるケースに対する修正を行いました。
- プラグイン「TinyMCE」の設定「tinymce\_relative\_urls」の初期値を「none」に変更しました。
- Windows環境で sys\_getloadavg がエラーになる問題を修正しました。
- Prototype クラスの translate メソッドで phrase に対して %エスケープするようにしました。
- テーマインポート時にリレーションが別スコープのオブジェクトと関連付いてしまう問題を修正しました。
- プラグイン「DisplayOptions」で、作成・編集画面の画面オプションに対する変更が許可されていない時、画面オプションボタンを非表示になるようにしました。
- プラグイン「DisplayOptions」で、除外権限のフィルタが正しく動作していなかった問題を修正しました。
- プラグイン「DisplayOptions」で追加カラムにデフォルトでチェックが付かないようにし、追加したカラムを編集カラムの末尾に表示するようにしました。
- プラグイン「BannedWords」で、禁止ワードを含むカラム名が翻訳されて表示されるようになりました。
- 17文字以上のバイナリ型カラムにファイルがアップロードできない問題を修正しました。
- MT形式、WordPress形式のファイルからのデータ移行時、同名のカテゴリが別スコープにある時カテゴリが生成されない問題を修正しました。
- 日付ベースアーカイブで ignore\_archive\_context 属性が効いていない問題を修正しました。
- 特定のフィルタを指定してダイアログを開いた時に、ダイアログのフィルタを固定化するようにしました。
- ビューの編集画面で、条件タグの外で「mt:else」「mt:elseif」が利用されている時に警告を表示するようにしました。
- ユーザーロックアウトされた後も、正しいパスワードを入力すると、ロックアウトされずにログインできる問題を修正しました。
- 長いテキストが格納されているフィールドの出力が255文字で切れる問題を修正しました。
- フィールドの値が編集画面でHTMLエスケープされない問題を修正しました。
- リッチテキスト型のフィールドの値が保存できない問題を修正しました。
- リビジョンの予約差し替えを実行すると、タグが重複してしまう問題を修正しました。
- ログの一覧画面で、filter\_log\_level が正しくフィルタされない問題を修正しました。
- 前後のオブジェクトを取得する Previous, Nextブロックタグが workspace単位の取得, LivePreview に対応しました。
- カラムタイプ変更時、既存のカラムに変換不可の値がある時にエラーを返すようにしました。
- テキスト型カラムのないモデルでは一覧画面の検索ボックスを非表示にするようにしました。
- 「SearchEstraier」プラグインで、全文検索実行時に全角半角を吸収するようにしました。
- 環境によって文字列「&」を含むGETパラメタが壊れる問題を修正しました。
- プラグイン「CookieUtilities」を追加しました。
- ブロックタグ「mt:referencedobjects」が1回しかループしない問題を修正しました。
- setvartemplate を利用するとブロックタグ「mt:nestableobjects」の予約変数 \_\_last\_\_がループ外でリセットされない問題を修正しました。
- ワークフローのユーザー選択ダイアログでフィルタ適用や検索実行時にパラメタが引き継がれるようにしました。
- ワークフローのユーザー選択ダイアログで ID による検索を行うと意図しないユーザーが表示される問題を修正しました。
- 編集画面に添付した画像が透過画像の時、loading 画像が表示されたままになっていた点を修正しました。
- 外部プレビュー有効期限の日付入力欄を大きくしました。
- 複数ファイルアップロード時のステータスをユーザーの権限に応じてセットするようになりました。環境変数「upload\_compat」を指定するとこれまでの振る舞いに戻ります。
- アセット選択ダイアログで削除権限のないユーザーがアセットを選択できない問題を修正しました。
- ファイルキャッシュを指定している時、キャシュディレクトリがない時にキャッシュが生成されない問題を修正しました。
- プラグインディレクトリに空のフォルダが存在する時、特定のプラグインが認識されない問題を修正しました。
- モデルの編集画面で、カラムのタイプが「テキスト\(50\)」の時、「選択項目」が選べない問題を修正しました。
- オブジェクトの編集画面で、not\_nullが反映されない問題を修正しました。
- ファンクションタグ「mt:mtime」を追加しました、file 又は module 属性を指定して、該当ファイル/モジュールの更新タイムスタンプを取得します。
- パスワードの検証が正しく動作しない\(パスワードの制約が有効にならない\)問題を修正しました。
- ワークフローのユーザ選択ダイアログでは「新しいユーザーリンク」「ユーザー詳細画面へのリンク」「複製リンク」を表示しないようにしました。
- ワークフローのユーザ選択ダイアログから画面オプション更新時にパラメタが引き継がれない問題を修正しました。
- CSVインポートで2行目以降がインポートできないケースを修正しました。
- ブロックタグ「mt:if」に tag 属性を指定した時の処理の負荷を低減し、高速化しました。
- 管理画面から新規タグが保存できない問題を修正しました。
- リレーションのロードの時 sort 指定カラムが SELECT文の対象外になり、エラーとなる問題を修正しました。
- URLの一覧からのリセットでエラーとなる問題を修正しました。
- CSVインポートでメタデータが空の時、関連付けを外すようにしました。
- オブジェクトをループ出力するブロックタグに ignore_filter 属性を追加できるようになりました。
- ブロックタグ「mt:speedmeter」に開始コメントを追加しました。
- ブロックタグ「mt:referencedobjects」\(リレーションの逆引き\)タグを追加しました。
- 一覧画面でステータスの公開以外 / 公開終了フィルタを追加しました。
- ログの一覧画面でログレベルを文字列表示するようにしました。
- リストフィルタのドロップダウンの幅を広くしました。
- 一覧画面で、リビジョンの検索に対応しました。
- テンプレートのコンテキストでオブジェクトのカウントが取れない問題を修正しました。
- プラグイン「SiteMap」で「サムネイルを含む」が正しくフィルタされない問題を修正しました。
- エディタにアセットを貼り付けたとき、リレーションエディタにIDが渡らない問題を修正しました。
- プラグイン「BannedWords」に Readmeを追加しました。
- db\-config\.php で「PADO\_DB\_CHARSET」\(デフォルトのキャラクターセット\)を指定可能になりました。

## 2019\-09\-28

version 1\.204

- プレビュー時 URLマップのない時 Content\-typeヘッダを省略するようにしました。
- テーマの \.htaccessを修正し、ダイナミック・パブリッシングでステータス404が返る問題を修正しました。
- オブジェクトがないモデルについては再構築のドロップダウンに出ないようにしました。
- pt\-check\.phpに OPcache のチェックを追加しました。
- ExternalPreviewリクエストを POSTリクエストに変更し、パスワード機能を追加しました。
- URLマップの編集画面でアーカイブ種別を変更した際に confirmメッセージの「キャンセル」を選択してもドロップダウンの値が変更される問題を修正しました。
- プラグイン「HTMLImporter」で title要素のセパレータが quoteされない問題を修正しました。
- フォームのメールアドレスにテンプレート・タグの指定を許可するようになりました。
- ダイナミック・パブリッシングでステータス404が返る問題を修正しました。
- 管理画面のコンパイルキャッシュが効かなくなっていた問題を修正しました。
- URLInfoを保存する際にエラーとなっていた問題を修正しました。
- PADOの loadメソッドに数値「0」が渡された時全件ロードになる問題を修正しました。
- 管理画面でサムネイルに古いブラウザキャッシュが残る問題を修正しました。
- 画像の編集後サムネイルのサイズをリアルタイムに反映するようになりました。
- グローバルモディファイア「wrap」で、文字の折返しを行単位で行うようにしました。
- query\_cache 指定があり、且つ OPcacheが有効な時、プラグインの有効無効、全般設定の保存が反映されない問題を修正しました。
- リビジョン選択モーダルからリビジョンを編集した後一覧に戻る時に元の一覧にならない問題を修正しました。
- PADO で errorHandlerがコールされた時、クエリキャッシュをクリアするようにしました。
- 環境変数「preview\_redirect」に "permalink" を指定できるようになり、管理画面と公開サイトのドメインが異なる場合の設定が簡単にできるようになりました。
- 検索インデックス作成時にサムネイル画像が取得できなかった時バイナリカラムの画像からサムネイルを作成するようになりました。
- load\_related\_objsメソッドで int型の検索カラムがidになっていなかった問題を修正しました。
- URLマップの「オブジェクトがない時アーカイブを出力しない」が正常に動作していなかった問題を修正しました。
- テーマを再適用した時、URLマップが重複する問題を修正しました。
- モデルのカラムで、浮動小数点(DOUBLE), 固定小数点(DECIMAL)をサポートしました。
- リレーションのカラム名に「color」を含む時、作成・編集画面の入力欄が input type="color" になってしまう問題を修正しました。
- jQuery におけるクロスサイトスクリプティングの脆弱性に対する対応を適用しました。

## 2019\-09\-15

version 1\.202

- 非同期・マルチスレッド処理による再構築をサポートしました。
- 環境変数「rebuild\_async」の指定のある時、最大「async\_max\_proc」で指定したスレッド数\(初期値4\)の並列処理で再構築を行います。
- 環境変数「async\_usleep」で並列処理のスタート時間をずらします\(ミリ秒\)。初期値は 20000です。
- ブラウザで「ERR\_TOO\_MANY\_REDIRECTS」など、リダイレクトの繰り返しによるエラーが表示された場合は async\_usleep の値を大きくしてください。
- 環境変数「async\_max\_proc\_time」で非同期再構築のタイムアウト秒を指定します。
- async\_max\_proc\_time 指定値\(初期値1200\)秒を超えると、画面にエラーレスポンスが返ります。ただし処理は継続しているため、結果についてはシステムログを確認してください。
- 環境変数「async\_skip」を追加しました。「rebuild\_async」の指定のある時、数値を指定すると、その時間内に発行された同一の再構築リクエストをスキップします。初期値は falseです。
- async\_max\_proc\_time と async\_skip 指定のある時、値の30% 秒\(1200の時、600秒\)以内に発行された実行中の同一の再構築リクエストをスキップします。
- 環境変数「redundancy」を追加しました。冗長化構成の時に trueを指定してください。
- プラグイン「CacheManager」を追加しました。各種キャッシュをリセットする機能を提供します。
- 再構築ウィンドウのサイズを小さくし、UIデザインを変更しました。
- URLマップ作成・編集時、インデックス以外のモデルに対応するマッピングがテンプレート・タグを含まない時、エラーとなるようにしました。
- ChromeでスコープセレクタがサイトIDと被る問題を修正しました。
- 階層のパスを出力するタグで、特定の階層のパスが出力されない問題を修正しました。
- テンプレートエンジンで変数の localize, restoreが正しく動作しない問題を修正しました。
- cleanup\_blobs タスクを廃止しました。
- CSVエクスポート/インポートで、リレーション対象が階層指定のある時「/」付きでパスをエクスポートし、正しいパスでインポートできるようになりました。
- 一部の管理画面テンプレートでコンパイルキャッシュが生成されない問題を修正しました。
- 会員サイトでサインアップ・フォームが表示されなくなっている問題を修正しました。
- 会員サイトのログインテンプレートなどでダイナミック・タグが利用できるようになりました。
- ブロックタグ「mt:nestableobject」内で、ネストした際の \_\_last\_\_が正しくセットされない問題を修正しました。
- インポート機能をメニューに表示する際、システムとスペースの判別が逆になっていた問題を修正しました。
- ダイナミック・パブリッシングで、workspace\_idが0の時、条件によってスペースのコンテキストがセットされてしまう問題を修正しました。
- 条件タグ「mt:if」で正規表現による比較を行う「match」属性がサポートされました。
- pt\-check\.php で PHPの Warningsが出力される問題を修正しました。
- エラーログにバージョン番号を追加しました。
- メールの本文を一定の文字数で折り返すようにし、メールサーバーの設定によって長い行を含むメールが文字化けする問題を修正しました。
- メールを何文字で折り返すかについては「wrap\_email」環境変数で設定を変更できます\(初期値200\)。
- フォームのメールアドレス欄にテンプレート・タグがある時、バリデーションで弾かれて保存できない問題を修正しました。
- URLマップ更新・削除時にダイナミック・タグのキャッシュをクリアするようにしました。
- モデル作成時に不要な「フォーマット」欄が表示されていた問題を修正しました。
- Mirroringプラグインで、スペースの動機を予約した時、タスク実行時にスペースのパスが取得できず同期できない問題を修正しました。
- ブロックタグ「archivelist」に urlmapping属性を指定できるようになりました。
- ダイナミック・パブリッシングで etag ヘッダーが正しくセットされない問題を修正しました。
- 管理画面の画像のサムネイルをブラウザキャッシュさせるようにしました。

## 2019\-09\-02

version 1\.200

- OPcache が有効な時の再構築パフォーマンスが大きく改善されました。
- ビューのビルドの時、テンプレートのコンパイルキャッシュファイルを利用するようにしました。
- 環境変数「trim\_tmpl」を追加しました。ビルドしたテンプレートの結果をトリミングします。
- ファンクションタグ「mt:include」で、テンプレートのコンパイルキャッシュを利用するようにしました。
- コンパイルディレクトリとキャッシュディレクトリの場所を変更しました。
- 環境変数「cache\_dir」を追加しました。
- 環境変数「cache\_driver」に"File"の指定のある時、キャッシュのフォーマットを変更しました。
- ダイナミック・パブリッシングでも、テンプレートのコンパイルキャッシュを利用するようになりました。
- 再構築時の URLモデルの保存をバルク処理に変更しました。
- モデルとプラグインの JSONファイルをキャッシュするようにしました。
- 環境変数「query\_cache」をサポートしました。データベースのクエリキャッシュをファイルキャッシュに保存することで速度向上を図ることができます。
- 環境変数「query\_cache」に「Memcached」または trueを指定できます。true指定の時は、ファイルキャッシュが利用されます。
- 一部のプラグインが有効な時、PADOのキャッシュがオフになってた問題を修正しました。
- デバッグフッタに Load Average を追加しました。
- 「tools/backupSQL\.php」を追加しました。環境変数「mysqldump\_path」「backup\_dir」の両方の指定のある時、スクリプト実行でデータベースのバックアップを保存します。
- 「tools/backupSQL\.php」では、環境変数「backup\_compress\(gzまたはzip\)」「backup\_rotate(バックアップ世代数\)」が指定可能です。
- 「tools/restoreSQL\.php」を追加しました。環境変数「mysql\_path」の指定のある時、ファイルを引数に指定してデータベースをリストアします。
- 「tools/restoreSQL\.php」の引数を省略した時は、最新のバックアップファイルが選択されます。

## 2019\-08\-29

version 1\.112

- 管理画面のコンパイルキャッシュが条件によって利用されない問題を修正しました。
- get\_scheme\_from\_db メソッドのパフォーマンスが向上しました。
- SQLの SELECT文に OFFSET値がない時、OFFSETを省略するようにしました。
- debug 有効時、スキーマアップグレード時に error.logに「PADOBaseModelException: unknown type\(relation\)」が記録される問題を修正しました。
- クラス Prototypeの get\_permalinkメソッドを最適化しました。
- ダイナミックで URLに対応するオブジェクトが存在しない時に error\.log にエラーが残る問題を修正しました。
- tools/rebuildFiles\.php を追加しました。アーカイブとファイルをすべてパブリッシュします。
- モデル「スペース\(workspace\)」に階層指定がある時、オブジェクトをループ出力するブロックタグで include\_workspaces="children"をサポートしました。
- 上記指定のある時、あわせて属性「root\_id\(省略時現在のスペース\)」「include\_this\(自身を含む\)」「depth\(階層の深さ\)」を指定できます。
- スペース管理者のナビゲーションメニューが消えてしまう問題を修正しました。
- ブロックタグ「mt:setcontext」内でオブジェクト数をカウントするタグが絞り込まれない問題を修正しました。
- ブロックタグ「mt:setcontext」内でオブジェクトのループを取得する時、余分なループが内部的に回っていた問題を修正しました。
- モデル定義の jsonファイル内の localeに指定がある時、最初のフレーズしかデータベースに登録されない問題を修正しました。
- ビューのプレビューで mime\_type が正しくセットされないことがある問題を修正しました。
- オブジェクト編集画面からののプレビューに失敗する問題を修正しました。
- urlinfoレコードの論理削除が効かなくなっていた問題を修正しました。
- class\.PTWorker\.php の実行時に PHPの max\_execution\_timeを延長する処理を追加しました。
- Websiteテーマの \.htaccessを修正しました。
- モデル「アセット」をインポート&エクスポート対象にした時、インポートでエラーとなる問題を修正しました。
- インポート処理のデータベーストランザクションが処理全体に対して張られていたのを単一オブジェクト単位としました。
- インポート機能で進捗がリアルタイムに表示されない問題を修正しました。
- エラーログの保存場所を1箇所に纏めました。
- インストールチェックで、MySQLのバージョンが 5\.6だった時の注意点についての警告メッセージを追加しました。
- CSVからのインポートで、添付ファイルなしで CSVのみをインポートした際に、ファイルのラベル\(画像の代替テキスト\)がセットされない問題を修正しました。
- CSVからのインポートで、モデル「アセット」「添付ファイル」のファイルのラベル\(画像の代替テキスト\)がセットできるようになりました。
- 会員機能の提供する画面でビューが存在する時、テンプレート変数「publish\_type」をセットセットするようにしました。
- ダイナミック・パブリッシングで $\_GET 変数が空の時「REDIRECT\_QUERY\_STRING」があれば、そこからパラメタを取得するようにしました。
- リクエストの種類に関わらず常にプラグインを読み込むようにし、フック「start\_app」「post\_run」が必ず実行されるようになりました。
- クラス PADO の loadメソッドの第3引数にカラムの配列を渡せるようになりました。
- インポート時のログのメタデータに保存される「新規」「更新」が逆になっていたのを修正しました。
- インポート時に更新と新規の件数が逆に表示される問題を修正しました。
- URLに「有効なアーカイブURL」フィルタを追加し、モデル「メニュー」からの選択時に適用するようにしました。
- リビジョン指定のないオブジェクトに対しても、更新時ログに差分を記録するようにしました。
- 更新時のログの差分情報にステータスの変更を含めるようにしました。
- ファンクションタグ「mt:websitepublishtype」を追加し、テーマの \.htaccessを変更しました。

## 2019\-08\-20

version 1\.110

- テーブル作成時の Collation設定の初期値を「utf8mb4\_general\_ci」にしました。
- db\-config\.php に PADO\_DB\_COLLATION\(テーブル作成時の Collation設定\)を指定できるようになりました。
- インストール・アップグレード時にテンプレートのコンパイルキャッシュをクリアするようにしました。
- input type="time"が4桁の数字を送信してきた時に不正な日付となる問題を修正しました。
- 記事・ページ・ウィジェットの新規作成画面でリッチエキストがドロップダウンと一致しない問題を修正しました。
- build\_page メソッドで、HTTP ヘッダーを送信済みの時、HTTP ヘッダーを再度送信しないようにしました。
- MySQLの複合インデックスをサポートし、mt\_relationテーブルと mt\_tagテーブルにインデックスを追加しました。
- クラス PADO の loadメソッドの第2引数にインデックス指定を追加するキー 'index'を追加しました。
- ブロックタグ「mt:setcontext」でタグでモデル「タグ」の loadメソッドに indexを指定するようにしました。
- モデルの編集画面で VARCHAR\(50\)カラム型をサポートし、一部のカラムに適用しました。
- モデルの編集画面でカラムの型を変更する時、データの整合性チェックを行うようにしました。
- インデックス・テンプレートが指定されているビューの編集画面から「保存と再構築」ボタンが消えていた件を修正しました。
- ビューの編集画面の「利用状況」の表内の「モデル」を「アーカイブ種別」に変更しました。
- ファンクションタグ「mt:include」内でsetvarした値がインクルード元で無効になる問題を修正しました。
- theme\.css を Minifyした theme\.min\.cssを追加し、読み込むように変更しました。
- template\_sourceコールバックでテンプレートが書き換えられた時、変更後の compileキャッシュを作成・利用するようにしました。
- 定期実行タスクで一定期間利用されていないコンパイルキャッシュをクリーンアップするようにしました。
- モデルのカラム値を取得するダイナミック・タグで管理画面で追加したカラムの値が取得できない問題を修正しました。
- スペースのスコープでシステムの再構築ボタンが表示されない問題を修正しました。
- cache\_driverに設定のある時 userモデルの cols指定を追加しました。
- 無効なプラグインの Markdownドキュメントが表示できない問題を修正しました。

## 2019\-08\-15

version 1\.109

- 一覧画面のページネーションにリストの最初と最後へのリンクを追加しました。
- debug時 loading画面の時にjQueryが読み込めない問題を修正しました。
- プレビュー時にテンプレート予約変数 publish\_typeがセットされない問題を修正しました。
- 複数選択チェックボックスのあるモデルでプレビュー時に Array to string conversion 警告が出ていた問題を修正しました。
- popup\_header\.tmplから不要な\.jsを削除しました。
- 環境変数 versionを追加し、cssの引数にバージョン・パラメタを渡すようにしました。
- 初期化時のデータベース処理において loadメソッドを load\_iterメソッドに変更し、処理速度を向上させました。
- 初期化時のデータベース処理において cols指定可能なものについて指定を追加し、処理速度を向上させました。
- PTUpgraderクラスの plugin\_modelsのコールが複数呼ばれていたのを1回に纏めました。
- プラグインが有効でない時、配下のテンプレートを認識しないように修正しました。
- モデルの jsonファイルがない時、テーブルを削除できるようにしました。
- コンパイルキャッシュが有効な時、一部のモデルの編集画面で indirect modification of overloaded property 警告が出ていた問題を修正しました。
- オブジェクトの編集画面において、画像を遅延ロードするようにしました。
- cache\_driverに Fileを指定している時、モデルの保存時にキャッシュがクリアされない問題を修正しました。
- インポート時にリレーション型カラムのラベルの「バ」「パ」の区別がされない問題を修正しました。この問題は utf8mb4\_general\_ciでは再現しません。
- 上記と同様に、ブロックタグ「mt:setcontext」にプライマリカラムの値をタグ属性で指定した時、「バ」「パ」の区別がされない可能性がある問題を修正しました。
- 一覧画面からスペース・セレクタでスコープを移動する時に offsetパラメタを引き継がないようにしました。
- IPアドレスにメモを付けられるようになりました。
- インポート及びデータ移行時 getパラメタにmagic\_tokenを付与しないようにしました。
- list\_propertyでリレーション型カラムの表示指定がテキストの時に検索が効かない問題を修正しました。

## 2019\-08\-14

version 1\.108

- アップグレード時にフレーズ、アプリの設定のキャッシュをクリアするようにしました。
- ログイン時ユーザー名の大文字小文字を区別するようになりました。
- 「always\_update\_login」指定のある時、クッキーの有効期限を常に延長するようにしました。
- プラグイン「Abs2Rel」が PHP7\.1 未満でエラーになって読み込めない問題を修正しました。
- オブジェクトの作成・編集画面で不正な日付を入力した時、エラーを返すようにしました。
- increment、decrementモディファイアを追加しました。タグ属性値に指定した数字を足し引きします。
- cache\_driverに Memcachedまたは Fileが指定されている時、再インストールできない問題を修正しました。
- input type="date" 非対応ブラウザで、jQuery UIの Datepickerを表示するようにしました。
- jQuery UI を最新版にアップデートしました。
- jQuery ver\.1系の利用を停止しました。
- ループ内で SELECT対象に含まれないカラムの値を取得できるようになりました。
- インストール画面と、loading画面のときに iframeが再帰的に呼ばれてしまう問題を修正しました。
- 環境変数「force\_compile」を追加しました。デフォルト値は falseです。
- 「force\_compile」が falseの時、管理画面のテンプレートをネイティブ PHPコードに変換したものをキャッシュします。結果として管理画面のレスポンス速度が向上します。
- 環境変数「force\_secure」を追加しました。trueの時、管理画面へ HTTPアクセスしたとき、HTTPSへリダイレクトされます。
- 環境変数「maintenance\_time」を追加しました。初期値は ["0200000000", "0500000000"] です。夜間バッチなどを実行する時間帯の範囲を指定できます。
- 日付アーカイブのコンテキストで、オブジェクト数を取得するタグが正しく動作しないケースを修正しました。
- 環境変数「memcached\_servers」を追加しました。cache\_driverに Memcached指定の時「host:port:weight」の形式で記述した文字列の配列を指定します。
- 環境変数「memcached\_servers」省略時は「localhost:11211:33」が使われます。
- リレーションエディタのダイアログにキャンセルボタンを追加しました。
- pt\-check\.php で、lftp/esctmdの実行結果を正しく判別できていなかった問題を修正しました。
- HTMLImporterのドキュメントの正規表現のサンプルを修正しました。
- 環境変数「compile\_dir」を追加しました。コンパイルキャッシュを保存するディレクトリを指定します。省略時は自動設定されます。
- クラス Prototypeに clear\_compiledメソッドを追加しました。テンプレート名を指定してコンパイルキャッシュを破棄します。
- クラス PTTags にメソッド build\_from\_compiledを追加しました。テンプレートファイルをコンパイルキャッシュを利用してビルドします。
- リッチテキストのないオブジェクトの作成・編集画面で進捗アニメーションを非表示にしました。
- モデルの jsonファイルがない時、テーブルを削除できるようになりました。

## 2019\-08\-07

version 1\.107

- 再構築ウィンドウのモデル表記を複数形に統一しました。
- 再構築ドロップダウンの「ビュー」表記を「インデックス」に変更しました。
- cache\_driverに Memcachedを指定している時、エラーになっていた問題を修正しました。
- caching 指定のある時、アプリの設定\(config\)をキャッシュするようにしました。
- caching 指定のある時、インストール済みかどうかを確認するSQLクエリを省略するようにしました。
- ファンクションタグ「mt:getoption」タグでキャッシュを利用し、不要なSQLクエリが発行されないようにしました。
- 非バッファクエリをサポートしました。環境変数「db\_use\_buffer」に falseを指定すると、PDO::MYSQL\_ATTR\_USE\_BUFFERED\_QUERYが falseに設定されます。
- オブジェクトをループ出力するタグ、関連オブジェクトの取得などのタグで、オブジェクトのload時にバイナリ/ファイル型のカラムを SELECT対象から除外して処理速度を向上させました。
- ポップアップウィンドウでの再構築処理の時、オブジェクトのload時にバイナリ/ファイル型のカラムを SELECT対象から除外して処理速度を向上させました。
- サムネイルがない時、元の画像が更新されたときのみサムネイルの生成処理を実行するようにしました。
- build\_path\_with\_map が falseを返した時、urlmapping\_id が一致するファイルのみ削除するように修正しました。
- 再構築オプションがオンデマンドの時、パラメタ付きリクエストではファイルが出力されないようにしました。
- BLOBを外部ファイル化するスクリプトで、シリアライズ済のデータがファイルに書き出されてしまう問題を修正しました。
- convertBlob2File\.php スクリプトに OPTIMIZE TABLE 処理を追加しました。
- URLMapのビルド結果が空文字のとき、再構築処理そのものをスキップするようにしました。
- HTTPSでのアクセスの時、クッキーに secureフラグを追加するようにしました。
- ログインクッキーに httponly属性を追加しました。
- HTTPヘッダに X\-XSS\-Protectionを追加しました。
- HTTPヘッダに X\-Frame\-Options を追加しました。
- Content\-typeヘッダに charset=UTF\-8 を追加しました。
- 環境変数「eval\_in\_view」を追加しました。指定のある時、リクエストが pt\-view\.php を通っている時に PHPコードを実行します。
- モデルを保存した時、テンプレート・タグのキャッシュを破棄するようにしました。
- cache\_driverに指定がない時、ファイルキャッシュデータがあるとキャッシュが使われてしまう問題を修正しました。
- 環境変数「max\_blob\_cols」を追加しました。初期値は 5です。この数を超えてモデルにバイナリ/ファイル型カラムを作成すると、画面に警告が表示されます。
- 「always\_update\_login」指定のある時、セッションの保存を10分おきに行うようにしました。

## 2019\-07\-26

version 1\.106

- プラグイン「Abs2Rel」を追加しました。HTML内のURLを相対パスに変換します。
- 環境変数「directory\_index」\(初期値: index\.html\)を追加しました。URLMapが空文字の時、Mime Type text/htmlでプレビュー結果を返します。
- グローバル・モディファイア「remove\_blank」を追加しました。空行を削除します。
- タスクによる再構築処理がプラグインによるタスクの前に必ず実行されるようになりました。
- 環境変数「always\_update\_login」が有効な時、毎回必ずセッション有効期限を延長するようにしました。
- ブロックタグ「mt:nestableobjects」でネストが深い時にループが途中で切れる問題を修正しました。
- 一覧画面の個々のオブジェクトに対する画像取得を1件に限定して表示速度を改善しました。
- システム管理者以外の権限情報をキャッシュするようにして速度を改善しました。
- インポート時に basenameを変更した時、バイナリ/ファイル型カラムの1点目のファイル名が更新されない問題を修正しました。
- 数値型リレーション・添付ファイルのファイルのクラスが正しくセットされない問題を修正しました。
- 数値型リレーション・添付ファイル、ウィジェットの背景画像をアップロードした時スタイルが崩れる問題を修正しました。
- アップロードファイルの拡張子が大文字のとき、画像の拡張子がマッチしない問題を修正しました。
- インポートファイルの第一階層にCSVファイルが含まれない時にインポートできない問題を修正しました。
- デバッグモード時のフッターに Peak memory を表示するようにしました。
- 定期実行タスクに taskにテーブルの最適化処理を追加しました。

## 2019\-07\-25

version 1\.105

- モデル「URLMapping」の mapping カラムをテキスト型に変更しました。
- カスタム権限が認識されない問題を修正しました。
- アプリケーション初期化時のいくつかのSQLクエリを最適化しました。
- 環境変数「always\_update\_login」\(初期値 true\)を追加しました。管理画面操作でセッション有効期限を延長します。
- 環境変数「performance\_logging」\(初期値 false\)を追加しました。一定時間以上再構築に時間を要したビューのログを logディレクトリに記録します。
- 環境変数「performance\_logging\_threshold」\(初期値 1\.0\)を追加しました。この数値秒以下のとき、performance\_loggingの対象外となります。
- ブロックタグ「mt:speedmeter」を追加しました。ブロックのビルド時間を計測してコメントを追記します。
- パスワード再設定\(recover\_password\)のエラーを修正しました。

## 2019\-07\-23

version 1\.103

- プラグイン「HTMLImporter」を追加しました。URL指定または ZIPファイルをアップロードしてHTMLからデータを移行する機能を提供します。
- プラグイン「Mirroring」を追加しました。LFTPを利用してウェブサイトをミラーリングする機能を提供します。最大5サーバーへの同期が可能です。
- プラグイン「Members」を追加しました。Webサイトへのログイン機能を提供します。
- プラグイン「BannedWords」を追加しました。禁止用語や表記揺れのチェック機能、文字列置換機能を提供します。
- プラグイン「SearchEstraier」を追加しました。HyperEstraierを使ってサイト内検索機能や関連ページ、お勧めページをレコメンドするAPIを利用できるようになります。
- プラグイン「ExclusionControl」を追加しました。編集画面への排他制御機能を提供します。
- プラグイン「DisplayOptions」でメニュー位置をスコープ毎に一括設定するUIを追加し、メニューの一括カスタマイズが可能になりました。
- ビューの編集画面からURLマップの作成画面をダイレクトに開くことができるようになりました。
- インストール直後のダッシュボードに「スペースの作成」「テーマのインストール」、スペースのダッシュボードに「スペース設定」「テーマの管理」ボタンを追加しました。
- リレーション/ダイアログ型のカラムで直接リレーション先のオブジェクトを作成・編集できるようになりました。
- 環境変数「import\_paths」を追加しました。インポートファイルの容量が大きい時、インポート画面で予めアップロードしたインポートファイルを選択できるようになります。
- アプリケーションディレクトリの直下に importディレクトリを追加しました。import\_pathsにデフォルトで含まれます。
- 環境変数「support\_dir」を追加しました。検索インデックスなど、ファイルを保存するディレクトリです。
- アプリケーションディレクトリの直下に supportディレクトリを追加しました。環境変数「support\_dir」を省略した時、このディレクトリが使われます。
- プラグイン一覧画面から Markdownで作成したドキュメントを表示するリンクを表示する仕組みを追加しました。
- クラス PADOBaseModel の load / load\_iter / count メソッドの第5引数に、第4引数 $extra の placeholder に対応する値の配列を指定できるようになりました。
- クラス PADOBaseModel の load / load\_iter / count メソッドの第1引数に SQL文字列を渡した時、第2引数に placeholder に対する値の配列を指定できるようになりました。
- クラス PADOBaseModel の load / load\_iter / count メソッドの第2引数 $args で JOIN, INNER JOIN, RIGHT OUTER JOIN, LEFT OUTER JOIN を指定できるようになりました。
- クラス Prototype にメソッド load\_context\_objs、load\_related\_objs を追加しました。
- プラグインの有効化 / 無効化 / アップグレードの処理内で追加処理を入れたり、エラーを返せるようになりました。
- プラグイン設定の保存時にコールバック「pre\_save\_plugin\_config」を追加しました。
- プラグインの config\.json に "email"と"committer"を追加できるようになりました。
- urlinfo テーブルに「was\_published」カラムを追加しました。1度でもディスクに吐き出されたファイルかどうかを判別するフラグです。
- was\_published が1でない URLオブジェクトを削除する時、物理削除となるように変更しました。
- tools/worker\.php の引数にタスク名を\(カンマ区切り\)指定して個別に実行できるようになりました。
- モデル名 + date 以外の日付型カラムの値を出力するファンクション・タグで formatモディファイアが利用可能になりました。
- ツールメニューをプラグインで拡張する時に condition \(表示・非表示を状況によって変更するコードを追加する\)を追加しました。
- テーブルのカラムの表示順の数値を 10刻みに変更しました。
- pt\-check\.php で file\_get\_contents の実行結果のチェックと、プラグイン関連の環境チェックを追加しました。
- PTUtil::file\_find で隠しファイルを含む・含まないを指定する第四引数を追加しました。
- PTFileMgr クラスの copyメソッドでコピーしたファイルのタイムスタンプをコピー元のファイルのタイムスタンプと同じになるようにしました。
- 環境変数「system\_info\_url」「news\_box\_url」の初期値を変更しました。
- 環境変数「publish\_callbacks」に指定のある時 templateモデルに「start\_publish」、「post\_publish」コールバックを追加しました。
- プラグインの環境変数が config\.json の指定値よりもが優先されていた問題を修正しました。
- タスク実行時に日時指定公開されたモデルのトリガーによる再構築が行われない問題を修正しました。
- モデル名に「\_」を含む時 dateタグが出力されない問題を修正しました。
- モデル名に「\_」を含む時、モデル名 + dateタグで formatモディファイアが効かない問題を修正しました。
- インポートに失敗した時、エラーが表示されないで次の処理を継続してしまう問題を修正しました。
- 「コンタクト」モデルの編集画面からメールの返信を作成できるようになりました。
- 再構築のタイムアウト対策を追加しました。
- モデル毎に再構築単位を指定できるようになりました。例えば記事の場合、環境変数「entries\_per\_rebuild」に数値を指定します。
- 管理画面ヘッダのパネルに表示するモデル数の上限を5とし、残りのモデルをドロップダウンへ移動しました。環境変数「panel\_limit」で表示数を変更できます。
- ブロックタグ「mt:tables」に limit、offsetを指定できるようになりました。
- モディファイア「preg\_quote」が追加されました。
- モデル「attachmentfile」のメニュー表示位置をシステムオブジェクトの変更しました。
- ダイアログを閉じた後、次にダイアログを開く時に以前の画面が残っていた問題を修正しました。

## 2019\-06\-19

version 1\.022

- 環境変数「unify\_breaks」\(ビルド時に改行コードを揃える\) を追加しました。
- URLMap に拡張子のない時、プレビュー時に mimt\_type が正しくセットされない問題を修正しました。
- オブジェクトの作成・編集画面で必須項目が未入力の時、添付ファイルとアセットのラベルを引き継げなかった問題を修正しました。
- SVG ファイルのエディタへの貼付け、サムネイルアイコン表示に対応しました。
- objectloop のコールバックの実行タイミングを調整しました。
- ignore\_archive\_context 指定のある時、workspace のコンテキストが変わらず効いていた問題を修正しました。
- 環境変数「panel\_width」を追加し、パネル・メニュー項目の最大幅を設定できるようになりました。
- プラグインによるタスク実行時にログを記録できるようになりました。
- 階層付きモデルのコンテキストでパンくずがが正しく出力されない問題を修正しました。
- タグを Normalizer クラスの normalizer\_normalize 関数で正規化するようにしました。
- PTListAction クラスで config object を文字列として処理してしまっていた問題を修正しました。
- テーマの不要ファイルを削除しました。
- pt\-check\.php の max\_input\_vars の計算が間違っている問題を修正しました。
- 一覧からステータス下書きにした際に warnings が発生する問題を修正しました。
- MySQLの設定によって階層付きオブジェクトを一覧から削除する時にエラーが発生するケースを修正しました。

## 2019\-06\-06

version 1\.021

- 一覧画面のフィルタ及び公開側の検索でリレーションを指定している時、存在しないリレーションが無視されていた問題を修正しました。
- リレーションでの一覧のフィルタで同一の値を渡した時に検索結果がヒットしない問題を修正しました。
- Prototypeを extendしたアプリケーションで validate\_magic メソッドが falseを返す問題を修正しました。
- DataMigratorプラグインでインポートモデルの権限チェックを追加し、権限のないモデルについて候補に表示されないようにしました。
- ユーザーのログインIPアドレスを記録するようにしました。
- ユーザーのログイン時にログを記録するようにしました。
- 環境変数「always\_update\_login」を追加しました。指定のある時、ログイン時以外の操作時もログイン時刻/IPを記録します。
- リレーション型、モデル「アセット」、タイプ「ダイアログ」としたカラムを「assets」という名前以外で作成したときに値が保存されない問題を修正しました。
- 環境変数「add\_port\_to\_url」を追加しました。falseの時、管理画面のURLの末尾にポート番号を追加しません。
- PowerCMS Xをインストール可能な環境かどうかをチェックする pt\-check\.php を追加しました。

## 2019\-05\-30

version 1\.020

- 2段階認証のメールテンプレートにパスワード再発行メールのテンプレートを選択していた問題を修正しました。
- 2段階認証の時、ユーザーの言語を反映するようにしました。
- キュー・オンデマンド再構築で正しくファイルが出力されない問題を修正しました。
- キューでの再構築の時にテンプレート変数「theme\_static」が正しくセットされない問題を修正しました。
- モデルを作成してダイアログで関連づけた時、権限がないユーザーにチェックボックスが表示されない問題を修正しました。
- 環境変数「publish\_callbacks」を追加し、指定のある時 templateモデルに「pre\_publish」、「post\_rebuild」コールバックを追加しました。
- templateモデルの「pre\_publish」コールバックで falseを返した時、ファイルの出力がスキップされます。
- 日本語ファイル名のファイルアップロード時のファイル名エンコード処理を rawurlencodeに統一しました。
- ファイルアップロード時に横並びのボタンのスタイルが崩れる問題を修正しました。
- ユーザーをアサインする設定のないオブジェクトで権限が正しく判別できないケースを修正しました。
- ダイナミック・パブリッシングの時、text/html 以外の Content\-Type ヘッダが正しくセットされない問題を修正しました。
- モデル「タグ」について、どのモデルに対するタグかを識別する「class」カラムを追加し、タグがモデル毎に保存されるようになりました。
- PADO の loadメソッドで'BINARY'指定をサポートしました。これにより、明示的に大文字小文字を区別する SELECT文が発行可能になりました。
- アイテムの一覧画面からのファイルアップロードで環境変数「upload\_size\_limit」が無視される問題を修正しました。
- 権限チェック機能と一覧画面の振る舞いについての不整合を修正しました。
- スペース管理者権限を持つユーザーがスペースの設定を編集できない問題を修正しました。
- 記事/ページモデルに extra\_pathカラムを追加し、スコープの設定画面で表示/非表示を選択できるようになりました。
- 環境変数「evel\_in\_preview」を追加し、指定のある時PHPコードのプレビューが可能になりました。
- WordPress形式のデータからの移行時にテキストフォーマットを指定できるようになりました。
- オブジェクトの作成・編集画面で公開終了日を指定するチェックを入れた時、終了日欄にフォーカスがあたるようになりました。
- プレビュー時に一時データを削除するためのJavaScriptコードが挿入されないようになりました。
- ビューのクラス選択肢に「Member」を追加しました。
- プラグインのアップグレード処理を追加する仕組みを追加しました。
- 80, 443以外のポート番号で正しく動作しない問題を修正しました。
- regex\_replace モディファイアの第三引数に counter\(置換する回数\)を指定できるようになりました。

## 2019\-05\-10

version 1\.018

- インポート&エクスポートで代替テキスト・ラベルをエクスポート・インポート可能になりました。
- get\_permalink メソッドで warningが出る問題を修正しました。
- モデルのプロパティ「ステータス」にチェックがある時、「有効期限対応」チェックなし・ありを切り替えた時に optionの値が正常にセットされない問題を修正しました。
- workspace\_idカラムのないモデルでワークフローが正しく動作しない問題を修正しました。
- ログインセッションに管理画面ユーザーと会員サイトのメンバーを識別するkeyを指定するようにしました。
- PTUtil::remove\_empty\_dirs及び remove\_dirメソッドで、アプリケーションディレクトリとサイトのルートディレクトリを削除対象外にしました。
- プレビュー時にブロックタグ「mt:breadcrumbs」が正常なパスを出力しない問題を修正しました。
- プレビュー時にテンプレートのソースが textパラメタの値に差し変わってしまう問題を修正しました。

## 2019\-05\-07

version 1\.017

- LivePreviewプラグインにおいて、スペース単位の LivePreview に対応しました。
- グローバル・モディファイア「absolute」を「relative」に変更しました。
- フォームにリッチテキストでコンテンツを追加できるようになりました。
- Websiteテーマの\.htaccessを修正しました。
- ワークスペースへのテーマ適用時にシステムのパスが適用される問題を修正しました。
- モデル名に「\_」が含まれる時、タグ名では「\_」を削除するようにし、カラム名のルールと同じにしました。
- simple\_html\_dom\.php を最新版にアップデートしました。
- スキーマ管理画面でバージョン記載のないモデルが選択できない問題を修正しました。
- スペースの作成時・エラー時の「ファイル出力」チェックボックス値が引き継がれるように修正しました。
- Prototypeクラスのプロパティ workspace\_idを追加しました。
- 会員サイト様対応用に、ユーザー関連のメソッドを一部修正しました。
- PTPluginクラスの get\_config\_valueに第3引数 inheritanceを追加しました\(workspaceに設定がない時、システムの設定をロードします\)。
- オブジェクトの作成・編集画面で、編集タイプ「日付」\(時刻指定のない年月日\)に対応しました。
- 非ログイン時に管理画面ヘッダの各ボタンを非表示になるようにしました。
- オブジェクトの作成・編集画面のリッチテキストエリアにarea\-label、placeholderを追加しました。
- オブジェクトの作成・編集画面でreorder\_fields関数の処理が終わる時にイベント「$\(document\)\.trigger\('pcmsx\.reorder\_fields\_done'\);」を追加しました。

## 2019\-04\-19

version 1\.016

- モデルの hierarchy のデフォルト値を「0」に設定し、アップグレード処理のために version を 1\.016 としました。
- プラグインにモデルのアップグレードがある時、バッジがヘッダに表示されない問題を修正しました。
- アクティビディ選択のドロップダウンの権限による絞り込みを追加しました。
- モデルのインデックス指定可能カラムのチェック対象に誤りがあったので修正しました。
- DisplayOptions プラグインでシステム管理者以外で設定が正しく反映されない問題を修正しました。
- プラグインによるコールバック処理が追加登録される問題を修正しました。
- 公開側サイトの検索フィルタからカラム status と rev\_type を除外しました。
- モデルの編集画面でカラムの「詳細」ボタンをクリックした時に画面の表示項目をリセットするようにしました。
- 「ワークフローを隠す」ボタンの表示位置を調整しました。
- ユーザー設定のない時、ラジオボタンとチェックボックスの境界線のコントラスト比を高くしました。
- 編集不可の select要素を VoiceOverで操作している時の問題を修正しました。
- ファンクションタグ「mt:gethashvar」でインデックスが0の配列要素が取得できない問題を修正しました。
- フォームのエラーメッセージが設問ごとに初期化されない問題を修正しました。
- Internet Explorer 11で getConversionRgba 関数がエラーになる問題を修正しました。
- send\_multipart\_mailで添付ファイル名を mb\_encode\_mimeheaderを通すようにしました。
- 非ログイン時\(ログイン画面など\)にフッターのコピーライトを非表示にしました\(バージョンナンバーが見える件の対策\)。

## 2019\-04\-18

version 1\.015

- 「allow\_static」, 「static\_conditional」環境変数を追加しました。
- allow\_static 指定のある時 pt\-view.php が CMS管理外の静的ファイルを返すようになります。
- debug プロパティ指定のある時、アップロード欄のスタイルが崩れる問題を修正しました。
- MySQL の sql\_mode で STRICT\_TRANS\_TABLES 指定のある時、アイテムが保存されない問題を修正しました。
- クラス PADO の PADO\_DB\_BLOB2FILE 指定のある時\(バイナリデータを外部ファイルに保存する\)の不具合を修正しました。この機能はベータ版です。
- DBカラムのプロパティ変更時に mt\_columnのレコードが正しく更新されない問題を修正しました。
- 設問の正規化設定のある時メールで濁点が文字化けする問題を修正しました。
- 同じロールを複数のスペースに割り当てた時、最後のロールだけしか有効化されない問題を修正しました。
- テーマ適用後の再構築結果がテーマによって正しくならない問題を修正しました。
- 30日以上運用している環境でアクティビティダッシュボードのグラフが正しく表示されない問題を修正しました。
- バーの配色が明るく、文字色が暗い配色の時、アクティブなメニュー文字列が白くなりコントラスト比が不足する問題を修正しました。
- スペースが存在しない時、画面左上のロゴのクリック可能なエリアが狭くなっている問題を修正しました。
- スキーマアップグレード時に「Duplicate key name\.\.\.」エラーが発生するケースの対策をしました。
- デフォルト pt\-view\.php を最新版にしました。
- スペースへのテーマ適用時にシステムルートにファイルが出力される問題を修正しました。
- ワークスペースバーを展開した時に横スクロールバーが出る問題を修正しました。
- DisplayOptions プラグインで、設定がスコープをまたがってキャッシュされる問題を修正しました。
- iOS Safariでプラグイン設定のモーダルがスクロールできない問題を修正しました。
- upload\_max\_filesizeを超えたファイルをアップロードした時のエラー処理を追加しました。
- 環境変数「developer\_mode」を「develop」に変更しました。
- PHP\_INT\_MAXが 2147483647\(32Bit版PHP\) の時に日付が正しく処理されない問題を修正しました。
- \_htaccessの設定「php_value upload\_max\_filesize」を "30M"に変更しました。
- PTUtilクラスに send\_multipart\_mail メソッドを追加しました。
- DATETIME型のカラムのバリデーションを強化しました。
- アクティビティウィジェットが表示されている時特定の画面サイズで画面がチラつく問題を修正しました。
- フォームに「データベースに保存しない」オプションを追加しました。
- フォームへの投稿の添付ファイルをメールに添付できるようになりました。
- コンタクトの編集画面で添付ファイルの表示が崩れていたのを修正しました。
- モデルの編集画面でインデックスを指定できないタイプのカラムにインデックス指定できないように修正しました。

## 2019\-04\-03

version 1\.014

- カスタマイズした設問タイプで設問を保存するとフィールド数欄・コネクタ欄が表示されない問題を修正しました。
- ヘッダーのワークスペース名が長い時の見栄えを整えるため幅を調整しました。
- 再構築ウィンドウのUIを改良しました。
- 再構築処理の際に不要な処理をスキップして若干の高速化を実現しました。
- モディファイア regex\_replace で後方参照が正しく動作しない問題を修正しました。$1などを指定する際は直前にバックスラッシュ「\\」を付けてください。
- mt:varタグで「request\.」から始まるクエリ取得の動作を改良しました。
- グループ機能の対象モデルを「テンプレート・タグ」にチェックのあるモデルを対象にしました。

## 2019\-03\-27

version 1\.013

- モデルに「ベースネームの重複を許可」設定項目を追加しました。
- ベースネームの重複を許可設定されている時、パーマリンクの重複がなければ設定したベースネームがそのまま使われます。
- ベースネームの重複を許可設定されている時、パーマリンクの重複があれば、これまでと同じルールでリネームされます。
- TinyMCEプラグインの設定に「高度な設定」を追加しました。
- MySQLデータベースの SSL接続\(PDO::MYSQL\_ATTR\_SSL\_CA\)をサポートしました。
- プラグイン「HTML\_CodeSniffer」の検証結果の翻訳漏れを修正しました。
- モデル「グループ」のオブジェクト作成画面で、モデル選択ドロップダウンに何も出ない問題を修正しました。
- 環境変数「model\_paths」を追加しました。指定したディレクトリにモデルの定義ファイル\(json\)を設置することができます。
- 環境変数「tmpl\_paths」を追加しました。指定したディレクトリに代替テンプレートを設置することができます。
- mt:transタグの component属性指定でプラグインのlocaleを利用できるようになりました。
- フォームの保存時「メールを送信する」にチェックがない時、メールアドレスのチェックをスキップするようにしました。
- デバッグモード有効時のフッターのデバッグエリア画面表示を改善しました。
- config\.jsonでのディレクトリ・パスの指定方法を揃えました。tmpl\_paths、plugin\_paths、theme\_paths、model\_pathsの4つが対象です。
- これらの環境変数は、すべて配列でフルパス指定、ディレクトリの末尾には DIRECTORY\_SEPARATOR を含まずに指定してください。
- 環境変数「log\_path」を「log\_dir」に変更しました。
- ファンクションタグ「mt:getregistry」を追加しました。タグ属性 registry / id / keyを指定して値を取得します。
- インストール時にバーの配色を登録するようにしました。
- 無効なプラグインの tmpl / alt-tmplディレクトリのテンプレートを読み込んでしまう問題を修正しました。
- boilerplate モデルが有効化されていない時、オブジェクトの作成・編集画面で errorログが残る問題を修正しました。
- プラグイン管理画面でスキーマアップグレードのメニューのバッジが表示されない問題を修正しました。
- プラグイン管理画面でプラグインがない時の表示を調整しました。

## 2019\-03\-13

version 1\.012

- モデル編集画面で翻訳漏れがあったのを修正しました。
- オブジェクトの編集画面で、削除時の Confirmメッセージへのアクションを待たずにオブジェクトが削除される問題を修正しました。
- regex\_replace モディファイアおよび replaceモディファイアに渡した属性値の変数が展開されない問題を修正しました。
- 日付アーカイブ以外のコンテナ指定のある URLマップで「オブジェクトがない時アーカイブを出力しない」オプションを追加しました。
- 上記のケースで非ログインユーザーに出力されていないアーカイブが見える問題を修正しました。
- LivePreviewプラグイン設定をデフォルトで承認待ちを含むように変更しました。
- URLMappingのカラムの Index名「publish\_file」が重複していたのを修正しました。
- ダイナミック・パブリッシングで、theme\_staticディレクトリのパスが正しく出力されない問題を修正しました。
- モデル名とかラム名に数字を利用している時、数字付きのテンプレート・タグが登録されない問題を修正しました。
- リレーション型のカラムの名前とラベルが異なる時、ラベル名でのブロックタグも利用できるようになりました。

## 2019\-02\-26

version 1\.011

- メールヘッダ「Return\-Path」を環境変数「mail\_return\_path」で設定できるようになりました。
- メールヘッダの文字エンコーディングを環境変数「mail\_encording」で指定できるようになりました。
- PTUtil::encode\_mimeheaderメソッドを追加しました。
- プラグインディレクトリとテーマディレクトリを複数指定できるようになりました。環境変数「plugin\_paths」「theme\_paths」に配列でパスを指定します。
- 上書き防止のため config\.json を config\.json\-original\.json にリネームしました。
- アプリケーションディレクトリをシンボリックリンクに設定できるようになりました。
- テーマのインストール時にテンプレートが正しくコンパイルされない問題を修正しました。
- PADOBaseModelの予約プロパティのキーを追加しました。
- 出力結果のハッシュ値比較の際、更新されているのにファイルが出力されないケースを修正しました。
- テーマのインストール時にフォームの URLが出力されない問題を修正しました。
- リストのフィルタ選択済みの時にフィルタが変更できない問題を修正しました。
- Chrome以外のブラウザでデータ移行画面が正しく表示されない問題を修正しました。
- 特定条件下で一覧のフィルタ削除時にパラメタが引き継がれない問題を修正しました。
- テーマの chache\_keyタグ属性のスペルミスを修正しました。
- テーマの Main Page マークアップを修正しました。

## 2019\-02\-12

version 1\.010

- バージョン番号を1\.010に変更しました。

## 2019\-02\-05

version 1\.009

- テーマの CSSを修正しました。
- ダイアログを閉じるボタンに翻訳漏れがあったのを修正しました。

## 2019\-01\-29

version 1\.008

- プラグイン「EntryImporter」は廃止され、「DataMigrator」プラグインに変更されました。EntryImporterが存在する場合は削除してください。
- 上記プラグインでは、entryモデル\(記事\)の他、page\(ページ\)モデルへのインポートが可能になりました。
- 「DataMigrator」プラグインでは、外部プラグインで独自のデータ移行処理を追加できます。
- ブロックタグ「mt:setvartemplate」タグを利用している時、コンパイルキャッシュが使われない問題を修正しました。
- ブロックタグ「mt:setvartemplate」タグを利用している時、出力結果にゴミが残る問題を修正しました。
- 階層付きオブジェクトのパスを取得するテンプレート・タグで、親オブジェクトが正しくロードされない問題を修正しました。
- メニューのカラー設定がリンクテキスト、ドロップダウンメニューやボタンに反映されない問題を修正しました。
- メニューのカラー設定をフッターにも適用しました。
- 軽量化・高速化のために管理画面のモデルの読み込みを必要なカラムのみにしました。
- カラム「cache\_key」をリビジョン対象から除外しました。
- 新規ユーザー作成時のステータスドロップダウンの初期値を「有効」にしました。

## 2019\-01\-23

version 1\.007

- 再構築処理でプリ・コンパイルされたテンプレートが利用されていなかった問題を修正しました。
- テンプレートマップのマッピングをプリ・コンパイルするようにしました。
- 上記2点の修正と改良により、再構築パフォーマンスが50%近く改善しました。
- フィールドの「電話番号\(セパレート\)」の input type をnumから tel に修正しました。
- Text\_Diff\_Engine_nativeで「Calling assert\(\) with a string argument is deprecated\.」警告が出ていた問題を修正しました。
- 管理画面でモデルのバージョン指定のある時、アップグレードを抑止できるようになりました。
- バイナリ/ファイル型カラムのファイル変更時古いURLオブジェクトが残る問題を修正しました。
- LivePreview中にウィッジェットの管理画面の背景画像が差しかわる問題を修正しました。
- LivePreview中にブラウザキャッシュを使わせないように変更しました。
- 「widget」モデルの最大画像サイズを設定しました。

## 2019\-01\-16

version 1\.006

- 環境変数「app\_path」指定のある時に、フォームからのメール送信でテンプレート変数「script\_uri」が正しくセットされない問題を修正しました。
- スペース管理者の権限がある時にヘッダのメニューが正しくフィルタリングされない問題を修正しました。
- システムスコープの一覧画面で、スペース毎のステータスとユーザーIDによるフィルタリングが正しく効くようになりました。
- ロールを修正した時、対象ユーザーの権限のキャッシュがクリアされないケースがある件を修正しました。
- モデル「table」のカラム「hierarchy」の初期値を「0」にしました。
- 一覧画面のオブジェクトのチェックボックス表示を権限と連動させました。
- 一覧画面で権限があるのに削除ボタンが非表示になるケースを修正しました。

## 2019\-01\-15

version 1\.005

- スペース管理者がオブジェクトを作成できない\(ボタンが表示されない\)問題を修正しました。
- 「URL」モデルの「delete\_flag」フィールドをデフォルトでリスト表示対象にしました。
- 「ユーザー」モデルのステータスの初期値を「有効\(1\)」にしました。
- フィールド\(フィールド\)機能をサポートしました。
- グローバルモディファイア「default」を追加しました。値が空の時、指定した属性値を出力します。
- データベースのオブジェクトを var\_dump した時、key => value の配列形式で値を出力するようにしました。
- 削除フラグ\(delete\_flag\)指定のある URLInfoオブジェクトがエクスポートに失敗する問題を修正しました。

## 2019\-01\-10

version 1\.004

- オブジェクトのリスト・フィルタで、複数のリレーションを条件にしている時に複数のフィルタが効かない問題を修正しました。
- relation型の擬似カラムに not\_null指定したオブジェクトが保存できない問題を修正しました。
- Websiteテーマの \.htaccessを修正しました。
- エディタへの画像・ファイル挿入ダイアログの順序入れ替えがキーボード操作可能になりました。
- バイナリ/ファイル型のカラムが空の時、URLタグで動的URLが出力される問題を修正しました。
- Websiteテーマの widgetの背景画像が空の時、動的URLが出力される問題を修正しました。
- ユニークなカラムの検索対象を同一スコープのオブジェクトに限定しました。
- ダイナミック・パブリッシングで複数のスコープに同一URLが存在する時、異なる URLがロードされるケースがある問題を修正しました。
- オブジェクトの作成・編集画面の画面オプションに「ドラッグ&ドロップでフィールドの表示順を変更できます。」のヒント記述を追加しました。
- user\_idがないモデルで、作成権限のあるユーザーが既存のオブジェクトを更新できない点を修正しました。
- DisplayOptionsの指定がある時、権限のないモデルがメニューに表示される問題を修正しました。

## 2019\-01\-07

version 1\.003

- Websiteテーマに「\(Website\) Pagination」モジュールを追加しました。
- Websiteテーマに prism\.js / prism\.css を追加しました。
- ファンクション・タグ「mt:archvetitle」で日付が正しく処理されない問題を修正しました。
- 年度別アーカイブが 1ファイルしか再構築されない問題を修正しました。
- ユーザー作成・編集画面の「入力欄の境界色」の初期値を修正しました。
- エディタへの画像\(ファイル\)挿入時、ダイアログのページ送りをクリックするとパラメタが引き継がれない問題を修正しました。
- CSVインポートの時に存在しない workspace\_id 値が指定されている時、現在のスコープに対してインポートを行うようにしました。
- CSVインポートの時に添付ファイル/アセットが存在しない時に warnings が記録される問題を修正しました。
- editor\.css に table関連のスタイルを追加しました。
- \.htaccess に PHP設定 upload\_max\_filesize\(8M\) を追加しました。
- システムスコープのオブジェクトの一覧画面で、「作成」権限が正しくセットされない問題を修正しました。
- オブジェクトを「リビジョンとして保存」した時、ステータスを下書きにするようにしました。
- アクティビティのグラフからリビジョン数を除外するようにしました。
- PTPlugin クラスに set\_config\_valueメソッドを追加しました。
- システムおよびワークスペースの「設定画面」の言語設定のドロップダウンが翻訳されていない問題を修正しました。
- モデルの編集画面で「Allow Comments」チェックボックスを非表示にしました。
- アクティビティのグラフの凡例のテキストを修正しました。
- データベースの port番号が 3306でない時に、データベース接続できない問題を修正しました。
- サーバー変数 DOCUMENT\_ROOT が「/」で終わっている時に CSS/JS ファイルへのリンクが切れる問題を修正しました。
- ドキュメント\(ユーザーガイド\)を更新しました。

## 2018\-12\-21

version 1\.002

- 一覧画面のチェックボックスの aria\-labelの値がエスケープされていなかった問題を修正しました。
- 管理画面からのオブジェクトの複製時、basename、status、audit関連カラムの値を初期化するようにしました。
- ブロックタグ「mt:breadcrumbs」タグで親オブジェクトがない時に警告が出ていた問題を修正しました。
- ブロックタグ「mt:loop」タグで sort\_by タグ属性指定が効いていなかった問題を修正しました。
- ドキュメントの jQueryバージョンが間違っていたのを修正しました\(v3\.2\.1\)。
- ドキュメントのタグ属性のCSV区切り文字が「:」になっていたのを「,」に修正しました。
- 再構築ポップアップウィンドウのサイズを調整しました。
- バイナリ/ファイルタイプのカラムに NOT NULL を指定した時、オブジェクトの保存時に必須チェックがパスされてしまっていた問題を修正しました。
- グローバル・モディファイア encode\_php を追加しました。
- グローバル・モディファイア encode\_xml、メソッド escape\('xml'\)が正しく動作していなかった問題を修正しました。
- グローバル・モディファイア escape の属性値に「js」「xml」「php」が新しく指定可能になりました。
- 画像サムネイルの有無ついて、オブジェクトの Diffの対象外となるようにしました。
- Websiteテーマの \.htaccess で、ErrorDocumentのパスが正しくない問題を修正しました。
- URLInfoオブジェクトが論理削除された時、同一URLのオブジェクトが存在する時は物理削除するようにしました。
- URLMappingモデルの編集画面におけるラベルをPowerCMS互換に変更、ラベル「モデル」を「アーカイブ種別」に、モデルの選択肢「ビュー」を「インデックス」に変更しました。
- ワークフロー設定時にオブジェクトの新規作成時、ステータス変更時に不要なアラートが表示される問題を修正しました。
- アイテム挿入時にチェックボックスがキーボード操作できない問題を修正しました。
- ブロックタグ「mt:sethashvars」ファンクションタグ「mt:gethashvar」タグを追加しました。
- 環境変数「temp\_dir」の初期値を「/tmp」に変更しました。
- 記事/ページの編集画面で、エラーの際に本文が引き継がれない問題を修正しました。
- 標準関数 eachが非推奨になったことによる Text/Diffのエラーを修正しました。
- テーマの CSSを修正しました。

## 2018\-12\-06

version 1\.0013

- \(公開側ページの\)一覧画面に limit/offset パラメタを指定したとき、ページネーションが有効になるようになりました。
- 外部プレビューのための設定がオブジクトの編集画面に表示されない問題を修正しました。
- 時限公開・差し替え処理の実行時に、再構築トリガーが処理されない問題を修正しました。
- workspace\_id が nullのレコードの値を「0」にセットするアップグレード処理を追加しました。
- 問い合わせフォーム以外の URLマップのファイル出力を「ダイナミック」から「静的」に変更しました。
- pageモデルのスキーマバージョンをバージョンアップしました。
- スタティックなページへのリクエストにパラメタがついている時、または GET以外のリクエストの時、動的処理が通るように修正しました。
- テーマの一覧画面にサムネイルを追加しました。

## 2018\-12\-05

version 1\.0012

- フォーム機能でメール From, Cc, Bccを指定できるようになりました。
- 存在しないカラムを sortのキーに指定した時にエラーになる問題を修正しました。
- プレビューで urlmappingが読み込めていない時、エラーを吐いて HTMLがそのまま表示される問題を修正しました。
- 標準関数 eachが非推奨になったことによる Text/Diffのエラーを修正しました。
- テーマの \.htaccess が、ビューから出力された pt\-view\.phpを参照するように修正されました。
- ライブプレビュー時に、リビジョンのファイルの URLが出力されない問題を修正しました。
- テーマに metaタグ\(description, keywords\)を追加しました。
- テンプレートのビルド時にコンパイル済みキャッシュが使われていないケースがある問題を修正しました。
- 特定条件下における Objectをループ出力するブロックタグの処理速度を向上しました。
- オブジェクトのカウントタグが正しい数字を返さないケースに対する修正を行いました。

## 2018\-12\-03

version 1\.001

- 新規インストール時に\(タイムアウト対策のため\)進捗を表示するようになりました。
- 再構築の最初のリクエスト時にインジケーターを表示するようにしました。
- オブジェクトのカウントタグがコンテキストによって取得できない問題を修正しました。
- テーマにウィジェットの2カラム表示モジュールを追加しました。
- ウィジェット内の a要素に対する CSSを追加しました。
- テーマに \.htaccessと pt-view\.phpを追加しました。
- ファンクションタグ「mt:phpstart」「mt:phpend」を追加しました。
- フォームの設問で値の連結設定をしている時に、値が空欄の時バリデーション処理でエラーになる問題を修正しました。
- ビューの編集画面で、画面幅を狭くした時にパーマリンク横の「ビュー」リンクが消える問題を修正しました。
- URLマップに「優先」カラムを追加しました。同一モデルに複数のマッピングが存在する時、優先指定のあるマッピングがパーマリンクに使われます。
- 特定の条件下で、ダイナミック・パブリッシングで正常にページが返されるのにステータスが404になる点を修正しました。
- フォーム投稿時のメール送信処理で、テンプレートモジュールが正常にロードできない問題を修正しました。
- オブジェクトの保存時や再構築時に、pre\_listingコールバックの処理をスキップするようにしました。
- 再構築処理時に未公開のオブジェクトをスキップするようにしました。
- 上記の関係で、オブジェクトのインポート時に、非公開オブジェクトの再構築処理が走るようになりました。
- 404テンプレートで、workspaceコンテキストが正しくセットされない点を修正しました。
- テーマの 404テンプレートを1カラムレイアウトに変更しました。
- 新規オブジェクト作成時に、meta, relationのロード処理が走っていた問題を修正しました。
- テンプレートのキャッシュ機能を有効にしている時、トークンが必要なフォームの投稿がエラーになる問題を修正しました。

## 2018\-11\-25

version 1\.00

- テーマのエクスポート機能、インポート機能を追加しました。
- デフォルトのテーマ「Website」を追加しました。
- サイトマップのツリー表示で、サブフォルダよりもフォルダ直下のオブジェクトを上部に表示できるようにしました。
- スキーマ画面管理・プラグイン管理画面がキーボード操作できない問題を修正しました。
- オブジェクトの編集画面から、オブジェクトが削除できない問題を修正しました。
- メニューオブジェクトのループ出力後に、該当するオブジェクトのプライマリカラム、IDカラム以外のカラム値が空のままキャッシュされてしまう問題を修正しました。
- 別のオブジェクトのコンテキストをセットしたとき、アーカイブオブジェクトのパーマリンクが取得できない問題を修正しました。
- モデルの設定画面でフォームを追加できるようになりました。
- 「ビュー」にフォームを追加しました。
- ファンクションタグ「mt:websitename」「mt:websiteurl」「mt:websitelanguage」「mt:websiteid」「mt:websitecopyright」「mt:websitedescription」を追加しました。
- ファンクションタグ「mt:hex2rgba」を追加しました。hex指定された色指定を rgba形式に変換します。
- グローバルモディファイア「language\(「ja」などの言語を指定して翻訳\)」「\_eval\(evalとの違いは、\{\{mt:タグ名\}\}形式の記述が利用できる点\)」を追加しました。
- workspace\_id カラムの値が nullの時、システムスコープのビューでオブジェクトの一覧が取得できない問題を修正しました。
- 階層付きオブジェクトが workspace\_id カラムを持つとき、システムスコープではシステムスコープのオブジェクトのみが一覧表示されるようになりました。
- 再構築トリガーがオブジェクトの削除処理の際に処理されない問題を修正しました。
- システム設定に、システムの説明\(description\)を登録できるようになりました。
- スペース設定に、コピーライト\(copyright\)を登録できるようになりました。
- システム設定に、すべてのユーザーのログインにIPアドレス制限が設定できるようになりました。
- システム設定に「許可されたIPアドレスをロックしない」設定が追加されました。
- 設問タイプのマークアップが、tableマークアップに変更され、テーマ「Website」に合わせたクラス名が付与されるようになりました。
- ブロックタグ「mt:if」に「tag」モディファイアを指定したとき、eq、likeなどの比較演算子が使えるようになりました。
- フォームの管理者への通知メールが、投稿者のメールアドレスに送信されてしまう問題を修正しました。
- ダイナミック・パブリッシングにおいて、不要な SQLクエリが発行されていた問題を修正しました。
- workspace\_idなど、いくつかの数値型のカラムの初期値を NULLから0に修正しました。
- オブジェクトのループ出力、階層表示、リレーション型のカラムを出力するブロックタグで「cols」モディファイア\(SELECT対象のカラム名のカンマ区切り\)が指定できるようになりました。
- id, status, workspace\_idカラムのあるオブジェクトでは「cols」モディファイアに、これらのカラムが自動的に追加されます。
- 「ページ」に対する「フォルダ」、「記事」に対する「カテゴリ」の CSVインポート/エクスポートにおける処理を改良しました。
- 新規インストール時に sessionレコードを取得しに行ってログに warnings が記録される問題を修正しました。
- LivePreview 時に オブジェクトのループ出力のブロックタグの include\_draft モディファイアが効かない問題を修正しました。
- mtsetcontextブロックタグ内で、元のオブジェクトのカラム値を取得するファンクションタグの値が空になる問題を修正しました。
- テンプレート変数「current\_archive\_model」と「current\_object\_id」をセットするようになりました。
- フォームに「model」「object\_id」パエメタを渡すことで、コンタクトの対象オブジェクトをセットできるようになりました。
- フォームに「identifier」パラメタを渡せるようになりました。
- publish\_obj メソッドで、dependencies\(依存オブジェクトの再構築\)をデフォルトでオフにしました。
- フォームのトークンの有効期限が切れた時、もしくはトークンが無効の時、エラー画面にならない問題を修正しました。
- 「ビュー」の編集画面の表示レスポンスを改善しました。
- 「mtinclude」を含む「ビュー」の編集画面の表示の際に httpd の負荷が上がり、表示に時間がかかる問題を修正しました。
- ドキュメント\(ユーザーガイド\)を更新しました。

## 2018\-11\-12

version 0\.99

- URLマップの作成・編集画面で URLマップが静的生成もしくはオンデマンドの時、再構築トリガーを設定できるようになりました。
- システムスコープの URLマップで「コンテナ」のスコープにスペースのオブジェクトを含まない設定ができるようになりました。
- 「entry」「category」モデルのオブジェクトがシステムスコープに作成できるようになりました。
- 「page」「folder」「widget」モデルを新しく追加しました。
- オブジェクトの作成・編集画面で、数値+階層型のカラムのレイアウトを調整しました。
- システムとワークスペースに作成できるオブジェクトの一覧画面について、「表示順」「階層」指定のあるモデルについては、同一スコープのオブジェクトのみの一覧を表示するようになりました。
- オブジェクトの作成・編集画面で「リレーション」「階層」を指定している時、同一スコープのオブジェクトのみを階層表示するようになりました。
- モデルの編集画面でカラムの「詳細」ダイアログで、\(システムが生成するカラム以外の\)文字列型、数値型、真偽値型のカラムの初期値を設定できるようになりました。
- モデルの設定で「アセット(アセットモデルのリレーション型のカラム)」を作成できるようになりました。通常の関連付けのほか、エディタへの貼り付けで関連アセットが追加されます。
- モデル「記事」にリレーション\(1対多\)型のカラム「アセット」を追加しました。
- URLマップで1対1のリレーションを設定しているモデルを「コンテナ」に指定できるようになりました。
- PHP設定の max\_input\_varsの推奨値より小さな値が設定されている時、モデルの編集画面に警告を表示するようになりました。
- 一覧画面のチェックボックスのアクセシビリティを改善しました\(キーボード操作対応とラベルの付与\)。
- URLの一覧画面ですべてを選択するチェックボックスのラベルで件数が正しくない数字になることがある点を修正しました。
- 「Directory」の翻訳フレーズを「フォルダ」から「ディレクトリ」に変更しました。
- モデル'queue'は今後標準モデルとして追加の可能性があるため、予約名としました。
- 「entry」「page」「widget」モデルで、テキストフォーマットの初期値を選択できるようになりました。
- ツリー表示でディレクトリにアイテムがない時、ログにエラーが残る問題を修正しました。
- リレーション\(1対多\)型のカラムを削除した時、該当する mt\_relationレコードを削除するようになりました。
- システムスコープの URLの一覧からワークスペース配下の URLの物理削除ができない問題を修正しました。
- 論理削除済みの URLに該当するアーカイブの再構築で、同一 URLの URLオブジェクトが生成されてしまう問題を修正しました。
- 「自分のオブジェクト」のみに権限が割り当てられている時、ファイル型のカラムに対する アップロードが 権限エラーになる問題を修正しました。
- ハンバーガーメニューのコントラストを改善しました。
- 階層指定のあるモデルの新規作成画面で、親を選択するとエラーで保存できない問題を修正しました。
- ファンクションタグ「mt:assetproperty」が正しい値を返さない問題を修正しました。
- フォームの「Text Input Group」でコネクタの出力をした際に、以降の設問でもコネクタが出力されてしまう問題を修正しました。
- PTUtil::object\_diff メソッドが一部のカラムをスキップしてしまう問題を修正しました。
- 管理者ログイン用のIPアドレスが登録できない問題を修正しました。
- Smarty互換テンプレート記法はサポート対象外となりました。
- ドキュメント\(ユーザーガイド\)を更新しました。

## 2018\-11\-07

version 0\.98

- インストール時にエラーログが記録される点を修正しました。
- スマートフォンで管理画面を利用した時のレイアウトを調整しました。
- オブジェクトの値に絵文字を含められるようになりました。保存できない、または表示できない時は、環境変数「set\_names」に trueを指定してください。
- ブロックタグ「mt:nestableobjects」および、リレーションを出力するブロックタグが LivePreviewに対応しました。
- 「メニュー」モデルを追加し、ブロックタグ「mt:menuitems」タグを追加しました。タグは LivePreviewに対応しています。
- これにより、階層付き、任意の並び順のメニューを作成できるようになりました。
- モデルをエクスポートする時、hide\_edit\_options指定のないモデルで warningが発生していた点を修正しました。
- 階層を持つオブジェクトの親に子オブジェクトを指定した時、あるいはルートオブジェクトが存在しなくなってしまう時、エラーを出すようにしました。
- また、階層を持つオブジェクトの編集画面で、子オブジェクトを親に指定できなくなりました。
- 環境変数「password\_letternum\(パスワードに英数字両方を含む\)」を追加しました。
- 環境変数「password\_upperlower\(パスワードに英字大文字小文字両方を含む\)」を追加しました。
- 環境変数「password\_symbol\(パスワードに記号を含む\)」を追加しました。
- 環境変数「password\_min\(パスワードの必要文字数\)」を追加しました。
- TinyMCEプラグインで、メニューバーがカスタマイズできるようになりました。
- ドキュメント\(ユーザーガイド\)を更新しました。

## 2018\-11\-06

version0\.97

- 新規インストール時に mt\_sessionテーブルが生成されない問題を修正しました。
- ビューのソースが空の時に、タグパーサがエラーを出していた問題を修正しました。
- 1対1のリレーションの時、タッチデバイスでサムネイルが拡大表示できない問題を修正しました。
- 新規インストール時の「ビュー」のメニュータイプをお気に入り\(Favorites\)に変更しました。

## 2018\-11\-05

version0\.96

- リッチテキストエディタ\(TinyMCE\)のバージョンを4\.8\.5にバージョンアップしました。
- TinyMCEプラグイン設定で、モバイルモードの使用を選択できるようになりました。
- サイトマップのツリーでサブフォルダが存在する時にURLが取得できていなかった点を修正しました。
- ダイナミック・パブリッシングで、URLマップのコンテナが正しくセットされなかった点を修正しました。
- ブロックタグ「mt:archivelist」が日別アーカイブをサポートしました。
- ブロックタグ「mt:setcontext」タグを追加しました。
- オブジェクトの作成・編集画面でリレーション型のカラム・階層のときの表示レイアウトを調整しました。
- サイトマップのツリーで、権限のない未公開のURLをツリーから除外するようになりました。
- フォーム機能で CSRF対策用の セッションがフォーム投稿後も残る問題を修正しました。
- ビューの compiledカラムをリビジョンの差分対象外としました。
- ダッシュボードウィジェットのドラッグできる領域をウィジェットのヘッダ部分に限定しました。
- ドキュメント\(ユーザーガイド\)を更新しました。

## 2018\-10\-31

version0\.95

- モデル「ビュー」のプレビューで warningが発生していた点を修正しました。
- モデル「ビュー」の編集画面で「保存と再構築」ボタンをクリックして保存した時、再構築されない問題を修正しました。
- フォームの確認画面が表示できない点を修正しました。
- ブロックタグ「mt:calendar」を追加しました。
- 日別アーカイブをサポートしました。
- 日付ベースアーカイブの時、URLオブジェクトの archive\_typeが空になっていた点を修正しました。
- リッチテキストへの画像挿入時に、オリジナルの幅と高さを表示するようにしました。
- 作成・編集画面でリレーション\(複数選択ダイアログの時\)の選択済み要素をドラッグして順番を入れ替えた時、バッジのマージンがなくなる問題を修正しました。
- ドラッグ&ドロップで順番を入れ替え可能な要素\(一覧画面の表示順入れ替えを除く\)がキーボード操作でも順序を入れ替えられるようになりました。
- 一部のフォームコントロールでフォーカスインジケーターが非表示になる問題を修正しました。

## 2018\-10\-30

version0\.94

- URLオブジェクトのアクション「URLのリセット」を追加しました。
- URLオブジェクトのアクション「物理削除」でオブジェクトが物理削除されない問題を修正しました。
- 一覧画面からのアクション実行時に、アクションが適用されているのに「対象の\(モデル名\)がありません。」と表示されることがある問題を修正しました。
- アセットの一覧画面からファイルをアップロードした時、warningが発生し、アップロードファイルサイズのチェックが正しく働いていなかった点を修正しました。
- アセットの一覧画面から日本語などマルチバイトのファイル名のファイルをアップロードした時、ラベルが URLエンコードされてしまう問題を修正しました。
- 権限チェックのコードで「すべてのオブジェクト\(update\_all\)」が割り当てられているのに falseを返すことがある問題を修正しました。
- リレーション型のカラムにアセット\(asset\)モデルを指定している時、権限のあるユーザーはアセットのラベルを編集できるようになりました。
- ダイナミック・パブリッシングの時、「URL」「対象のモデル」「ビュー」のうち最も新しいオブジェクトの更新タイムスタンプをブラウザキャッシュの利用基準としました。
- ExternalPreviewプラグインのプラグイン設定の編集画面のUIを改良しました。
- UUIDカラムがない時またはURLが発行されていない時に ExternalPreviewプラグインによる\(編集画面のボタンや日付欄など\)UIを非表示にしました。
- リレーションカラム名に\_などの英数文字以外の記号を含む時、テンプレート・タグが正しく認識されない問題を修正しました。
- データに更新がない時も、URLオブジェクトの最終更新日時が更新されてしまう問題を修正しました。
- ExternalPreviewプラグインによるプレビューに対応させるため、entryモデルと assetモデルにUUIDカラムを追加\(復活\)しました。
- 環境変数 build\_one\_by\_oneがセットされている時、正しい内容・正しいパスにファイルがパブリッシュされない問題を修正しました。

version0\.93

## 2018\-10\-29

- db\-config\.php\-original\.txt を db\-config\.php\-original\.php にリネームしました。
- CMSと公開サイトのドメインが異なるとき、公開サイトにログインできる機能を追加しました。
- 非公開のオブジェクトが非ログインユーザーに見えてしまうケースがある問題を修正しました。
- 上記の機能追加により、CMSと公開サイトのドメインが異なるときにログインユーザーが非公開URLを確認できるようになりました。
- 同様にCMSと公開サイトのドメインが異なるときに LivePreviewによる未来日のウェブサイトの確認ができるようになりました。
- オブジェクト名\+Next、Previousブロックタグにタグ属性 rebuild="1" 指定で\(オブジェクトの保存時の再構築に限り\)前後のオブジェクトを再構築するようになりました。
- 記事・アセットの公開日・非公開日が正しく保存されない問題を修正しました。
- アップグレード処理のタイムアウト時間を延ばしました。
- URLの一覧画面で、検索結果が正しい結果を返さない問題を修正しました。
- インポート機能で、アップロードファイルがインポート前に削除されてしまう問題を修正しました。
- プラグイン「EntryImporter」でインポートの進捗が画面に出力されない問題を修正しました。

version0\.92

## 2018\-10\-25

- 【重要】db\-config\.phpの定数名が変更になりました。各定数の先頭に「PADO\_」を追加してください。
- db\-config\.php を db\-config\.php\-original\.txt にリネームしました。
- データベースのスキーマアップグレードをダッシュボードとバッジで知らせるようになりました。
- アクティビティ・ダッシュボードウィジェットが特定のウィンドウサイズでちらつく問題を解消しました。
- MySQLの設定で ONLY\_FULL\_GROUP\_BYが指定されている時、アクティビティ・ダッシュボードがエラーになる点を修正しました。
- アクティビティ・ダッシュボードのグラフが公開日・作成日ベースから更新日ベースに変更されました。
- 最初のインストール時にログを記録するようになりました。
- Internet Explorer 11でオブジェクトの保存が重複する問題を修正しました。
- Internet Explorer 11 / Microsoft Edgeで一部の画面が崩れる問題を修正しました。
- 一部のモーダル画面が iOS・Safariでスクロールできない問題を修正しました。
- ビューの編集画面のテンプレート・タグの構文チェックで閉じタグがあるのに見つからないエラーとなる点を修正しました。
- ビューの編集画面のテンプレート・タグの構文チェックのエラーメッセージを翻訳しました。
- 一覧画面での「階層の管理」ボタンを画面幅が狭い時にアイコン表示になるようにしました。
- ステータスを公開に変更して保存した時に不要なリビジョン・添付ファイルが生成される問題を解消しました。
- お知らせをダッシュボードに追加し、バージョンアップ情報などをダッシュボードで確認できるようになりました。
- 「イベントとニュース」ダッシュボードを追加しました。
- インポートや worker\.phpなど、多くの処理を実行する際にメモリ不足となる可能性がある点を解消しました。
- また、これらの多くの処理を実行する際に PHPのタイムアウトを延長できるようにしました\(デフォルト3600秒\)。
- ウィジェットのデフォルト表示順をプラグインなどで指定できるようになりました。
- テンプレート変数 app\_version で、バージョン情報を取得できるようにしました。
- インストール時のアプリ名、コピーライトの初期値を設定済みにしました。
- 環境変数 image\_qualityで、サムネイルなどを作成する際の画像圧縮率を数値指定\(デフォルト60\)できるようになりました\(0\(最低品質\)〜100\(最高品質\)\)。
- 環境変数 error\_document404で、エラーページのパスを指定できるようになりました。
- アイテムの新規作成画面でラベル欄が空の時、アップロード時にファイル名をラベル欄にセットするようにしました。
- モデル「記事」のデフォルトカラム「og\_image」は削除されました。後から追加することはできます。
- デバッグモードが有効の時、モーダルダイアログや管理画面のページ下部が隠れてしまう点を修正しました。
- フォームの確認画面で設問タイプ「チェックボックス」のフォーム項目が常にチェックされた表示となる問題を修正しました。

version0\.91

## 2018\-10\-23

- 【重要】db\-config\.json\.cgiは セキュリティの観点から db\-config\.phpに変更されました。後方互換性は維持されています。
- ビューの編集画面でテンプレート・タグの構文チェックを行えるようになりました。
- ビューの編集画面で CodeMirrorのシンタックスハイライトにテンプレート・タグが対応していない点を修正しました。
- アクティビティ・ダッシュボードウィジェットで任意のモデルを選択できるようになりました。
- MySQLデータベースのテーブル圧縮に対応しました。
- 直列型ワークフローが設定されている時のUIを改善しました。
- テンプレート\(ビュー\)のインライン変数はサポート外になりました。
- ワークスペースのツールバーをユーザー設定で画面上部に固定できるようになりました。
- 画面幅を狭めた時もワークスペースのセレクタが常時表示されるようになりました。
- CSVからのインポート速度が高速化されました。
- モデルへの添付ファイル機能が追加されました。
- ファイルアップロードオプション\(画像サイズ、最大容量\)の設定が可能になりました。
- カスタム・設問タイプのクラス指定が可能になりました。
- モデルのメニュータイプ「お気に入り\(Favorites\)」が追加されました。
- URLオブジェクト\(urlinfoモデル\)を論理削除するように変更しました。
- デフォルトのモデルからUUIDカラムを削除しました。後から追加は可能です。
- デバッグモードが有効の時、デバッグ表示エリアの大きさをマウスドラッグで変更できるようになりました。
- ドキュメント\(ユーザーガイド\)を更新しました。
